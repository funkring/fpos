!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(g,j,f){function h(e,k){if(!j[e]){if(!g[e]){var i="function"==typeof require&&require;if(!k&&i){return i(e,!0)}if(d){return d(e,!0)}var m=new Error("Cannot find module '"+e+"'");throw m.code="MODULE_NOT_FOUND",m}var l=j[e]={exports:{}};g[e][0].call(l.exports,function(o){var p=g[e][1][o];return h(p?p:o)},l,l.exports,a,g,j,f)}return j[e].exports}for(var d="function"==typeof require&&require,c=0;c<f.length;c++){h(f[c])}return h}({1:[function(f,c,g){function d(h){return function(){var e=arguments.length;if(e){for(var j=[],i=-1;++i<e;){j[i]=arguments[i]}return h.call(this,j)}return h.call(this,[])}}c.exports=d},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var s=arguments,p=this.useColors;if(s[0]=(p?"%c":"")+this.namespace+(p?" %c":" ")+s[0]+(p?"%c ":" ")+"+"+f.humanize(this.diff),!p){return s}var q="color: "+this.color;s=[s[0],q,"color: inherit"].concat(Array.prototype.slice.call(s,1));var u=0,n=0;return s[0].replace(/%[a-z%]/g,function(i){"%%"!==i&&(u++,"%c"===i&&(n=u))}),s.splice(n,0,q),s}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(n){try{null==n?f.storage.removeItem("debug"):f.storage.debug=n}catch(i){}}function m(){var n;try{n=f.storage.debug}catch(i){}return n}function k(){try{return window.localStorage}catch(i){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(i){return JSON.stringify(i)},f.enable(m())},{3:3}],3:[function(l,v,h){function d(){return h.colors[k++%h.colors.length]}function g(n){function f(){}function r(){var B=r,z=+new Date,y=z-(m||z);B.diff=y,B.prev=m,B.curr=z,m=z,null==B.useColors&&(B.useColors=h.useColors()),null==B.color&&B.useColors&&(B.color=d());var o=Array.prototype.slice.call(arguments);o[0]=h.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var A=0;o[0]=o[0].replace(/%([a-z%])/g,function(s,u){if("%%"===s){return s}A++;var C=h.formatters[u];if("function"==typeof C){var e=o[A];s=C.call(B,e),o.splice(A,1),A--}return s}),"function"==typeof h.formatArgs&&(o=h.formatArgs.apply(B,o));var x=r.log||h.log||console.log.bind(console);x.apply(B,o)}f.enabled=!1,r.enabled=!0;var c=h.enabled(n)?r:f;return c.namespace=n,c}function j(i){h.save(i);for(var c=(i||"").split(/[\s,]+/),f=c.length,n=0;f>n;n++){c[n]&&(i=c[n].replace(/\*/g,".*?"),"-"===i[0]?h.skips.push(new RegExp("^"+i.substr(1)+"$")):h.names.push(new RegExp("^"+i+"$")))}}function p(){h.enable("")}function w(i){var c,f;for(c=0,f=h.skips.length;f>c;c++){if(h.skips[c].test(i)){return !1}}for(c=0,f=h.names.length;f>c;c++){if(h.names[c].test(i)){return !0}}return !1}function q(c){return c instanceof Error?c.stack||c.message:c}h=v.exports=g,h.coerce=q,h.disable=p,h.enable=j,h.enabled=w,h.humanize=l(9),h.names=[],h.skips=[],h.formatters={};var m,k=0},{9:9}],4:[function(j,f,l){function h(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(i){return"function"==typeof i}function d(i){return"number"==typeof i}function c(i){return"object"==typeof i&&null!==i}function g(i){return void 0===i}f.exports=h,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._maxListeners=void 0,h.defaultMaxListeners=10,h.prototype.setMaxListeners=function(i){if(!d(i)||0>i||isNaN(i)){throw TypeError("n must be a positive number")}return this._maxListeners=i,this},h.prototype.emit=function(s){var p,w,q,o,m,v;if(this._events||(this._events={}),"error"===s&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if(p=arguments[1],p instanceof Error){throw p}throw TypeError('Uncaught, unspecified "error" event.')}if(w=this._events[s],g(w)){return !1}if(k(w)){switch(arguments.length){case 1:w.call(this);break;case 2:w.call(this,arguments[1]);break;case 3:w.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),w.apply(this,o)}}else{if(c(w)){for(o=Array.prototype.slice.call(arguments,1),v=w.slice(),q=v.length,m=0;q>m;m++){v[m].apply(this,o)}}}return !0},h.prototype.addListener=function(m,i){var o;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?c(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,c(this._events[m])&&!this._events[m].warned&&(o=g(this._maxListeners)?h.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[m].length>o&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},h.prototype.on=h.prototype.addListener,h.prototype.once=function(o,i){function p(){this.removeListener(o,p),m||(m=!0,i.apply(this,arguments))}if(!k(i)){throw TypeError("listener must be a function")}var m=!1;return p.listener=i,this.on(o,p),this},h.prototype.removeListener=function(u,o){var v,q,m,p;if(!k(o)){throw TypeError("listener must be a function")}if(!this._events||!this._events[u]){return this}if(v=this._events[u],m=v.length,q=-1,v===o||k(v.listener)&&v.listener===o){delete this._events[u],this._events.removeListener&&this.emit("removeListener",u,o)}else{if(c(v)){for(p=m;p-->0;){if(v[p]===o||v[p].listener&&v[p].listener===o){q=p;break}}if(0>q){return this}1===v.length?(v.length=0,delete this._events[u]):v.splice(q,1),this._events.removeListener&&this.emit("removeListener",u,o)}}return this},h.prototype.removeAllListeners=function(m){var i,o;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(o=this._events[m],k(o)){this.removeListener(m,o)}else{if(o){for(;o.length;){this.removeListener(m,o[o.length-1])}}}return delete this._events[m],this},h.prototype.listeners=function(m){var i;return i=this._events&&this._events[m]?k(this._events[m])?[this._events[m]]:this._events[m].slice():[]},h.prototype.listenerCount=function(m){if(this._events){var i=this._events[m];if(k(i)){return 1}if(i){return i.length}}return 0},h.listenerCount=function(m,i){return m.listenerCount(i)}},{}],5:[function(d,c,f){(function(q){function j(){p=!0;for(var l,i,o=k.length;o;){for(i=k,k=[],l=-1;++l<o;){i[l]()}o=k.length}p=!1}function g(i){1!==k.push(i)||p||h()}var h,m=q.MutationObserver||q.WebKitMutationObserver;if(m){var v=0,x=new m(j),w=q.document.createTextNode("");x.observe(w,{characterData:!0}),h=function(){w.data=v=++v%2}}else{if(q.setImmediate||"undefined"==typeof q.MessageChannel){h="document" in q&&"onreadystatechange" in q.document.createElement("script")?function(){var e=q.document.createElement("script");e.onreadystatechange=function(){j(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},q.document.documentElement.appendChild(e)}:function(){setTimeout(j,0)}}else{var t=new q.MessageChannel;t.port1.onmessage=j,h=function(){t.port2.postMessage(0)}}}var p,k=[];c.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(d,c,f){"function"==typeof Object.create?c.exports=function(h,g){h.super_=g,h.prototype=Object.create(g.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:c.exports=function(h,g){h.super_=g;var i=function(){};i.prototype=g.prototype,h.prototype=new i,h.prototype.constructor=h}},{}],7:[function(d,c,f){(function(g){g("object"==typeof f?f:this)}).call(this,function(i){var g=Array.prototype.slice,j=Array.prototype.forEach,h=function(k){if("object"!=typeof k){throw k+" is not an object"}var l=g.call(arguments,1);return j.call(l,function(e){if(e){for(var m in e){"object"==typeof e[m]&&k[m]?h.call(k,k[m],e[m]):k[m]=e[m]}}}),k};i.extend=h})},{}],8:[function(H,q,B){function x(){}function A(c){if("function"!=typeof c){throw new TypeError("resolver must be a function")}this.state=C,this.queue=[],this.outcome=void 0,c!==x&&k(this,c)}function E(d,c,f){this.promise=d,"function"==typeof c&&(this.onFulfilled=c,this.callFulfilled=this.otherCallFulfilled),"function"==typeof f&&(this.onRejected=f,this.callRejected=this.otherCallRejected)}function K(d,c,f){z(function(){var e;try{e=c(f)}catch(h){return j.reject(d,h)}e===d?j.reject(d,new TypeError("Cannot resolve promise with itself")):j.resolve(d,e)})}function w(d){var c=d&&d.then;return d&&"object"==typeof d&&"function"==typeof c?function(){c.apply(d,arguments)}:void 0}function k(l,f){function p(e){d||(d=!0,j.reject(l,e))}function h(e){d||(d=!0,j.resolve(l,e))}function m(){f(h,p)}var d=!1,c=J(m);"error"===c.status&&p(c.value)}function J(f,c){var h={};try{h.value=f(c),h.status="success"}catch(d){h.status="error",h.value=d}return h}function G(c){return c instanceof this?c:j.resolve(new this(x),c)}function D(d){var c=new this(x);return j.reject(c,d)}function I(l){function v(n,c){function i(o){p[c]=o,++y!==d||h||(h=!0,j.resolve(m,p))}f.resolve(n).then(i,function(o){h||(h=!0,j.reject(m,o))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var d=l.length,h=!1;if(!d){return this.resolve([])}for(var p=new Array(d),y=0,r=-1,m=new this(x);++r<d;){v(l[r],r)}return m}function F(l){function f(i){p.resolve(i).then(function(n){d||(d=!0,j.resolve(h,n))},function(n){d||(d=!0,j.reject(h,n))})}var p=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var m=l.length,d=!1;if(!m){return this.resolve([])}for(var c=-1,h=new this(x);++c<m;){f(l[c])}return h}var z=H(5),j={},g=["REJECTED"],L=["FULFILLED"],C=["PENDING"];q.exports=B=A,A.prototype["catch"]=function(c){return this.then(null,c)},A.prototype.then=function(d,c){if("function"!=typeof d&&this.state===L||"function"!=typeof c&&this.state===g){return this}var h=new this.constructor(x);if(this.state!==C){var f=this.state===L?d:c;K(h,f,this.outcome)}else{this.queue.push(new E(h,d,c))}return h},E.prototype.callFulfilled=function(c){j.resolve(this.promise,c)},E.prototype.otherCallFulfilled=function(c){K(this.promise,this.onFulfilled,c)},E.prototype.callRejected=function(c){j.reject(this.promise,c)},E.prototype.otherCallRejected=function(c){K(this.promise,this.onRejected,c)},j.resolve=function(h,d){var m=J(w,d);if("error"===m.status){return j.reject(h,m.value)}var f=m.value;if(f){k(h,f)}else{h.state=L,h.outcome=d;for(var l=-1,c=h.queue.length;++l<c;){h.queue[l].callFulfilled(d)}}return h},j.reject=function(f,c){f.state=g,f.outcome=c;for(var h=-1,d=f.queue.length;++h<d;){f.queue[h].callRejected(c)}return f},B.resolve=G,B.reject=D,B.all=I,B.race=F},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var c=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(c){var l=parseFloat(c[1]),f=(c[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(c){return c>=m?Math.round(c/m)+"d":c>=q?Math.round(c/q)+"h":c>=w?Math.round(c/w)+"m":c>=y?Math.round(c/y)+"s":c+"ms"}function k(c){return v(c,m,"day")||v(c,q,"hour")||v(c,w,"minute")||v(c,y,"second")||c+" ms"}function v(f,c,i){return c>f?void 0:1.5*c>f?Math.floor(f/c)+" "+i:Math.ceil(f/c)+" "+i+"s"}var y=1000,w=60*y,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,c){return c=c||{},"string"==typeof f?d(f):c["long"]?k(f):g(f)}},{}],10:[function(y,D,m){function g(n){if(null!==n){switch(typeof n){case"boolean":return n?1:0;case"number":return x(n);case"string":return n.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var f=Array.isArray(n),l=f?n:Object.keys(n),p=-1,d=l.length,c="";if(f){for(;++p<d;){c+=m.toIndexableString(l[p])}}else{for(;++p<d;){var h=l[p];c+=m.toIndexableString(h)+m.toIndexableString(n[h])}}return c}}return""}function k(p,I){var h,d=I,f="1"===p[I];if(f){h=0,I++}else{var l="0"===p[I];I++;var G="",J=p.substring(I,I+z),H=parseInt(J,10)+q;for(l&&(H=-H),I+=z;;){var F=p[I];if("\x00"===F){break}G+=F,I++}G=G.split("."),h=1===G.length?parseInt(G,10):parseFloat(G[0]+"."+G[1]),l&&(h-=10),0!==H&&(h=parseFloat(h+"e"+H))}return{num:h,length:I-d}}function v(l,f){var s=l.pop();if(f.length){var h=f[f.length-1];s===h.element&&(f.pop(),h=f[f.length-1]);var p=h.element,d=h.index;if(Array.isArray(p)){p.push(s)}else{if(d===l.length-2){var c=l.pop();p[c]=s}else{l.push(s)}}}}function B(h,d){for(var f=Math.min(h.length,d.length),l=0;f>l;l++){var c=m.collate(h[l],d[l]);if(0!==c){return c}}return h.length===d.length?0:h.length>d.length?1:-1}function E(d,c){return d===c?0:d>c?1:-1}function C(n,f){for(var l=Object.keys(n),p=Object.keys(f),d=Math.min(l.length,p.length),c=0;d>c;c++){var h=m.collate(l[c],p[c]);if(0!==h){return h}if(h=m.collate(n[l[c]],f[p[c]]),0!==h){return h}}return l.length===p.length?0:l.length>p.length?1:-1}function A(d){var c=["boolean","number","string","object"],f=c.indexOf(typeof d);return ~f?null===d?1:Array.isArray(d)?5:3>f?f+2:f+3:Array.isArray(d)?5:void 0}function x(l){if(0===l){return"1"}var G=l.toExponential().split(/e\+?/),f=parseInt(G[1],10),c=0>l,d=c?"0":"2",h=(c?-f:f)-q,p=j.padLeft(h.toString(),"0",z);d+=w+p;var H=Math.abs(parseFloat(G[0]));c&&(H=10-H);var F=H.toFixed(20);return F=F.replace(/\.?0+$/,""),d+=w+F}var q=-324,z=3,w="",j=y(11);m.collate=function(f,c){if(f===c){return 0}f=m.normalizeKey(f),c=m.normalizeKey(c);var d=A(f),h=A(c);if(d-h!==0){return d-h}if(null===f){return 0}switch(typeof f){case"number":return f-c;case"boolean":return f===c?0:c>f?-1:1;case"string":return E(f,c)}return Array.isArray(f)?B(f,c):C(f,c)},m.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var f=l;if(Array.isArray(l)){var h=l.length;l=new Array(h);for(var n=0;h>n;n++){l[n]=m.normalizeKey(f[n])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var d in f){if(f.hasOwnProperty(d)){var c=f[d];"undefined"!=typeof c&&(l[d]=m.normalizeKey(c))}}}}}return l},m.toIndexableString=function(d){var c="\x00";return d=m.normalizeKey(d),A(d)+w+g(d)+c},m.parseIndexableString=function(p){for(var I=[],h=[],d=0;;){var G=p[d++];if("\x00"!==G){switch(G){case"1":I.push(null);break;case"2":I.push("1"===p[d]),d++;break;case"3":var J=k(p,d);I.push(J.num),d+=J.length;break;case"4":for(var H="";;){var F=p[d];if("\x00"===F){break}H+=F,d++}H=H.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),I.push(H);break;case"5":var o={element:[],index:I.length};I.push(o.element),h.push(o);break;case"6":var i={element:{},index:I.length};I.push(i.element),h.push(i);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+G)}}else{if(1===I.length){return I.pop()}v(I,h)}}}},{11:11}],11:[function(f,c,g){function d(j,h,l){for(var i="",k=l-j.length;i.length<k;){i+=h}return i}g.padLeft=function(i,h,k){var j=d(i,h,k);return j+i},g.padRight=function(i,h,k){var j=d(i,h,k);return i+j},g.stringLexCompare=function(m,k){var q,l=m.length,p=k.length;for(q=0;l>q;q++){if(q===p){return 1}var j=m.charAt(q),h=k.charAt(q);if(j!==h){return h>j?-1:1}}return p>l?-1:0},g.intToDecimalForm=function(j){var h=0>j,k="";do{var i=h?-Math.ceil(j%10):Math.floor(j%10);k=i+k,j=h?Math.ceil(j/10):Math.floor(j/10)}while(j);return h&&"0"!==k&&(k="-"+k),k}},{}],12:[function(f,c,h){function d(){this.store={}}function g(j){if(this.store=new d,j&&Array.isArray(j)){for(var i=0,k=j.length;k>i;i++){this.add(j[i])}}}h.Map=d,h.Set=g,d.prototype.mangle=function(i){if("string"!=typeof i){throw new TypeError("key must be a string but Got "+i)}return"$"+i},d.prototype.unmangle=function(i){return i.substring(1)},d.prototype.get=function(j){var i=this.mangle(j);return i in this.store?this.store[i]:void 0},d.prototype.set=function(j,i){var k=this.mangle(j);return this.store[k]=i,!0},d.prototype.has=function(j){var i=this.mangle(j);return i in this.store},d.prototype["delete"]=function(j){var i=this.mangle(j);return i in this.store?(delete this.store[i],!0):!1},d.prototype.forEach=function(m){for(var k=Object.keys(this.store),q=0,l=k.length;l>q;q++){var p=k[q],j=this.store[p];p=this.unmangle(p),m(j,p)}},g.prototype.add=function(i){return this.store.set(i,!0)},g.prototype.has=function(i){return this.store.has(i)},g.prototype["delete"]=function(i){return this.store["delete"](i)}},{}],13:[function(p,x,h){function d(){m=!1,y.length?q=y.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var c=q.length;c;){for(y=q,q=[];++j<c;){y&&y[j].run()}j=-1,c=q.length}y=null,m=!1,clearTimeout(f)}}function k(f,c){this.fun=f,this.array=c}function v(){}var y,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var c=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){c[i-1]=arguments[i]}}q.push(new k(f,c)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(c){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(c){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(d,c,f){(function(){var g={}.hasOwnProperty,h=[].slice;c.exports=function(k,m){var n,j,e,l;j=[],l=[];for(n in m){g.call(m,n)&&(e=m[n],"this"!==n&&(j.push(n),l.push(e)))}return Function.apply(null,h.call(j).concat([k])).apply(m["this"],l)}}).call(this)},{}],15:[function(c,e,d){!function(g){if("object"==typeof d){e.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(J){function w(l,g,p,h,m,f){return g=H(H(g,l),H(h,f)),H(g<<m|g>>>32-m,p)}function C(m,t,l,p,g,f,h){return w(t&l|~t&p,m,t,g,f,h)}function z(m,t,l,p,g,f,h){return w(t&p|l&~p,m,t,g,f,h)}function B(m,t,l,p,g,f,h){return w(t^l^p,m,t,g,f,h)}function F(m,t,l,p,g,f,h){return w(l^(t|~p),m,t,g,f,h)}function N(l,h){var f=l[0],i=l[1],g=l[2],m=l[3];f=C(f,i,g,m,h[0],7,-680876936),m=C(m,f,i,g,h[1],12,-389564586),g=C(g,m,f,i,h[2],17,606105819),i=C(i,g,m,f,h[3],22,-1044525330),f=C(f,i,g,m,h[4],7,-176418897),m=C(m,f,i,g,h[5],12,1200080426),g=C(g,m,f,i,h[6],17,-1473231341),i=C(i,g,m,f,h[7],22,-45705983),f=C(f,i,g,m,h[8],7,1770035416),m=C(m,f,i,g,h[9],12,-1958414417),g=C(g,m,f,i,h[10],17,-42063),i=C(i,g,m,f,h[11],22,-1990404162),f=C(f,i,g,m,h[12],7,1804603682),m=C(m,f,i,g,h[13],12,-40341101),g=C(g,m,f,i,h[14],17,-1502002290),i=C(i,g,m,f,h[15],22,1236535329),f=z(f,i,g,m,h[1],5,-165796510),m=z(m,f,i,g,h[6],9,-1069501632),g=z(g,m,f,i,h[11],14,643717713),i=z(i,g,m,f,h[0],20,-373897302),f=z(f,i,g,m,h[5],5,-701558691),m=z(m,f,i,g,h[10],9,38016083),g=z(g,m,f,i,h[15],14,-660478335),i=z(i,g,m,f,h[4],20,-405537848),f=z(f,i,g,m,h[9],5,568446438),m=z(m,f,i,g,h[14],9,-1019803690),g=z(g,m,f,i,h[3],14,-187363961),i=z(i,g,m,f,h[8],20,1163531501),f=z(f,i,g,m,h[13],5,-1444681467),m=z(m,f,i,g,h[2],9,-51403784),g=z(g,m,f,i,h[7],14,1735328473),i=z(i,g,m,f,h[12],20,-1926607734),f=B(f,i,g,m,h[5],4,-378558),m=B(m,f,i,g,h[8],11,-2022574463),g=B(g,m,f,i,h[11],16,1839030562),i=B(i,g,m,f,h[14],23,-35309556),f=B(f,i,g,m,h[1],4,-1530992060),m=B(m,f,i,g,h[4],11,1272893353),g=B(g,m,f,i,h[7],16,-155497632),i=B(i,g,m,f,h[10],23,-1094730640),f=B(f,i,g,m,h[13],4,681279174),m=B(m,f,i,g,h[0],11,-358537222),g=B(g,m,f,i,h[3],16,-722521979),i=B(i,g,m,f,h[6],23,76029189),f=B(f,i,g,m,h[9],4,-640364487),m=B(m,f,i,g,h[12],11,-421815835),g=B(g,m,f,i,h[15],16,530742520),i=B(i,g,m,f,h[2],23,-995338651),f=F(f,i,g,m,h[0],6,-198630844),m=F(m,f,i,g,h[7],10,1126891415),g=F(g,m,f,i,h[14],15,-1416354905),i=F(i,g,m,f,h[5],21,-57434055),f=F(f,i,g,m,h[12],6,1700485571),m=F(m,f,i,g,h[3],10,-1894986606),g=F(g,m,f,i,h[10],15,-1051523),i=F(i,g,m,f,h[1],21,-2054922799),f=F(f,i,g,m,h[8],6,1873313359),m=F(m,f,i,g,h[15],10,-30611744),g=F(g,m,f,i,h[6],15,-1560198380),i=F(i,g,m,f,h[13],21,1309151649),f=F(f,i,g,m,h[4],6,-145523070),m=F(m,f,i,g,h[11],10,-1120210379),g=F(g,m,f,i,h[2],15,718787259),i=F(i,g,m,f,h[9],21,-343485551),l[0]=H(f,l[0]),l[1]=H(i,l[1]),l[2]=H(g,l[2]),l[3]=H(m,l[3])}function x(g){var f,h=[];for(f=0;64>f;f+=4){h[f>>2]=g.charCodeAt(f)+(g.charCodeAt(f+1)<<8)+(g.charCodeAt(f+2)<<16)+(g.charCodeAt(f+3)<<24)}return h}function q(g){var f,h=[];for(f=0;64>f;f+=4){h[f>>2]=g[f]+(g[f+1]<<8)+(g[f+2]<<16)+(g[f+3]<<24)}return h}function L(s){var P,l,g,h,m,y,v=s.length,p=[1732584193,-271733879,-1732584194,271733878];for(P=64;v>=P;P+=64){N(p,x(s.substring(P-64,P)))}for(s=s.substring(P-64),l=s.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P=0;l>P;P+=1){g[P>>2]|=s.charCodeAt(P)<<(P%4<<3)}if(g[P>>2]|=128<<(P%4<<3),P>55){for(N(p,g),P=0;16>P;P+=1){g[P]=0}}return h=8*v,h=h.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),y=parseInt(h[1],16)||0,g[14]=m,g[15]=y,N(p,g),p}function I(u){var y,l,g,h,m,P,v=u.length,p=[1732584193,-271733879,-1732584194,271733878];for(y=64;v>=y;y+=64){N(p,q(u.subarray(y-64,y)))}for(u=v>y-64?u.subarray(y-64):new Uint8Array(0),l=u.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=0;l>y;y+=1){g[y>>2]|=u[y]<<(y%4<<3)}if(g[y>>2]|=128<<(y%4<<3),y>55){for(N(p,g),y=0;16>y;y+=1){g[y]=0}}return h=8*v,h=h.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),P=parseInt(h[1],16)||0,g[14]=m,g[15]=P,N(p,g),p}function E(g){var f,h="";for(f=0;4>f;f+=1){h+=M[g>>8*f+4&15]+M[g>>8*f&15]}return h}function K(g){var f;for(f=0;f<g.length;f+=1){g[f]=E(g[f])}return g.join("")}function G(f){return/[\u0080-\uFFFF]/.test(f)&&(f=unescape(encodeURIComponent(f))),f}function A(l,g){var p,h=l.length,m=new ArrayBuffer(h),f=new Uint8Array(m);for(p=0;h>p;p+=1){f[p]=l.charCodeAt(p)}return g?f:m}function k(f){return String.fromCharCode.apply(null,new Uint8Array(f))}function j(h,f,i){var g=new Uint8Array(h.byteLength+f.byteLength);return g.set(new Uint8Array(h)),g.set(new Uint8Array(f),h.byteLength),i?g:g.buffer}function O(h){var f,i=[],g=h.length;for(f=0;g-1>f;f+=2){i.push(parseInt(h.substr(f,2),16))}return String.fromCharCode.apply(String,i)}function D(){this.reset()}var H=function(g,f){return g+f&4294967295},M=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==K(L("hello"))&&(H=function(h,f){var i=(65535&h)+(65535&f),g=(h>>16)+(f>>16)+(i>>16);return g<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function f(h,g){return h=0|h||0,0>h?Math.max(h+g,0):Math.min(h,g)}ArrayBuffer.prototype.slice=function(l,g){var h,m,v,P,y=this.byteLength,t=f(l,y),p=y;return g!==J&&(p=f(g,y)),t>p?new ArrayBuffer(0):(h=p-t,m=new ArrayBuffer(h),v=new Uint8Array(m),P=new Uint8Array(this,t,h),v.set(P),m)}}(),D.prototype.append=function(f){return this.appendBinary(G(f)),this},D.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var f,h=this._buff.length;for(f=64;h>=f;f+=64){N(this._hash,x(this._buff.substring(f-64,f)))}return this._buff=this._buff.substring(f-64),this},D.prototype.end=function(l){var g,p,h=this._buff,m=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;m>g;g+=1){f[g>>2]|=h.charCodeAt(g)<<(g%4<<3)}return this._finish(f,m),p=K(this._hash),l&&(p=O(p)),this.reset(),p},D.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},D.prototype.setState=function(f){return this._buff=f.buff,this._length=f.length,this._hash=f.hash,this},D.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},D.prototype._finish=function(l,g){var p,h,m,f=g;if(l[f>>2]|=128<<(f%4<<3),f>55){for(N(this._hash,l),f=0;16>f;f+=1){l[f]=0}}p=8*this._length,p=p.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(p[2],16),m=parseInt(p[1],16)||0,l[14]=h,l[15]=m,N(this._hash,l)},D.hash=function(g,f){return D.hashBinary(G(g),f)},D.hashBinary=function(h,f){var i=L(h),g=K(i);return f?O(g):g},D.ArrayBuffer=function(){this.reset()},D.ArrayBuffer.prototype.append=function(h){var f,i=j(this._buff.buffer,h,!0),g=i.length;for(this._length+=h.byteLength,f=64;g>=f;f+=64){N(this._hash,q(i.subarray(f-64,f)))}return this._buff=g>f-64?new Uint8Array(i.buffer.slice(f-64)):new Uint8Array(0),this},D.ArrayBuffer.prototype.end=function(l){var g,p,h=this._buff,m=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;m>g;g+=1){f[g>>2]|=h[g]<<(g%4<<3)}return this._finish(f,m),p=K(this._hash),l&&(p=O(p)),this.reset(),p},D.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.ArrayBuffer.prototype.getState=function(){var f=D.prototype.getState.call(this);return f.buff=k(f.buff),f},D.ArrayBuffer.prototype.setState=function(f){return f.buff=A(f.buff,!0),D.prototype.setState.call(this,f)},D.ArrayBuffer.prototype.destroy=D.prototype.destroy,D.ArrayBuffer.prototype._finish=D.prototype._finish,D.ArrayBuffer.hash=function(h,f){var i=I(new Uint8Array(h)),g=K(i);return f?O(g):g},D})},{}],16:[function(f,c,g){function d(m,k,q){var l=q[q.length-1];m===l.element&&(q.pop(),l=q[q.length-1]);var p=l.element,j=l.index;if(Array.isArray(p)){p.push(m)}else{if(j===k.length-2){var h=k.pop();p[h]=m}else{k.push(m)}}}g.stringify=function(x){var C=[];C.push({obj:x});for(var m,j,k,q,A,D,B,z,w,p,y,v="";m=C.pop();){if(j=m.obj,k=m.prefix||"",q=m.val||"",v+=k,q){v+=q}else{if("object"!=typeof j){v+="undefined"==typeof j?null:JSON.stringify(j)}else{if(null===j){v+="null"}else{if(Array.isArray(j)){for(C.push({val:"]"}),A=j.length-1;A>=0;A--){D=0===A?"":",",C.push({obj:j[A],prefix:D})}C.push({val:"["})}else{B=[];for(z in j){j.hasOwnProperty(z)&&B.push(z)}for(C.push({val:"}"}),A=B.length-1;A>=0;A--){w=B[A],p=j[w],y=A>0?",":"",y+=JSON.stringify(w)+":",C.push({obj:p,prefix:y})}C.push({val:"{"})}}}}}return v},g.parse=function(v){for(var A,k,j,p,y,B,z,x,r,m=[],w=[],q=0;;){if(A=v[q++],"}"!==A&&"]"!==A&&"undefined"!=typeof A){switch(A){case" ":case"	":case"\n":case":":case",":break;case"n":q+=3,d(null,m,w);break;case"t":q+=3,d(!0,m,w);break;case"f":q+=4,d(!1,m,w);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(k="",q--;;){if(j=v[q++],!/[\d\.\-e\+]/.test(j)){q--;break}k+=j}d(parseFloat(k),m,w);break;case'"':for(p="",y=void 0,B=0;;){if(z=v[q++],'"'===z&&("\\"!==y||B%2!==1)){break}p+=z,y=z,"\\"===y?B++:B=0}d(JSON.parse('"'+p+'"'),m,w);break;case"[":x={element:[],index:m.length},m.push(x.element),w.push(x);break;case"{":r={element:{},index:m.length},m.push(r.element),w.push(r);break;default:throw new Error("unexpectedly reached end of input: "+A)}}else{if(1===m.length){return m.pop()}d(m.pop(),m,w)}}}},{}],17:[function(d,c,f){(function(ex,ep){function ev(k,h){k=k||[],h=h||{};try{return new Blob(k,h)}catch(m){if("TypeError"!==m.name){throw m}for(var j="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,l=new j,g=0;g<k.length;g+=1){l.append(k[g])}return l.getBlob(h.type)}}function eE(h,g){if("undefined"==typeof FileReader){return g((new FileReaderSync).readAsArrayBuffer(h))}var i=new FileReader;i.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);g(k)},i.readAsArrayBuffer(h)}function eO(){for(var i={},g=new b0(function(k,l){i.resolve=k,i.reject=l}),j=new Array(arguments.length),h=0;h<j.length;h++){j[h]=arguments[h]}return i.promise=g,b0.resolve().then(function(){return fetch.apply(null,j)}).then(function(k){i.resolve(k)})["catch"](function(k){i.reject(k)}),i}function el(k,h){var m,j,l,i=new Headers,g={method:k.method,credentials:"include",headers:i};return k.json&&(i.set("Accept","application/json"),i.set("Content-Type",k.headers["Content-Type"]||"application/json")),k.body&&k.body instanceof Blob?eE(k.body,function(n){g.body=n}):k.body&&k.processData&&"string"!=typeof k.body?g.body=JSON.stringify(k.body):"body" in k?g.body=k.body:g.body=null,Object.keys(k.headers).forEach(function(n){k.headers.hasOwnProperty(n)&&i.set(n,k.headers[n])}),m=eO(k.url,g),k.timeout>0&&(j=setTimeout(function(){m.reject(new Error("Load timeout for resource: "+k.url))},k.timeout)),m.promise.then(function(n){return l={statusCode:n.status},k.timeout>0&&clearTimeout(j),l.statusCode>=200&&l.statusCode<300?k.binary?n.blob():n.text():n.json()}).then(function(n){l.statusCode>=200&&l.statusCode<300?h(null,l,n):h(n,l)})["catch"](function(n){h(n,l)}),{abort:m.reject}}function ej(l,i){var m,k,g=function(){m.abort()};m=l.xhr?new l.xhr:new XMLHttpRequest;try{m.open(l.method,l.url)}catch(j){i(j,{statusCode:413})}m.withCredentials="withCredentials" in l?l.withCredentials:!0,"GET"===l.method?delete l.headers["Content-Type"]:l.json&&(l.headers.Accept="application/json",l.headers["Content-Type"]=l.headers["Content-Type"]||"application/json",l.body&&l.processData&&"string"!=typeof l.body&&(l.body=JSON.stringify(l.body))),l.binary&&(m.responseType="arraybuffer"),"body" in l||(l.body=null);for(var h in l.headers){l.headers.hasOwnProperty(h)&&m.setRequestHeader(h,l.headers[h])}return l.timeout>0&&(k=setTimeout(g,l.timeout),m.onprogress=function(){clearTimeout(k),k=setTimeout(g,l.timeout)},"undefined"!=typeof m.upload&&(m.upload.onprogress=m.onprogress)),m.onreadystatechange=function(){if(4===m.readyState){var q={statusCode:m.status};if(m.status>=200&&m.status<300){var o;o=l.binary?ev([m.response||""],{type:m.getResponseHeader("Content-Type")}):m.responseText,i(null,q,o)}else{var n={};try{n=JSON.parse(m.response)}catch(p){}i(n,q)}}},l.body&&l.body instanceof Blob?eE(l.body,function(n){m.send(n)}):m.send(l.body),{abort:g}}function eM(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function eJ(h,g){return da||h.xhr?ej(h,g):el(h,g)}function eA(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function eL(i,g,j){function h(k){for(var l in i){"function"!=typeof i[l]&&(this[l]=i[l])}void 0!==j&&(this.name=j),void 0!==k&&(this.reason=k)}return h.prototype=eA.prototype,new h(g)}function eG(k){var h,m,j,l,g;return m=k.error===!0&&"string"==typeof k.name?k.name:k.error,g=k.reason,j=aU("name",m,g),k.missing||"missing"===g||"deleted"===g||"not_found"===m?j=aO:"doc_validation"===m?(j=cw,l=g):"bad_request"===m&&j.message!==g&&(j=dz),j||(j=aU("status",k.status,g)||bQ),h=eL(j,g,m),l&&(h.message=l),k.id&&(h.id=k.id),k.status&&(h.status=k.status),k.missing&&(h.missing=k.missing),h}function es(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function eh(i){if("function"==typeof i.slice){return i.slice(0)}var g=new ArrayBuffer(i.byteLength),j=new Uint8Array(g),h=new Uint8Array(i);return j.set(h),g}function ed(h){if(h instanceof ArrayBuffer){return eh(h)}var g=h.size,i=h.type;return"function"==typeof h.slice?h.slice(0,g,i):h.webkitSlice(0,g,i)}function eP(i){var g,k,h;if(!i||"object"!=typeof i){return i}if(Array.isArray(i)){for(g=[],k=0,h=i.length;h>k;k++){g[k]=eP(i[k])}return g}if(i instanceof Date){return i.toISOString()}if(es(i)){return ed(i)}g={};for(k in i){if(Object.prototype.hasOwnProperty.call(i,k)){var j=eP(i[k]);"undefined"!=typeof j&&(g[k]=j)}}return g}function ey(){return""}function eH(i,g){function k(l,q,m){if(!i.binary&&i.json&&"string"==typeof l){try{l=JSON.parse(l)}catch(p){return m(p)}}Array.isArray(l)&&(l=l.map(function(n){return n.error||n.missing?eG(n):n})),i.binary&&dX(l,q),m(null,l,q)}function h(q,m){var u,p;if(q.code&&q.status){var s=new Error(q.message||q.code);return s.status=q.status,m(s)}try{u=JSON.parse(q.responseText),p=eG(u)}catch(l){p=eG(q)}m(p)}i=eP(i);var j={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return i=d9.extend(j,i),i.json&&(i.binary||(i.headers.Accept="application/json"),i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"),i.binary&&(i.encoding=null,i.json=!1),i.processData||(i.json=!1),eJ(i,function(r,n,l){if(r){return r.status=n?n.statusCode:400,h(r,g)}var p,m=n.headers&&n.headers["content-type"],v=l||ey();if(!i.binary&&(i.json||!i.processData)&&"object"!=typeof v&&(/json/.test(m)||/^[\s]*\{/.test(v)&&/\}[\s]*$/.test(v))){try{v=JSON.parse(v.toString())}catch(q){}}n.statusCode>=200&&n.statusCode<300?k(v,n,g):(p=eG(v),p.status=n.statusCode,g(p))})}function eN(m,j){var q=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",l=-1!==q.indexOf("safari")&&-1===q.indexOf("chrome"),p=-1!==q.indexOf("msie"),h=l&&"POST"===m.method||p&&"GET"===m.method,g="cache" in m?m.cache:!0;if(h||!g){var k=-1!==m.url.indexOf("?");m.url+=(k?"&":"?")+"_nonce="+Date.now()}return eH(m,j)}function eg(h){var g=!1;return c6(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function fm(g){return c6(function(k){k=eP(k);var l,m=this,j="function"==typeof k[k.length-1]?k.pop():!1;j&&(l=function(n,i){ex.nextTick(function(){j(n,i)})});var h=new b0(function(v,u){var p;try{var o=eg(function(n,i){n?u(n):v(i)});k.push(o),p=g.apply(m,k),p&&"function"==typeof p.then&&v(p)}catch(q){u(q)}});return l&&h.then(function(i){l(null,i)},l),h})}function e0(h,g){function i(m,k,q){if(fb.enabled){for(var l=[m._db_name,k],p=0;p<q.length-1;p++){l.push(q[p])}fb.apply(null,l);var j=q[q.length-1];q[q.length-1]=function(v,s){var u=[m._db_name,k];u=u.concat(v?["error",v]:["success",s]),fb.apply(null,u),j(v,s)}}}return fm(c6(function(j){if(this._closed){return b0.reject(new Error("database is closed"))}var k=this;return i(k,h,j),this.taskqueue.isReady?g.apply(this,j):new b0(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[h].apply(k,j))})})}))}function eB(k,h){for(var m={},j=0,l=h.length;l>j;j++){var g=h[j];g in k&&(m[g]=k[g])}return m}function eq(h,g,i){return new b0(function(j,k){h.get(g,function(n,l){if(n){if(404!==n.status){return k(n)}l={}}var o=l._rev,m=i(l);return m?(m._id=g,m._rev=o,void j(ef(h,m,i))):j({updated:!1,rev:o})})})}function ef(h,g,i){return h.put(g).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return eq(h,g._id,i)})}function fu(q){for(var z,j,g,h,m=q.rev_tree.slice();h=m.pop();){var x=h.ids,A=x[2],y=h.pos;if(A.length){for(var w=0,p=A.length;p>w;w++){m.push({pos:y+1,ids:A[w]})}}else{var k=!!x[1].deleted,v=x[0];(!z||(g!==k?g:j!==y?y>j:v>z))&&(z=v,j=y,g=k)}}return j+"-"+z}function eY(g){return g.ids}function e6(i,g){g||(g=fu(i));for(var k,h=g.substring(g.indexOf("-")+1),j=i.rev_tree.map(eY);k=j.pop();){if(k[0]===h){return !!k[1].deleted}j=j.concat(k[2])}}function eD(g){return aZ("return "+g+";",{})}function fq(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function fa(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function fg(h){var g=fa(h);return g?g.join("/"):null}function e1(l,v){for(var j,g=l.slice();j=g.pop();){for(var h=j.pos,k=j.ids,p=k[2],w=v(0===p.length,h,k[0],j.ctx,k[1]),q=0,m=p.length;m>q;q++){g.push({pos:h+1,ids:p[q],ctx:w})}}}function fp(h,g){return h.pos-g.pos}function e7(i){var g=[];e1(i,function(m,q,l,p,k){m&&g.push({rev:q+"-"+l,pos:q,opts:k})}),g.sort(fp).reverse();for(var j=0,h=g.length;h>j;j++){delete g[j].pos}return g}function fs(l){for(var j=fu(l),p=e7(l.rev_tree),k=[],m=0,h=p.length;h>m;m++){var g=p[m];g.rev===j||g.opts.deleted||k.push(g.rev)}return k}function fl(l,j,p){function k(){m.cancel()}fz.EventEmitter.call(this);var m=this;this.db=l,j=j?eP(j):{};var h=j.complete=eg(function(i,o){i?m.emit("error",i):m.emit("complete",o),m.removeAllListeners(),l.removeListener("destroyed",k)});p&&(m.on("complete",function(i){p(null,i)}),m.on("error",p)),l.once("destroyed",k),j.onChange=function(i){j.isCancelled||(m.emit("change",i),m.startSeq&&m.startSeq<=i.seq&&(m.startSeq=!1))};var g=new b0(function(i,o){j.complete=function(n,q){n?o(n):i(q)}});m.once("cancel",function(){l.removeListener("destroyed",k),j.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this["catch"]=g["catch"].bind(g),this.then(function(i){h(null,i)},h),l.taskqueue.isReady?m.doChanges(j):l.taskqueue.addTask(function(){m.isCancelled?m.emit("cancel"):m.doChanges(j)})}function e9(i,g,k){var h=[{rev:i._rev}];"all_docs"===k.style&&(h=e7(g.rev_tree).map(function(l){return{rev:l.rev}}));var j={id:g.id,changes:h,doc:i};return e6(g,i._rev)&&(j.deleted=!0),k.conflicts&&(j.doc._conflicts=fs(g),j.doc._conflicts.length||delete j.doc._conflicts),j}function eX(m,w,j){function g(){var i=[];l.forEach(function(n){n.docs.forEach(function(o){i.push({id:n.id,docs:[o]})})}),j(null,{results:i})}function h(){++p===v&&g()}function k(o,i,r){l[o]={id:i,docs:r},h()}var q=Array.isArray(w)?w:w.docs,x={};q.forEach(function(i){i.id in x?x[i.id].push(i):x[i.id]=[i]});var v=Object.keys(x).length,p=0,l=new Array(v);Object.keys(x).forEach(function(A,y){var z=x[A],i=eB(z[0],["atts_since","attachments"]);i.open_revs=z.map(function(n){return n.rev}),i.open_revs=i.open_revs.filter(function(n){return n});var s=function(n){return n};0===i.open_revs.length&&(delete i.open_revs,s=function(n){return[{ok:n}]}),["revs","attachments","binary"].forEach(function(n){n in w&&(i[n]=w[n])}),m.get(A,i,function(o,n){k(y,A,o?[{error:o}]:s(n))})})}function e4(g){return/^_local/.test(g)}function fh(q){for(var z,j=[],g=q.slice();z=g.pop();){var h=z.pos,m=z.ids,x=m[0],A=m[1],y=m[2],w=0===y.length,p=z.history?z.history.slice():[];p.push({id:x,opts:A}),w&&j.push({pos:h+1-p.length,ids:p});for(var k=0,v=y.length;v>k;k++){g.push({pos:h+1,ids:y[k],history:p})}}return j.reverse()}function eU(g){return 0|Math.random()*g}function fd(i,g){g=g||cU.length;var j="",h=-1;if(i){for(;++h<i;){j+=cU[eU(g)]}return j}for(;++h<36;){switch(h){case 8:case 13:case 18:case 23:j+="-";break;case 19:j+=cU[3&eU(16)|8];break;default:j+=cU[eU(16)]}}return j}function fc(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function fj(h){var g;if(h?"string"!=typeof h?g=eL(dJ):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=eL(d4)):g=eL(cG),g){throw g}}function eV(i){if(!/^\d+\-./.test(i)){return eL(e)}var g=i.indexOf("-"),j=i.substring(0,g),h=i.substring(g+1);return{prefix:parseInt(j,10),id:h}}function eT(l,j){for(var p=l.start-l.ids.length+1,k=l.ids,m=[k[0],j,[]],h=1,g=k.length;g>h;h++){m=[k[h],{status:"missing"},[m]]}return[{pos:p,ids:m}]}function ec(l,v){var j,g,h,k={status:"available"};if(l._deleted&&(k.deleted=!0),v){if(l._id||(l._id=fd()),g=fd(32,16).toLowerCase(),l._rev){if(h=eV(l._rev),h.error){return h}l._rev_tree=[{pos:h.prefix,ids:[h.id,{status:"missing"},[[g,k,[]]]]}],j=h.prefix+1}else{l._rev_tree=[{pos:1,ids:[g,k,[]]}],j=1}}else{if(l._revisions&&(l._rev_tree=eT(l._revisions,k),j=l._revisions.start,g=l._revisions.ids[0]),!l._rev_tree){if(h=eV(l._rev),h.error){return h}j=h.prefix,g=h.id,l._rev_tree=[{pos:j,ids:[g,k,[]]}]}}fj(l._id),l._rev=j+"-"+g;var p={metadata:{},data:{}};for(var w in l){if(Object.prototype.hasOwnProperty.call(l,w)){var q="_"===w[0];if(q&&!aJ[w]){var m=eL(cw,w);throw m.message=cw.message+": "+w,m}q&&!dD[w]?p.metadata[w.slice(1)]=l[w]:p.data[w]=l[w]}}return p}function e2(h,g){return g>h?-1:h>g?1:0}function fL(h,g){for(var i=0;i<h.length;i++){if(g(h[i],i)===!0){return h[i]}}}function eS(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function eR(k){for(var h=0;h<k.length;h++){var m=k[h];if(m._deleted){delete m._attachments}else{if(m._attachments){for(var j=Object.keys(m._attachments),l=0;l<j.length;l++){var g=j[l];m._attachments[g]=eB(m._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function d1(i,g){var k=e2(i._id,g._id);if(0!==k){return k}var h=i._revisions?i._revisions.start:0,j=g._revisions?g._revisions.start:0;return e2(h,j)}function a3(h){var g={},i=[];return e1(h,function(m,l,n,k){var j=l+"-"+n;return m&&(g[j]=0),void 0!==k&&i.push({from:k,to:j}),j}),i.reverse(),i.forEach(function(j){void 0===g[j.from]?g[j.from]=1+g[j.to]:g[j.from]=Math.min(g[j.from],1+g[j.to])}),g}function cs(i,g,k){var h="limit" in g?g.keys.slice(g.skip,g.limit+g.skip):g.skip>0?g.keys.slice(g.skip):g.keys;if(g.descending&&h.reverse(),!h.length){return i._allDocs({limit:0},k)}var j={offset:g.skip};return b0.all(h.map(function(m){var l=d9.extend({key:m,deleted:"ok"},g);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new b0(function(o,n){i._allDocs(l,function(q,p){return q?n(q):(j.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return j.rows=l,j})}function bD(i){var g=i._compactionQueue[0],h=g.opts,j=g.callback;i.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(h.last_seq=k.last_seq),i._compact(h,function(l,m){l?j(l):j(null,m),ex.nextTick(function(){i._compactionQueue.shift(),i._compactionQueue.length&&bD(i)})})})}function b8(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function di(){fz.EventEmitter.call(this)}function fK(){this.isReady=!1,this.failed=!1,this.queue=[]}function bj(g){g&&ep.debug&&console.error(g)}function aS(l,j){function p(){h.emit("destroyed",m),h.emit(m,"destroyed")}function k(){l.removeListener("destroyed",p),l.emit("destroyed",l)}var m=j.originalName,h=l.constructor,g=h._destructionListeners;l.once("destroyed",p),g.has(m)||g.set(m,[]),g.get(m).push(k)}function eK(k,h,m){if(!(this instanceof eK)){return new eK(k,h,m)}var j=this;("function"==typeof h||"undefined"==typeof h)&&(m=h,h={}),k&&"object"==typeof k&&(h=k,k=void 0),"undefined"==typeof m&&(m=bj),k=k||h.name,h=eP(h),delete h.name,this.__opts=h;var l=m;j.auto_compaction=h.auto_compaction,j.prefix=eK.prefix,di.call(j),j.taskqueue=new fK;var g=new b0(function(v,q){m=function(o,i){return o?q(o):(delete i.then,void v(i))},h=eP(h);var n,r,p=h.name||k;return function(){try{if("string"!=typeof p){throw r=new Error("Missing/invalid DB name"),r.code=400,r}if(n=eK.parseAdapter(p,h),h.originalName=p,h.name=n.name,h.prefix&&"http"!==n.adapter&&"https"!==n.adapter&&(h.name=h.prefix+h.name),h.adapter=h.adapter||n.adapter,j._adapter=h.adapter,cd("pouchdb:adapter")("Picked adapter: "+h.adapter),j._db_name=p,!eK.adapters[h.adapter]){throw r=new Error("Adapter is missing"),r.code=404,r}if(!eK.adapters[h.adapter].valid()){throw r=new Error("Invalid Adapter"),r.code=404,r}}catch(i){j.taskqueue.fail(i)}}(),r?q(r):(j.adapter=h.adapter,j.replicate={},j.replicate.from=function(o,i,s){return j.constructor.replicate(o,j,i,s)},j.replicate.to=function(o,i,s){return j.constructor.replicate(j,o,i,s)},j.sync=function(o,i,s){return j.constructor.sync(j,o,i,s)},j.replicate.sync=j.sync,void eK.adapters[h.adapter].call(j,h,function(i){return i?(j.taskqueue.fail(i),void m(i)):(aS(j,h),j.emit("created",j),eK.emit("created",h.originalName),j.taskqueue.ready(j),void m(null,j))}))});g.then(function(i){l(null,i)},l),j.then=g.then.bind(g),j["catch"]=g["catch"].bind(g)}function dQ(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function cN(){return a5}function ea(h){Object.keys(fz.EventEmitter.prototype).forEach(function(i){"function"==typeof fz.EventEmitter.prototype[i]&&(h[i]=dN[i].bind(dN))});var g=h._destructionListeners=new bM.Map;h.on("destroyed",function(i){g.has(i)&&(g.get(i).forEach(function(j){j()}),g["delete"](i))})}function dw(i){for(var g=i.length,k=new ArrayBuffer(g),h=new Uint8Array(k),j=0;g>j;j++){h[j]=i.charCodeAt(j)}return k}function bX(h,g){return ev([dw(h)],{type:g})}function aH(l){for(var j=d7.exec(l),p={},k=14;k--;){var m=fG[k],h=j[k]||"",g=-1!==["user","password"].indexOf(m);p[m]=g?decodeURIComponent(h):h}return p[bU]={},p[fG[12]].replace(eC,function(o,i,n){i&&(p[bU][i]=n)}),p}function fR(i,g,k){try{return !i(g,k)}catch(h){var j="Filter function threw: "+h.toString();return eL(dz,j)}}function am(h){var g={},i=h.filter&&"function"==typeof h.filter;return g.query=h.query_params,function(k){k.doc||(k.doc={});var l=i&&fR(h.filter,k.doc,g);if("object"==typeof l){return l}if(l){return !1}if(h.include_docs){if(!h.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function cD(h,g){"console" in ep&&"info" in console&&console.info("The above "+h+" is totally normal. "+g)}function dG(i,g,k,h,j){return i.get(g)["catch"](function(l){if(404===l.status){return"http"===i.type()&&cD(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:h,_id:g,history:[],replicator:c4,version:fx}}throw l}).then(function(l){return j.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==h}),l.history.unshift({last_seq:k,session_id:h}),l.history=l.history.slice(0,cb),l.version=fx,l.replicator=c4,l.session_id=h,l.last_seq=k,i.put(l)["catch"](function(m){if(409===m.status){return dG(i,g,k,h,j)}throw m}))})}function fk(i,g,j,h){this.src=i,this.target=g,this.id=j,this.returnValue=h}function ax(i,g){if(i.session_id===g.session_id){return{last_seq:i.last_seq,history:i.history||[]}}var j=i.history||[],h=g.history||[];return aC(j,h)}function aC(m,j){var q=m[0],l=m.slice(1),p=j[0],h=j.slice(1);if(!q||0===j.length){return{last_seq:bz,history:[]}}var g=q.session_id;if(cO(g,j)){return{last_seq:q.last_seq,history:m}}var k=p.session_id;return cO(k,l)?{last_seq:p.last_seq,history:h}:aC(l,h)}function cO(i,g){var j=g[0],h=g.slice(1);return i&&0!==g.length?i===j.session_id?!0:cO(i,h):!1}function cX(i,g){i=parseInt(i,10)||0,g=parseInt(g,10),g!==g||i>=g?g=(i||1)<<1:g+=1;var j=Math.random(),h=g-i;return ~~(h*j+i)}function bN(h){var g=0;return h||(g=2000),cX(h,g)}function ag(i,g,j,h){return i.retry===!1?(g.emit("error",j),void g.removeAllListeners()):("function"!=typeof i.back_off_function&&(i.back_off_function=bN),g.emit("requestError",j),("active"===g.state||"pending"===g.state)&&(g.emit("paused",j),g.state="stopped",g.once("active",function(){i.current_back_off=dU})),i.current_back_off=i.current_back_off||dU,i.current_back_off=i.back_off_function(i.current_back_off),void setTimeout(h,i.current_back_off))}function bs(g){return dd(g)}function cE(i,g,j,h){(j>0||h<g.byteLength)&&(g=new Uint8Array(g,j,Math.min(h,g.byteLength)-j)),i.append(g)}function dx(i,g,j,h){(j>0||h<g.length)&&(g=g.substring(j,h)),i.appendBinary(g)}function c7(g){return Object.keys(g).sort(bC.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function aX(l,j,p){var k=p.doc_ids?p.doc_ids.sort(bC.collate):"",m=p.filter?p.filter.toString():"",h="",g="";return p.filter&&p.query_params&&(h=JSON.stringify(c7(p.query_params))),p.filter&&"_view"===p.filter&&(g=p.view.toString()),b0.all([l.id(),j.id()]).then(function(n){var i=n[0]+n[1]+m+g+h+k;return bw(i)}).then(function(i){return i=i.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+i})}function d2(g){return/^1-/.test(g)}function fv(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0,attachments:!0,binary:!0}}function cY(l,q,j){function g(){var i=fv(q);if(i.docs.length){return l.bulkGet(i).then(function(n){if(j.cancelled){throw new Error("cancelled")}n.results.forEach(function(o){o.docs.forEach(function(r){r.ok&&p.push(r.ok)})})})}}function h(i){return i._attachments&&Object.keys(i._attachments).length>0}function k(i){return l.allDocs({keys:i,include_docs:!0}).then(function(n){if(j.cancelled){throw new Error("cancelled")}n.rows.forEach(function(o){!o.deleted&&o.doc&&d2(o.value.rev)&&!h(o.doc)&&(p.push(o.doc),delete q[o.id])})})}function m(){var i=Object.keys(q).filter(function(o){var r=q[o].missing;return 1===r.length&&d2(r[0])});return i.length>0?k(i):void 0}function v(){return p}q=eP(q);var p=[];return b0.resolve().then(m).then(g).then(v)}function aM(dt,ar,bt,be,br){function ct(){return G?b0.resolve():aX(dt,ar,bt).then(function(g){U=g,G=new fk(dt,ar,U,be)})}function eo(){if(K=[],0!==ai.docs.length){var g=ai.docs;return ar.bulkDocs({docs:g,new_edits:!1}).then(function(k){if(be.cancelled){throw de(),new Error("cancelled")}var m=[],j={};k.forEach(function(i){i.error&&(br.doc_write_failures++,m.push(i),j[i.id]=i)}),V=V.concat(m),br.docs_written+=ai.docs.length-m.length;var h=m.filter(function(i){return"unauthorized"!==i.name&&"forbidden"!==i.name});if(g.forEach(function(n){var i=j[n._id];i?be.emit("denied",eP(i)):K.push(n)}),h.length>0){var l=new Error("bulkDocs error");throw l.other_errors=m,ee("target.bulkDocs failed to write docs",l),new Error("bulkWrite partial failure")}},function(h){throw br.doc_write_failures+=g.length,h})}}function at(){br.last_seq=J=ai.seq;var g=eP(br);return K.length&&(g.docs=K,be.emit("change",g)),ae=!0,G.writeCheckpoint(ai.seq,X).then(function(){if(ae=!1,be.cancelled){throw de(),new Error("cancelled")}ai=void 0,ce()})["catch"](function(h){throw ae=!1,ee("writeCheckpoint completed with error",h),h})}function ao(){var g={};return ai.changes.forEach(function(h){"_user/"!==h.id&&(g[h.id]=h.changes.map(function(i){return i.rev}))}),ar.revsDiff(g).then(function(h){if(be.cancelled){throw de(),new Error("cancelled")}ai.diffs=h})}function ei(){return cY(dt,ai.diffs,be).then(function(g){g.forEach(function(h){delete ai.diffs[h._id],br.docs_read++,ai.docs.push(h)})})}function dr(){if(!be.cancelled&&!ai){if(0===co.length){return void cn(!0)}ai=co.shift(),ao().then(ei).then(eo).then(at).then(dr)["catch"](function(g){ee("batch processing terminated with error",g)})}}function cn(g){return 0===bn.changes.length?void (0!==co.length||ai||((cr&&Q.live||Y)&&(be.state="pending",be.emit("paused")),Y&&de())):void ((g||Y||bn.changes.length>=W)&&(co.push(bn),bn={seq:0,changes:[],docs:[]},("pending"===be.state||"stopped"===be.state)&&(be.state="active",be.emit("active")),dr()))}function ee(h,g){z||(g.message||(g.message=h),br.ok=!1,br.status="aborting",br.errors.push(g),V=V.concat(g),co=[],bn={seq:0,changes:[],docs:[]},de())}function de(){if(!(z||be.cancelled&&(br.status="cancelled",ae))){br.status=br.status||"complete",br.end_time=new Date,br.last_seq=J,z=!0;var h=V.filter(function(i){return"unauthorized"!==i.name&&"forbidden"!==i.name});if(h.length>0){var g=V.pop();V.length>0&&(g.other_errors=V),g.result=br,ag(bt,be,g,function(){aM(dt,ar,bt,be)})}else{br.errors=V,be.emit("complete",br),be.removeAllListeners()}}}function bo(h){if(be.cancelled){return de()}var g=am(bt)(h);g&&(bn.seq=h.seq,bn.changes.push(h),cn(0===co.length))}function an(g){return P=!1,be.cancelled?de():(g.results.length>0?(Q.since=g.last_seq,ce()):cr?(Q.live=!0,ce()):Y=!0,void cn(!0))}function Z(g){return P=!1,be.cancelled?de():void ee("changes rejected",g)}function ce(){function h(){g.cancel()}function j(){be.removeListener("cancel",h)}if(!P&&!Y&&co.length<M){P=!0,be._changes&&(be.removeListener("cancel",be._abortChanges),be._changes.cancel()),be.once("cancel",h);var g=dt.changes(Q).on("change",bo);g.then(j,j),g.then(an)["catch"](Z),bt.retry&&(be._changes=g,be._abortChanges=h)}}function dn(){ct().then(function(){return be.cancelled?void de():G.getCheckpoint().then(function(g){J=g,Q={since:J,limit:W,batch_size:W,style:"all_docs",doc_ids:H,return_docs:!0},bt.filter&&("string"!=typeof bt.filter?Q.include_docs=!0:Q.filter=bt.filter),"heartbeat" in bt&&(Q.heartbeat=bt.heartbeat),"timeout" in bt&&(Q.timeout=bt.timeout),bt.query_params&&(Q.query_params=bt.query_params),bt.view&&(Q.view=bt.view),ce()})})["catch"](function(g){ee("getCheckpoint rejected with ",g)})}function en(g){throw ae=!1,ee("writeCheckpoint completed with error",g),g}var ai,U,G,co=[],bn={seq:0,changes:[],docs:[]},ae=!1,Y=!1,z=!1,J=0,cr=bt.continuous||bt.live||!1,W=bt.batch_size||100,M=bt.batches_limit||10,P=!1,H=bt.doc_ids,V=[],K=[],X=fd();br=br||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var Q={};return be.ready(dt,ar),be.cancelled?void de():(be._addedListeners||(be.once("cancel",de),"function"==typeof bt.complete&&(be.once("error",bt.complete),be.once("complete",function(g){bt.complete(null,g)})),be._addedListeners=!0),void ("undefined"==typeof bt.since?dn():ct().then(function(){return ae=!0,G.writeCheckpoint(bt.since,X)}).then(function(){return ae=!1,be.cancelled?void de():(J=bt.since,void dn())})["catch"](en)))}function dH(){fz.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new b0(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function a8(h,g){var i=g.PouchConstructor;return"string"==typeof h?new i(h,g):h}function ap(l,j,p,k){if("function"==typeof p&&(k=p,p={}),"undefined"==typeof p&&(p={}),p.doc_ids&&!Array.isArray(p.doc_ids)){throw eL(dz,"`doc_ids` filter parameter is not a list.")}p.complete=k,p=eP(p),p.continuous=p.continuous||p.live,p.retry="retry" in p?p.retry:!1,p.PouchConstructor=p.PouchConstructor||this;var m=new dH(p),h=a8(l,p),g=a8(j,p);return aM(h,g,p,m),m}function dR(i,g,j,h){return"function"==typeof j&&(h=j,j={}),"undefined"==typeof j&&(j={}),j=eP(j),j.PouchConstructor=j.PouchConstructor||this,i=b1.toPouch(i,j),g=b1.toPouch(g,j),new cu(i,g,j,h)}function cu(F,m,A,w){function z(h){D.emit("change",{direction:"pull",change:h})}function C(h){D.emit("change",{direction:"push",change:h})}function I(h){D.emit("denied",{direction:"push",doc:h})}function q(h){D.emit("denied",{direction:"pull",doc:h})}function k(){D.pushPaused=!0,D.pullPaused&&D.emit("paused")}function H(){D.pullPaused=!0,D.pushPaused&&D.emit("paused")}function E(){D.pushPaused=!1,D.pullPaused&&D.emit("active",{direction:"push"})}function B(){D.pullPaused=!1,D.pushPaused&&D.emit("active",{direction:"pull"})}function G(h){return function(l,y){var o="change"===l&&(y===z||y===C),u="denied"===l&&(y===q||y===I),s="paused"===l&&(y===H||y===k),i="active"===l&&(y===B||y===E);(o||u||s||i)&&(l in g||(g[l]={}),g[l][h]=!0,2===Object.keys(g[l]).length&&D.removeAllListeners(l))}}var D=this;this.canceled=!1;var x=A.push?d9.extend({},A,A.push):A,j=A.pull?d9.extend({},A,A.pull):A;this.push=db(F,m,x),this.pull=db(m,F,j),this.pushPaused=!0,this.pullPaused=!0;var g={};A.live&&(this.push.on("complete",D.pull.cancel.bind(D.pull)),this.pull.on("complete",D.push.cancel.bind(D.push))),this.on("newListener",function(h){"change"===h?(D.pull.on("change",z),D.push.on("change",C)):"denied"===h?(D.pull.on("denied",q),D.push.on("denied",I)):"active"===h?(D.pull.on("active",B),D.push.on("active",E)):"paused"===h&&(D.pull.on("paused",H),D.push.on("paused",k))}),this.on("removeListener",function(h){"change"===h?(D.pull.removeListener("change",z),D.push.removeListener("change",C)):"denied"===h?(D.pull.removeListener("denied",q),D.push.removeListener("denied",I)):"active"===h?(D.pull.removeListener("active",B),D.push.removeListener("active",E)):"paused"===h&&(D.pull.removeListener("paused",H),D.push.removeListener("paused",k))}),this.pull.on("removeListener",G("pull")),this.push.on("removeListener",G("push"));var J=b0.all([this.push,this.pull]).then(function(i){var h={push:i[0],pull:i[1]};return D.emit("complete",h),w&&w(null,h),D.removeAllListeners(),h},function(h){if(D.cancel(),w?w(h):D.emit("error",h),D.removeAllListeners(),w){throw h}});this.then=function(i,h){return J.then(i,h)},this["catch"]=function(h){return J["catch"](h)}}function dj(h,g){return bX(cl(h),g)}function fM(i){for(var g="",k=new Uint8Array(i),h=k.byteLength,j=0;h>j;j++){g+=String.fromCharCode(k[j])}return g}function bY(i,g){if("undefined"==typeof FileReader){return g(fM((new FileReaderSync).readAsArrayBuffer(i)))}var j=new FileReader,h="function"==typeof j.readAsBinaryString;j.onloadend=function(k){var l=k.target.result||"";return h?g(l):void g(fM(l))},h?j.readAsBinaryString(i):j.readAsArrayBuffer(i)}function eQ(g){return new b0(function(h){bY(g,function(i){h(dd(i))})})}function eb(i){for(var g=[],j=0,h=i.length;h>j;j++){g=g.concat(i[j])}return g}function fW(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=dj(j.data,j.content_type)})}function b9(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function bO(g){return g._attachments&&Object.keys(g._attachments)?b0.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?eQ(i.data).then(function(j){i.data=j}):void 0})):b0.resolve()}function fE(h){var g=aH(h);(g.user||g.password)&&(g.auth={username:g.user,password:g.password});var i=g.path.replace(/(^\/|\/$)/g,"").split("/");return g.db=i.pop(),-1===g.db.indexOf("%")&&(g.db=encodeURIComponent(g.db)),g.path=i.join("/"),g}function c8(h,g){return cj(h,h.db+"/"+g)}function cj(h,g){var i=h.path?"/":"";return h.protocol+"://"+h.host+(h.port?":"+h.port:"")+"/"+h.path+i+g}function bE(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function bq(z,E){function m(l,h,s){var i=l.ajax||{},p=d9.extend(eP(q),i,h);return dK(p.method+" "+p.url),b4.ajax(p,s)}function g(i,h){return new b0(function(l,n){m(i,h,function(p,o){return p?n(p):void l(o)})})}function k(i,h){return e0(i,c6(function(l){w().then(function(o){return h.apply(this,l)})["catch"](function(o){var p=l.pop();p(o)})}))}function w(){if(z.skipSetup||z.skip_setup){return b0.resolve()}if(C){return C}var h={method:"GET",url:y};return C=g({},h)["catch"](function(i){return i&&i.status&&404===i.status?(cD(404,"PouchDB is just detecting if the remote exists."),g({},{method:"PUT",url:y})):b0.reject(i)})["catch"](function(i){return i&&i.status&&412===i.status?!0:b0.reject(i)}),C["catch"](function(){C=null}),C}function B(h){return h.split("/").map(encodeURIComponent).join("/")}var F=this,D=fE;z.getHost&&(D=z.getHost);var A=D(z.name,z),y=c8(A,"");z=eP(z);var q=z.ajax||{};if(F.getUrl=function(){return y},F.getHeaders=function(){return q.headers||{}},z.auth||A.auth){var x=z.auth||A.auth,j=dd(x.username+":"+x.password);q.headers=q.headers||{},q.headers.Authorization="Basic "+j}var C;setTimeout(function(){E(null,F)}),F.type=function(){return"http"},F.id=k("id",function(h){m({},{method:"GET",url:cj(A,"")},function(i,o){var l=o&&o.uuid?o.uuid+A.db:c8(A,"");h(null,l)})}),F.request=k("request",function(i,h){i.url=c8(A,i.url),m({},i,h)}),F.compact=k("compact",function(i,h){"function"==typeof i&&(h=i,i={}),i=eP(i),m(i,{url:c8(A,"_compact"),method:"POST"},function(){function l(){F.info(function(n,p){p&&!p.compact_running?h(null,{ok:!0}):setTimeout(l,i.interval||200)})}l()})}),F.bulkGet=e0("bulkGet",function(v,n){function u(i){var o={};v.revs&&(o.revs=!0),v.attachments&&(o.attachments=!0),m({},{url:c8(A,"_bulk_get"+bE(o)),method:"POST",body:{docs:v.docs}},i)}function G(){function M(o){return function(N,s){I[o]=s.results,++i===K&&n(null,{results:eb(I)})}}for(var J=bb,K=Math.ceil(v.docs.length/J),i=0,I=new Array(K),H=0;K>H;H++){var L=eB(v,["revs","attachments"]);L.docs=v.docs.slice(H*J,Math.min(v.docs.length,(H+1)*J)),eX(l,L,M(H))}}var l=this,h=cj(A,""),p=aP[h];"boolean"!=typeof p?u(function(o,s){if(o){var i=Math.floor(o.status/100);4===i||5===i?(aP[h]=!1,cD(o.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),G()):n(o)}else{aP[h]=!0,n(null,s)}}):p?u(n):G()}),F._info=function(h){w().then(function(){m({},{method:"GET",url:c8(A,"")},function(i,l){return i?h(i):(l.host=c8(A,""),void h(null,l))})})["catch"](h)},F.get=k("get",function(v,p,H){function G(i){var u=i._attachments,s=u&&Object.keys(u);return u&&s.length?b0.all(s.map(function(J){var n=u[J],I=b9(i._id)+"/"+B(J)+"?rev="+i._rev;return g(p,{method:"GET",url:c8(A,I),binary:!0}).then(function(o){return p.binary?o:eQ(o)}).then(function(o){delete n.stub,delete n.length,n.data=o})})):void 0}function l(i){return Array.isArray(i)?b0.all(i.map(function(n){return n.ok?G(n.ok):void 0})):G(i)}"function"==typeof p&&(H=p,p={}),p=eP(p);var r={};p.revs&&(r.revs=!0),p.revs_info&&(r.revs_info=!0),p.open_revs&&("all"!==p.open_revs&&(p.open_revs=JSON.stringify(p.open_revs)),r.open_revs=p.open_revs),p.rev&&(r.rev=p.rev),p.conflicts&&(r.conflicts=p.conflicts),v=b9(v);var h={method:"GET",url:c8(A,v+bE(r))};g(p,h).then(function(i){return b0.resolve().then(function(){return p.attachments?l(i):void 0}).then(function(){H(null,i)})})["catch"](H)}),F.remove=k("remove",function(s,n,p,u){var l;"string"==typeof n?(l={_id:s,_rev:n},"function"==typeof p&&(u=p,p={})):(l=s,"function"==typeof n?(u=n,p={}):(u=p,p=n));var h=l._rev||p.rev;m(p,{method:"DELETE",url:c8(A,b9(l._id))+"?rev="+h},u)}),F.getAttachment=k("getAttachment",function(u,l,p,v){"function"==typeof p&&(v=p,p={});var h=p.rev?"?rev="+p.rev:"",n=c8(A,b9(u))+"/"+B(l)+h;m(p,{method:"GET",url:n,binary:!0},v)}),F.removeAttachment=k("removeAttachment",function(p,l,n,s){var h=c8(A,b9(p)+"/"+B(l))+"?rev="+n;m({},{method:"DELETE",url:h},s)}),F.putAttachment=k("putAttachment",function(K,N,l,G,H,O){"function"==typeof H&&(O=H,H=G,G=l,l=null);var M=b9(K)+"/"+B(N),J=c8(A,M);if(l&&(J+="?rev="+l),"string"==typeof G){var I;try{I=cl(G)}catch(n){return O(eL(aE,"Attachment is not a valid base64 string"))}G=I?bX(I,H):""}var L={headers:{"Content-Type":H},method:"PUT",url:J,processData:!1,body:G,timeout:q.timeout||60000};m({},L,O)}),F._bulkDocs=function(l,h,i){l.new_edits=h.new_edits,w().then(function(){return b0.all(l.docs.map(bO))}).then(function(){m(h,{method:"POST",url:c8(A,"_bulk_docs"),body:l},function(o,n){return o?i(o):(n.forEach(function(p){p.ok=!0}),void i(null,n))})})["catch"](i)},F.allDocs=k("allDocs",function(u,p){"function"==typeof u&&(p=u,u={}),u=eP(u);var G,v={},l="GET";u.conflicts&&(v.conflicts=!0),u.descending&&(v.descending=!0),u.include_docs&&(v.include_docs=!0),u.attachments&&(v.attachments=!0),u.key&&(v.key=JSON.stringify(u.key)),u.start_key&&(u.startkey=u.start_key),u.startkey&&(v.startkey=JSON.stringify(u.startkey)),u.end_key&&(u.endkey=u.end_key),u.endkey&&(v.endkey=JSON.stringify(u.endkey)),"undefined"!=typeof u.inclusive_end&&(v.inclusive_end=!!u.inclusive_end),"undefined"!=typeof u.limit&&(v.limit=u.limit),"undefined"!=typeof u.skip&&(v.skip=u.skip);var h=bE(v);if("undefined"!=typeof u.keys){var r="keys="+encodeURIComponent(JSON.stringify(u.keys));r.length+h.length+1<=eu?h+="&"+r:(l="POST",G={keys:u.keys})}g(u,{method:l,url:c8(A,"_all_docs"+h),body:G}).then(function(i){u.include_docs&&u.attachments&&u.binary&&i.rows.forEach(fW),p(null,i)})["catch"](p)}),F._changes=function(K){var Q="batch_size" in K?K.batch_size:fC;K=eP(K),K.timeout="timeout" in K?K.timeout:"timeout" in q?q.timeout:30000;var i,n=K.timeout?{timeout:K.timeout-5000}:{},N="undefined"!=typeof K.limit?K.limit:!1;i="return_docs" in K?K.return_docs:"returnDocs" in K?K.returnDocs:!0;var R=N;if(K.style&&(n.style=K.style),(K.include_docs||K.filter&&"function"==typeof K.filter)&&(n.include_docs=!0),K.attachments&&(n.attachments=!0),K.continuous&&(n.feed="longpoll"),K.conflicts&&(n.conflicts=!0),K.descending&&(n.descending=!0),"heartbeat" in K?K.heartbeat&&(n.heartbeat=K.heartbeat):n.heartbeat=10000,K.filter&&"string"==typeof K.filter&&(n.filter=K.filter,"_view"===K.filter&&K.view&&"string"==typeof K.view&&(n.view=K.view)),K.query_params&&"object"==typeof K.query_params){for(var P in K.query_params){K.query_params.hasOwnProperty(P)&&(n[P]=K.query_params[P])}}var J,L="GET";if(K.doc_ids){n.filter="_doc_ids";var H=JSON.stringify(K.doc_ids);H.length<eu?n.doc_ids=H:(L="POST",J={doc_ids:K.doc_ids})}var l,O,M=function(p,o){if(!K.aborted){n.since=p,"object"==typeof n.since&&(n.since=JSON.stringify(n.since)),K.descending?N&&(n.limit=R):n.limit=!N||R>Q?Q:R;var h={method:L,url:c8(A,"_changes"+bE(n)),timeout:K.timeout,body:J};O=p,K.aborted||w().then(function(){l=m(K,h,o)})["catch"](o)}},G={results:[]},I=function(v,r){if(!K.aborted){var p=0;if(r&&r.results){p=r.results.length,G.last_seq=r.last_seq;var h={};h.query=K.query_params,r.results=r.results.filter(function(o){R--;var u=am(K)(o);return u&&(K.include_docs&&K.attachments&&K.binary&&fW(o),i&&G.results.push(o),K.onChange(o)),u})}else{if(v){return K.aborted=!0,void K.complete(v)}}r&&r.last_seq&&(O=r.last_seq);var s=N&&0>=R||r&&Q>p||K.descending;(!K.continuous||N&&0>=R)&&s?K.complete(null,G):setTimeout(function(){M(O,I)},0)}};return M(K.since||0,I),{cancel:function(){K.aborted=!0,l&&l.abort()}}},F.revsDiff=k("revsDiff",function(l,h,i){"function"==typeof h&&(i=h,h={}),m(h,{method:"POST",url:c8(A,"_revs_diff"),body:l},i)}),F._close=function(h){h()},F._destroy=function(h,i){m(h,{url:c8(A,""),method:"DELETE"},function(l,o){return l&&l.status&&404!==l.status?i(l):(F.emit("destroyed"),F.constructor.emit("destroyed",z.name),void i(null,o))})}}function dS(){this.promise=new b0(function(g){g()})}function aY(g){return cg.hash(g)}function cf(m){var j=m.db,q=m.viewName,l=m.map,p=m.reduce,h=m.temporary,g=l.toString()+(p&&p.toString())+"undefined";if(!h&&j._cachedViews){var k=j._cachedViews[g];if(k){return b0.resolve(k)}}return j.info().then(function(o){function n(v){v.views=v.views||{};var s=q;-1===s.indexOf("/")&&(s=q+"/"+q);var u=v.views[s]=v.views[s]||{};if(!u[i]){return u[i]=!0,v}}var i=o.db_name+"-mrview-"+(h?"temp":aY(g));return eq(j,"_local/mrviews",n).then(function(){return j.registerDependentDatabase(i).then(function(u){var v=u.db;v.auto_compaction=!0;var r={name:i,db:v,sourceDB:j,adapter:j.adapter,mapFun:l,reduceFun:p};return r.db.get("_local/lastSeq")["catch"](function(s){if(404!==s.status){throw s}}).then(function(s){return r.seq=s?s.seq:0,h||(j._cachedViews=j._cachedViews||{},j._cachedViews[g]=r,r.db.once("destroyed",function(){delete j._cachedViews[g]})),r})})})})}function bu(k,h,m,j,l,g){return aZ("return ("+k.replace(/;\s*$/,"")+");",{emit:h,sum:m,log:j,isArray:l,toJSON:g})}function bZ(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function c9(g){return 1===g.length&&/^1-/.test(g[0].rev)}function fA(h,g){try{h.emit("error",g)}catch(i){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(g)}}function a9(i,g,j){try{return{output:g.apply(null,j)}}catch(h){return fA(i,h),{error:h}}}function aN(h,g){var i=dA(h.key,g.key);return 0!==i?i:dA(h.value,g.value)}function ek(h,g,i){return i=i||0,"number"==typeof g?h.slice(i,g+i):i>0?h.slice(i):h}function dI(h){var g=h.value,i=g&&"object"==typeof g&&g._id||h.id;return i}function cF(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=dj(k.data,k.content_type)})})}function d3(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&cF(h),h}}function dk(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new a4(g)}function bP(m){for(var j=0,q=0,l=m.length;l>q;q++){var p=m[q];if("number"!=typeof p){if(!Array.isArray(p)){throw dk("_sum")}j="number"==typeof j?[j]:j;for(var h=0,g=p.length;g>h;h++){var k=p[h];if("number"!=typeof k){throw dk("_sum")}"undefined"==typeof j[h]?j.push(k):j[h]+=k}}else{"number"==typeof j?j+=p:j[0]+=p}}return j}function aD(i,g,k,h){var j=g[i];"undefined"!=typeof j&&(h&&(j=encodeURIComponent(JSON.stringify(j))),k.push(i+"="+j))}function fN(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function ab(g){return g.group_level=fN(g.group_level),g.limit=fN(g.limit),g.skip=fN(g.skip),g}function cv(g){if(g){if("number"!=typeof g){return new aI('Invalid value for integer: "'+g+'"')}if(0>g){return new aI('Invalid value for positive integer: "'+g+'"')}}}function dy(i,g){var j=i.descending?"endkey":"startkey",h=i.descending?"startkey":"endkey";if("undefined"!=typeof i[j]&&"undefined"!=typeof i[h]&&dA(i[j],i[h])>0){throw new aI("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(g.reduce&&i.reduce!==!1){if(i.include_docs){throw new aI("{include_docs:true} is invalid for reduce")}if(i.keys&&i.keys.length>1&&!i.group&&!i.group_level){throw new aI("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=cv(i[k]);if(l){throw l}})}function eW(l,q,j){var g,h=[],k="GET";if(aD("reduce",j,h),aD("include_docs",j,h),aD("attachments",j,h),aD("limit",j,h),aD("descending",j,h),aD("group",j,h),aD("group_level",j,h),aD("skip",j,h),aD("stale",j,h),aD("conflicts",j,h),aD("startkey",j,h,!0),aD("start_key",j,h,!0),aD("endkey",j,h,!0),aD("end_key",j,h,!0),aD("inclusive_end",j,h),aD("key",j,h,!0),h=h.join("&"),h=""===h?"":"?"+h,"undefined"!=typeof j.keys){var m=2000,v="keys="+encodeURIComponent(JSON.stringify(j.keys));v.length+h.length+1<=m?h+=("?"===h[0]?"&":"?")+v:(k="POST","string"==typeof q?g={keys:j.keys}:q.keys=j.keys)}if("string"==typeof q){var p=bZ(q);return l.request({method:k,url:"_design/"+p[0]+"/_view/"+p[1]+h,body:g}).then(d3(j))}return g=g||{},Object.keys(q).forEach(function(i){Array.isArray(q[i])?g[i]=q[i]:g[i]=q[i].toString()}),l.request({method:"POST",url:"_temp_view"+h,body:g}).then(d3(j))}function aq(h,g,i){return new b0(function(j,k){h._query(g,i,function(m,l){return m?k(m):void j(l)})})}function ay(g){return new b0(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function cJ(g){return function(h){if(404===h.status){return g}throw h}}function cP(m,w,j){function g(){return c9(l)?b0.resolve(x):w.db.get(q)["catch"](cJ(x))}function h(i){return i.keys.length?w.db.allDocs({keys:i.keys,include_docs:!0}):b0.resolve({rows:[]})}function k(D,G){for(var A=[],y={},z=0,B=G.rows.length;B>z;z++){var E=G.rows[z],H=E.doc;if(H&&(A.push(H),y[H._id]=!0,H._deleted=!p[H._id],!H._deleted)){var F=p[H._id];"value" in F&&(H.value=F.value)}}var C=Object.keys(p);return C.forEach(function(n){if(!y[n]){var i={_id:n},r=p[n];"value" in r&&(i.value=r.value),A.push(i)}}),D.keys=bH(C.concat(D.keys)),A.push(D),A}var q="_local/doc_"+m,x={_id:q,keys:[]},v=j[m],p=v.indexableKeysToKeyValues,l=v.changes;return g().then(function(i){return h(i).then(function(n){return k(i,n)})})}function bF(i,g,j){var h="_local/lastSeq";return i.db.get(h)["catch"](cJ({_id:h,seq:0})).then(function(k){var l=Object.keys(g);return b0.all(l.map(function(m){return cP(m,i,g)})).then(function(m){var n=eb(m);return k.seq=j,n.push(k),i.db.bulkDocs({docs:n})})})}function fX(h){var g="string"==typeof h?h:h.name,i=cB[g];return i||(i=cB[g]=new dS),i}function bk(g){return cR(fX(g),function(){return cz(g)})()}function cz(l){function q(o,i){var r={id:h._id,key:av(o)};"undefined"!=typeof i&&null!==i&&(r.value=av(i)),g.push(r)}function j(i,o){return function(){return bF(l,i,o)}}var g,h,k;if("function"==typeof l.mapFun&&2===l.mapFun.length){var m=l.mapFun;k=function(i){return m(i,q)}}else{k=bu(l.mapFun.toString(),q,bP,cx,Array.isArray,JSON.parse)}var v=l.seq||0,p=new dS;return new b0(function(n,i){function r(){p.finish().then(function(){l.seq=v,n()})}function o(){function s(u){i(u)}l.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:v,limit:c1}).on("complete",function(J){var F=J.results;if(!F.length){return r()}for(var z={},C=0,A=F.length;A>C;C++){var u=F[C];if("_"!==u.doc._id[0]){g=[],h=u.doc,h._deleted||a9(l.sourceDB,k,[h]),g.sort(aN);for(var I,E={},H=0,x=g.length;x>H;H++){var B=g[H],D=[B.key,B.id];0===dA(B.key,I)&&D.push(H);var G=e3(D);E[G]=B,I=B.key}z[u.doc._id]={indexableKeysToKeyValues:E,changes:u.changes}}v=u.seq}return p.add(j(z,v)),F.length<c1?r():o()}).on("error",s)}o()})}function dq(m,w,j){0===j.group_level&&delete j.group_level;var g,h=j.group||j.group_level;g=aV[m.reduceFun]?aV[m.reduceFun]:bu(m.reduceFun.toString(),null,bP,cx,Array.isArray,JSON.parse);var k=[],q=j.group_level;w.forEach(function(o){var i=k[k.length-1],r=h?o.key:null;return h&&Array.isArray(r)&&"number"==typeof q&&(r=r.length>q?r.slice(0,q):r),i&&0===dA(i.key[0][0],r)?(i.key.push([r,o.id]),void i.value.push(o.value)):void k.push({key:[[r,o.id]],value:[o.value]})});for(var x=0,v=k.length;v>x;x++){var p=k[x],l=a9(m.sourceDB,g,[p.key,p.value,!1]);if(l.error&&l.error instanceof a4){throw l.error}p.value=l.error?null:l.output,p.key=p.key[0][0]}return{rows:ek(k,j.limit,j.skip)}}function cZ(h,g){return cR(fX(h),function(){return aT(h,g)})()}function aT(q,z){function j(i){return i.include_docs=!0,q.db.allDocs(i).then(function(l){return h=l.total_rows,l.rows.map(function(u){if("value" in u.doc&&"object"==typeof u.doc.value&&null!==u.doc.value){var o=Object.keys(u.doc.value).sort(),B=["id","key","value"];if(!(B>o||o>B)){return u.doc.value}}var s=aA(u.doc._id);return{key:s[0],id:s[1],value:"value" in u.doc?u.doc.value:null}})})}function g(o){var l;if(l=m?dq(q,o,z):{total_rows:h,offset:x,rows:o},z.include_docs){var i=bH(o.map(dI));return q.sourceDB.allDocs({keys:i,include_docs:!0,conflicts:z.conflicts,attachments:z.attachments,binary:z.binary}).then(function(r){var n={};return r.rows.forEach(function(s){s.doc&&(n["$"+s.id]=s.doc)}),o.forEach(function(u){var B=dI(u),s=n["$"+B];s&&(u.doc=s)}),l})}return l}var h,m=q.reduceFun&&z.reduce!==!1,x=z.skip||0;if("undefined"==typeof z.keys||z.keys.length||(z.limit=0,delete z.keys),"undefined"!=typeof z.keys){var A=z.keys,y=A.map(function(l){var i={startkey:e3([l]),endkey:e3([l,{}])};return j(i)});return b0.all(y).then(eb).then(g)}var w={descending:z.descending};if(z.start_key&&(z.startkey=z.start_key),z.end_key&&(z.endkey=z.end_key),"undefined"!=typeof z.startkey&&(w.startkey=e3(z.descending?[z.startkey,{}]:[z.startkey])),"undefined"!=typeof z.endkey){var p=z.inclusive_end!==!1;z.descending&&(p=!p),w.endkey=e3(p?[z.endkey,{}]:[z.endkey])}if("undefined"!=typeof z.key){var k=e3([z.key]),v=e3([z.key,{}]);w.descending?(w.endkey=k,w.startkey=v):(w.startkey=k,w.endkey=v)}return m||("number"==typeof z.limit&&(w.limit=z.limit),w.skip=x),j(w).then(g)}function dW(g){return g.request({method:"POST",url:"_view_cleanup"})}function e8(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(m){var k=bZ(m),l="_design/"+k[0],n=k[1];j[l]=j[l]||{},j[l][n]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(m){var n={};m.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(v){var r=o+"/"+v;h.views[r]||(r=v);var q=Object.keys(h.views[r]),u=p.doc&&p.doc.views&&p.doc.views[v];q.forEach(function(s){n[s]=n[s]||u})})});var l=Object.keys(n).filter(function(o){return !n[o]}),k=l.map(function(o){return cR(fX(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return b0.all(k).then(function(){return{ok:!0}})})},cJ({ok:!0}))}function cT(n,k,m){if("http"===n.type()){return eW(n,k,m)}if("function"==typeof n._query){return aq(n,k,m)}if("string"!=typeof k){dy(m,k);var p={db:n,viewName:"temp_view/temp_view",map:k.map,reduce:k.reduce,temporary:!0};return du.add(function(){return cf(p).then(function(o){function i(){return o.db.destroy()}return t(bk(o).then(function(){return cZ(o,m)}),i)})}),du.finish()}var j=k,g=bZ(j),l=g[0],h=g[1];return n.get("_design/"+l).then(function(q){var r=q.views&&q.views[h];if(!r||"string"!=typeof r.map){throw new dC("ddoc "+l+" has no view named "+h)}dy(m,r);var i={db:n,viewName:j,map:r.map,reduce:r.reduce};return cf(i).then(function(o){return"ok"===m.stale||"update_after"===m.stale?("update_after"===m.stale&&ex.nextTick(function(){bk(o)}),cZ(o,m)):bk(o).then(function(){return cZ(o,m)})})})}function aI(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,aI)}catch(g){}}function dC(h){this.status=404,this.name="not_found",this.message=h,this.error=!0;try{Error.captureStackTrace(this,dC)}catch(g){}}function a4(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,a4)}catch(g){}}function ah(g){return"'"+g+"'"}function dM(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function ck(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function dc(g){return delete g._id,delete g._rev,JSON.stringify(g)}function fF(h,g,i){return h=JSON.parse(h),h._id=g,h._rev=i,h}function bT(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function ez(i,g,k,h,j){return"SELECT "+i+" FROM "+("string"==typeof g?g:g.join(" JOIN "))+(k?" ON "+k:"")+(h?" WHERE "+("string"==typeof h?h:h.join(" AND ")):"")+(j?" ORDER BY "+j:"")}function d6(l,j,p){function k(){++h===l.length&&m()}function m(){if(g.length){var i="SELECT DISTINCT digest AS digest FROM "+dg+" WHERE seq IN "+bT(g.length);p.executeSql(i,g,function(u,q){for(var w=[],s=0;s<q.rows.length;s++){w.push(q.rows.item(s).digest)}if(w.length){var v="DELETE FROM "+dg+" WHERE seq IN ("+g.map(function(){return"?"}).join(",")+")";u.executeSql(v,g,function(o){var n="SELECT digest FROM "+dg+" WHERE digest IN ("+w.map(function(){return"?"}).join(",")+")";o.executeSql(n,w,function(z,x){for(var y=new bM.Set,A=0;A<x.rows.length;A++){y.add(x.rows.item(A).digest)}w.forEach(function(r){y.has(r)||(z.executeSql("DELETE FROM "+dg+" WHERE digest=?",[r]),z.executeSql("DELETE FROM "+ak+" WHERE digest=?",[r]))})})})}})}}if(l.length){var h=0,g=[];l.forEach(function(i){var n="SELECT seq FROM "+a6+" WHERE doc_id=? AND rev=?";p.executeSql(n,[j,i],function(q,o){if(!o.rows.length){return k()}var r=o.rows.item(0).seq;g.push(r),q.executeSql("DELETE FROM "+a6+" WHERE seq=?",[r],k)})})}}function fS(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(eL(cK,j,i))}}function b3(h){if("size" in h){return 1000000*h.size}var g=/Android/.test(window.navigator.userAgent);return g?5000000:1}function bJ(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function fw(h,g){try{return{db:h(g)}}catch(i){return{error:i}}}function c3(h){var g=fI[h.name];if(!g){var i=bJ();g=fI[h.name]=fw(i,h),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return g}function ca(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function by(g){dQ()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):cN()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function bd(){fz.EventEmitter.call(this),this._listeners={},by(this)}function dV(g){return decodeURIComponent(window.escape(g))}function a1(g){return 65>g?g-48:g-55}function ci(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(a1(i.charCodeAt(g++))<<4|a1(i.charCodeAt(g++)))}return h}function bx(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(a1(i.charCodeAt(g+2))<<12|a1(i.charCodeAt(g+3))<<8|a1(i.charCodeAt(g))<<4|a1(i.charCodeAt(g+1))),g+=4}return h}function b2(h,g){return"UTF-8"===g?dV(ci(h,0,h.length)):bx(h,0,h.length)}function fD(h){try{return JSON.parse(h)}catch(g){return bv.parse(h)}}function bc(h){try{return JSON.stringify(h)}catch(g){return bv.stringify(h)}}function aQ(l,i,p){function k(q){try{return cl(q)}catch(o){var r=eL(aE,"Attachment is not a valid base64 string");return{error:r}}}function m(q,s){if(q.stub){return s()}if("string"==typeof q.data){var r=k(q.data);if(r.error){return s(r.error)}q.length=r.length,"blob"===i?q.data=bX(r,q.content_type):"base64"===i?q.data=dd(r):q.data=r,bw(r).then(function(n){q.digest="md5-"+n,s()})}else{eE(q.data,function(n){"binary"===i?q.data=fM(n):"base64"===i&&(q.data=dd(fM(n))),bw(n).then(function(o){q.digest="md5-"+o,q.length=n.byteLength,s()})})}}function g(){h++,l.length===h&&(j?p(j):p())}if(!l.length){return p()}var j,h=0;l.forEach(function(u){function q(n){j=n,s++,s===v.length&&g()}var v=u.data&&u.data._attachments?Object.keys(u.data._attachments):[],s=0;if(!v.length){return g()}for(var o in u.data._attachments){u.data._attachments.hasOwnProperty(o)&&m(u.data._attachments[o],q)}})}function ew(h,g){return h.pos-g.pos}function dL(k,h,m){for(var j,l=0,g=k.length;g>l;){j=l+g>>>1,m(k[j],h)<0?l=j+1:g=j}return l}function cI(i,g,j){var h=dL(i,g,j);i.splice(h,0,g)}function d5(m,j){for(var q,l,p=j,h=m.length;h>p;p++){var g=m[p],k=[g.id,g.opts,[]];l?(l[2].push(k),l=k):q=l=k}return q}function dp(h,g){return h[0]<g[0]?-1:1}function bS(l,v){for(var j=[{tree1:l,tree2:v}],g=!1;j.length>0;){var h=j.pop(),k=h.tree1,p=h.tree2;(k[1].status||p[1].status)&&(k[1].status="available"===k[1].status||"available"===p[1].status?"available":"missing");for(var w=0;w<p[2].length;w++){if(k[2][0]){for(var q=!1,m=0;m<k[2].length;m++){k[2][m][0]===p[2][w][0]&&(j.push({tree1:k[2][m],tree2:p[2][w]}),q=!0)}q||(g="new_branch",cI(k[2],p[2][w],dp))}else{g="new_leaf",k[2][0]=p[2][w]}}}return{conflicts:g,tree:l}}function aG(J,w,C){var z,B=[],F=!1,M=!1;if(!J.length){return{tree:[w],conflicts:"new_leaf"}}for(var x=0,q=J.length;q>x;x++){var L=J[x];if(L.pos===w.pos&&L.ids[0]===w.ids[0]){z=bS(L.ids,w.ids),B.push({pos:L.pos,ids:z.tree}),F=F||z.conflicts,M=!0}else{if(C!==!0){var I=L.pos<w.pos?L:w,E=L.pos<w.pos?w:L,K=E.pos-I.pos,G=[],A=[];for(A.push({ids:I.ids,diff:K,parent:null,parentIdx:null});A.length>0;){var k=A.pop();if(0!==k.diff){for(var j=k.ids[2],N=0,D=j.length;D>N;N++){A.push({ids:j[N],diff:k.diff-1,parent:k.ids,parentIdx:N})}}else{k.ids[0]===E.ids[0]&&G.push(k)}}var H=G[0];H?(z=bS(H.ids,E.ids),H.parent[2][H.parentIdx]=z.tree,B.push({pos:I.pos,ids:I.ids}),F=F||z.conflicts,M=!0):B.push(L)}else{B.push(L)}}}return M||B.push(w),B.sort(ew),{tree:B,conflicts:F||"internal_node"}}function fQ(l,v){for(var j,g=fh(l),h=0,k=g.length;k>h;h++){var p=g[h],w=p.ids,q=Math.max(0,w.length-v),m={pos:p.pos+q,ids:d5(w,q)};j=j?aG(j,m,!0).tree:[m]}return j}function af(i,g,j){var h=aG(i,g);return{tree:fQ(h.tree,j),conflicts:h.conflicts}}function cy(l,v){for(var j,g=l.slice(),h=v.split("-"),k=parseInt(h[0],10),p=h[1];j=g.pop();){if(j.pos===k&&j.ids[0]===p){return !0}for(var w=j.ids[2],q=0,m=w.length;m>q;q++){g.push({pos:j.pos+1,ids:w[q]})}}return !1}function dB(L,z,E,B,D,H,O,A){if(cy(z.rev_tree,E.metadata.rev)){return B[D]=E,H()}var x=z.winningRev||fu(z),M="deleted" in z?z.deleted:e6(z,x),K="deleted" in E.metadata?E.metadata.deleted:e6(E.metadata),G=/^1-/.test(E.metadata.rev);if(M&&!K&&A&&G){var I=E.data;I._rev=x,I._id=E.metadata.id,E=ec(I,A)}var C=af(z.rev_tree,E.metadata.rev_tree[0],L),q=A&&(M&&K||!M&&"new_leaf"!==C.conflicts||M&&!K&&"new_branch"===C.conflicts);if(q){var j=eL(em);return B[D]=j,H()}var P=E.metadata.rev;E.metadata.rev_tree=C.tree,z.rev_map&&(E.metadata.rev_map=z.rev_map);var F,J=fu(E.metadata),N=e6(E.metadata,J),k=M===N?0:N>M?-1:1;F=P===J?N:e6(E.metadata,P),O(E,J,N,F,!0,k,D,H)}function e5(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function aw(z,E,m,g,k,w,B,F,D){function A(s,i,H){var l=fu(s.metadata),v=e6(s.metadata,l);if("was_delete" in F&&v){return w[i]=eL(aO,"deleted"),H()}var h=q&&e5(s);if(h){var G=eL(em);return w[i]=G,H()}var p=v?0:1;B(s,l,v,v,!1,p,i,H)}function y(){++j===C&&D&&D()}z=z||1000;var q=F.new_edits,x=new bM.Map,j=0,C=E.length;E.forEach(function(n,i){if(n._id&&e4(n._id)){var l=n._deleted?"_removeLocal":"_putLocal";return void m[l](n,{ctx:k},function(o,p){w[i]=o||p,y()})}var h=n.metadata.id;x.has(h)?(C--,x.get(h).push([n,i])):x.set(h,[[n,i]])}),x.forEach(function(i,r){function p(){++h<i.length?l():y()}function l(){var o=i[h],u=o[0],v=o[1];if(g.has(r)){dB(z,g.get(r),u,w,v,p,B,q)}else{var n=af([],u.metadata.rev_tree[0],z);u.metadata.rev_tree=n.tree,A(u,v,p)}}var h=0;l()})}function aB(h){var g=[];return e1(h.rev_tree,function(l,p,k,m,j){"available"!==j.status||l||(g.push(p+"-"+k),j.status="missing")}),g}function cM(N,A,G,C,F,J,Q){function B(){return P?Q(P):(J.notify(C._name),C._docCount=-1,void Q(null,k))}function x(h,g){var i="SELECT count(*) as cnt FROM "+ak+" WHERE digest=?";L.executeSql(i,[h],function(p,l){if(0===l.rows.item(0).cnt){var m=eL(cA,"unknown stub attachment with digest "+h);g(m)}else{g()}})}function O(i){function g(){++l===m.length&&i(h)}var m=[];if(R.forEach(function(n){n.data&&n.data._attachments&&Object.keys(n.data._attachments).forEach(function(o){var p=n.data._attachments[o];p.stub&&m.push(p.digest)})}),!m.length){return i()}var h,l=0;m.forEach(function(n){x(n,function(o){o&&!h&&(h=o),g()})})}function M(S,ae,m,g,r,W,ai,Z){function U(){function v(bo,at){function bn(){return ++u===n.length&&at(),!1}function br(bt){var ce="INSERT INTO "+dg+" (digest, seq) VALUES (?,?)",s=[ar._attachments[bt].digest,bo];L.executeSql(ce,s,bn,bn)}var u=0,n=Object.keys(ar._attachments||{});if(!n.length){return at()}for(var be=0;be<n.length;be++){br(n[be])}}var ar=S.data,an=g?1:0,o=ar._id,h=ar._rev,y=dc(ar),l="INSERT INTO "+a6+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",ao=[o,h,y,an];L.executeSql(l,ao,function(s,u){var i=u.insertId;v(i,function(){w(s,i)})},function(){var i=ez("seq",a6,null,"doc_id=? AND rev=?");return L.executeSql(i,[o,h],function(at,bo){var be=bo.rows.item(0).seq,s="UPDATE "+a6+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",bn=[y,an,o,h];at.executeSql(s,bn,function(n){v(be,function(){w(n,be)})})}),!1})}function E(h){Y||(h?(Y=h,Z(Y)):V===X.length&&U())}function p(h){V++,E(h)}function T(){if(r&&C.auto_compaction){var h=S.metadata.id,i=aB(S.metadata);d6(i,h,L)}}function w(v,i){T(),S.metadata.seq=i,delete S.metadata.rev;var s=r?"UPDATE "+dE+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+a6+" WHERE doc_id="+dE+".id AND rev=?) WHERE id=?":"INSERT INTO "+dE+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",h=bc(S.metadata),u=S.metadata.id,l=r?[h,i,ae,u]:[u,i,i,h];v.executeSql(s,l,function(){k[ai]={ok:!0,id:S.metadata.id,rev:ae},z.set(u,S.metadata),Z()})}var Y=null,V=0;S.data._id=S.metadata.id,S.data._rev=S.metadata.rev;var X=Object.keys(S.data._attachments||{});g&&(S.data._deleted=!0),X.forEach(function(h){var s=S.data._attachments[h];if(s.stub){V++,E()}else{var i=s.data;delete s.data;var l=s.digest;D(l,i,p)}}),X.length||U()}function I(){aw(N.revs_limit,R,C,z,L,k,M,G)}function K(h){function g(){++i===R.length&&h()}if(!R.length){return h()}var i=0;R.forEach(function(l){if(l._id&&e4(l._id)){return g()}var m=l.metadata.id;L.executeSql("SELECT json FROM "+dE+" WHERE id = ?",[m],function(p,n){if(n.rows.length){var s=fD(n.rows.item(0).json);z.set(m,s)}g()})})}function D(i,g,l){var h="SELECT digest FROM "+ak+" WHERE digest=?";L.executeSql(h,[i],function(n,m){return m.rows.length?l():(h="INSERT INTO "+ak+" (digest, body, escaped) VALUES (?,?,1)",void n.executeSql(h,[i,dM(g)],function(){l()},function(){return l(),!1}))})}var q=G.new_edits,j=A.docs,R=j.map(function(h){if(h._id&&e4(h._id)){return h}var g=ec(h,q);return g}),H=R.filter(function(g){return g.error});if(H.length){return Q(H[0])}var L,P,k=new Array(R.length),z=new bM.Map;aQ(R,"binary",function(g){return g?Q(g):void F.transaction(function(h){L=h,O(function(i){i?P=i:K(I)})},fS(Q),B)})}function cS(l,q,j,g,h){function k(){++p===v.length&&h&&h()}function m(r,u){var i=r._attachments[u],n={binary:q.binary,ctx:g};j._getAttachment(i,n,function(o,s){r._attachments[u]=d9.extend(eB(i,["digest","content_type"]),{data:s}),k()})}var v=Object.keys(l._attachments||{});if(!v.length){return h&&h()}var p=0;v.forEach(function(i){q.attachments&&q.include_docs?m(l,i):(l._attachments[i].stub=!0,k())})}function bI(O,B){function G(){cN()&&(window.localStorage["_pouch__websqldb_"+H._name]=!0),B(null,H)}function D(h,g){h.executeSql(fU),h.executeSql("ALTER TABLE "+a6+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){h.executeSql(eF),h.executeSql("ALTER TABLE "+dE+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){h.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+dE+" (local, id)");var i="SELECT "+dE+".winningseq AS seq, "+dE+".json AS metadata FROM "+a6+" JOIN "+dE+" ON "+a6+".seq = "+dE+".winningseq";h.executeSql(i,[],function(w,S){for(var v=[],y=[],m=0;m<S.rows.length;m++){var k=S.rows.item(m),p=k.seq,l=JSON.parse(k.metadata);e6(l)&&v.push(p),e4(l.id)&&y.push(l.id)}w.executeSql("UPDATE "+dE+"SET local = 1 WHERE id IN "+bT(y.length),y,function(){w.executeSql("UPDATE "+a6+" SET deleted = 1 WHERE seq IN "+bT(v.length),v,g)})})})})}function F(h,g){var i="CREATE TABLE IF NOT EXISTS "+dO+" (id UNIQUE, rev, json)";h.executeSql(i,[],function(){var k="SELECT "+dE+".id AS id, "+a6+".json AS data FROM "+a6+" JOIN "+dE+" ON "+a6+".seq = "+dE+".winningseq WHERE local = 1";h.executeSql(k,[],function(p,u){function m(){if(!s.length){return g(p)}var r=s.shift(),o=JSON.parse(r.data)._rev;p.executeSql("INSERT INTO "+dO+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(n){n.executeSql("DELETE FROM "+dE+" WHERE id=?",[r.id],function(v){v.executeSql("DELETE FROM "+a6+" WHERE seq=?",[r.seq],function(){m()})})})}for(var s=[],l=0;l<u.rows.length;l++){s.push(u.rows.item(l))}m()})})}function K(i,g){function k(m){function l(){if(!m.length){return g(i)}var w=m.shift(),r=b2(w.hex,q),n=r.lastIndexOf("::"),v=r.substring(0,n),p=r.substring(n+2),y="UPDATE "+a6+" SET doc_id=?, rev=? WHERE doc_id_rev=?";i.executeSql(y,[v,p,r],function(){l()})}l()}var h="ALTER TABLE "+a6+" ADD COLUMN doc_id";i.executeSql(h,[],function(m){var l="ALTER TABLE "+a6+" ADD COLUMN rev";m.executeSql(l,[],function(n){n.executeSql(d8,[],function(p){var o="SELECT hex(doc_id_rev) as hex FROM "+a6;p.executeSql(o,[],function(v,s){for(var u=[],w=0;w<s.rows.length;w++){u.push(s.rows.item(w))}k(u)})})})})}function R(i,g){function k(l){var m="SELECT COUNT(*) AS cnt FROM "+ak;l.executeSql(m,[],function(v,y){function u(){var o=ez(c5+", "+dE+".id AS id",[dE,a6],fy,null,dE+".id ");o+=" LIMIT "+p+" OFFSET "+s,s+=p,v.executeSql(o,[],function(X,S){function r(ar,ao){var at=U[ar]=U[ar]||[];-1===at.indexOf(ao)&&at.push(ao)}if(!S.rows.length){return g(X)}for(var U={},ae=0;ae<S.rows.length;ae++){for(var an=S.rows.item(ae),ai=fF(an.data,an.id,an.rev),Z=Object.keys(ai._attachments||{}),W=0;W<Z.length;W++){var T=ai._attachments[Z[W]];r(T.digest,an.seq)}}var Y=[];if(Object.keys(U).forEach(function(ao){var n=U[ao];n.forEach(function(ar){Y.push([ao,ar])})}),!Y.length){return u()}var V=0;Y.forEach(function(ao){var ar="INSERT INTO "+dg+" (digest, seq) VALUES (?,?)";X.executeSql(ar,ao,function(){++V===Y.length&&u()})})})}var w=y.rows.item(0).cnt;if(!w){return g(v)}var s=0,p=10;u()})}var h="CREATE TABLE IF NOT EXISTS "+dg+" (digest, seq INTEGER)";i.executeSql(h,[],function(l){l.executeSql(bL,[],function(m){m.executeSql(b6,[],k)})})}function C(h,g){var i="ALTER TABLE "+ak+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";h.executeSql(i,[],g)}function A(h,g){var i="ALTER TABLE "+dE+" ADD COLUMN max_seq INTEGER";h.executeSql(i,[],function(k){var l="UPDATE "+dE+" SET max_seq=(SELECT MAX(seq) FROM "+a6+" WHERE doc_id=id)";k.executeSql(l,[],function(m){var o="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+dE+" (max_seq)";m.executeSql(o,[],g)})})}function P(h,g){h.executeSql('SELECT HEX("a") AS hex',[],function(k,l){var i=l.rows.item(0).hex;q=2===i.length?"UTF-8":"UTF-16",g()})}function N(){for(;x.length>0;){var g=x.pop();g(null,M)}}function I(s,V){if(0===V){var i="CREATE TABLE IF NOT EXISTS "+cp+" (dbid, db_version INTEGER)",w="CREATE TABLE IF NOT EXISTS "+ak+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",o="CREATE TABLE IF NOT EXISTS "+dg+" (digest, seq INTEGER)",u="CREATE TABLE IF NOT EXISTS "+dE+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",r="CREATE TABLE IF NOT EXISTS "+a6+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",g="CREATE TABLE IF NOT EXISTS "+dO+" (id UNIQUE, rev, json)";s.executeSql(w),s.executeSql(g),s.executeSql(o,[],function(){s.executeSql(b6),s.executeSql(bL)}),s.executeSql(u,[],function(){s.executeSql(fU),s.executeSql(r,[],function(){s.executeSql(eF),s.executeSql(d8),s.executeSql(i,[],function(){var h="INSERT INTO "+cp+" (db_version, dbid) VALUES (?,?)";M=fd();var l=[aK,M];s.executeSql(h,l,function(){N()})})})})}else{var U=function(){var l=aK>V;l&&s.executeSql("UPDATE "+cp+" SET db_version = "+aK);var h="SELECT dbid FROM "+cp;s.executeSql(h,[],function(n,m){M=m.rows.item(0).dbid,N()})},S=[D,F,K,R,C,A,U],T=V,k=function(h){S[T-1](h,k),T++};k(s)}}function L(){J.transaction(function(g){P(g,function(){E(g)})},fS(B),G)}function E(h){var g="SELECT sql FROM sqlite_master WHERE tbl_name = "+cp;h.executeSql(g,[],function(k,i){i.rows.length?/db_version/.test(i.rows.item(0).sql)?k.executeSql("SELECT db_version FROM "+cp,[],function(m,l){var o=l.rows.item(0).db_version;I(m,o)}):k.executeSql("ALTER TABLE "+cp+" ADD COLUMN db_version INTEGER",[],function(){I(k,1)}):I(k,0)})}function z(h,g){if(-1!==H._docCount){return g(H._docCount)}var i=ez("COUNT("+dE+".id) AS 'num'",[dE,a6],fy,a6+".deleted=0");h.executeSql(i,[],function(k,l){H._docCount=l.rows.item(0).num,g(H._docCount)})}var q,H=this,M=null,Q=b3(O),x=[];H._docCount=-1,H._name=O.name;var j=c3({name:H._name,version:bV,description:H._name,size:Q,location:O.location,createFromLocation:O.createFromLocation,androidDatabaseImplementation:O.androidDatabaseImplementation});if(j.error){return fS(B)(j.error)}var J=j.db;"function"!=typeof J.readTransaction&&(J.readTransaction=J.transaction),L(),H.type=function(){return"websql"},H._id=fm(function(g){g(null,M)}),H._info=function(g){J.readTransaction(function(h){z(h,function(k){var i="SELECT MAX(seq) AS seq FROM "+a6;h.executeSql(i,[],function(l,m){var n=m.rows.item(0).seq||0;g(null,{doc_count:k,update_seq:n,sqlite_plugin:J._sqlitePlugin,websql_encoding:q})})})},fS(g))},H._bulkDocs=function(g,i,h){cM(O,g,i,H,J,bI.Changes,h)},H._get=function(m,y,k){function g(){k(v,{doc:h,metadata:l,ctx:S})}var h,l,v,S=y.ctx;if(!S){return J.readTransaction(function(i){H._get(m,d9.extend({ctx:i},y),k)})}var w,p;y.rev?(w=ez(c5,[dE,a6],dE+".id="+a6+".doc_id",[a6+".doc_id=?",a6+".rev=?"]),p=[m,y.rev]):(w=ez(c5,[dE,a6],fy,dE+".id=?"),p=[m]),S.executeSql(w,p,function(o,r){if(!r.rows.length){return v=eL(aO,"missing"),g()}var i=r.rows.item(0);return l=fD(i.metadata),i.deleted&&!y.rev?(v=eL(aO,"deleted"),g()):(h=fF(i.data,l.id,i.rev),void g())})},H._allDocs=function(S,X){var m,g=[],k="startkey" in S?S.startkey:!1,v="endkey" in S?S.endkey:!1,V="key" in S?S.key:!1,Y="descending" in S?S.descending:!1,W="limit" in S?S.limit:-1,U="skip" in S?S.skip:0,y=S.inclusive_end!==!1,p=[],T=[];if(V!==!1){T.push(dE+".id = ?"),p.push(V)}else{if(k!==!1||v!==!1){if(k!==!1&&(T.push(dE+".id "+(Y?"<=":">=")+" ?"),p.push(k)),v!==!1){var w=Y?">":"<";y&&(w+="="),T.push(dE+".id "+w+" ?"),p.push(v)}V!==!1&&(T.push(dE+".id = ?"),p.push(V))}}"ok"!==S.deleted&&T.push(a6+".deleted = 0"),J.readTransaction(function(h){z(h,function(n){if(m=n,0!==W){var l=ez(c5,[dE,a6],fy,T,dE+".id "+(Y?"DESC":"ASC"));l+=" LIMIT "+W+" OFFSET "+U,h.executeSql(l,p,function(be,Z){for(var r=0,ai=Z.rows.length;ai>r;r++){var ar=Z.rows.item(r),bn=fD(ar.metadata),at=bn.id,ao=fF(ar.data,at,ar.rev),an=ao._rev,ae={id:at,key:at,value:{rev:an}};if(S.include_docs&&(ae.doc=ao,ae.doc._rev=an,S.conflicts&&(ae.doc._conflicts=fs(bn)),cS(ae.doc,S,H,be)),ar.deleted){if("ok"!==S.deleted){continue}ae.value.deleted=!0,ae.doc=null}g.push(ae)}})}})},fS(X),function(){X(null,{total_rows:m,offset:S.skip,rows:g})})},H._changes=function(p){function k(){var U=dE+".json AS metadata, "+dE+".max_seq AS maxSeq, "+a6+".json AS winningDoc, "+a6+".rev AS winningRev ",o=dE+" JOIN "+a6,T=dE+".id="+a6+".doc_id AND "+dE+".winningseq="+a6+".seq",S=["maxSeq > ?"],w=[p.since];p.doc_ids&&(S.push(dE+".id IN "+bT(p.doc_ids.length)),w=w.concat(p.doc_ids));var r="maxSeq "+(m?"DESC":"ASC"),y=ez(U,o,T,S,r),s=am(p);p.view||p.filter||(y+=" LIMIT "+u);var i=p.since||0;J.readTransaction(function(n){n.executeSql(y,w,function(ar,W){function V(at){return function(){p.onChange(at)}}for(var ao=0,ae=W.rows.length;ae>ao;ao++){var Y=W.rows.item(ao),X=fD(Y.metadata);i=Y.maxSeq;var Z=fF(Y.winningDoc,X.id,Y.winningRev),an=p.processChange(Z,X,p);an.seq=Y.maxSeq;var ai=s(an);if("object"==typeof ai){return p.complete(ai)}if(ai&&(l++,h&&g.push(an),p.attachments&&p.include_docs?cS(Z,p,H,ar,V(an)):V(an)()),l===u){break}}})},fS(p.complete),function(){p.continuous||p.complete(null,{results:g,last_seq:i})})}if(p=eP(p),p.continuous){var v=H._name+":"+fd();return bI.Changes.addListener(H._name,v,H,p),bI.Changes.notify(H._name),{cancel:function(){bI.Changes.removeListener(H._name,v)}}}var m=p.descending;p.since=p.since&&!m?p.since:0;var u="limit" in p?p.limit:-1;0===u&&(u=1);var h;h="return_docs" in p?p.return_docs:"returnDocs" in p?p.returnDocs:!0;var g=[],l=0;k()},H._close=function(g){g()},H._getAttachment=function(p,k,v){var m,u=k.ctx,h=p.digest,g=p.content_type,l="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+ak+" WHERE digest=?";u.executeSql(l,[h],function(w,y){var n=y.rows.item(0),r=n.escaped?ck(n.body):b2(n.body,q);m=k.binary?bX(r,g):dd(r),v(null,m)})},H._getRevisionTree=function(h,g){J.readTransaction(function(k){var i="SELECT json AS metadata FROM "+dE+" WHERE id = ?";k.executeSql(i,[h],function(m,o){if(o.rows.length){var l=fD(o.rows.item(0).metadata);g(null,l.rev_tree)}else{g(eL(aO))}})})},H._doCompaction=function(h,g,i){return g.length?void J.transaction(function(l){var k="SELECT json AS metadata FROM "+dE+" WHERE id = ?";l.executeSql(k,[h],function(u,p){var s=fD(p.rows.item(0).metadata);e1(s.rev_tree,function(S,U,y,T,w){var v=U+"-"+y;-1!==g.indexOf(v)&&(w.status="missing")});var m="UPDATE "+dE+" SET json = ? WHERE id = ?";u.executeSql(m,[bc(s),h])}),d6(g,h,l)},fS(i),function(){i()}):i()},H._getLocal=function(h,g){J.readTransaction(function(k){var i="SELECT json, rev FROM "+dO+" WHERE id=?";k.executeSql(i,[h],function(s,m){if(m.rows.length){var p=m.rows.item(0),l=fF(p.json,h,p.rev);g(null,l)}else{g(eL(aO))}})})},H._putLocal=function(m,w,k){function g(n){var i,o;l?(i="UPDATE "+dO+" SET rev=?, json=? WHERE id=? AND rev=?",o=[h,v,p,l]):(i="INSERT INTO "+dO+" (id, rev, json) VALUES (?,?,?)",o=[p,h,v]),n.executeSql(i,o,function(u,s){s.rowsAffected?(y={ok:!0,id:p,rev:h},w.ctx&&k(null,y)):k(eL(em))},function(){return k(eL(em)),!1})}"function"==typeof w&&(k=w,w={}),delete m._revisions;var h,l=m._rev,p=m._id;h=l?m._rev="0-"+(parseInt(l.split("-")[1],10)+1):m._rev="0-1";var y,v=dc(m);w.ctx?g(w.ctx):J.transaction(g,fS(k),function(){y&&k(null,y)})},H._removeLocal=function(i,g,l){function h(o){var n="DELETE FROM "+dO+" WHERE id=? AND rev=?",m=[i._id,i._rev];o.executeSql(n,m,function(s,p){return p.rowsAffected?(k={ok:!0,id:i._id,rev:"0-0"},void (g.ctx&&l(null,k))):l(eL(aO))})}"function"==typeof g&&(l=g,g={});var k;g.ctx?h(g.ctx):J.transaction(h,fS(l),function(){k&&l(null,k)})},H._destroy=function(h,g){bI.Changes.removeAllListeners(H._name),J.transaction(function(k){var i=[dE,a6,ak,cp,dO,dg];i.forEach(function(l){k.executeSql("DROP TABLE IF EXISTS "+l,[])})},fS(g),function(){cN()&&(delete window.localStorage["_pouch__websqldb_"+H._name],delete window.localStorage[H._name]),g(null,{ok:!0})})}}function aa(i,g,j){try{i.apply(g,j)}catch(h){"undefined"!=typeof PouchDB&&PouchDB.emit("error",h)}}function bp(){if(!fH.running&&fH.queue.length){fH.running=!0;var g=fH.queue.shift();g.action(function(h,i){aa(g.callback,this,[h,i]),fH.running=!1,ex.nextTick(bp)})}}function cC(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(eL(az,i,h.type))}}function dv(h,g,i){return{data:bc(h),winningRev:g,deletedOrLocal:i?"1":"0",seq:h.seq,id:h.id}}function c2(h){if(!h){return null}var g=fD(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function aW(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function d0(i,g,j,h){j?h(i?"string"!=typeof i?i:dj(i,g):ev([""],{type:g})):i?"string"!=typeof i?bY(i,function(k){h(dd(k))}):h(i):h("")}function fi(m,j,q,l){function p(){++k===g.length&&l&&l()}function h(v,s){var u=v._attachments[s],o=u.digest,n=q.objectStore(a2).get(o);n.onsuccess=function(i){u.body=i.target.result.body,p()}}var g=Object.keys(m._attachments||{});if(!g.length){return l&&l()}var k=0;g.forEach(function(i){j.attachments&&j.include_docs?h(m,i):(m._attachments[i].stub=!0,p())})}function cW(h,g){return b0.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return b0.all(j.map(function(p){var l=i.doc._attachments[p];if("body" in l){var m=l.body,k=l.content_type;return new b0(function(n){d0(m,k,g,function(o){i.doc._attachments[p]=d9.extend(eB(l,["digest","content_type"]),{data:o}),n()})})}}))}}))}function aL(l,v,j){function g(){m--,m||h()}function h(){k.length&&k.forEach(function(n){var i=q.index("digestSeq").count(IDBKeyRange.bound(n+"::",n+"::",!1,!1));i.onsuccess=function(o){var r=o.target.result;r||w["delete"](n)}})}var k=[],p=j.objectStore(dY),w=j.objectStore(a2),q=j.objectStore(cm),m=l.length;l.forEach(function(i){var s=p.index("_doc_id_rev"),r=v+"::"+i;s.getKey(r).onsuccess=function(u){var o=u.target.result;if("number"!=typeof o){return g()}p["delete"](o);var x=q.index("seq").openCursor(IDBKeyRange.only(o));x.onsuccess=function(z){var y=z.target.result;if(y){var A=y.value.digestSeq.split("::")[0];k.push(A),q["delete"](y.primaryKey),y["continue"]()}else{g()}}}})}function dF(i,g,j){try{return{txn:i.transaction(g,j)}}catch(h){return{error:h}}}function a7(ce,U,an,X,ai,bn,cr){function V(){var h=[bh,dY,a2,bA,b5,cm],g=dF(ai,h,"readwrite");return g.error?cr(g.error):(co=g.txn,co.onabort=cC(cr),co.ontimeout=cC(cr),co.oncomplete=bt,M=co.objectStore(bh),Q=co.objectStore(dY),B=co.objectStore(a2),at=co.objectStore(cm),void bo(function(i){return i?(J=!0,cr(i)):void cn()}))}function P(){aw(ce.revs_limit,K,X,G,co,W,ae,an)}function cn(){function l(){++p===K.length&&P()}function j(i){var o=c2(i.target.result);o&&G.set(o.id,o),l()}if(K.length){for(var p=0,k=0,m=K.length;m>k;k++){var h=K[k];if(h._id&&e4(h._id)){l()}else{var g=M.get(h.metadata.id);g.onsuccess=j}}}}function bt(){J||(bn.notify(X._meta.name),X._meta.docCount+=Z,cr(null,W))}function ar(h,g){var i=B.get(h);i.onsuccess=function(k){if(k.target.result){g()}else{var j=eL(cA,"unknown stub attachment with digest "+h);j.status=412,g(j)}}}function bo(i){function g(){++j===k.length&&i(h)}var k=[];if(K.forEach(function(l){l.data&&l.data._attachments&&Object.keys(l.data._attachments).forEach(function(m){var n=l.data._attachments[m];n.stub&&k.push(n.digest)})}),!k.length){return i()}var h,j=0;k.forEach(function(l){ar(l,function(m){m&&!h&&(h=m),g()})})}function ae(l,v,j,g,h,k,p,w){Z+=k,l.metadata.winningRev=v,l.metadata.deleted=j;var q=l.data;q._id=l.metadata.id,q._rev=l.metadata.rev,g&&(q._deleted=!0);var m=q._attachments&&Object.keys(q._attachments).length;return m?ct(l,v,j,h,p,w):void H(l,v,j,h,p,w)}function N(h){var g=aB(h.metadata);aL(g,h.metadata.id,co)}function H(p,x,h,g,k,v){function y(n){g&&X.auto_compaction&&N(p),j.seq=n.target.result,delete j.rev;var l=dv(j,x,h),o=M.put(l);o.onsuccess=r}function w(l){l.preventDefault(),l.stopPropagation();var i=Q.index("_doc_id_rev"),o=i.getKey(m._doc_id_rev);o.onsuccess=function(s){var n=Q.put(m,s.target.result);n.onsuccess=y}}function r(){W[k]={ok:!0,id:j.id,rev:x},G.set(p.metadata.id,p.metadata),ao(p,j.seq,v)}var m=p.data,j=p.metadata;m._doc_id_rev=j.id+"::"+j.rev,delete m._id,delete m._rev;var q=Q.put(m);q.onsuccess=y,q.onerror=w}function ct(m,w,j,g,h,k){function q(){p===l.length&&H(m,w,j,g,h,k)}function x(){p++,q()}var v=m.data,p=0,l=Object.keys(v._attachments);l.forEach(function(i){var y=m.data._attachments[i];if(y.stub){p++,q()}else{var s=y.data;delete y.data;var u=y.digest;br(u,s,x)}})}function ao(m,j,q){function l(){++h===g.length&&q()}function p(u){var s=m.data._attachments[u].digest,r=at.put({seq:j,digestSeq:s+"::"+j});r.onsuccess=l,r.onerror=function(i){i.preventDefault(),i.stopPropagation(),l()}}var h=0,g=Object.keys(m.data._attachments||{});if(!g.length){return q()}for(var k=0;k<g.length;k++){p(g[k])}}function br(i,g,j){var h=B.count(i);h.onsuccess=function(m){var n=m.target.result;if(n){return j()}var l={digest:i,body:g},k=B.put(l);k.onsuccess=j}}for(var co,M,Q,B,at,Y,K=U.docs,Z=0,z=0,F=K.length;F>z;z++){var be=K[z];be._id&&e4(be._id)||(be=K[z]=ec(be,an.new_edits),be.error&&!Y&&(Y=be))}if(Y){return cr(Y)}var W=new Array(K.length),G=new bM.Map,J=!1,D=X._meta.blobSupport?"blob":"base64";aQ(K,D,function(g){return g?cr(g):void V()})}function al(k,h,m,j,l){try{if(k&&h){return l?IDBKeyRange.bound(h,k,!m,!1):IDBKeyRange.bound(k,h,!1,!m)}if(k){return l?IDBKeyRange.upperBound(k):IDBKeyRange.lowerBound(k)}if(h){return l?IDBKeyRange.lowerBound(h,!m):IDBKeyRange.upperBound(h,!m)}if(j){return IDBKeyRange.only(j)}}catch(g){return{error:g}}return null}function dP(i,g,j,h){return"DataError"===j.name&&0===j.code?h(null,{total_rows:i._meta.docCount,offset:g.skip,rows:[]}):void h(eL(az,j.name,j.message))}function cq(k,h,m,j){function l(Q,F){function I(i,s,p){var q=i.id+"::"+p;n.get(q).onsuccess=function(o){s.doc=aW(o.target.result),Q.conflicts&&(s.doc._conflicts=fs(i)),fi(s.doc,Q,O)}}function M(q,u,s){var p={id:s.id,key:s.id,value:{rev:u}},o=s.deleted;if("ok"===Q.deleted){L.push(p),o?(p.value.deleted=!0,p.doc=null):Q.include_docs&&I(s,p,u)}else{if(!o&&R--<=0&&(L.push(p),Q.include_docs&&I(s,p,u),0===--N)){return}}q["continue"]()}function V(p){G=h._meta.docCount;var s=p.target.result;if(s){var i=c2(s.value),q=i.winningRev;M(s,q,i)}}function D(){F(null,{total_rows:G,offset:Q.skip,rows:L})}function B(){Q.attachments?cW(L,Q.binary).then(D):D()}var T="startkey" in Q?Q.startkey:!1,P="endkey" in Q?Q.endkey:!1,K="key" in Q?Q.key:!1,R=Q.skip||0,N="number"==typeof Q.limit?Q.limit:-1,H=Q.inclusive_end!==!1,A="descending" in Q&&Q.descending?"prev":null,x=al(T,P,H,K,A);if(x&&x.error){return dP(h,Q,x.error,F)}var W=[bh,dY];Q.attachments&&W.push(a2);var J=dF(m,W,"readonly");if(J.error){return F(J.error)}var O=J.txn,U=O.objectStore(bh),z=O.objectStore(dY),C=A?U.openCursor(x,A):U.openCursor(x),n=z.index("_doc_id_rev"),L=[],G=0;O.oncomplete=B,C.onsuccess=V}function g(i,o){return 0===i.limit?o(null,{total_rows:h._meta.docCount,offset:i.skip,rows:[]}):void l(i,o)}g(k,j)}function dh(g){return new b0(function(h){var i=ev([""]);g.objectStore(df).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function fJ(h,g){var i=this;fH.queue.push({action:function(j){bW(i,h,j)},callback:g}),bp()}function bW(x,C,g){function k(i){var h=i.createObjectStore(bh,{keyPath:"id"});i.createObjectStore(dY,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),i.createObjectStore(a2,{keyPath:"digest"}),i.createObjectStore(bA,{keyPath:"id",autoIncrement:!1}),i.createObjectStore(df),h.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),i.createObjectStore(b5,{keyPath:"_id"});var l=i.createObjectStore(cm,{autoIncrement:!0});l.createIndex("seq","seq"),l.createIndex("digestSeq","digestSeq",{unique:!0})}function n(i,h){var l=i.objectStore(bh);l.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),l.openCursor().onsuccess=function(u){var s=u.target.result;if(s){var v=s.value,p=e6(v);v.deletedOrLocal=p?"1":"0",l.put(v),s["continue"]()}else{h()}}}function z(h){h.createObjectStore(b5,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function D(s,l){var v=s.objectStore(b5),p=s.objectStore(bh),u=s.objectStore(dY),h=p.openCursor();h.onsuccess=function(H){var E=H.target.result;if(E){var K=E.value,N=K.id,M=e4(N),J=fu(K);if(M){var G=N+"::"+J,r=N+"::",I=N+"::~",F=u.index("_doc_id_rev"),o=IDBKeyRange.bound(r,I,!1,!1),L=F.openCursor(o);L.onsuccess=function(O){if(L=O.target.result){var i=L.value;i._doc_id_rev===G&&v.put(i),u["delete"](L.primaryKey),L["continue"]()}else{p["delete"](E.primaryKey),E["continue"]()}}}else{E["continue"]()}}else{l&&l()}}}function B(i){var h=i.createObjectStore(cm,{autoIncrement:!0});h.createIndex("seq","seq"),h.createIndex("digestSeq","digestSeq",{unique:!0})}function y(s,l){var v=s.objectStore(dY),p=s.objectStore(a2),u=s.objectStore(cm),h=p.count();h.onsuccess=function(o){var i=o.target.result;return i?void (v.openCursor().onsuccess=function(J){var F=J.target.result;if(!F){return l()}for(var E=F.value,H=F.primaryKey,L=Object.keys(E._attachments||{}),N={},M=0;M<L.length;M++){var K=E._attachments[L[M]];N[K.digest]=!0}var I=Object.keys(N);for(M=0;M<I.length;M++){var G=I[M];u.put({seq:H,digestSeq:G+"::"+H})}F["continue"]()}):l()}}function w(l){function h(o){return o.data?c2(o):(o.deleted="1"===o.deletedOrLocal,o)}var s=l.objectStore(dY),i=l.objectStore(bh),p=i.openCursor();p.onsuccess=function(E){function F(){var I=v.id+"::",G=v.id+"::",H=s.index("_doc_id_rev").openCursor(IDBKeyRange.bound(I,G)),J=0;H.onsuccess=function(K){var o=K.target.result;if(!o){return v.seq=J,u()}var L=o.primaryKey;L>J&&(J=L),o["continue"]()}}function u(){var G=dv(v,v.winningRev,v.deleted),o=i.put(G);o.onsuccess=function(){r["continue"]()}}var r=E.target.result;if(r){var v=h(r.value);return v.winningRev=v.winningRev||fu(v),v.seq?u():void F()}}}var m=C.name,q=null;x._meta=null,x.type=function(){return"idb"},x._id=fm(function(h){h(null,x._meta.instanceId)}),x._bulkDocs=function(l,h,i){a7(C,l,h,x,q,fJ.Changes,i)},x._get=function(E,H,p){function h(){p(F,{doc:l,metadata:v,ctx:I})}var l,v,F,I=H.ctx;if(!I){var G=dF(q,[bh,dY,a2],"readonly");if(G.error){return p(G.error)}I=G.txn}I.objectStore(bh).get(E).onsuccess=function(o){if(v=c2(o.target.result),!v){return F=eL(aO,"missing"),h()}if(e6(v)&&!H.rev){return F=eL(aO,"deleted"),h()}var s=I.objectStore(dY),i=H.rev||v.winningRev,r=v.id+"::"+i;s.index("_doc_id_rev").get(r).onsuccess=function(u){return l=u.target.result,l&&(l=aW(l)),l?void h():(F=eL(aO,"missing"),h())}}},x._getAttachment=function(u,p,E){var s;if(p.ctx){s=p.ctx}else{var v=dF(q,[bh,dY,a2],"readonly");if(v.error){return E(v.error)}s=v.txn}var l=u.digest,h=u.content_type;s.objectStore(a2).get(l).onsuccess=function(o){var i=o.target.result.body;d0(i,h,p.binary,function(r){E(null,r)})}},x._info=function(p){if(null===q||!bg[m]){var F=new Error("db isn't open");return F.id="idbNull",p(F)}var v,E,l=dF(q,[dY],"readonly");if(l.error){return p(l.error)}var h=l.txn,u=h.objectStore(dY).openCursor(null,"prev");u.onsuccess=function(i){var o=i.target.result;v=o?o.key:0,E=x._meta.docCount},h.oncomplete=function(){p(null,{doc_count:E,update_seq:v,idb_attachment_format:x._meta.blobSupport?"binary":"base64"})}},x._allDocs=function(h,i){cq(h,x,q,i)},x._changes=function(G){function L(U){function W(){return p.seq!==s?U["continue"]():(F=s,p.winningRev===u._rev?V(u):void v())}function v(){var o=u._id+"::"+p.winningRev,i=h.get(o);i.onsuccess=function(r){V(aW(r.target.result))}}function V(Y){var i=G.processChange(Y,p,G);i.seq=p.seq;var X=S(i);return"object"==typeof X?G.complete(X):(X&&(O++,P&&M.push(i),G.attachments&&G.include_docs?fi(Y,G,Q,function(){cW([i],G.binary).then(function(){G.onChange(i)})}):G.onChange(i)),void (O!==R&&U["continue"]()))}var u=aW(U.value),s=U.key;if(H&&!H.has(u._id)){return U["continue"]()}var p;return(p=l.get(u._id))?W():void (E.get(u._id).onsuccess=function(i){p=c2(i.target.result),l.set(u._id,p),W()})}function I(o){var i=o.target.result;i&&L(i)}function K(){var i=[bh,dY];G.attachments&&i.push(a2);var r=dF(q,i,"readonly");if(r.error){return G.complete(r.error)}Q=r.txn,Q.onabort=cC(G.complete),Q.oncomplete=N,J=Q.objectStore(dY),E=Q.objectStore(bh),h=J.index("_doc_id_rev");var p;p=G.descending?J.openCursor(null,"prev"):J.openCursor(IDBKeyRange.lowerBound(G.since,!0)),p.onsuccess=I}function N(){function i(){G.complete(null,{results:M,last_seq:F})}!G.continuous&&G.attachments?cW(M).then(i):i()}if(G=eP(G),G.continuous){var T=m+":"+fd();return fJ.Changes.addListener(m,T,x,G),fJ.Changes.notify(m),{cancel:function(){fJ.Changes.removeListener(m,T)}}}var H=G.doc_ids&&new bM.Set(G.doc_ids);G.since=G.since||0;var F=G.since,R="limit" in G?G.limit:-1;0===R&&(R=1);var P;P="return_docs" in G?G.return_docs:"returnDocs" in G?G.returnDocs:!0;var Q,J,E,h,M=[],O=0,S=am(G),l=new bM.Map;K()},x._close=function(h){return null===q?h(eL(dl)):(q.close(),delete bg[m],q=null,void h())},x._getRevisionTree=function(l,h){var s=dF(q,[bh],"readonly");if(s.error){return h(s.error)}var i=s.txn,p=i.objectStore(bh).get(l);p.onsuccess=function(o){var r=c2(o.target.result);r?h(null,r.rev_tree):h(eL(aO))}},x._doCompaction=function(u,p,E){var s=[bh,dY,a2,cm],v=dF(q,s,"readwrite");if(v.error){return E(v.error)}var l=v.txn,h=l.objectStore(bh);h.get(u).onsuccess=function(H){var F=c2(H.target.result);e1(F.rev_tree,function(L,N,K,M,J){var I=N+"-"+K;-1!==p.indexOf(I)&&(J.status="missing")}),aL(p,u,l);var G=F.winningRev,i=F.deleted;l.objectStore(bh).put(dv(F,G,i))},l.onabort=cC(E),l.oncomplete=function(){E()}},x._getLocal=function(l,h){var s=dF(q,[b5],"readonly");if(s.error){return h(s.error)}var i=s.txn,p=i.objectStore(b5).get(l);p.onerror=cC(h),p.onsuccess=function(o){var r=o.target.result;r?(delete r._doc_id_rev,h(null,r)):h(eL(aO))}},x._putLocal=function(E,I,p){"function"==typeof I&&(p=I,I={}),delete E._revisions;var h=E._rev,l=E._id;h?E._rev="0-"+(parseInt(h.split("-")[1],10)+1):E._rev="0-1";var v,G=I.ctx;if(!G){var J=dF(q,[b5],"readwrite");if(J.error){return p(J.error)}G=J.txn,G.onerror=cC(p),G.oncomplete=function(){v&&p(null,v)}}var H,F=G.objectStore(b5);h?(H=F.get(l),H.onsuccess=function(u){var i=u.target.result;if(i&&i._rev===h){var r=F.put(E);r.onsuccess=function(){v={ok:!0,id:E._id,rev:E._rev},I.ctx&&p(null,v)}}else{p(eL(em))}}):(H=F.add(E),H.onerror=function(i){p(eL(em)),i.preventDefault(),i.stopPropagation()},H.onsuccess=function(){v={ok:!0,id:E._id,rev:E._rev},I.ctx&&p(null,v)})},x._removeLocal=function(E,H,p){"function"==typeof H&&(p=H,H={});var h=H.ctx;if(!h){var l=dF(q,[b5],"readwrite");if(l.error){return p(l.error)}h=l.txn,h.oncomplete=function(){v&&p(null,v)}}var v,F=E._id,I=h.objectStore(b5),G=I.get(F);G.onerror=cC(p),G.onsuccess=function(i){var s=i.target.result;s&&s._rev===E._rev?(I["delete"](F),v={ok:!0,id:F,rev:"0-0"},H.ctx&&p(null,v)):p(eL(aO))}},x._destroy=function(i,h){fJ.Changes.removeAllListeners(m),fJ.openReqList[m]&&fJ.openReqList[m].result&&(fJ.openReqList[m].result.close(),delete bg[m]);var l=indexedDB.deleteDatabase(m);l.onsuccess=function(){fJ.openReqList[m]&&(fJ.openReqList[m]=null),cN()&&m in localStorage&&delete localStorage[m],h(null,{ok:!0})},l.onerror=cC(h)};var j=bg[m];if(j){return q=j.idb,x._meta=j.global,void ex.nextTick(function(){g(null,x)})}var A;A=C.storage?eI(m,C.storage):indexedDB.open(m,bB),"openReqList" in fJ||(fJ.openReqList={}),fJ.openReqList[m]=A,A.onupgradeneeded=function(p){function i(){var l=h[s-1];s++,l&&l(o,i)}var u=p.target.result;if(p.oldVersion<1){return k(u)}var o=p.currentTarget.transaction;p.oldVersion<3&&z(u),p.oldVersion<4&&B(u);var h=[n,D,y,w],s=p.oldVersion;i()},A.onsuccess=function(p){q=p.target.result,q.onversionchange=function(){q.close(),delete bg[m]},q.onabort=function(i){console.error("Database has a global failure",i.target.error),q.close(),delete bg[m]};var v=q.transaction([bA,df,bh],"readwrite"),u=v.objectStore(bA).get(bA),l=null,h=null,r=null;u.onsuccess=function(s){var E=function(){null!==l&&null!==h&&null!==r&&(x._meta={name:m,instanceId:r,blobSupport:l,docCount:h},bg[m]={idb:q,global:x._meta},g(null,x))},i=s.target.result||{id:bA};m+"_id" in i?(r=i[m+"_id"],E()):(r=fd(),i[m+"_id"]=r,v.objectStore(bA).put(i).onsuccess=function(){E()}),cc||(cc=dh(v)),cc.then(function(o){l=o,E()});var F=v.objectStore(bh).index("deletedOrLocal");F.count(IDBKeyRange.only("0")).onsuccess=function(o){h=o.target.result,E()}}},A.onerror=function(i){var h="Failed to open indexedDB, are you in private browsing mode?";console.error(h),g(eL(az,h))}}function eI(h,g){try{return indexedDB.open(h,{version:bB,storage:g})}catch(i){return indexedDB.open(h,bB)}}var d9=d(7),fV="default" in d9?d9["default"]:d9,b7=d(6);b7="default" in b7?b7["default"]:b7;var bM=d(12);bM="default" in bM?bM["default"]:bM;var fz=d(4),c6=d(1);c6="default" in c6?c6["default"]:c6;var cd=d(2);cd="default" in cd?cd["default"]:cd;var bC=d(10),bi="default" in bC?bC["default"]:bC,dT=d(8);dT="default" in dT?dT["default"]:dT;var aZ=d(14);aZ="default" in aZ?aZ["default"]:aZ;var cg=d(15);cg="default" in cg?cg["default"]:cg;var bv=d(16);bv="default" in bv?bv["default"]:bv;var b0="function"==typeof Promise?Promise:dT,da=eM();b7(eA,Error),eA.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var fB=new eA({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),ba=new eA({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),aO=new eA({status:404,error:"not_found",reason:"missing"}),em=new eA({status:409,error:"conflict",reason:"Document update conflict"}),dJ=new eA({status:400,error:"invalid_id",reason:"_id field must contain a string"}),cG=new eA({status:412,error:"missing_id",reason:"_id is required for puts"}),d4=new eA({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),dl=new eA({status:412,error:"precondition_failed",reason:"Database not open"}),bQ=new eA({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),aE=new eA({status:500,error:"badarg",reason:"Some query argument is invalid"}),fO=new eA({status:400,error:"invalid_request",reason:"Request was invalid"}),ac=new eA({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),cw=new eA({status:500,error:"doc_validation",reason:"Bad special document member"}),dz=new eA({status:400,error:"bad_request",reason:"Something wrong with the request"}),eZ=new eA({status:400,error:"bad_request",reason:"Document must be a JSON object"}),au=new eA({status:404,error:"not_found",reason:"Database not found"}),az=new eA({status:500,error:"indexed_db_went_bad",reason:"unknown"}),cK=new eA({status:500,error:"web_sql_went_bad",reason:"unknown"}),cQ=new eA({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),bG=new eA({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),e=new eA({status:400,error:"bad_request",reason:"Invalid rev format"}),bl=new eA({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),cA=new eA({status:412,error:"missing_stub"}),ds=new eA({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),c0={UNAUTHORIZED:fB,MISSING_BULK_DOCS:ba,MISSING_DOC:aO,REV_CONFLICT:em,INVALID_ID:dJ,MISSING_ID:cG,RESERVED_ID:d4,NOT_OPEN:dl,UNKNOWN_ERROR:bQ,BAD_ARG:aE,INVALID_REQUEST:fO,QUERY_PARSE_ERROR:ac,DOC_VALIDATION:cw,BAD_REQUEST:dz,NOT_AN_OBJECT:eZ,DB_MISSING:au,WSQ_ERROR:cK,LDB_ERROR:cQ,FORBIDDEN:bG,INVALID_REV:e,FILE_EXISTS:bl,MISSING_STUB:cA,IDB_ERROR:az,INVALID_URL:ds},aU=function(i,g,k){var h=Object.keys(c0).filter(function(m){var l=c0[m];return"function"!=typeof l&&l[i]===g}),j=k&&h.filter(function(m){var l=c0[m];return l.message===k})[0]||h[0];return j?c0[j]:null},dX=function(){},fb=cd("pouchdb:api");b7(fl,fz.EventEmitter),fl.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},fl.prototype.doChanges=function(i){var g=this,k=i.complete;if(i=eP(i),"live" in i&&!("continuous" in i)&&(i.continuous=i.live),i.processChange=e9,"latest"===i.since&&(i.since="now"),i.since||(i.since=0),"now"===i.since){return void this.db.info().then(function(l){return g.isCancelled?void k(null,{status:"cancelled"}):(i.since=l.update_seq,void g.doChanges(i))},k)}if(i.continuous&&"now"!==i.since&&this.db.info().then(function(l){g.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),i.filter&&"string"==typeof i.filter&&("_view"===i.filter?i.view=fg(i.view):i.filter=fg(i.filter),"http"!==this.db.type()&&!i.doc_ids)){return this.filterChanges(i)}"descending" in i||(i.descending=!1),i.limit=0===i.limit?1:i.limit,i.complete=k;var h=this.db._changes(i);if(h&&"function"==typeof h.cancel){var j=g.cancel;g.cancel=c6(function(l){h.cancel(),j.apply(this,l)})}},fl.prototype.filterChanges=function(k){var h=this,m=k.complete;if("_view"===k.filter){if(!k.view||"string"!=typeof k.view){var j=eL(dz,"`view` filter parameter not found or invalid.");return m(j)}var l=fa(k.view);this.db.get("_design/"+l[0],function(p,o){if(h.isCancelled){return m(null,{status:"cancelled"})}if(p){return m(eG(p))}var n=o&&o.views&&o.views[l[1]]&&o.views[l[1]].map;return n?(k.filter=fq(n),void h.doChanges(k)):m(eL(aO,o.views?"missing json key: "+l[1]:"missing json key: views"))})}else{var g=fa(k.filter);if(!g){return h.doChanges(k)}this.db.get("_design/"+g[0],function(n,p){if(h.isCancelled){return m(null,{status:"cancelled"})}if(n){return m(eG(n))}var i=p&&p.filters&&p.filters[g[1]];return i?(k.filter=eD(i),void h.doChanges(k)):m(eL(aO,p&&p.filters?"missing json key: "+g[1]:"missing json key: filters"))})}};var cU="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),aJ=fc(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),dD=fc(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);b7(di,fz.EventEmitter),di.prototype.post=e0("post",function(h,g,i){return"function"==typeof g&&(i=g,g={}),"object"!=typeof h||Array.isArray(h)?i(eL(eZ)):void this.bulkDocs({docs:[h]},g,eS(i))}),di.prototype.put=e0("put",c6(function(l){var j,p,k,m,h=l.shift(),g="_id" in h;if("object"!=typeof h||Array.isArray(h)){return(m=l.pop())(eL(eZ))}for(;;){if(j=l.shift(),p=typeof j,"string"!==p||g?"string"!==p||!g||"_rev" in h?"object"===p?k=j:"function"===p&&(m=j):h._rev=j:(h._id=j,g=!0),!l.length){break}}return k=k||{},fj(h._id),e4(h._id)&&"function"==typeof this._putLocal?h._deleted?this._removeLocal(h,m):this._putLocal(h,m):void this.bulkDocs({docs:[h]},k,eS(m))})),di.prototype.putAttachment=e0("putAttachment",function(m,j,q,l,p,h){function g(i){return i._attachments=i._attachments||{},i._attachments[j]={content_type:p,data:l},k.put(i)}var k=this;return"function"==typeof p&&(h=p,p=l,l=q,q=null),"undefined"==typeof p&&(p=l,l=q,q=null),k.get(m).then(function(i){if(i._rev!==q){throw eL(em)}return g(i)},function(i){if(i.reason===aO.message){return g({_id:m})}throw i})}),di.prototype.removeAttachment=e0("removeAttachment",function(i,g,k,h){var j=this;j.get(i,function(m,l){return m?void h(m):l._rev!==k?void h(eL(em)):l._attachments?(delete l._attachments[g],0===Object.keys(l._attachments).length&&delete l._attachments,void j.put(l,h)):h()})}),di.prototype.remove=e0("remove",function(k,h,m,j){var l;"string"==typeof h?(l={_id:k,_rev:h},"function"==typeof m&&(j=m,m={})):(l=k,"function"==typeof h?(j=h,m={}):(j=m,m=h)),m=m||{},m.was_delete=!0;var g={_id:l._id,_rev:l._rev||m.rev};return g._deleted=!0,e4(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(l,j):void this.bulkDocs({docs:[g]},m,eS(j))}),di.prototype.revsDiff=e0("revsDiff",function(m,j,q){function l(n,i){k.has(n)||k.set(n,{missing:[]}),k.get(n).missing.push(i)}function p(i,s){var r=m[i].slice(0);e1(s,function(y,A,w,o,x){var v=A+"-"+w,z=r.indexOf(v);-1!==z&&(r.splice(z,1),"available"!==x.status&&l(i,v))}),r.forEach(function(n){l(i,n)})}"function"==typeof j&&(q=j,j={});var h=Object.keys(m);if(!h.length){return q(null,{})}var g=0,k=new bM.Map;h.map(function(i){this._getRevisionTree(i,function(o,n){if(o&&404===o.status&&"missing"===o.message){k.set(i,{missing:m[i]})}else{if(o){return q(o)}p(i,n)}if(++g===h.length){var s={};return k.forEach(function(u,r){s[r]=u}),q(null,s)}})},this)}),di.prototype.bulkGet=e0("bulkGet",function(h,g){eX(this,h,g)}),di.prototype.compactDocument=e0("compactDocument",function(i,g,j){var h=this;this._getRevisionTree(i,function(p,m){if(p){return j(p)}var k=a3(m),n=[],l=[];Object.keys(k).forEach(function(o){k[o]>g&&n.push(o)}),e1(m,function(v,s,x,u,w){var q=s+"-"+x;"available"===w.status&&-1!==n.indexOf(q)&&l.push(q)}),h._doCompaction(i,l,j)})}),di.prototype.compact=e0("compact",function(h,g){"function"==typeof h&&(g=h,h={});var i=this;h=h||{},i._compactionQueue=i._compactionQueue||[],i._compactionQueue.push({opts:h,callback:g}),1===i._compactionQueue.length&&bD(i)}),di.prototype._compact=function(l,j){function p(i){g.push(m.compactDocument(i.id,0))}function k(i){var o=i.last_seq;b0.all(g).then(function(){return eq(m,"_local/compaction",function(n){return !n.last_seq||n.last_seq<o?(n.last_seq=o,n):!1})}).then(function(){j(null,{ok:!0})})["catch"](j)}var m=this,h={return_docs:!1,last_seq:l.last_seq||0},g=[];m.changes(h).on("change",p).on("complete",k).on("error",j)},di.prototype.get=e0("get",function(m,j,q){function l(){var n=[],i=p.length;return i?void p.forEach(function(r){h.get(m,{rev:r,revs:j.revs,attachments:j.attachments},function(s,o){s?n.push({missing:r}):n.push({ok:o}),i--,i||q(null,n)})}):q(null,n)}if("function"==typeof j&&(q=j,j={}),"string"!=typeof m){return q(eL(dJ))}if(e4(m)&&"function"==typeof this._getLocal){return this._getLocal(m,q)}var p=[],h=this;if(!j.open_revs){return this._get(m,j,function(B,i){if(B){return q(B)}var w=i.doc,F=i.metadata,I=i.ctx;if(j.conflicts){var H=fs(F);H.length&&(w._conflicts=H)}if(e6(F,w._rev)&&(w._deleted=!0),j.revs||j.revs_info){var D=fh(F.rev_tree),A=fL(D,function(o){return -1!==o.ids.map(function(r){return r.id}).indexOf(w._rev.split("-")[1])}),x=A.ids.map(function(o){return o.id}).indexOf(w._rev.split("-")[1])+1,C=A.ids.length-x;if(A.ids.splice(x,C),A.ids.reverse(),j.revs&&(w._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(o){return o.id})}),j.revs_info){var z=A.pos+A.ids.length;w._revs_info=A.ids.map(function(o){return z--,{rev:z+"-"+o.id,status:o.opts.status}})}}if(j.attachments&&w._attachments){var n=w._attachments,G=Object.keys(n).length;if(0===G){return q(null,w)}Object.keys(n).forEach(function(o){this._getAttachment(n[o],{binary:j.binary,ctx:I},function(u,v){var s=w._attachments[o];s.data=v,delete s.stub,delete s.length,--G||q(null,w)})},h)}else{if(w._attachments){for(var E in w._attachments){w._attachments.hasOwnProperty(E)&&(w._attachments[E].stub=!0)}}q(null,w)}})}if("all"===j.open_revs){this._getRevisionTree(m,function(n,i){return n?q(n):(p=e7(i).map(function(o){return o.rev}),void l())})}else{if(!Array.isArray(j.open_revs)){return q(eL(bQ,"function_clause"))}p=j.open_revs;for(var g=0;g<p.length;g++){var k=p[g];if("string"!=typeof k||!/^\d+-/.test(k)){return q(eL(e))}}l()}}),di.prototype.getAttachment=e0("getAttachment",function(i,g,k,h){var j=this;k instanceof Function&&(h=k,k={}),this._get(i,k,function(m,l){return m?h(m):l.doc._attachments&&l.doc._attachments[g]?(k.ctx=l.ctx,k.binary=!0,j._getAttachment(l.doc._attachments[g],k,h),void 0):h(eL(aO))})}),di.prototype.allDocs=e0("allDocs",function(h,g){if("function"==typeof h&&(g=h,h={}),h.skip="undefined"!=typeof h.skip?h.skip:0,h.start_key&&(h.startkey=h.start_key),h.end_key&&(h.endkey=h.end_key),"keys" in h){if(!Array.isArray(h.keys)){return g(new TypeError("options.keys must be an array"))}var i=["startkey","endkey","key"].filter(function(j){return j in h})[0];if(i){return void g(eL(ac,"Query parameter `"+i+"` is not compatible with multi-get"))}if("http"!==this.type()){return cs(this,h,g)}}return this._allDocs(h,g)}),di.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new fl(this,h,g)},di.prototype.close=e0("close",function(g){return this._closed=!0,this._close(g)}),di.prototype.info=e0("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),di.prototype.id=e0("id",function(g){return this._id(g)}),di.prototype.bulkDocs=e0("bulkDocs",function(i,g,k){if("function"==typeof g&&(k=g,g={}),g=g||{},Array.isArray(i)&&(i={docs:i}),!i||!i.docs||!Array.isArray(i.docs)){return k(eL(ba))}for(var h=0;h<i.docs.length;++h){if("object"!=typeof i.docs[h]||Array.isArray(i.docs[h])){return k(eL(eZ))}}var j;return i.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){j=j||b8(m)})}),j?k(eL(dz,j)):("new_edits" in g||("new_edits" in i?g.new_edits=i.new_edits:g.new_edits=!0),g.new_edits||"http"===this.type()||i.docs.sort(d1),eR(i.docs),this._bulkDocs(i,g,function(m,l){return m?k(m):(g.new_edits||(l=l.filter(function(n){return n.error})),void k(null,l))}))}),di.prototype.registerDependentDatabase=e0("registerDependentDatabase",function(i,g){function j(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[i]?!1:(k.dependentDbs[i]=!0,k)}var h=new this.constructor(i,this.__opts);eq(this,"_local/_pouch_dependentDbs",j).then(function(){g(null,{db:h})})["catch"](g)}),di.prototype.destroy=e0("destroy",function(i,g){function k(){h._destroy(i,function(l,m){return l?g(l):(h.emit("destroyed"),void g(null,m||{ok:!0}))})}"function"==typeof i&&(g=i,i={});var h=this,j="use_prefix" in h?h.use_prefix:!0;return"http"===h.type()?k():void h.get("_local/_pouch_dependentDbs",function(p,n){if(p){return 404!==p.status?g(p):k()}var l=n.dependentDbs,o=h.constructor,m=Object.keys(l).map(function(r){var q=j?r.replace(new RegExp("^"+o.prefix),""):r;return new o(q,h.__opts).destroy()});b0.all(m).then(k,g)})}),fK.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},fK.prototype.fail=function(g){this.failed=g,this.execute()},fK.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},fK.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},b7(eK,di),eK.debug=cd;var a5;if(dQ()){a5=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),a5=!!localStorage.getItem("_pouch_check_localstorage")}catch(aj){a5=!1}}eK.adapters={},eK.preferredAdapters=[],eK.prefix="_pouch_";var dN=new fz.EventEmitter;ea(eK),eK.parseAdapter=function(m,j){var q,l,p=m.match(/([a-z\-]*):\/\/(.*)/);if(p){if(m=/http(s?)/.test(p[1])?p[1]+"://"+p[2]:p[2],q=p[1],!eK.adapters[q].valid()){throw"Invalid adapter"}return{name:m,adapter:p[1]}}var h="idb" in eK.adapters&&"websql" in eK.adapters&&cN()&&localStorage["_pouch__websqldb_"+eK.prefix+m];if(j.adapter){l=j.adapter}else{if("undefined"!=typeof j&&j.db){l="leveldb"}else{for(var g=0;g<eK.preferredAdapters.length;++g){if(l=eK.preferredAdapters[g],l in eK.adapters){if(h&&"idb"===l){console.log('PouchDB is downgrading "'+m+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}q=eK.adapters[l];var k=q&&"use_prefix" in q?q.use_prefix:!0;return{name:k?eK.prefix+m:m,adapter:l}},eK.adapter=function(h,g,i){g.valid()&&(eK.adapters[h]=g,i&&eK.preferredAdapters.push(h))},eK.plugin=function(g){return Object.keys(g).forEach(function(h){eK.prototype[h]=g[h]}),eK},eK.defaults=function(h){function g(k,i,j){return this instanceof g?(("function"==typeof i||"undefined"==typeof i)&&(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=d9.extend({},h,i),void eK.call(this,k,i,j)):new g(k,i,j)}return b7(g,eK),ea(g),g.preferredAdapters=eK.preferredAdapters.slice(),Object.keys(eK).forEach(function(i){i in g||(g[i]=eK[i])}),g};var cl=function(g){return atob(g)},dd=function(g){return btoa(g)},fG=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],bU="queryKey",eC=/(?:^|&)([^&=]*)=?([^&]*)/g,d7=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,fT=fV.extend,b4={ajax:eN,parseUri:aH,uuid:fd,Promise:b0,atob:cl,btoa:dd,binaryStringToBlobOrBuffer:bX,clone:eP,extend:fT,createError:eL},bK=bi.collate,fx=1,c4="pouchdb",cb=5,bz=0;fk.prototype.writeCheckpoint=function(h,g){var i=this;return this.updateTarget(h,g).then(function(){return i.updateSource(h,g)})},fk.prototype.updateTarget=function(h,g){return dG(this.target,this.id,h,g,this.returnValue)},fk.prototype.updateSource=function(h,g){var i=this;return this.readOnlySource?b0.resolve(!0):dG(this.src,this.id,h,g,this.returnValue)["catch"](function(k){var j="number"==typeof k.status&&4===Math.floor(k.status/100);if(j){return i.readOnlySource=!0,!0}throw k})};var bf={undefined:function(h,g){return 0===bK(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return ax(g,h).last_seq}};fk.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.src.get(g.id).then(function(i){if(h.version!==i.version){return bz}var j;return j=h.version?h.version.toString():"undefined",j in bf?bf[j](h,i):bz},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:bz}).then(function(){return bz},function(j){return 401===j.status?(g.readOnlySource=!0,h.last_seq):bz})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return bz})};var dU=0,a0=ep.setImmediate||ep.setTimeout,ch=32768,bw=fm(function(l,v){function j(){var n=w*k,u=n+k;if(w++,p>w){m(q,l,n,u),a0(j)}else{m(q,l,n,u);var s=q.end(!0),i=bs(s);v(null,i),q.destroy()}}var g="string"==typeof l,h=g?l.length:l.byteLength,k=Math.min(ch,h),p=Math.ceil(h/k),w=0,q=g?new cg:new cg.ArrayBuffer,m=g?dx:cE;j()});b7(dH,fz.EventEmitter),dH.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},dH.prototype.ready=function(i,g){function k(){j.cancel()}function h(){i.removeListener("destroyed",k),g.removeListener("destroyed",k)}var j=this;j._readyCalled||(j._readyCalled=!0,i.once("destroyed",k),g.once("destroyed",k),j.once("complete",h))};var b1={replicate:ap,toPouch:a8},db=b1.replicate;b7(cu,fz.EventEmitter),cu.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var fC=25,bb=50,aP={},eu=1800,dK=cd("pouchdb:http");bq.valid=function(){return !0};var cH=function(h,g){return g&&h.then(function(i){ex.nextTick(function(){g(null,i)})},function(i){ex.nextTick(function(){g(i)})}),h},dm=function(g){return c6(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&cH(i,j),i})},bR=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},aF=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},fP=function(k){for(var h={},m=0,j=k.length;j>m;m++){h["$"+k[m]]=!0}var l=Object.keys(h),g=new Array(l.length);for(m=0,j=l.length;j>m;m++){g[m]=l[m].substring(1)}return g},ad={uniq:fP,sequentialize:aF,fin:bR,callbackify:dm,promisedCallback:cH};dS.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},dS.prototype.finish=function(){return this.promise};var cx,dA=bi.collate,e3=bi.toIndexableString,av=bi.normalizeKey,aA=bi.parseIndexableString;cx="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var cL=ad.callbackify,cR=ad.sequentialize,bH=ad.uniq,t=ad.fin,bm=ad.promisedCallback,cB={},du=new dS,c1=50,aV={_sum:function(h,g){return bP(g)},_count:function(h,g){return g.length},_stats:function(h,g){function i(l){for(var j=0,p=0,k=l.length;k>p;p++){var m=l[p];j+=m*m}return j}return{sum:bP(g),min:Math.min.apply(null,g),max:Math.max.apply(null,g),count:g.length,sumsqr:i(g)}}},dZ=cL(function(){var g=this;return"http"===g.type()?dW(g):"function"==typeof g._viewCleanup?ay(g):e8(g)}),ff=function(i,g,k){"function"==typeof g&&(k=g,g={}),g=g?ab(g):{},"function"==typeof i&&(i={map:i});var h=this,j=b0.resolve().then(function(){return cT(h,i,g)});return bm(j,k),j};b7(aI,Error),b7(dC,Error),b7(a4,Error);var cV={query:ff,viewCleanup:dZ},aK=7,dE=ah("document-store"),a6=ah("by-sequence"),ak=ah("attach-store"),dO=ah("local-store"),cp=ah("metadata-store"),dg=ah("attach-seq-store"),fI={};b7(bd,fz.EventEmitter),bd.prototype.addListener=function(l,j,p,k){function m(){function n(){g=!1}if(h._listeners[j]){if(g){return void (g="waiting")}g=!0;var i=eB(k,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);p.changes(i).on("change",function(o){o.seq>k.since&&!k.cancelled&&(k.since=o.seq,k.onChange(o))}).on("complete",function(){"waiting"===g&&setTimeout(function(){m()},0),g=!1}).on("error",n)}}if(!this._listeners[j]){var h=this,g=!1;this._listeners[j]=m,this.on(l,m)}},bd.prototype.removeListener=function(h,g){g in this._listeners&&fz.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},bd.prototype.notifyLocalWindows=function(g){dQ()?chrome.storage.local.set({dbName:g}):cN()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},bd.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var bV=1,eF="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+a6+" (seq, deleted)",d8="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+a6+" (doc_id, rev)",fU="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+dE+" (winningseq)",b6="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+dg+" (seq)",bL="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+dg+" (digest, seq)",fy=a6+".seq = "+dE+".winningseq",c5=a6+".seq AS seq, "+a6+".deleted AS deleted, "+a6+".json AS data, "+a6+".rev AS rev, "+dE+".json AS metadata";bI.valid=ca,bI.Changes=new bd;var cc,bB=5,bh="document-store",dY="by-sequence",a2="attach-store",cm="attach-seq-store",bA="meta-store",b5="local-store",df="detect-blob-support",fH={running:!1,queue:[]},bg={};fJ.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange},fJ.Changes=new bd;var aR={idb:fJ,websql:bI};eK.ajax=eN,eK.utils=b4,eK.Errors=c0,eK.replicate=b1.replicate,eK.sync=dR,eK.version="5.2.0",eK.adapter("http",bq),eK.adapter("https",bq),eK.plugin(cV),Object.keys(aR).forEach(function(g){eK.adapter(g,aR[g],!0)}),c.exports=eK}).call(this,d(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});