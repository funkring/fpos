!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(c,f,h){function j(i,l){if(!f[i]){if(!c[i]){var k="function"==typeof require&&require;if(!l&&k){return k(i,!0)}if(g){return g(i,!0)}var e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}var m=f[i]={exports:{}};c[i][0].call(m.exports,function(o){var n=c[i][1][o];return j(n?n:o)},m,m.exports,a,c,f,h)}return f[i].exports}for(var g="function"==typeof require&&require,d=0;d<h.length;d++){j(h[d])}return j}({1:[function(j,l,f){function k(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function g(e){return"number"==typeof e}function h(e){return"object"==typeof e&&null!==e}function c(e){return void 0===e}l.exports=k,k.EventEmitter=k,k.prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.prototype.setMaxListeners=function(e){if(!g(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},k.prototype.emit=function(i){var p,n,o,q,e,m;if(this._events||(this._events={}),"error"===i&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){if(p=arguments[1],p instanceof Error){throw p}throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[i],c(n)){return !1}if(d(n)){switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:q=Array.prototype.slice.call(arguments,1),n.apply(this,q)}}else{if(h(n)){for(q=Array.prototype.slice.call(arguments,1),m=n.slice(),o=m.length,e=0;o>e;e++){m[e].apply(this,q)}}}return !0},k.prototype.addListener=function(m,i){var e;if(!d(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,d(i.listener)?i.listener:i),this._events[m]?h(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,h(this._events[m])&&!this._events[m].warned&&(e=c(this._maxListeners)?k.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},k.prototype.on=k.prototype.addListener,k.prototype.once=function(e,m){function i(){this.removeListener(e,i),n||(n=!0,m.apply(this,arguments))}if(!d(m)){throw TypeError("listener must be a function")}var n=!1;return i.listener=m,this.on(e,i),this},k.prototype.removeListener=function(m,p){var o,n,e,i;if(!d(p)){throw TypeError("listener must be a function")}if(!this._events||!this._events[m]){return this}if(o=this._events[m],e=o.length,n=-1,o===p||d(o.listener)&&o.listener===p){delete this._events[m],this._events.removeListener&&this.emit("removeListener",m,p)}else{if(h(o)){for(i=e;i-->0;){if(o[i]===p||o[i].listener&&o[i].listener===p){n=i;break}}if(0>n){return this}1===o.length?(o.length=0,delete this._events[m]):o.splice(n,1),this._events.removeListener&&this.emit("removeListener",m,p)}}return this},k.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],d(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},k.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?d(this._events[i])?[this._events[i]]:this._events[i].slice():[]},k.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(d(e)){return 1}if(e){return e.length}}return 0},k.listenerCount=function(i,e){return i.listenerCount(e)}},{}],2:[function(m,q,w){function p(){j&&v&&(j=!1,v.length?A=v.concat(A):d=-1,A.length&&c())}function c(){if(!j){var f=y(p);j=!0;for(var e=A.length;e;){for(v=A,A=[];++d<e;){v&&v[d].run()}d=-1,e=A.length}v=null,j=!1,x(f)}}function g(f,e){this.fun=f,this.array=e}function z(){}var y,x,k=q.exports={};!function(){try{y=setTimeout}catch(e){y=function(){throw new Error("setTimeout is not defined")}}try{x=clearTimeout}catch(e){x=function(){throw new Error("clearTimeout is not defined")}}}();var v,A=[],j=!1,d=-1;k.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var h=1;h<arguments.length;h++){e[h-1]=arguments[h]}}A.push(new g(f,e)),1!==A.length||j||y(c,0)},g.prototype.run=function(){this.fun.apply(null,this.array)},k.title="browser",k.browser=!0,k.env={},k.argv=[],k.version="",k.versions={},k.on=z,k.addListener=z,k.once=z,k.off=z,k.removeListener=z,k.removeAllListeners=z,k.emit=z,k.binding=function(e){throw new Error("process.binding is not supported")},k.cwd=function(){return"/"},k.chdir=function(e){throw new Error("process.chdir is not supported")},k.umask=function(){return 0}},{}],3:[function(c,f,d){(function(dC,bJ){function eX(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function e4(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function f3(j){if("function"==typeof j.slice){return j.slice(0)}var h=new ArrayBuffer(j.byteLength),g=new Uint8Array(h),i=new Uint8Array(j);return g.set(i),h}function eO(i){if(i instanceof ArrayBuffer){return f3(i)}var h=i.size,g=i.type;return"function"==typeof i.slice?i.slice(0,h,g):i.webkitSlice(0,h,g)}function d2(i){var h=Object.getPrototypeOf(i);if(null===h){return !0}var g=h.constructor;return"function"==typeof g&&g instanceof g&&eJ.call(g)==cz}function dY(h){var k,j,g;if(!h||"object"!=typeof h){return h}if(Array.isArray(h)){for(k=[],j=0,g=h.length;g>j;j++){k[j]=dY(h[j])}return k}if(h instanceof Date){return h.toISOString()}if(e4(h)){return eO(h)}if(!d2(h)){return h}k={};for(j in h){if(Object.prototype.hasOwnProperty.call(h,j)){var i=dY(h[j]);"undefined"!=typeof i&&(k[j]=i)}}return k}function dg(g){var h=!1;return cf(function(i){if(h){throw new Error("once called more than once")}h=!0,g.apply(this,i)})}function f5(g){return cf(function(j){j=dY(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(m,n){dC.nextTick(function(){i(m,n)})});var h=new bm(function(q,p){var n;try{var m=dg(function(r,s){r?p(r):q(s)});j.push(m),n=g.apply(l,j),n&&"function"==typeof n.then&&q(n)}catch(o){p(o)}});return k&&h.then(function(m){k(null,m)},k),h})}function eE(i,h){function g(n,l,j){if(d4.enabled){for(var m=[n._db_name,l],o=0;o<j.length-1;o++){m.push(j[o])}d4.apply(null,m);var k=j[j.length-1];j[j.length-1]=function(r,p){var q=[n._db_name,l];q=q.concat(r?["error",r]:["success",p]),d4.apply(null,q),k(r,p)}}}return f5(cf(function(j){if(this._closed){return bm.reject(new Error("database is closed"))}if(this._destroyed){return bm.reject(new Error("database is destroyed"))}var k=this;return g(k,i,j),this.taskqueue.isReady?h.apply(this,j):new bm(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[i].apply(k,j))})})}))}function fD(i,l){for(var k={},h=0,j=l.length;j>h;h++){var g=l[h];g in i&&(k[g]=i[g])}return k}function ed(g){return g}function ch(g){return[{ok:g}]}function eB(i,m,g){function n(){var w=[];h.forEach(function(x){x.docs.forEach(function(y){w.push({id:x.id,docs:[y]})})}),g(null,{results:w})}function o(){++r===s&&n()}function u(y,x,w){h[y]={id:x,docs:w},o()}function q(){if(!(v>=j.length)){var x=Math.min(v+aZ,j.length),w=j.slice(v,x);k(w,v),v+=w.length}}function k(x,w){x.forEach(function(D,B){var z=w+B,A=l[D],C=fD(A[0],["atts_since","attachments"]);C.open_revs=A.map(function(E){return E.rev}),C.open_revs=C.open_revs.filter(ed);var y=ed;0===C.open_revs.length&&(delete C.open_revs,y=ch),["revs","attachments","binary","ajax"].forEach(function(E){E in m&&(C[E]=m[E])}),i.get(D,C,function(G,E){var F;F=G?[{error:G}]:y(E),u(z,D,F),q()})})}var p=m.docs,l={};p.forEach(function(w){w.id in l?l[w.id].push(w):l[w.id]=[w]});var s=Object.keys(l).length,r=0,h=new Array(s),j=Object.keys(l),v=0;q()}function c4(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function dd(){return fC}function dy(g){c4()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):dd()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function eC(){b6.EventEmitter.call(this),this._listeners={},dy(this)}function dX(g){if("undefined"!==console&&g in console){var h=Array.prototype.slice.call(arguments,1);console[g].apply(console,h)}}function eK(h,k){var j=600000;h=parseInt(h,10)||0,k=parseInt(k,10),k!==k||h>=k?k=(h||1)<<1:k+=1,k>j&&(h=j>>1,k=j);var g=Math.random(),i=k-h;return ~~(i*g+h)}function c1(g){var h=0;return g||(h=2000),eK(g,h)}function cU(g,h){dX("info","The above "+g+" is totally normal. "+h)}function eA(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function bS(j,h,g){function i(k){for(var l in j){"function"!=typeof j[l]&&(this[l]=j[l])}void 0!==g&&(this.name=g),void 0!==k&&(this.reason=k)}return i.prototype=eA.prototype,new i(h)}function aL(i){var l,k,h,j,g;return k=i.error===!0&&"string"==typeof i.name?i.name:i.error,g=i.reason,h=cD("name",k,g),i.missing||"missing"===g||"deleted"===g||"not_found"===k?h=aX:"doc_validation"===k?(h=f7,j=g):"bad_request"===k&&h.message!==g&&(h=cs),h||(h=cD("status",i.status,g)||e6),l=bS(h,g,k),j&&(l.message=j),i.id&&(l.id=i.id),i.status&&(l.status=i.status),i.missing&&(l.missing=i.missing),l}function bc(h,k,j){try{return !h(k,j)}catch(g){var i="Filter function threw: "+g.toString();return bS(cs,i)}}function d8(i){var h={},g=i.filter&&"function"==typeof i.filter;return h.query=i.query_params,function(k){k.doc||(k.doc={});var l=g&&bc(i.filter,k.doc,h);if("object"==typeof l){return l}if(l){return !1}if(i.include_docs){if(!i.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function eU(j){for(var h=[],g=0,i=j.length;i>g;g++){h=h.concat(j[g])}return h}function av(g){var h;if(g?"string"!=typeof g?h=bS(au):/^_/.test(g)&&!/^_(design|local)/.test(g)&&(h=bS(kh)):h=bS(dF),h){throw h}}function dk(g,h){return"listenerCount" in g?g.listenerCount(h):b6.EventEmitter.listenerCount(g,h)}function bH(g){if(!g){return null}var h=g.split("/");return 2===h.length?h:1===h.length?[g,g]:null}function eR(g){var h=bH(g);return h?h.join("/"):null}function aU(k){for(var i=dw.exec(k),g={},j=14;j--;){var l=ea[j],m=i[j]||"",h=-1!==["user","password"].indexOf(l);g[l]=h?decodeURIComponent(m):m}return g[jR]={},g[ea[12]].replace(ka,function(p,n,o){n&&(g[jR][n]=o)}),g}function jG(i,h,g){return new bm(function(j,k){i.get(h,function(o,m){if(o){if(404!==o.status){return k(o)}m={}}var l=m._rev,n=g(m);return n?(n._id=h,n._rev=l,void j(aP(i,n,g))):j({updated:!1,rev:l})})})}function aP(i,h,g){return i.put(h).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return jG(i,h._id,g)})}function ds(g){return 0|Math.random()*g}function cm(j,h){h=h||kd.length;var g="",i=-1;if(j){for(;++i<j;){g+=kd[ds(h)]}return g}for(;++i<36;){switch(i){case 8:case 13:case 18:case 23:g+="-";break;case 19:g+=kd[3&ds(16)|8];break;default:g+=kd[ds(16)]}}return g}function d3(r){for(var l,o,m,n,q=r.rev_tree.slice();n=q.pop();){var j=n.ids,s=j[2],k=n.pos;if(s.length){for(var i=0,g=s.length;g>i;i++){q.push({pos:k+1,ids:s[i]})}}else{var p=!!j[1].deleted,h=j[0];l&&!(m!==p?m:o!==k?k>o:h>l)||(l=h,o=k,m=p)}}return o+"-"+l}function fB(o,h){for(var l,j=o.slice();l=j.pop();){for(var k=l.pos,m=l.ids,g=m[2],i=h(0===g.length,k,m[0],l.ctx,m[1]),n=0,p=g.length;p>n;n++){j.push({pos:k+1,ids:g[n],ctx:i})}}}function fM(g,h){return g.pos-h.pos}function dH(j){var h=[];fB(j,function(l,n,k,m,o){l&&h.push({rev:n+"-"+k,pos:n,opts:o})}),h.sort(fM).reverse();for(var g=0,i=h.length;i>g;g++){delete h[g].pos}return h}function e8(k){for(var i=d3(k),g=dH(k.rev_tree),j=[],l=0,m=g.length;m>l;l++){var h=g[l];h.rev===i||h.opts.deleted||j.push(h.rev)}return j}function af(g){var h=[];return fB(g.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(h.push(i+"-"+k),j.status="missing")}),h}function dh(r){for(var l,o=[],m=r.slice();l=m.pop();){var n=l.pos,q=l.ids,j=q[0],s=q[1],k=q[2],i=0===k.length,g=l.history?l.history.slice():[];g.push({id:j,opts:s}),i&&o.push({pos:n+1-g.length,ids:g});for(var p=0,h=k.length;h>p;p++){m.push({pos:n+1,ids:k[p],history:g})}}return o.reverse()}function aA(g,h){return g.pos-h.pos}function fH(i,l,k){for(var h,j=0,g=i.length;g>j;){h=j+g>>>1,k(i[h],l)<0?j=h+1:g=h}return j}function du(j,h,g){var i=fH(j,h,g);j.splice(i,0,h)}function ap(j,l){for(var h,n,g=l,k=j.length;k>g;g++){var i=j[g],m=[i.id,i.opts,[]];n?(n[2].push(m),n=m):h=n=m}return h}function ki(g,h){return g[0]<h[0]?-1:1}function bI(o,h){for(var l=[{tree1:o,tree2:h}],j=!1;l.length>0;){var k=l.pop(),m=k.tree1,g=k.tree2;(m[1].status||g[1].status)&&(m[1].status="available"===m[1].status||"available"===g[1].status?"available":"missing");for(var i=0;i<g[2].length;i++){if(m[2][0]){for(var n=!1,p=0;p<m[2].length;p++){m[2][p][0]===g[2][i][0]&&(l.push({tree1:m[2][p],tree2:g[2][i]}),n=!0)}n||(j="new_branch",du(m[2],g[2][i],ki))}else{j="new_leaf",m[2][0]=g[2][i]}}}return{conflicts:j,tree:o}}function ad(q,y,p){var n,k=[],v=!1,w=!1;if(!q.length){return{tree:[y],conflicts:"new_leaf"}}for(var A=0,j=q.length;j>A;A++){var o=q[A];if(o.pos===y.pos&&o.ids[0]===y.ids[0]){n=bI(o.ids,y.ids),k.push({pos:o.pos,ids:n.tree}),v=v||n.conflicts,w=!0}else{if(p!==!0){var m=o.pos<y.pos?o:y,s=o.pos<y.pos?y:o,z=s.pos-m.pos,x=[],i=[];for(i.push({ids:m.ids,diff:z,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],u=0,r=g.length;r>u;u++){i.push({ids:g[u],diff:h.diff-1,parent:h.ids,parentIdx:u})}}else{h.ids[0]===s.ids[0]&&x.push(h)}}var l=x[0];l?(n=bI(l.ids,s.ids),l.parent[2][l.parentIdx]=n.tree,k.push({pos:m.pos,ids:m.ids}),v=v||n.conflicts,w=!0):k.push(o)}else{k.push(o)}}}return w||k.push(y),k.sort(aA),{tree:k,conflicts:v||"internal_node"}}function aI(r,l){for(var o,m=dh(r),n={},q=0,j=m.length;j>q;q++){for(var s=m[q],k=s.ids,i=Math.max(0,k.length-l),g={pos:s.pos+i,ids:ap(k,i)},p=0;i>p;p++){var h=s.pos+p+"-"+k[p].id;n[h]=!0}o=o?ad(o,g,!0).tree:[g]}return fB(o,function(u,w,v){delete n[w+"-"+v]}),{tree:o,revs:Object.keys(n)}}function cV(h,k,j){var g=ad(h,k),i=aI(g.tree,j);return{tree:i.tree,stemmedRevs:i.revs,conflicts:g.conflicts}}function cE(o,h){for(var l,j=o.slice(),k=h.split("-"),m=parseInt(k[0],10),g=k[1];l=j.pop();){if(l.pos===m&&l.ids[0]===g){return !0}for(var i=l.ids[2],n=0,p=i.length;p>n;n++){j.push({pos:l.pos+1,ids:i[n]})}}return !1}function bi(g){return g.ids}function aT(h,k){k||(k=d3(h));for(var j,g=k.substring(k.indexOf("-")+1),i=h.rev_tree.map(bi);j=i.pop();){if(j[0]===g){return !!j[1].deleted}i=i.concat(j[2])}}function e5(g){return/^_local/.test(g)}function cI(g){return cL("return "+g+";",{})}function jY(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function dZ(i,h){try{i.emit("change",h)}catch(g){dX("error",'Error in .on("change", function):',g)}}function eM(k,i,g){function j(){l.cancel()}b6.EventEmitter.call(this);var l=this;this.db=k,i=i?dY(i):{};var m=i.complete=dg(function(n,o){n?dk(l,"error")>0&&l.emit("error",n):l.emit("complete",o),l.removeAllListeners(),k.removeListener("destroyed",j)});g&&(l.on("complete",function(n){g(null,n)}),l.on("error",g)),k.once("destroyed",j),i.onChange=function(n){i.isCancelled||(dZ(l,n),l.startSeq&&l.startSeq<=n.seq&&(l.startSeq=!1))};var h=new bm(function(n,o){i.complete=function(p,q){p?o(p):n(q)}});l.once("cancel",function(){k.removeListener("destroyed",j),i.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){m(null,n)},m),k.taskqueue.isReady?l.doChanges(i):k.taskqueue.addTask(function(){l.isCancelled?l.emit("cancel"):l.doChanges(i)})}function eS(h,k,j){var g=[{rev:h._rev}];"all_docs"===j.style&&(g=dH(k.rev_tree).map(function(l){return{rev:l.rev}}));var i={id:k.id,changes:g,doc:h};return aT(k,h._rev)&&(i.deleted=!0),j.conflicts&&(i.doc._conflicts=e8(k),i.doc._conflicts.length||delete i.doc._conflicts),i}function cP(g,h){return h>g?-1:g>h?1:0}function f0(i,h){for(var g=0;g<i.length;g++){if(h(i[g],g)===!0){return i[g]}}}function bP(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function jQ(i){for(var l=0;l<i.length;l++){var k=i[l];if(k._deleted){delete k._attachments}else{if(k._attachments){for(var h=Object.keys(k._attachments),j=0;j<h.length;j++){var g=h[j];k._attachments[g]=fD(k._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function dT(h,k){var j=cP(h._id,k._id);if(0!==j){return j}var g=h._revisions?h._revisions.start:0,i=k._revisions?k._revisions.start:0;return cP(g,i)}function cd(i){var h={},g=[];return fB(i,function(l,k,m,j){var n=k+"-"+m;return l&&(h[n]=0),void 0!==j&&g.push({from:j,to:n}),n}),g.reverse(),g.forEach(function(j){void 0===h[j.from]?h[j.from]=1+h[j.to]:h[j.from]=Math.min(h[j.from],1+h[j.to])}),h}function bV(h,k,j){var g="limit" in k?k.keys.slice(k.skip,k.limit+k.skip):k.skip>0?k.keys.slice(k.skip):k.keys;if(k.descending&&g.reverse(),!g.length){return h._allDocs({limit:0},j)}var i={offset:k.skip};return bm.all(g.map(function(m){var l=dc.extend({key:m,deleted:"ok"},k);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new bm(function(n,o){h._allDocs(l,function(q,p){return q?o(q):(i.total_rows=p.total_rows,void n(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return i.rows=l,i})}function eb(j){var h=j._compactionQueue[0],i=h.opts,g=h.callback;j.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(i.last_seq=k.last_seq),j._compact(i,function(l,m){l?g(l):g(null,m),dC.nextTick(function(){j._compactionQueue.shift(),j._compactionQueue.length&&eb(j)})})})}function e3(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function e0(){b6.EventEmitter.call(this)}function c9(){this.isReady=!1,this.failed=!1,this.queue=[]}function aQ(g){g&&bJ.debug&&dX("error",g)}function eG(k,i){function g(){m.emit("destroyed",l)}function j(){k.removeListener("destroyed",g),k.emit("destroyed",k)}var l=i.originalName,m=k.constructor,h=m._destructionListeners;k.once("destroyed",g),h.has(l)||h.set(l,[]),h.get(l).push(j)}function aa(k,i,g){if(!(this instanceof aa)){return new aa(k,i,g)}var j=this;if("function"!=typeof i&&"undefined"!=typeof i||(g=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),"undefined"==typeof g){g=aQ}else{var l=g;g=function(){return dX("warn","Using a callback for new PouchDB()is deprecated."),l.apply(null,arguments)}}k=k||i.name,i=dY(i),delete i.name,this.__opts=i;var m=g;j.auto_compaction=i.auto_compaction,j.prefix=aa.prefix,e0.call(j),j.taskqueue=new c9;var h=new bm(function(n,p){g=function(r,s){return r?p(r):(delete s.then,void n(s))},i=dY(i);var o,q;return function(){try{if("string"!=typeof k){throw q=new Error("Missing/invalid DB name"),q.code=400,q}var r=(i.prefix||"")+k;if(o=aa.parseAdapter(r,i),i.originalName=k,i.name=o.name,i.adapter=i.adapter||o.adapter,j._adapter=i.adapter,cJ("pouchdb:adapter")("Picked adapter: "+i.adapter),j._db_name=k,!aa.adapters[i.adapter]){throw q=new Error("Adapter is missing"),q.code=404,q}if(!aa.adapters[i.adapter].valid()){throw q=new Error("Invalid Adapter"),q.code=404,q}}catch(s){j.taskqueue.fail(s)}}(),q?p(q):(j.adapter=i.adapter,j.replicate={},j.replicate.from=function(r,u,s){return j.constructor.replicate(r,j,u,s)},j.replicate.to=function(r,u,s){return j.constructor.replicate(j,r,u,s)},j.sync=function(r,u,s){return j.constructor.sync(j,r,u,s)},j.replicate.sync=j.sync,void aa.adapters[i.adapter].call(j,i,function(r){return r?(j.taskqueue.fail(r),void g(r)):(eG(j,i),j.emit("created",j),aa.emit("created",i.originalName),j.taskqueue.ready(j),void g(null,j))}))});h.then(function(n){m(null,n)},m),j.then=h.then.bind(h),j["catch"]=h["catch"].bind(h)}function bR(g){Object.keys(b6.EventEmitter.prototype).forEach(function(i){"function"==typeof b6.EventEmitter.prototype[i]&&(g[i]=bF[i].bind(bF))});var h=g._destructionListeners=new cY.Map;g.on("destroyed",function(i){h.get(i).forEach(function(j){j()}),h["delete"](i)})}function bq(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function eh(j){if(!/^\d+\-./.test(j)){return bS(bE)}var h=j.indexOf("-"),g=j.substring(0,h),i=j.substring(h+1);return{prefix:parseInt(g,10),id:i}}function e(k,i){for(var g=k.start-k.ids.length+1,j=k.ids,l=[j[0],i,[]],m=1,h=j.length;h>m;m++){l=[j[m],{status:"missing"},[l]]}return[{pos:g,ids:l}]}function dE(o,h){var l,j,k,m={status:"available"};if(o._deleted&&(m.deleted=!0),h){if(o._id||(o._id=cm()),j=cm(32,16).toLowerCase(),o._rev){if(k=eh(o._rev),k.error){return k}o._rev_tree=[{pos:k.prefix,ids:[k.id,{status:"missing"},[[j,m,[]]]]}],l=k.prefix+1}else{o._rev_tree=[{pos:1,ids:[j,m,[]]}],l=1}}else{if(o._revisions&&(o._rev_tree=e(o._revisions,m),l=o._revisions.start,j=o._revisions.ids[0]),!o._rev_tree){if(k=eh(o._rev),k.error){return k}l=k.prefix,j=k.id,o._rev_tree=[{pos:l,ids:[j,m,[]]}]}}av(o._id),o._rev=l+"-"+j;var g={metadata:{},data:{}};for(var i in o){if(Object.prototype.hasOwnProperty.call(o,i)){var n="_"===i[0];if(n&&!c2[i]){var p=bS(f7,i);throw p.message=f7.message+": "+i,p}n&&!cu[i]?g.metadata[i.slice(1)]=o[i]:g.data[i]=o[i]}}return g}function jW(h){for(var k="",j=new Uint8Array(h),g=j.byteLength,i=0;g>i;i++){k+=String.fromCharCode(j[i])}return k}function db(g){return dV(jW(g))}function jV(i,l){i=i||[],l=l||{};try{return new Blob(i,l)}catch(k){if("TypeError"!==k.name){throw k}for(var h="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,j=new h,g=0;g<i.length;g+=1){j.append(i[g])}return j.getBlob(l.type)}}function cO(h){for(var k=h.length,j=new ArrayBuffer(k),g=new Uint8Array(j),i=0;k>i;i++){g[i]=h.charCodeAt(i)}return j}function dv(g,h){return jV([cO(g)],{type:h})}function bd(g,h){return dv(fG(g),h)}function jM(j,h){if("undefined"==typeof FileReader){return h(jW((new FileReaderSync).readAsArrayBuffer(j)))}var g=new FileReader,i="function"==typeof g.readAsBinaryString;g.onloadend=function(k){var l=k.target.result||"";return i?h(l):void h(jW(l))},i?g.readAsBinaryString(j):g.readAsArrayBuffer(j)}function aR(g,h){jM(g,function(i){h(dV(i))})}function jN(i,h){if("undefined"==typeof FileReader){return h((new FileReaderSync).readAsArrayBuffer(i))}var g=new FileReader;g.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);h(k)},g.readAsArrayBuffer(i)}function bu(g){return dV(g)}function aD(j,h,g,i){(g>0||i<h.byteLength)&&(h=new Uint8Array(h,g,Math.min(i,h.byteLength)-g)),j.append(h)}function fK(j,h,g,i){(g>0||i<h.length)&&(h=h.substring(g,i)),j.appendBinary(h)}function j1(o,h){function l(){var q=i*m,u=q+m;if(i++,g>i){p(n,o,q,u),bA(l)}else{p(n,o,q,u);var r=n.end(!0),s=bu(r);h(s),n.destroy()}}var j="string"==typeof o,k=j?o.length:o.byteLength,m=Math.min(bG,k),g=Math.ceil(k/m),i=0,n=j?new ca:new ca.ArrayBuffer,p=j?fK:aD;l()}function dj(g){return ca.hash(g)}function j0(j,l,h){function n(o){try{return fG(o)}catch(q){var p=bS(eP,"Attachment is not a valid base64 string");return{error:p}}}function g(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=n(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===l?q.data=dv(o,q.content_type):"base64"===l?q.data=dV(o):q.data=o,j1(o,function(r){q.digest="md5-"+r,p()})}else{jN(q.data,function(r){"binary"===l?q.data=jW(r):"base64"===l&&(q.data=db(r)),j1(r,function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function k(){m++,j.length===m&&(i?h(i):h())}if(!j.length){return h()}var i,m=0;j.forEach(function(r){function p(u){i=u,q++,q===s.length&&k()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return k()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&g(r.data._attachments[o],p)}})}function bs(j,A,h,u,g,z,y,k){if(cE(A.rev_tree,h.metadata.rev)){return u[g]=h,z()}var p=A.winningRev||d3(A),m="deleted" in A?A.deleted:aT(A,p),r="deleted" in h.metadata?h.metadata.deleted:aT(h.metadata),n=/^1-/.test(h.metadata.rev);if(m&&!r&&k&&n){var i=h.data;i._rev=p,i._id=h.metadata.id,h=dE(i,k)}var l=cV(A.rev_tree,h.metadata.rev_tree[0],j),q=k&&(m&&r||!m&&"new_leaf"!==l.conflicts||m&&!r&&"new_branch"===l.conflicts);if(q){var s=bS(bW);return u[g]=s,z()}var w=h.metadata.rev;h.metadata.rev_tree=l.tree,h.stemmedRevs=l.stemmedRevs||[],A.rev_map&&(h.metadata.rev_map=A.rev_map);var v,B=d3(h.metadata),o=aT(h.metadata,B),x=m===o?0:o>m?-1:1;v=w===B?o:aT(h.metadata,w),y(h,B,o,v,!0,x,g,z)}function cp(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function b8(u,g,l,m,i,o,q,k,v){function h(B,x,C){var D=d3(B.metadata),z=aT(B.metadata,D);if("was_delete" in k&&z){return o[x]=bS(aX,"deleted"),C()}var A=n&&cp(B);if(A){var w=bS(bW);return o[x]=w,C()}var y=z?0:1;q(B,D,z,z,!1,y,x,C)}function s(){++j===r&&v&&v()}u=u||1000;var n=k.new_edits,p=new cY.Map,j=0,r=g.length;g.forEach(function(w,y){if(w._id&&e5(w._id)){var z=w._deleted?"_removeLocal":"_putLocal";return void l[z](w,{ctx:i},function(B,A){o[y]=B||A,s()})}var x=w.metadata.id;p.has(x)?(r--,p.get(x).push([w,y])):p.set(x,[[w,y]])}),p.forEach(function(z,x){function w(){++y<z.length?A():s()}function A(){var C=z[y],E=C[0],D=C[1];if(m.has(x)){bs(u,m.get(x),E,o,D,w,q,n)}else{var B=cV([],E.metadata.rev_tree[0],u);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],h(E,D,w)}}var y=0;A()})}function cy(g){try{return JSON.parse(g)}catch(h){return aC.parse(g)}}function j7(g){return g.length<50000?JSON.parse(g):cy(g)}function dz(g){try{return JSON.stringify(g)}catch(h){return aC.stringify(g)}}function eg(h,k,j,g){try{h.apply(k,j)}catch(i){g.emit("error",i)}}function cZ(g){if(!kf.running&&kf.queue.length){kf.running=!0;var h=kf.queue.shift();h.action(function(i,j){eg(h.callback,this,[i,j],g),kf.running=!1,dC.nextTick(function(){cZ(g)})})}}function j8(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(bS(ba,i,h.type))}}function b1(i,h,g){return{data:dz(i),winningRev:h,deletedOrLocal:g?"1":"0",seq:i.seq,id:i.id}}function fE(g){if(!g){return null}var h=j7(g.data);return h.winningRev=g.winningRev,h.deleted="1"===g.deletedOrLocal,h.seq=g.seq,h}function t(g){if(!g){return g}var h=g._doc_id_rev.lastIndexOf(":");return g._id=g._doc_id_rev.substring(0,h-1),g._rev=g._doc_id_rev.substring(h+1),delete g._doc_id_rev,g}function aB(j,h,g,i){g?i(j?"string"!=typeof j?j:bd(j,h):jV([""],{type:h})):j?"string"!=typeof j?jM(j,function(k){i(dV(k))}):i(j):i("")}function bM(j,l,h,n){function g(){++m===i.length&&n&&n()}function k(s,q){var r=s._attachments[q],p=r.digest,o=h.objectStore(dW).get(p);o.onsuccess=function(u){r.body=u.target.result.body,g()}}var i=Object.keys(j._attachments||{});if(!i.length){return n&&n()}var m=0;i.forEach(function(o){l.attachments&&l.include_docs?k(j,o):(j._attachments[o].stub=!0,g())})}function bB(g,h){return bm.all(g.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return bm.all(j.map(function(k){var m=i.doc._attachments[k];if("body" in m){var n=m.body,l=m.content_type;return new bm(function(o){aB(n,l,h,function(p){i.doc._attachments[k]=dc.extend(fD(m,["digest","content_type"]),{data:p}),o()})})}}))}}))}function aO(o,h,l){function j(){p--,p||k()}function k(){m.length&&m.forEach(function(q){var r=n.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::￿",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||i["delete"](q)}})}var m=[],g=l.objectStore(e7),i=l.objectStore(dW),n=l.objectStore(ag),p=o.length;o.forEach(function(s){var r=g.index("_doc_id_rev"),q=h+"::"+s;r.getKey(q).onsuccess=function(w){var v=w.target.result;if("number"!=typeof v){return j()}g["delete"](v);var u=n.index("seq").openCursor(IDBKeyRange.only(v));u.onsuccess=function(y){var x=y.target.result;if(x){var z=x.value.digestSeq.split("::")[0];m.push(z),n["delete"](x.primaryKey),x["continue"]()}else{j()}}}})}function bl(j,h,g){try{return{txn:j.transaction(h,g)}}catch(i){return{error:i}}}function ay(k,r,y,u,D,p,n){function l(){var P=[cA,e7,dW,bT,ag],O=bl(D,P,"readwrite");return O.error?n(O.error):(A=O.txn,A.onabort=j8(n),A.ontimeout=j8(n),A.oncomplete=j,E=A.objectStore(cA),q=A.objectStore(e7),I=A.objectStore(dW),M=A.objectStore(ag),void g(function(Q){return Q?(z=!0,n(Q)):void h()}))}function m(){b8(k.revs_limit,s,u,F,A,o,x,y)}function h(){function T(){++O===s.length&&m()}function R(W){var V=fE(W.target.result);V&&F.set(V.id,V),T()}if(s.length){for(var O=0,S=0,U=s.length;U>S;S++){var Q=s[S];if(Q._id&&e5(Q._id)){T()}else{var P=E.get(Q.metadata.id);P.onsuccess=R}}}}function j(){z||(p.notify(u._meta.name),u._meta.docCount+=B,n(null,o))}function G(P,O){var Q=I.get(P);Q.onsuccess=function(S){if(S.target.result){O()}else{var R=bS(d6,"unknown stub attachment with digest "+P);R.status=412,O(R)}}}function g(Q){function O(){++R===S.length&&Q(P)}var S=[];if(s.forEach(function(T){T.data&&T.data._attachments&&Object.keys(T.data._attachments).forEach(function(V){var U=T.data._attachments[V];U.stub&&S.push(U.digest)})}),!S.length){return Q()}var P,R=0;S.forEach(function(T){G(T,function(U){U&&!P&&(P=U),O()})})}function x(U,O,S,Q,R,T,W,P){B+=T,U.metadata.winningRev=O,U.metadata.deleted=S;var X=U.data;X._id=U.metadata.id,X._rev=U.metadata.rev,Q&&(X._deleted=!0);var V=X._attachments&&Object.keys(X._attachments).length;return V?v(U,O,S,R,W,P):void K(U,O,S,R,W,P)}function K(X,Q,S,R,U,O){function W(an){var ae=X.stemmedRevs||[];R&&u.auto_compaction&&(ae=ae.concat(af(X.metadata))),ae&&ae.length&&aO(ae,X.metadata.id,A),T.seq=an.target.result,delete T.rev;var ao=b1(T,Q,S),ai=E.put(ao);ai.onsuccess=Z}function P(ae){ae.preventDefault(),ae.stopPropagation();var an=q.index("_doc_id_rev"),ai=an.getKey(V._doc_id_rev);ai.onsuccess=function(ar){var ao=q.put(V,ar.target.result);ao.onsuccess=W}}function Z(){o[U]={ok:!0,id:T.id,rev:Q},F.set(X.metadata.id,X.metadata),C(X,T.seq,O)}var V=X.data,T=X.metadata;V._doc_id_rev=T.id+"::"+T.rev,delete V._id,delete V._rev;var Y=q.put(V);Y.onsuccess=W,Y.onerror=P}function v(W,P,T,R,S,U){function Y(){X===V.length&&K(W,P,T,R,S,U)}function Q(){X++,Y()}var O=W.data,X=0,V=Object.keys(O._attachments);V.forEach(function(ai){var Z=W.data._attachments[ai];if(Z.stub){X++,Y()}else{var ae=Z.data;delete Z.data,Z.revpos=parseInt(P,10);var an=Z.digest;H(an,ae,Q)}})}function C(T,Q,V){function S(){++P===O.length&&V()}function U(Y){var X=T.data._attachments[Y].digest,W=M.put({seq:Q,digestSeq:X+"::"+Q});W.onsuccess=S,W.onerror=function(Z){Z.preventDefault(),Z.stopPropagation(),S()}}var P=0,O=Object.keys(T.data._attachments||{});if(!O.length){return V()}for(var R=0;R<O.length;R++){U(O[R])}}function H(Q,O,R){var P=I.count(Q);P.onsuccess=function(T){var U=T.target.result;if(U){return R()}var S={digest:Q,body:O},V=I.put(S);V.onsuccess=R}}for(var A,E,q,I,M,L,s=r.docs,B=0,N=0,J=s.length;J>N;N++){var w=s[N];w._id&&e5(w._id)||(w=s[N]=dE(w,y.new_edits),w.error&&!L&&(L=w))}if(L){return n(L)}var o=new Array(s.length),F=new cY.Map,z=!1,i=u._meta.blobSupport?"blob":"base64";j0(s,i,function(O){return O?n(O):void l()})}function cX(i,l,k,h,j){try{if(i&&l){return j?IDBKeyRange.bound(l,i,!k,!1):IDBKeyRange.bound(i,l,!1,!k)}if(i){return j?IDBKeyRange.upperBound(i):IDBKeyRange.lowerBound(i)}if(l){return j?IDBKeyRange.lowerBound(l,!k):IDBKeyRange.upperBound(l,!k)}if(h){return IDBKeyRange.only(h)}}catch(g){return{error:g}}return null}function cR(j,h,g,i){return"DataError"===g.name&&0===g.code?i(null,{total_rows:j._meta.docCount,offset:h.skip,rows:[]}):void i(bS(ba,g.name,g.message))}function c3(i,l,k,h){function j(q,H){function E(O,N,L){var M=O.id+"::"+L;D.get(M).onsuccess=function(P){N.doc=t(P.target.result),q.conflicts&&(N.doc._conflicts=e8(O)),bM(N.doc,q,G)}}function v(P,M,L){var O={id:L.id,key:L.id,value:{rev:M}},N=L.deleted;if("ok"===q.deleted){m.push(O),N?(O.value.deleted=!0,O.doc=null):q.include_docs&&E(L,O,M)}else{if(!N&&I--<=0&&(m.push(O),q.include_docs&&E(L,O,M),0===--F)){return}}P["continue"]()}function z(L){K=l._meta.docCount;var N=L.target.result;if(N){var O=fE(N.value),M=O.winningRev;v(N,M,O)}}function A(){H(null,{total_rows:K,offset:q.skip,rows:m})}function C(){q.attachments?bB(m,q.binary).then(A):A()}var s="startkey" in q?q.startkey:!1,r="endkey" in q?q.endkey:!1,x="key" in q?q.key:!1,I=q.skip||0,F="number"==typeof q.limit?q.limit:-1,u=q.inclusive_end!==!1,y="descending" in q&&q.descending?"prev":null,o=cX(s,r,u,x,y);if(o&&o.error){return cR(l,q,o.error,H)}var J=[cA,e7];q.attachments&&J.push(dW);var B=bl(k,J,"readonly");if(B.error){return H(B.error)}var G=B.txn,n=G.objectStore(cA),w=G.objectStore(e7),p=y?n.openCursor(o,y):n.openCursor(o),D=w.index("_doc_id_rev"),m=[],K=0;G.oncomplete=C,p.onsuccess=z}function g(n,m){return 0===n.limit?m(null,{total_rows:l._meta.docCount,offset:n.skip,rows:[]}):void j(n,m)}g(i,h)}function aE(g){return new bm(function(h){var i=jV([""]);g.objectStore(aq).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function fJ(i,h){var g=this;kf.queue.push({action:function(j){bk(g,i,j)},callback:h}),cZ(g.constructor)}function bk(g,h,l){function n(x){var w=x.createObjectStore(cA,{keyPath:"id"});x.createObjectStore(e7,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),x.createObjectStore(dW,{keyPath:"digest"}),x.createObjectStore(cB,{keyPath:"id",autoIncrement:!1}),x.createObjectStore(aq),w.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.createObjectStore(bT,{keyPath:"_id"});var v=x.createObjectStore(ag,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function o(x,w){var v=x.objectStore(cA);v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),v.openCursor().onsuccess=function(z){var B=z.target.result;if(B){var y=B.value,A=aT(y);y.deletedOrLocal=A?"1":"0",v.put(y),B["continue"]()}else{w()}}}function k(v){v.createObjectStore(bT,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function u(v,x){var w=v.objectStore(bT),y=v.objectStore(cA),z=v.objectStore(e7),A=y.openCursor();A.onsuccess=function(C){var L=C.target.result;if(L){var F=L.value,I=F.id,H=e5(I),E=d3(F);if(H){var B=I+"::"+E,K=I+"::",D=I+"::~",M=z.index("_doc_id_rev"),J=IDBKeyRange.bound(K,D,!1,!1),G=M.openCursor(J);G.onsuccess=function(N){if(G=N.target.result){var O=G.value;O._doc_id_rev===B&&w.put(O),z["delete"](G.primaryKey),G["continue"]()}else{y["delete"](L.primaryKey),L["continue"]()}}}else{L["continue"]()}}else{x&&x()}}}function p(w){var v=w.createObjectStore(ag,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function q(v,x){var w=v.objectStore(e7),y=v.objectStore(dW),z=v.objectStore(ag),A=y.count();A.onsuccess=function(B){var C=B.target.result;return C?void (w.openCursor().onsuccess=function(M){var I=M.target.result;if(!I){return x()}for(var H=I.value,K=I.primaryKey,E=Object.keys(H._attachments||{}),G={},F=0;F<E.length;F++){var D=H._attachments[E[F]];G[D.digest]=!0}var L=Object.keys(G);for(F=0;F<L.length;F++){var J=L[F];z.put({seq:K,digestSeq:J+"::"+K})}I["continue"]()}):x()}}function i(w){function x(A){return A.data?fE(A):(A.deleted="1"===A.deletedOrLocal,A)}var v=w.objectStore(e7),z=w.objectStore(cA),y=z.openCursor();y.onsuccess=function(C){function D(){var H=A.id+"::",F=A.id+"::￿",G=v.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return A.seq=I,B()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function B(){var G=b1(A,A.winningRev,A.deleted),F=z.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var A=x(E.value);return A.winningRev=A.winningRev||d3(A),A.seq?B():void D()}}}var m=h.name,j=null;g._meta=null,g.type=function(){return"idb"},g._id=f5(function(v){v(null,g._meta.instanceId)}),g._bulkDocs=function(v,w,x){ay(h,v,w,g,j,a9,x)},g._get=function(C,x,w){function A(){w(D,{doc:B,metadata:z,ctx:y})}var B,z,D,y=x.ctx;if(!y){var v=bl(j,[cA,e7,dW],"readonly");if(v.error){return w(v.error)}y=v.txn}y.objectStore(cA).get(C).onsuccess=function(E){if(z=fE(E.target.result),!z){return D=bS(aX,"missing"),A()}if(aT(z)&&!x.rev){return D=bS(aX,"deleted"),A()}var G=y.objectStore(e7),H=x.rev||z.winningRev,F=z.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return B=I.target.result,B&&(B=t(B)),B?void A():(D=bS(aX,"missing"),A())}}},g._getAttachment=function(C,x,w,A,B){var z;if(A.ctx){z=A.ctx}else{var D=bl(j,[cA,e7,dW],"readonly");if(D.error){return B(D.error)}z=D.txn}var y=w.digest,v=w.content_type;z.objectStore(dW).get(y).onsuccess=function(E){var F=E.target.result.body;aB(F,v,A.binary,function(G){B(null,G)})}},g._info=function(A){if(null===j||!jT.has(m)){var y=new Error("db isn't open");return y.id="idbNull",A(y)}var x,w,v=bl(j,[e7],"readonly");if(v.error){return A(v.error)}var z=v.txn,B=z.objectStore(e7).openCursor(null,"prev");B.onsuccess=function(D){var C=D.target.result;x=C?C.key:0,w=g._meta.docCount},z.oncomplete=function(){A(null,{doc_count:w,update_seq:x,idb_attachment_format:g._meta.blobSupport?"binary":"base64"})}},g._allDocs=function(v,w){c3(v,g,j,w)},g._changes=function(w){function L(N){function T(){return S.seq!==O?N["continue"]():(A=O,S.winningRev===P._rev?R(P):void Q())}function Q(){var U=P._id+"::"+S.winningRev,V=x.get(U);V.onsuccess=function(W){R(t(W.target.result))}}function R(V){var W=w.processChange(V,S,w);W.seq=S.seq;var U=D(W);return"object"==typeof U?w.complete(U):(U&&(E++,C&&K.push(W),w.attachments&&w.include_docs?bM(V,w,z,function(){bB([W],w.binary).then(function(){w.onChange(W)})}):w.onChange(W)),void (E!==F&&N["continue"]()))}var P=t(N.value),O=N.key;if(B&&!B.has(P._id)){return N["continue"]()}var S;return(S=y.get(P._id))?T():void (v.get(P._id).onsuccess=function(U){S=fE(U.target.result),y.set(P._id,S),T()})}function G(N){var O=N.target.result;O&&L(O)}function I(){var P=[cA,e7];w.attachments&&P.push(dW);var O=bl(j,P,"readonly");if(O.error){return w.complete(O.error)}z=O.txn,z.onabort=j8(w.complete),z.oncomplete=M,J=z.objectStore(e7),v=z.objectStore(cA),x=J.index("_doc_id_rev");var N;N=w.descending?J.openCursor(null,"prev"):J.openCursor(IDBKeyRange.lowerBound(w.since,!0)),N.onsuccess=G}function M(){function N(){w.complete(null,{results:K,last_seq:A})}!w.continuous&&w.attachments?bB(K).then(N):N()}if(w=dY(w),w.continuous){var H=m+":"+cm();return a9.addListener(m,H,g,w),a9.notify(m),{cancel:function(){a9.removeListener(m,H)}}}var B=w.doc_ids&&new cY.Set(w.doc_ids);w.since=w.since||0;var A=w.since,F="limit" in w?w.limit:-1;0===F&&(F=1);var C;C="return_docs" in w?w.return_docs:"returnDocs" in w?w.returnDocs:!0;var z,J,v,x,K=[],E=0,D=d8(w),y=new cY.Map;I()},g._close=function(v){return null===j?v(bS(cS)):(j.close(),jT["delete"](m),j=null,void v())},g._getRevisionTree=function(w,x){var v=bl(j,[cA],"readonly");if(v.error){return x(v.error)}var z=v.txn,y=z.objectStore(cA).get(w);y.onsuccess=function(B){var A=fE(B.target.result);A?x(null,A.rev_tree):x(bS(aX))}},g._doCompaction=function(y,A,w){var B=[cA,e7,dW,ag],x=bl(j,B,"readwrite");if(x.error){return w(x.error)}var v=x.txn,z=v.objectStore(cA);z.get(y).onsuccess=function(E){var C=fE(E.target.result);fB(C.rev_tree,function(I,K,H,J,G){var L=K+"-"+H;-1!==A.indexOf(L)&&(G.status="missing")}),aO(A,y,v);var D=C.winningRev,F=C.deleted;v.objectStore(cA).put(b1(C,D,F))},v.onabort=j8(w),v.oncomplete=function(){w()}},g._getLocal=function(w,x){var v=bl(j,[bT],"readonly");if(v.error){return x(v.error)}var z=v.txn,y=z.objectStore(bT).get(w);y.onerror=j8(x),y.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,x(null,A)):x(bS(aX))}},g._putLocal=function(z,E,C){"function"==typeof E&&(C=E,E={}),delete z._revisions;var x=z._rev,y=z._id;x?z._rev="0-"+(parseInt(x.split("-")[1],10)+1):z._rev="0-1";var w,B=E.ctx;if(!B){var v=bl(j,[bT],"readwrite");if(v.error){return C(v.error)}B=v.txn,B.onerror=j8(C),B.oncomplete=function(){w&&C(null,w)}}var D,A=B.objectStore(bT);x?(D=A.get(y),D.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===x){var F=A.put(z);F.onsuccess=function(){w={ok:!0,id:z._id,rev:z._rev},E.ctx&&C(null,w)}}else{C(bS(bW))}}):(D=A.add(z),D.onerror=function(F){C(bS(bW)),F.preventDefault(),F.stopPropagation()},D.onsuccess=function(){w={ok:!0,id:z._id,rev:z._rev},E.ctx&&C(null,w)})},g._removeLocal=function(C,x,w){"function"==typeof x&&(w=x,x={});var A=x.ctx;if(!A){var B=bl(j,[bT],"readwrite");if(B.error){return w(B.error)}A=B.txn,A.oncomplete=function(){z&&w(null,z)}}var z,D=C._id,y=A.objectStore(bT),v=y.get(D);v.onerror=j8(w),v.onsuccess=function(F){var E=F.target.result;E&&E._rev===C._rev?(y["delete"](D),z={ok:!0,id:D,rev:"0-0"},x.ctx&&w(null,z)):w(bS(aX))}},g._destroy=function(v,x){a9.removeAllListeners(m);var w=cN.get(m);w&&w.result&&(w.result.close(),jT["delete"](m));var y=indexedDB.deleteDatabase(m);y.onsuccess=function(){cN["delete"](m),dd()&&m in localStorage&&delete localStorage[m],x(null,{ok:!0})},y.onerror=j8(x)};var s=jT.get(m);if(s){return j=s.idb,g._meta=s.global,void dC.nextTick(function(){l(null,g)})}var r;r=h.storage?aG(m,h.storage):indexedDB.open(m,dG),cN.set(m,r),r.onupgradeneeded=function(x){function v(){var B=z[A-1];A++,B&&B(w,v)}var y=x.target.result;if(x.oldVersion<1){return n(y)}var w=x.currentTarget.transaction;x.oldVersion<3&&k(y),x.oldVersion<4&&p(y);var z=[o,u,q,i],A=x.oldVersion;v()},r.onsuccess=function(y){j=y.target.result,j.onversionchange=function(){j.close(),jT["delete"](m)},j.onabort=function(B){dX("error","Database has a global failure",B.target.error),j.close(),jT["delete"](m)};var w=j.transaction([cB,aq,cA],"readwrite"),z=w.objectStore(cB).get(cB),x=null,v=null,A=null;z.onsuccess=function(D){var B=function(){null!==x&&null!==v&&null!==A&&(g._meta={name:m,instanceId:A,blobSupport:x,docCount:v},jT.set(m,{idb:j,global:g._meta}),l(null,g))},E=D.target.result||{id:cB};m+"_id" in E?(A=E[m+"_id"],B()):(A=cm(),E[m+"_id"]=A,w.objectStore(cB).put(E).onsuccess=function(){B()}),eQ||(eQ=aE(w)),eQ.then(function(F){x=F,B()});var C=w.objectStore(cA).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){v=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";dX("error",v),l(bS(ba,v))}}function aG(i,h){try{return indexedDB.open(i,{version:dG,storage:h})}catch(g){return indexedDB.open(i,dG)}}function b4(g){g.adapter("idb",fJ,!0)}function b5(g){return decodeURIComponent(escape(g))}function bY(g){return 65>g?g-48:g-55}function al(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(bY(j.charCodeAt(h++))<<4|bY(j.charCodeAt(h++)))}return i}function bh(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(bY(j.charCodeAt(h+2))<<12|bY(j.charCodeAt(h+3))<<8|bY(j.charCodeAt(h))<<4|bY(j.charCodeAt(h+1))),h+=4}return i}function aV(g,h){return"UTF-8"===h?b5(al(g,0,g.length)):bh(g,0,g.length)}function cH(g){return"'"+g+"'"}function aS(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function aM(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function aJ(g){return delete g._id,delete g._rev,JSON.stringify(g)}function cw(i,h,g){return i=JSON.parse(i),i._id=h,i._rev=g,i}function dl(g){for(var h="(";g--;){h+="?",g&&(h+=",")}return h+")"}function aw(h,k,j,g,i){return"SELECT "+h+" FROM "+("string"==typeof k?k:k.join(" JOIN "))+(j?" ON "+j:"")+(g?" WHERE "+("string"==typeof g?g:g.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function aH(k,i,g){function j(){++m===k.length&&l()}function l(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+dL+" WHERE seq IN "+dl(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+dL+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(u){var v="SELECT digest FROM "+dL+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";u.executeSql(v,s,function(x,y){for(var w=new cY.Set,z=0;z<y.rows.length;z++){w.add(y.rows.item(z).digest)}s.forEach(function(A){w.has(A)||(x.executeSql("DELETE FROM "+dL+" WHERE digest=?",[A]),x.executeSql("DELETE FROM "+am+" WHERE digest=?",[A]))})})})}})}}if(k.length){var m=0,h=[];k.forEach(function(n){var o="SELECT seq FROM "+aW+" WHERE doc_id=? AND rev=?";g.executeSql(o,[i,n],function(q,p){if(!p.rows.length){return j()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+aW+" WHERE seq=?",[r],j)})})}}function cQ(g){return function(h){dX("error","WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(bS(cM,j,i))}}function bf(g){if("size" in g){return 1000000*g.size}var h="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return h?5000000:1}function c5(x,u,g,m,n,C,B){function k(){return w?B(w):(C.notify(m._name),m._docCount=-1,void B(null,r))}function s(E,D){var F="SELECT count(*) as cnt FROM "+am+" WHERE digest=?";p.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=bS(d6,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function y(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){s(I,function(J){J&&!E&&(E=J),D()})})}function z(H,P,K,F,D,M,R,O){function J(){function Z(ar,a0){function at(){return ++ao===an.length&&a0(),!1}function ai(a2){var a3="INSERT INTO "+dL+" (digest, seq) VALUES (?,?)",a1=[Y._attachments[a2].digest,ar];p.executeSql(a3,a1,at,at)}var ao=0,an=Object.keys(Y._attachments||{});if(!an.length){return a0()}for(var ae=0;ae<an.length;ae++){ai(an[ae])}}var Y=H.data,T=F?1:0,W=Y._id,S=Y._rev,U=aJ(Y),V="INSERT INTO "+aW+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",X=[W,S,U,T];p.executeSql(V,X,function(ai,ae){var an=ae.insertId;Z(an,function(){I(ai,an)})},function(){var ae=aw("seq",aW,null,"doc_id=? AND rev=?");return p.executeSql(ae,[W,S],function(ar,ai){var an=ai.rows.item(0).seq,ao="UPDATE "+aW+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",at=[U,T,W,S];ar.executeSql(ao,at,function(a0){Z(an,function(){I(a0,an)})})}),!1})}function G(S){E||(S?(E=S,O(E)):N===L.length&&J())}function Q(S){N++,G(S)}function I(W,V){var Y=H.metadata.id,X=H.stemmedRevs||[];D&&m.auto_compaction&&(X=af(H.metadata).concat(X)),X.length&&aH(X,Y,W),H.metadata.seq=V,delete H.metadata.rev;var S=D?"UPDATE "+dQ+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+aW+" WHERE doc_id="+dQ+".id AND rev=?) WHERE id=?":"INSERT INTO "+dQ+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",T=dz(H.metadata),U=D?[T,V,P,Y]:[Y,V,V,T];W.executeSql(S,U,function(){r[R]={ok:!0,id:H.metadata.id,rev:P},A.set(Y,H.metadata),O()})}var E=null,N=0;H.data._id=H.metadata.id,H.data._rev=H.metadata.rev;var L=Object.keys(H.data._attachments||{});F&&(H.data._deleted=!0),L.forEach(function(S){var U=H.data._attachments[S];if(U.stub){N++,G()}else{var V=U.data;delete U.data,U.revpos=parseInt(P,10);var T=U.digest;v(T,V,Q)}}),L.length||J()}function q(){b8(x.revs_limit,o,m,A,p,r,z,g)}function i(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&e5(G._id)){return D()}var H=G.metadata.id;p.executeSql("SELECT json FROM "+dQ+" WHERE id = ?",[H],function(K,J){if(J.rows.length){var I=j7(J.rows.item(0).json);A.set(H,I)}D()})})}function v(F,D,G){var E="SELECT digest FROM "+am+" WHERE digest=?";p.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+am+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,aS(D)],function(){G()},function(){return G(),!1}))})}var l=g.new_edits,j=u.docs,o=j.map(function(E){if(E._id&&e5(E._id)){return E}var D=dE(E,l);return D}),h=o.filter(function(D){return D.error});if(h.length){return B(h[0])}var p,w,r=new Array(o.length),A=new cY.Map;j0(o,"binary",function(D){return D?B(D):void n.transaction(function(E){p=E,y(function(F){F?w=F:i(q)})},cQ(B),k)})}function dM(g){return g.websql(g.name,g.version,g.description,g.size)}function ab(g){try{return{db:dM(g)}}catch(h){return{error:h}}}function cK(g){var h=j5.get(g.name);return h||(h=ab(g),j5.set(g.name,h),h.db&&(h.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)),h}function f4(k,n,i,g,j){function l(){++m===h.length&&j&&j()}function o(q,s){var r=q._attachments[s],p={binary:n.binary,ctx:g};i._getAttachment(q._id,s,r,p,function(v,u){q._attachments[s]=dc.extend(fD(r,["digest","content_type"]),{data:u}),l()})}var h=Object.keys(k._attachments||{});if(!h.length){return j&&j()}var m=0;h.forEach(function(p){n.attachments&&n.include_docs?o(k,p):(k._attachments[p].stub=!0,l())})}function ek(A,k){function y(){dd()&&(window.localStorage["_pouch__websqldb_"+s._name]=!0),k(null,s)}function m(F,E){F.executeSql(cv),F.executeSql("ALTER TABLE "+aW+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(el),F.executeSql("ALTER TABLE "+dQ+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+dQ+" (local, id)");var G="SELECT "+dQ+".winningseq AS seq, "+dQ+".json AS metadata FROM "+aW+" JOIN "+dQ+" ON "+aW+".seq = "+dQ+".winningseq";F.executeSql(G,[],function(J,N){for(var I=[],L=[],M=0;M<N.rows.length;M++){var O=N.rows.item(M),H=O.seq,K=JSON.parse(O.metadata);aT(K)&&I.push(H),e5(K.id)&&L.push(K.id)}J.executeSql("UPDATE "+dQ+"SET local = 1 WHERE id IN "+dl(L.length),L,function(){J.executeSql("UPDATE "+aW+" SET deleted = 1 WHERE seq IN "+dl(I.length),I,E)})})})})}function p(F,E){var G="CREATE TABLE IF NOT EXISTS "+cW+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+dQ+".id AS id, "+aW+".json AS data FROM "+aW+" JOIN "+dQ+" ON "+aW+".seq = "+dQ+".winningseq WHERE local = 1";F.executeSql(H,[],function(M,J){function L(){if(!I.length){return E(M)}var O=I.shift(),N=JSON.parse(O.data)._rev;M.executeSql("INSERT INTO "+cW+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+dQ+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+aW+" WHERE seq=?",[O.seq],function(){L()})})})}for(var I=[],K=0;K<J.rows.length;K++){I.push(J.rows.item(K))}L()})})}function g(G,E){function H(I){function J(){if(!I.length){return E(G)}var P=I.shift(),N=aV(P.hex,j),K=N.lastIndexOf("::"),O=N.substring(0,K),M=N.substring(K+2),L="UPDATE "+aW+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(L,[O,M,N],function(){J()})}J()}var F="ALTER TABLE "+aW+" ADD COLUMN doc_id";G.executeSql(F,[],function(I){var J="ALTER TABLE "+aW+" ADD COLUMN rev";I.executeSql(J,[],function(K){K.executeSql(jL,[],function(M){var L="SELECT hex(doc_id_rev) as hex FROM "+aW;M.executeSql(L,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function x(G,E){function H(J){var I="SELECT COUNT(*) AS cnt FROM "+am;J.executeSql(I,[],function(O,K){function N(){var Q=aw(f2+", "+dQ+".id AS id",[dQ,aW],jK,null,dQ+".id ");Q+=" LIMIT "+L+" OFFSET "+M,M+=L,O.executeSql(Q,[],function(ai,X){function S(at,ar){var ao=an[at]=an[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!X.rows.length){return E(ai)}for(var an={},U=0;U<X.rows.length;U++){for(var W=X.rows.item(U),V=cw(W.data,W.id,W.rev),R=Object.keys(V._attachments||{}),T=0;T<R.length;T++){var Z=V._attachments[R[T]];S(Z.digest,W.seq)}}var Y=[];if(Object.keys(an).forEach(function(ar){var ao=an[ar];ao.forEach(function(at){Y.push([ar,at])})}),!Y.length){return N()}var ae=0;Y.forEach(function(ao){var ar="INSERT INTO "+dL+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++ae===Y.length&&N()})})})}var P=K.rows.item(0).cnt;if(!P){return E(O)}var M=0,L=10;N()})}var F="CREATE TABLE IF NOT EXISTS "+dL+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(bL,[],function(J){J.executeSql(bg,[],H)})})}function B(F,E){var G="ALTER TABLE "+am+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function v(F,E){var G="ALTER TABLE "+dQ+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(I){var H="UPDATE "+dQ+" SET max_seq=(SELECT MAX(seq) FROM "+aW+" WHERE doc_id=id)";I.executeSql(H,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+dQ+" (max_seq)";J.executeSql(K,[],E)})})}function D(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(I,G){var H=G.rows.item(0).hex;j=2===H.length?"UTF-8":"UTF-16",E()})}function w(){for(;u.length>0;){var E=u.pop();E(null,n)}}function C(L,H){if(0===H){var E="CREATE TABLE IF NOT EXISTS "+c7+" (dbid, db_version INTEGER)",N="CREATE TABLE IF NOT EXISTS "+am+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",K="CREATE TABLE IF NOT EXISTS "+dL+" (digest, seq INTEGER)",I="CREATE TABLE IF NOT EXISTS "+dQ+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",J="CREATE TABLE IF NOT EXISTS "+aW+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",P="CREATE TABLE IF NOT EXISTS "+cW+" (id UNIQUE, rev, json)";L.executeSql(N),L.executeSql(P),L.executeSql(K,[],function(){L.executeSql(bg),L.executeSql(bL)}),L.executeSql(I,[],function(){L.executeSql(cv),L.executeSql(J,[],function(){L.executeSql(el),L.executeSql(jL),L.executeSql(E,[],function(){var R="INSERT INTO "+c7+" (db_version, dbid) VALUES (?,?)";n=cm();var Q=[j6,n];L.executeSql(R,Q,function(){w()})})})})}else{var F=function(){var Q=j6>H;Q&&L.executeSql("UPDATE "+c7+" SET db_version = "+j6);var R="SELECT dbid FROM "+c7;L.executeSql(R,[],function(T,S){n=S.rows.item(0).dbid,w()})},O=[m,p,g,x,B,v,F],M=H,G=function(Q){O[M-1](Q,G),M++};G(L)}}function o(){l.transaction(function(E){D(E,function(){r(E)})},cQ(k),y)}function r(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+c7;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+c7,[],function(K,J){var I=J.rows.item(0).db_version;C(K,I)}):H.executeSql("ALTER TABLE "+c7+" ADD COLUMN db_version INTEGER",[],function(){C(H,1)}):C(H,0)})}function h(F,E){if(-1!==s._docCount){return E(s._docCount)}var G=aw("COUNT("+dQ+".id) AS 'num'",[dQ,aW],jK,aW+".deleted=0");F.executeSql(G,[],function(I,H){s._docCount=H.rows.item(0).num,E(s._docCount)})}var j,s=this,n=null,q=bf(A),u=[];s._docCount=-1,s._name=A.name;var z=dc.extend({},A,{version:dB,description:A.name,size:q}),i=cK(z);if(i.error){return cQ(k)(i.error)}var l=i.db;"function"!=typeof l.readTransaction&&(l.readTransaction=l.transaction),o(),s.type=function(){return"websql"},s._id=f5(function(E){E(null,n)}),s._info=function(E){l.readTransaction(function(F){h(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+aW;F.executeSql(G,[],function(J,K){var I=K.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:I,sqlite_plugin:l._sqlitePlugin,websql_encoding:j})})})},cQ(E))},s._bulkDocs=function(E,G,F){c5(A,E,G,s,l,bX,F)},s._get=function(G,H,E){function L(){E(J,{doc:M,metadata:F,ctx:N})}var M,F,J,N=H.ctx;if(!N){return l.readTransaction(function(O){s._get(G,dc.extend({ctx:O},H),E)})}var K,I;H.rev?(K=aw(f2,[dQ,aW],dQ+".id="+aW+".doc_id",[aW+".doc_id=?",aW+".rev=?"]),I=[G,H.rev]):(K=aw(f2,[dQ,aW],jK,dQ+".id=?"),I=[G]),N.executeSql(K,I,function(O,P){if(!P.rows.length){return J=bS(aX,"missing"),L()}var Q=P.rows.item(0);return F=j7(Q.metadata),Q.deleted&&!H.rev?(J=bS(aX,"deleted"),L()):(M=cw(Q.data,F.id,Q.rev),void L())})},s._allDocs=function(L,H){var I,P=[],R="startkey" in L?L.startkey:!1,M="endkey" in L?L.endkey:!1,F="key" in L?L.key:!1,J="descending" in L?L.descending:!1,G="limit" in L?L.limit:-1,E="skip" in L?L.skip:0,O=L.inclusive_end!==!1,K=[],Q=[];if(F!==!1){Q.push(dQ+".id = ?"),K.push(F)}else{if(R!==!1||M!==!1){if(R!==!1&&(Q.push(dQ+".id "+(J?"<=":">=")+" ?"),K.push(R)),M!==!1){var N=J?">":"<";O&&(N+="="),Q.push(dQ+".id "+N+" ?"),K.push(M)}F!==!1&&(Q.push(dQ+".id = ?"),K.push(F))}}"ok"!==L.deleted&&Q.push(aW+".deleted = 0"),l.readTransaction(function(S){h(S,function(T){if(I=T,0!==G){var U=aw(f2,[dQ,aW],jK,Q,dQ+".id "+(J?"DESC":"ASC"));U+=" LIMIT "+G+" OFFSET "+E,S.executeSql(U,K,function(ai,ar){for(var ao=0,X=ar.rows.length;X>ao;ao++){var Z=ar.rows.item(ao),an=j7(Z.metadata),W=an.id,Y=cw(Z.data,W,Z.rev),V=Y._rev,ae={id:W,key:W,value:{rev:V}};if(L.include_docs&&(ae.doc=Y,ae.doc._rev=V,L.conflicts&&(ae.doc._conflicts=e8(an)),f4(ae.doc,L,s,ai)),Z.deleted){if("ok"!==L.deleted){continue}ae.value.deleted=!0,ae.doc=null}P.push(ae)}})}})},cQ(H),function(){H(null,{total_rows:I,offset:L.skip,rows:P})})},s._changes=function(F){function G(){var S=dQ+".json AS metadata, "+dQ+".max_seq AS maxSeq, "+aW+".json AS winningDoc, "+aW+".rev AS winningRev ",T=dQ+" JOIN "+aW,R=dQ+".id="+aW+".doc_id AND "+dQ+".winningseq="+aW+".seq",Q=["maxSeq > ?"],O=[F.since];F.doc_ids&&(Q.push(dQ+".id IN "+dl(F.doc_ids.length)),O=O.concat(F.doc_ids));var U="maxSeq "+(K?"DESC":"ASC"),N=aw(S,T,R,Q,U),M=d8(F);F.view||F.filter||(N+=" LIMIT "+H);var P=F.since||0;l.readTransaction(function(V){V.executeSql(N,O,function(X,Y){function at(a0){return function(){F.onChange(a0)}}for(var an=0,ai=Y.rows.length;ai>an;an++){var Z=Y.rows.item(an),W=j7(Z.metadata);P=Z.maxSeq;var ae=cw(Z.winningDoc,W.id,Z.winningRev),ar=F.processChange(ae,W,F);ar.seq=Z.maxSeq;var ao=M(ar);if("object"==typeof ao){return F.complete(ao)}if(ao&&(J++,E&&L.push(ar),F.attachments&&F.include_docs?f4(ae,F,s,X,at(ar)):at(ar)()),J===H){break}}})},cQ(F.complete),function(){F.continuous||F.complete(null,{results:L,last_seq:P})})}if(F=dY(F),F.continuous){var I=s._name+":"+cm();return bX.addListener(s._name,I,s,F),bX.notify(s._name),{cancel:function(){bX.removeListener(s._name,I)}}}var K=F.descending;F.since=F.since&&!K?F.since:0;var H="limit" in F?F.limit:-1;0===H&&(H=1);var E;E="return_docs" in F?F.return_docs:"returnDocs" in F?F.returnDocs:!0;var L=[],J=0;G()},s._close=function(E){E()},s._getAttachment=function(G,H,E,L,M){var F,J=L.ctx,N=E.digest,K=E.content_type,I="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+am+" WHERE digest=?";J.executeSql(I,[N],function(P,O){var Q=O.rows.item(0),R=Q.escaped?aM(Q.body):aV(Q.body,j);F=L.binary?dv(R,K):dV(R),M(null,F)})},s._getRevisionTree=function(F,E){l.readTransaction(function(H){var G="SELECT json AS metadata FROM "+dQ+" WHERE id = ?";H.executeSql(G,[F],function(K,I){if(I.rows.length){var J=j7(I.rows.item(0).metadata);E(null,J.rev_tree)}else{E(bS(aX))}})})},s._doCompaction=function(F,E,G){return E.length?void l.transaction(function(H){var I="SELECT json AS metadata FROM "+dQ+" WHERE id = ?";H.executeSql(I,[F],function(M,K){var L=j7(K.rows.item(0).metadata);fB(L.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var J="UPDATE "+dQ+" SET json = ? WHERE id = ?";M.executeSql(J,[dz(L),F])}),aH(E,F,H)},cQ(G),function(){G()}):G()},s._getLocal=function(F,E){l.readTransaction(function(H){var G="SELECT json, rev FROM "+cW+" WHERE id=?";H.executeSql(G,[F],function(I,K){if(K.rows.length){var L=K.rows.item(0),J=cw(L.json,F,L.rev);E(null,J)}else{E(bS(aX))}})})},s._putLocal=function(E,I,L){function J(N){var P,O;M?(P="UPDATE "+cW+" SET rev=?, json=? WHERE id=? AND rev=?",O=[K,H,G,M]):(P="INSERT INTO "+cW+" (id, rev, json) VALUES (?,?,?)",O=[G,K,H]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(F={ok:!0,id:G,rev:K},I.ctx&&L(null,F)):L(bS(bW))},function(){return L(bS(bW)),!1})}"function"==typeof I&&(L=I,I={}),delete E._revisions;var K,M=E._rev,G=E._id;K=M?E._rev="0-"+(parseInt(M.split("-")[1],10)+1):E._rev="0-1";var F,H=aJ(E);I.ctx?J(I.ctx):l.transaction(J,cQ(L),function(){F&&L(null,F)})},s._removeLocal=function(H,F,E){function G(L){var K="DELETE FROM "+cW+" WHERE id=? AND rev=?",J=[H._id,H._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(I={ok:!0,id:H._id,rev:"0-0"},void (F.ctx&&E(null,I))):E(bS(aX))})}"function"==typeof F&&(E=F,F={});var I;F.ctx?G(F.ctx):l.transaction(G,cQ(E),function(){I&&E(null,I)})},s._destroy=function(F,E){bX.removeAllListeners(s._name),l.transaction(function(H){var G=[dQ,aW,am,c7,cW,dL];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},cQ(E),function(){dd()&&(delete window.localStorage["_pouch__websqldb_"+s._name],delete window.localStorage[s._name]),E(null,{ok:!0})})}}function ep(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(g){return !1}}function cb(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent)){return !0}var i=dd(),h="_pouch__websqldb_valid_"+navigator.userAgent;if(i&&localStorage[h]){return"1"===localStorage[h]}var g=ep();return i&&(localStorage[h]=g?"1":"0"),g}function eY(){return"undefined"!=typeof SQLitePlugin?!0:"undefined"==typeof openDatabase?!1:cb()}function bK(g){return function(i,l,j,k){if("undefined"!=typeof sqlitePlugin){var h=dc.extend({},g,{name:i,version:l,description:j,size:k});return sqlitePlugin.openDatabase(h)}return openDatabase(i,l,j,k)}}function jJ(j,h){var g=bK(j),i=dc.extend({websql:g},j);ek.call(this,i,h)}function bU(g){g.adapter("websql",jJ,!0)}function jF(){for(var j={},h=new bm(function(k,l){j.resolve=k,j.reject=l}),g=new Array(arguments.length),i=0;i<g.length;i++){g[i]=arguments[i]}return j.promise=h,bm.resolve().then(function(){return fetch.apply(null,g)}).then(function(k){j.resolve(k)})["catch"](function(k){j.reject(k)}),j}function cF(k,i){var g,j,l,m=new Headers,h={method:k.method,credentials:"include",headers:m};return k.json&&(m.set("Accept","application/json"),m.set("Content-Type",k.headers["Content-Type"]||"application/json")),k.body&&k.body instanceof Blob?jN(k.body,function(n){h.body=n}):k.body&&k.processData&&"string"!=typeof k.body?h.body=JSON.stringify(k.body):"body" in k?h.body=k.body:h.body=null,Object.keys(k.headers).forEach(function(n){k.headers.hasOwnProperty(n)&&m.set(n,k.headers[n])}),g=jF(k.url,h),k.timeout>0&&(j=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+k.url))},k.timeout)),g.promise.then(function(n){return l={statusCode:n.status},k.timeout>0&&clearTimeout(j),l.statusCode>=200&&l.statusCode<300?k.binary?n.blob():n.text():n.json()}).then(function(n){l.statusCode>=200&&l.statusCode<300?i(null,l,n):i(n,l)})["catch"](function(n){i(n,l)}),{abort:g.reject}}function j4(k,n){var i,g,j=!1,l=function(){i.abort()},o=function(){j=!0,i.abort()};i=k.xhr?new k.xhr:new XMLHttpRequest;try{i.open(k.method,k.url)}catch(h){n(h,{statusCode:413})}i.withCredentials="withCredentials" in k?k.withCredentials:!0,"GET"===k.method?delete k.headers["Content-Type"]:k.json&&(k.headers.Accept="application/json",k.headers["Content-Type"]=k.headers["Content-Type"]||"application/json",k.body&&k.processData&&"string"!=typeof k.body&&(k.body=JSON.stringify(k.body))),k.binary&&(i.responseType="arraybuffer"),"body" in k||(k.body=null);for(var m in k.headers){k.headers.hasOwnProperty(m)&&i.setRequestHeader(m,k.headers[m])}return k.timeout>0&&(g=setTimeout(o,k.timeout),i.onprogress=function(){clearTimeout(g),4!==i.readyState&&(g=setTimeout(o,k.timeout))},"undefined"!=typeof i.upload&&(i.upload.onprogress=i.onprogress)),i.onreadystatechange=function(){if(4===i.readyState){var s={statusCode:i.status};if(i.status>=200&&i.status<300){var q;q=k.binary?jV([i.response||""],{type:i.getResponseHeader("Content-Type")}):i.responseText,n(null,s,q)}else{var p={};if(j){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(i.response)}catch(r){}}n(p,s)}}},k.body&&k.body instanceof Blob?jN(k.body,function(p){i.send(p)}):i.send(k.body),{abort:l}}function fP(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function a8(g,h){return bN||g.xhr?j4(g,h):cF(g,h)}function aY(){return""}function f8(h,k){function j(m,l,n){if(!h.binary&&h.json&&"string"==typeof m){try{m=JSON.parse(m)}catch(o){return n(o)}}Array.isArray(m)&&(m=m.map(function(p){return p.error||p.missing?aL(p):p})),h.binary&&bD(m,l),n(null,m,l)}function g(p,n){var l,o;if(p.code&&p.status){var q=new Error(p.message||p.code);return q.status=p.status,n(q)}if(p.message&&"ETIMEDOUT"===p.message){return n(p)}try{l=JSON.parse(p.responseText),o=aL(l)}catch(m){o=aL(p)}n(o)}h=dY(h);var i={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return h=dc.extend(i,h),h.json&&(h.binary||(h.headers.Accept="application/json"),h.headers["Content-Type"]=h.headers["Content-Type"]||"application/json"),h.binary&&(h.encoding=null,h.json=!1),h.processData||(h.json=!1),a8(h,function(q,n,l){if(q){return q.status=n?n.statusCode:400,g(q,k)}var o,m=n.headers&&n.headers["content-type"],r=l||aY();if(!h.binary&&(h.json||!h.processData)&&"object"!=typeof r&&(/json/.test(m)||/^[\s]*\{/.test(r)&&/\}[\s]*$/.test(r))){try{r=JSON.parse(r.toString())}catch(p){}}n.statusCode>=200&&n.statusCode<300?j(r,n,k):(o=aL(r),o.status=n.statusCode,k(o))})}function dD(o,h){var l=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",j=-1!==l.indexOf("safari")&&-1===l.indexOf("chrome"),k=-1!==l.indexOf("msie"),m=-1!==l.indexOf("edge"),g=j||(k||m)&&"GET"===o.method,i="cache" in o?o.cache:!0,n=/^blob:/.test(o.url);if(!n&&(g||!i)){var p=-1!==o.url.indexOf("?");o.url+=(p?"&":"?")+"_nonce="+Date.now()}return f8(o,h)}function eL(g){var h=g.doc&&g.doc._attachments;h&&Object.keys(h).forEach(function(i){var j=h[i];j.data=bd(j.data,j.content_type)})}function e1(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function bC(g){return g._attachments&&Object.keys(g._attachments)?bm.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?new bm(function(j){aR(i.data,j)}).then(function(j){i.data=j}):void 0})):bm.resolve()}function dI(i){var h=aU(i);(h.user||h.password)&&(h.auth={username:h.user,password:h.password});var g=h.path.replace(/(^\/|\/$)/g,"").split("/");return h.db=g.pop(),-1===h.db.indexOf("%")&&(h.db=encodeURIComponent(h.db)),h.path=g.join("/"),h}function cj(g,h){return eI(g,g.db+"/"+h)}function eI(i,h){var g=i.path?"/":"";return i.protocol+"://"+i.host+(i.port?":"+i.port:"")+"/"+i.path+g+h}function fN(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function kc(j,o){function w(A,z,x){var y=A.ajax||{},B=dc.extend(dY(q),y,z);return cT(B.method+" "+B.url),k._ajax(B,x)}function p(y,x){return new bm(function(z,A){w(y,x,function(C,B){return C?A(C):void z(B)})})}function i(y,x){return eE(y,cf(function(z){v().then(function(){return x.apply(this,z)})["catch"](function(A){var B=z.pop();B(A)})}))}function v(){if(j.skipSetup||j.skip_setup){return bm.resolve()}if(m){return m}var x={method:"GET",url:h};return m=p({},x)["catch"](function(y){return y&&y.status&&404===y.status?(cU(404,"PouchDB is just detecting if the remote exists."),p({},{method:"PUT",url:h})):bm.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:bm.reject(y)}),m["catch"](function(){m=null}),m}function g(x){return x.split("/").map(encodeURIComponent).join("/")}var k=this,u=dI;j.getHost&&(u=j.getHost);var n=u(j.name,j),h=cj(n,"");j=dY(j);var q=j.ajax||{};if(k.getUrl=function(){return h},k.getHeaders=function(){return q.headers||{}},j.auth||n.auth){var s=j.auth||n.auth,r=s.username+":"+s.password,l=dV(unescape(encodeURIComponent(r)));q.headers=q.headers||{},q.headers.Authorization="Basic "+l}k._ajax=dD;var m;setTimeout(function(){o(null,k)}),k.type=function(){return"http"},k.id=i("id",function(x){w({},{method:"GET",url:eI(n,"")},function(y,A){var z=A&&A.uuid?A.uuid+n.db:cj(n,"");x(null,z)})}),k.request=i("request",function(y,x){y.url=cj(n,y.url),w({},y,x)}),k.compact=i("compact",function(y,x){"function"==typeof y&&(x=y,y={}),y=dY(y),w(y,{url:cj(n,"_compact"),method:"POST"},function(){function z(){k.info(function(A,B){B&&!B.compact_running?x(null,{ok:!0}):setTimeout(z,y.interval||200)})}z()})}),k.bulkGet=eE("bulkGet",function(y,C){function B(F){var E={};y.revs&&(E.revs=!0),y.attachments&&(E.attachments=!0),w({},{url:cj(n,"_bulk_get"+fN(E)),method:"POST",body:{docs:y.docs}},F)}function A(){function F(L){return function(M,N){I[L]=N.results,++G===K&&C(null,{results:eU(I)})}}for(var J=aF,K=Math.ceil(y.docs.length/J),G=0,I=new Array(K),H=0;K>H;H++){var E=fD(y,["revs","attachments"]);E.ajax=q,E.docs=y.docs.slice(H*J,Math.min(y.docs.length,(H+1)*J)),eB(z,E,F(H))}}var z=this,D=eI(n,""),x=fF[D];"boolean"!=typeof x?B(function(E,F){if(E){var G=Math.floor(E.status/100);4===G||5===G?(fF[D]=!1,cU(E.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),A()):C(E)}else{fF[D]=!0,C(null,F)}}):x?B(C):A()}),k._info=function(x){v().then(function(){w({},{method:"GET",url:cj(n,"")},function(y,z){return y?x(y):(z.host=cj(n,""),void x(null,z))})})["catch"](x)},k.get=i("get",function(C,y,B){function A(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?bm.all(E.map(function(I){var J=G[I],H=e1(F._id)+"/"+g(I)+"?rev="+F._rev;return p(y,{method:"GET",url:cj(n,H),binary:!0}).then(function(K){return y.binary?K:new bm(function(L){aR(K,L)})}).then(function(K){delete J.stub,delete J.length,J.data=K})})):void 0}function z(E){return Array.isArray(E)?bm.all(E.map(function(F){return F.ok?A(F.ok):void 0})):A(E)}"function"==typeof y&&(B=y,y={}),y=dY(y);var x={};y.revs&&(x.revs=!0),y.revs_info&&(x.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),x.open_revs=y.open_revs),y.rev&&(x.rev=y.rev),y.conflicts&&(x.conflicts=y.conflicts),C=e1(C);var D={method:"GET",url:cj(n,C+fN(x))};p(y,D).then(function(E){return bm.resolve().then(function(){return y.attachments?z(E):void 0}).then(function(){B(null,E)})})["catch"](B)}),k.remove=i("remove",function(B,z,x,C){var y;"string"==typeof z?(y={_id:B,_rev:z},"function"==typeof x&&(C=x,x={})):(y=B,"function"==typeof z?(C=z,x={}):(C=x,x=z));var A=y._rev||x.rev;w(x,{method:"DELETE",url:cj(n,e1(y._id))+"?rev="+A},C)}),k.getAttachment=i("getAttachment",function(B,x,z,y){"function"==typeof z&&(y=z,z={});var A=z.rev?"?rev="+z.rev:"",C=cj(n,e1(B))+"/"+g(x)+A;w(z,{method:"GET",url:C,binary:!0},y)}),k.removeAttachment=i("removeAttachment",function(A,z,y,x){var B=cj(n,e1(A)+"/"+g(z))+"?rev="+y;w({},{method:"DELETE",url:B},x)}),k.putAttachment=i("putAttachment",function(C,G,x,y,A,H){"function"==typeof A&&(H=A,A=y,y=x,x=null);var F=e1(C)+"/"+g(G),E=cj(n,F);if(x&&(E+="?rev="+x),"string"==typeof y){var z;try{z=fG(y)}catch(D){return H(bS(eP,"Attachment is not a valid base64 string"))}y=z?dv(z,A):""}var B={headers:{"Content-Type":A},method:"PUT",url:E,processData:!1,body:y,timeout:q.timeout||60000};w({},B,H)}),k._bulkDocs=function(z,x,y){z.new_edits=x.new_edits,v().then(function(){return bm.all(z.docs.map(bC))}).then(function(){w(x,{method:"POST",url:cj(n,"_bulk_docs"),body:z},function(B,A){return B?y(B):(A.forEach(function(C){C.ok=!0}),void y(null,A))})})["catch"](y)},k.allDocs=i("allDocs",function(C,y){"function"==typeof C&&(y=C,C={}),C=dY(C);var B,A={},z="GET";C.conflicts&&(A.conflicts=!0),C.descending&&(A.descending=!0),C.include_docs&&(A.include_docs=!0),C.attachments&&(A.attachments=!0),C.key&&(A.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(A.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(A.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(A.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(A.limit=C.limit),"undefined"!=typeof C.skip&&(A.skip=C.skip);var D=fN(A);if("undefined"!=typeof C.keys){var x="keys="+encodeURIComponent(JSON.stringify(C.keys));x.length+D.length+1<=fA?D+="&"+x:(z="POST",B={keys:C.keys})}p(C,{method:z,url:cj(n,"_all_docs"+D),body:B}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(eL),y(null,E)})["catch"](y)}),k._changes=function(B){var J="batch_size" in B?B.batch_size:ej;B=dY(B),B.timeout="timeout" in B?B.timeout:"timeout" in q?q.timeout:30000;var H,A=B.timeout?{timeout:B.timeout-5000}:{},D="undefined"!=typeof B.limit?B.limit:!1;H="return_docs" in B?B.return_docs:"returnDocs" in B?B.returnDocs:!0;var L=D;if(B.style&&(A.style=B.style),(B.include_docs||B.filter&&"function"==typeof B.filter)&&(A.include_docs=!0),B.attachments&&(A.attachments=!0),B.continuous&&(A.feed="longpoll"),B.conflicts&&(A.conflicts=!0),B.descending&&(A.descending=!0),"heartbeat" in B?B.heartbeat&&(A.heartbeat=B.heartbeat):A.heartbeat=10000,B.filter&&"string"==typeof B.filter&&(A.filter=B.filter),B.view&&"string"==typeof B.view&&(A.filter="_view",A.view=B.view),B.query_params&&"object"==typeof B.query_params){for(var y in B.query_params){B.query_params.hasOwnProperty(y)&&(A[y]=B.query_params[y])}}var F,E="GET";if(B.doc_ids){A.filter="_doc_ids";var C=JSON.stringify(B.doc_ids);C.length<fA?A.doc_ids=C:(E="POST",F={doc_ids:B.doc_ids})}var z,K,x=function(N,M){if(!B.aborted){A.since=N,"object"==typeof A.since&&(A.since=JSON.stringify(A.since)),B.descending?D&&(A.limit=L):A.limit=!D||L>J?J:L;var O={method:E,url:cj(n,"_changes"+fN(A)),timeout:B.timeout,body:F};K=N,B.aborted||v().then(function(){z=w(B,O,M)})["catch"](M)}},I={results:[]},G=function(O,Q){if(!B.aborted){var P=0;if(Q&&Q.results){P=Q.results.length,I.last_seq=Q.last_seq;var M={};M.query=B.query_params,Q.results=Q.results.filter(function(R){L--;var S=d8(B)(R);return S&&(B.include_docs&&B.attachments&&B.binary&&eL(R),H&&I.results.push(R),B.onChange(R)),S})}else{if(O){return B.aborted=!0,void B.complete(O)}}Q&&Q.last_seq&&(K=Q.last_seq);var N=D&&0>=L||Q&&J>P||B.descending;(!B.continuous||D&&0>=L)&&N?B.complete(null,I):setTimeout(function(){x(K,G)},0)}};return x(B.since||0,G),{cancel:function(){B.aborted=!0,z&&z.abort()}}},k.revsDiff=i("revsDiff",function(z,x,y){"function"==typeof x&&(y=x,x={}),w(x,{method:"POST",url:cj(n,"_revs_diff"),body:z},y)}),k._close=function(x){x()},k._destroy=function(y,x){w(y,{url:cj(n,""),method:"DELETE"},function(z,A){return z&&z.status&&404!==z.status?x(z):void x(null,A)})}}function cq(g){g.adapter("http",kc,!1),g.adapter("https",kc,!1)}function jZ(){this.promise=new bm(function(g){g()})}function aj(j){var l=j.db,h=j.viewName,n=j.map,g=j.reduce,k=j.temporary,i=n.toString()+(g&&g.toString())+"undefined";if(!k&&l._cachedViews){var m=l._cachedViews[i];if(m){return bm.resolve(m)}}return l.info().then(function(p){function o(u){u.views=u.views||{};var r=h;-1===r.indexOf("/")&&(r=h+"/"+h);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(k?"temp":dj(i));return jG(l,"_local/mrviews",o).then(function(){return l.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:l,adapter:l.adapter,mapFun:n,reduceFun:g};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,k||(l._cachedViews=l._cachedViews||{},l._cachedViews[i]=r,r.db.once("destroyed",function(){delete l._cachedViews[i]})),r})})})})}function eV(i,l,k,h,j,g){return cL("return ("+i.replace(/;\s*$/,"")+");",{emit:l,sum:k,log:h,isArray:j,toJSON:g})}function kk(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function ah(g){return 1===g.length&&/^1-/.test(g[0].rev)}function dA(i,h){try{i.emit("error",h)}catch(g){dX("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),dX("error",h)}}function bO(j,h,g){try{return{output:h.apply(null,g)}}catch(i){return dA(j,i),{error:i}}}function cc(i,h){var g=bb.collate(i.key,h.key);return 0!==g?g:bb.collate(i.value,h.value)}function dR(i,h,g){return g=g||0,"number"==typeof h?i.slice(g,h+g):g>0?i.slice(g):i}function e2(i){var h=i.value,g=h&&"object"==typeof h&&h._id||i.id;return g}function fQ(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=bd(k.data,k.content_type)})})}function eq(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&fQ(h),h}}function eT(g){var h="builtin "+g+" function requires map values to be numbers or number arrays";return new jH(h)}function j3(j){for(var l=0,h=0,n=j.length;n>h;h++){var g=j[h];if("number"!=typeof g){if(!Array.isArray(g)){throw eT("_sum")}l="number"==typeof l?[l]:l;for(var k=0,i=g.length;i>k;k++){var m=g[k];if("number"!=typeof m){throw eT("_sum")}"undefined"==typeof l[k]?l.push(m):l[k]+=m}}else{"number"==typeof l?l+=g:l[0]+=g}}return l}function km(h,k,j,g){var i=k[h];"undefined"!=typeof i&&(g&&(i=encodeURIComponent(JSON.stringify(i))),j.push(h+"="+i))}function jP(g){if("undefined"!=typeof g){var h=Number(g);return isNaN(h)||h!==parseInt(g,10)?g:h}}function kb(g){return g.group_level=jP(g.group_level),g.limit=jP(g.limit),g.skip=jP(g.skip),g}function em(g){if(g){if("number"!=typeof g){return new eF('Invalid value for integer: "'+g+'"')}if(0>g){return new eF('Invalid value for positive integer: "'+g+'"')}}}function kj(j,h){var g=j.descending?"endkey":"startkey",i=j.descending?"startkey":"endkey";if("undefined"!=typeof j[g]&&"undefined"!=typeof j[i]&&bb.collate(j[g],j[i])>0){throw new eF("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(h.reduce&&j.reduce!==!1){if(j.include_docs){throw new eF("{include_docs:true} is invalid for reduce")}if(j.keys&&j.keys.length>1&&!j.group&&!j.group_level){throw new eF("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=em(j[k]);if(l){throw l}})}function jI(k,n,i){var g,j=[],l="GET";if(km("reduce",i,j),km("include_docs",i,j),km("attachments",i,j),km("limit",i,j),km("descending",i,j),km("group",i,j),km("group_level",i,j),km("skip",i,j),km("stale",i,j),km("conflicts",i,j),km("startkey",i,j,!0),km("start_key",i,j,!0),km("endkey",i,j,!0),km("end_key",i,j,!0),km("inclusive_end",i,j),km("key",i,j,!0),j=j.join("&"),j=""===j?"":"?"+j,"undefined"!=typeof i.keys){var o=2000,h="keys="+encodeURIComponent(JSON.stringify(i.keys));h.length+j.length+1<=o?j+=("?"===j[0]?"&":"?")+h:(l="POST","string"==typeof n?g={keys:i.keys}:n.keys=i.keys)}if("string"==typeof n){var m=kk(n);return k.request({method:l,url:"_design/"+m[0]+"/_view/"+m[1]+j,body:g}).then(eq(i))}return g=g||{},Object.keys(n).forEach(function(p){Array.isArray(n[p])?g[p]=n[p]:g[p]=n[p].toString()}),k.request({method:"POST",url:"_temp_view"+j,body:g}).then(eq(i))}function dq(i,h,g){return new bm(function(j,k){i._query(h,g,function(m,l){return m?k(m):void j(l)})})}function j9(g){return new bm(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function kg(g){return function(h){if(404===h.status){return g}throw h}}function ef(h,l,g){function n(){return ah(o)?bm.resolve(k):l.db.get(i)["catch"](kg(k))}function m(r){return r.keys.length?l.db.allDocs({keys:r.keys,include_docs:!0}):bm.resolve({rows:[]})}function p(w,z){for(var r=[],B={},s=0,u=z.rows.length;u>s;s++){var x=z.rows[s],A=x.doc;if(A&&(r.push(A),B[A._id]=!0,A._deleted=!q[A._id],!A._deleted)){var y=q[A._id];"value" in y&&(A.value=y.value)}}var v=Object.keys(q);return v.forEach(function(C){if(!B[C]){var E={_id:C},D=q[C];"value" in D&&(E.value=D.value),r.push(E)}}),w.keys=d7(v.concat(w.keys)),r.push(w),r}var i="_local/doc_"+h,k={_id:i,keys:[]},j=g[h],q=j.indexableKeysToKeyValues,o=j.changes;return n().then(function(r){return m(r).then(function(s){return p(r,s)})})}function jU(j,h,g){var i="_local/lastSeq";return j.db.get(i)["catch"](kg({_id:i,seq:0})).then(function(k){var l=Object.keys(h);return bm.all(l.map(function(m){return ef(m,j,h)})).then(function(n){var m=eU(n);return k.seq=g,m.push(k),j.db.bulkDocs({docs:m})})})}function f9(i){var h="string"==typeof i?i:i.name,g=bj[h];return g||(g=bj[h]=new jZ),g}function j2(g){return aN(f9(g),function(){return f6(g)})()}function f6(k){function n(p,r){var q={id:j._id,key:bb.normalizeKey(p)};"undefined"!=typeof r&&null!==r&&(q.value=bb.normalizeKey(r)),g.push(q)}function i(q,p){return function(){return jU(k,q,p)}}var g,j,l;if("function"==typeof k.mapFun&&2===k.mapFun.length){var o=k.mapFun;l=function(p){return o(p,n)}}else{l=eV(k.mapFun.toString(),n,j3,b7,Array.isArray,JSON.parse)}var h=k.seq||0,m=new jZ;return new bm(function(p,s){function r(){m.finish().then(function(){k.seq=h,p()})}function q(){function u(v){s(v)}k.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:bx}).on("complete",function(C){var x=C.results;if(!x.length){return r()}for(var D={},v=0,F=x.length;F>v;v++){var A=x[v];if("_"!==A.doc._id[0]){g=[],j=A.doc,j._deleted||bO(k.sourceDB,l,[j]),g.sort(cc);for(var z,H={},y=0,E=g.length;E>y;y++){var G=g[y],w=[G.key,G.id];0===bb.collate(G.key,z)&&w.push(y);var B=bb.toIndexableString(w);H[B]=G,z=G.key}D[A.doc._id]={indexableKeysToKeyValues:H,changes:A.changes}}h=A.seq}return m.add(i(D,h)),x.length<bx?r():q()}).on("error",u)}q()})}function eN(h,l,g){0===g.group_level&&delete g.group_level;var n,m=g.group||g.group_level;n=b0[h.reduceFun]?b0[h.reduceFun]:eV(h.reduceFun.toString(),null,j3,b7,Array.isArray,JSON.parse);var p=[],i=isNaN(g.group_level)?Number.POSITIVE_INFINITY:g.group_level;l.forEach(function(r){var u=p[p.length-1],s=m?r.key:null;return m&&Array.isArray(s)&&(s=s.slice(0,i)),u&&0===bb.collate(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void p.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),l=[];for(var k=0,j=p.length;j>k;k++){var q=p[k],o=bO(h.sourceDB,n,[q.keys,q.values,!1]);if(o.error&&o.error instanceof jH){throw o.error}l.push({value:o.error?null:o.output,key:q.groupKey})}return{rows:dR(l,g.limit,g.skip)}}function fO(g,h){return aN(f9(g),function(){return jX(g,h)})()}function jX(r,l){function o(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return n=v.total_rows,v.rows.map(function(z){if("value" in z.doc&&"object"==typeof z.doc.value&&null!==z.doc.value){var x=Object.keys(z.doc.value).sort(),w=["id","key","value"];if(!(w>x||x>w)){return z.doc.value}}var y=bb.parseIndexableString(z.doc._id);return{key:y[0],id:y[1],value:"value" in z.doc?z.doc.value:null}})})}function m(v){var u;if(u=q?eN(r,v,l):{total_rows:n,offset:j,rows:v},l.include_docs){var w=d7(v.map(e2));return r.sourceDB.allDocs({keys:w,include_docs:!0,conflicts:l.conflicts,attachments:l.attachments,binary:l.binary}).then(function(y){var x={};return y.rows.forEach(function(z){z.doc&&(x["$"+z.id]=z.doc)}),v.forEach(function(A){var B=e2(A),z=x["$"+B];z&&(A.doc=z)}),u})}return u}var n,q=r.reduceFun&&l.reduce!==!1,j=l.skip||0;if("undefined"==typeof l.keys||l.keys.length||(l.limit=0,delete l.keys),"undefined"!=typeof l.keys){var s=l.keys,k=s.map(function(u){var v={startkey:bb.toIndexableString([u]),endkey:bb.toIndexableString([u,{}])};return o(v)});return bm.all(k).then(eU).then(m)}var i={descending:l.descending};if(l.start_key&&(l.startkey=l.start_key),l.end_key&&(l.endkey=l.end_key),"undefined"!=typeof l.startkey&&(i.startkey=l.descending?bb.toIndexableString([l.startkey,{}]):bb.toIndexableString([l.startkey])),"undefined"!=typeof l.endkey){var g=l.inclusive_end!==!1;l.descending&&(g=!g),i.endkey=bb.toIndexableString(g?[l.endkey,{}]:[l.endkey])}if("undefined"!=typeof l.key){var p=bb.toIndexableString([l.key]),h=bb.toIndexableString([l.key,{}]);i.descending?(i.endkey=p,i.startkey=h):(i.startkey=p,i.endkey=h)}return q||("number"==typeof l.limit&&(i.limit=l.limit),i.skip=j),o(i).then(m)}function kl(g){return g.request({method:"POST",url:"_view_cleanup"})}function fL(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(n){var l=kk(n),m="_design/"+l[0],k=l[1];j[m]=j[m]||{},j[m][k]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(n){var k={};n.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){k[v]=k[v]||s})})});var m=Object.keys(k).filter(function(o){return !k[o]}),l=m.map(function(o){return aN(f9(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return bm.all(l).then(function(){return{ok:!0}})})},kg({ok:!0}))}function fI(g,m,j){if("http"===g.type()){return jI(g,m,j)}if("function"==typeof g._query){return dq(g,m,j)}if("string"!=typeof m){kj(j,m);var h={db:g,viewName:"temp_view/temp_view",map:m.map,reduce:m.reduce,temporary:!0};return dx.add(function(){return aj(h).then(function(o){function p(){return o.db.destroy()}return ke(j2(o).then(function(){return fO(o,j)}),p)})}),dx.finish()}var l=m,i=kk(l),n=i[0],k=i[1];return g.get("_design/"+n).then(function(o){var p=o.views&&o.views[k];if(!p||"string"!=typeof p.map){throw new ac("ddoc "+n+" has no view named "+k)}kj(j,p);var q={db:g,viewName:l,map:p.map,reduce:p.reduce};return aj(q).then(function(r){return"ok"===j.stale||"update_after"===j.stale?("update_after"===j.stale&&dC.nextTick(function(){j2(r)}),fO(r,j)):j2(r).then(function(){return fO(r,j)})})})}function eF(g){this.status=400,this.name="query_parse_error",this.message=g,this.error=!0;try{Error.captureStackTrace(this,eF)}catch(h){}}function ac(g){this.status=404,this.name="not_found",this.message=g,this.error=!0;try{Error.captureStackTrace(this,ac)}catch(h){}}function jH(g){this.status=500,this.name="invalid_value",this.message=g,this.error=!0;try{Error.captureStackTrace(this,jH)}catch(h){}}function bQ(g){return/^1-/.test(g)}function fR(i,h,g){return !i._attachments||!i._attachments[g]||i._attachments[g].digest!==h._attachments[g].digest}function cC(i,h){var g=Object.keys(h._attachments);return bm.all(g.map(function(j){return i.getAttachment(h._id,j,{rev:h._rev})}))}function eD(h,k,j){var g="http"===k.type()&&"http"!==h.type(),i=Object.keys(j._attachments);return g?h.get(j._id).then(function(l){return bm.all(i.map(function(m){return fR(l,j,m)?k.getAttachment(j._id,m):h.getAttachment(l._id,m)}))})["catch"](function(l){if(404!==l.status){throw l}return cC(k,j)}):cC(k,j)}function cx(g){var h=[];return Object.keys(g).forEach(function(j){var i=g[j].missing;i.forEach(function(k){h.push({id:j,rev:k})})}),{docs:h,revs:!0}}function bv(g,k,p,m){function n(){var r=cx(p);if(r.docs.length){return g.bulkGet(r).then(function(s){if(m.cancelled){throw new Error("cancelled")}return bm.all(s.results.map(function(u){return bm.all(u.docs.map(function(w){var v=w.ok;return w.error&&(o=!1),v&&v._attachments?eD(k,g,v).then(function(y){var x=Object.keys(v._attachments);return y.forEach(function(z,B){var A=v._attachments[x[B]];delete A.stub,delete A.length,A.data=z}),v}):v}))})).then(function(u){q=q.concat(eU(u).filter(Boolean))})})}}function h(r){return r._attachments&&Object.keys(r._attachments).length>0}function i(r){return g.allDocs({keys:r,include_docs:!0}).then(function(s){if(m.cancelled){throw new Error("cancelled")}s.rows.forEach(function(u){!u.deleted&&u.doc&&bQ(u.value.rev)&&!h(u.doc)&&(q.push(u.doc),delete p[u.id])})})}function l(){var r=Object.keys(p).filter(function(s){var u=p[s].missing;return 1===u.length&&bQ(u[0])});return r.length>0?i(r):void 0}function j(){return{ok:o,docs:q}}p=dY(p);var q=[],o=!0;return bm.resolve().then(l).then(n).then(j)}function ec(h,k,j,g,i){return h.get(k)["catch"](function(l){if(404===l.status){return"http"===h.type()&&cU(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:g,_id:k,history:[],replicator:dK,version:az}}throw l}).then(function(l){return i.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==g}),l.history.unshift({last_seq:j,session_id:g}),l.history=l.history.slice(0,dp),l.version=az,l.replicator=dK,l.session_id=g,l.last_seq=j,h.put(l)["catch"](function(m){if(409===m.status){return ec(h,k,j,g,i)}throw m}))})}function b9(j,h,g,i){this.src=j,this.target=h,this.id=g,this.returnValue=i}function d0(g,h){return g.session_id===h.session_id?{last_seq:g.last_seq,history:g.history}:jO(g.history,h.history)}function jO(j,l){var h=j[0],n=j.slice(1),g=l[0],k=l.slice(1);if(!h||0===l.length){return{last_seq:b3,history:[]}}var i=h.session_id;if(cl(i,l)){return{last_seq:h.last_seq,history:j}}var m=g.session_id;return cl(m,n)?{last_seq:g.last_seq,history:k}:jO(n,k)}function cl(j,h){var g=h[0],i=h.slice(1);return j&&0!==h.length?j===g.session_id?!0:cl(j,i):!1}function dm(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function dS(j,h,g,i){return j.retry===!1?(h.emit("error",g),void h.removeAllListeners()):("function"!=typeof j.back_off_function&&(j.back_off_function=c1),h.emit("requestError",g),"active"!==h.state&&"pending"!==h.state||(h.emit("paused",g),h.state="stopped",h.once("active",function(){j.current_back_off=bZ})),j.current_back_off=j.current_back_off||bZ,j.current_back_off=j.back_off_function(j.current_back_off),void setTimeout(i,j.current_back_off))}function da(g){return Object.keys(g).sort(bb.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function c0(k,i,g){var j=g.doc_ids?g.doc_ids.sort(bb.collate):"",l=g.filter?g.filter.toString():"",m="",h="";return g.filter&&g.query_params&&(m=JSON.stringify(da(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),bm.all([k.id(),i.id()]).then(function(o){var n=o[0]+o[1]+l+h+m+j;return new bm(function(p){j1(n,p)})}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function dN(J,g,s,n,r){function z(){return F?bm.resolve():c0(J,g,s).then(function(T){Q=T,F=new b9(J,g,Q,n)})}function m(){if(k=[],0!==H.docs.length){var T=H.docs;return g.bulkDocs({docs:T,new_edits:!1}).then(function(X){if(n.cancelled){throw q(),new Error("cancelled")}var U=[],W={};X.forEach(function(Z){Z.error&&(r.doc_write_failures++,U.push(Z),W[Z.id]=Z)}),I=I.concat(U),r.docs_written+=H.docs.length-U.length;var V=U.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=W[Z._id];ae?n.emit("denied",dY(ae)):k.push(Z)}),V.length>0){var Y=new Error("bulkDocs error");throw Y.other_errors=U,A("target.bulkDocs failed to write docs",Y),new Error("bulkWrite partial failure")}},function(U){throw r.doc_write_failures+=T.length,U})}}function h(){if(H.error){throw new Error("There was a problem getting docs.")}r.last_seq=y=H.seq;var T=dY(r);return k.length&&(T.docs=k,n.emit("change",T)),C=!0,F.writeCheckpoint(H.seq,K).then(function(){if(C=!1,n.cancelled){throw q(),new Error("cancelled")}H=void 0,v()})["catch"](R)}function M(){var T={};return H.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),g.revsDiff(T).then(function(U){if(n.cancelled){throw q(),new Error("cancelled")}H.diffs=U})}function E(){return bv(J,g,H.diffs,n).then(function(T){H.error=!T.ok,T.docs.forEach(function(U){delete H.diffs[U._id],r.docs_read++,H.docs.push(U)})})}function w(){if(!n.cancelled&&!H){if(0===x.length){return void O(!0)}H=x.shift(),M().then(E).then(m).then(h).then(w)["catch"](function(T){A("batch processing terminated with error",T)})}}function O(T){return 0===p.changes.length?void (0!==x.length||H||((j&&u.live||l)&&(n.state="pending",n.emit("paused")),l&&q())):void ((T||l||p.changes.length>=N)&&(x.push(p),p={seq:0,changes:[],docs:[]},"pending"!==n.state&&"stopped"!==n.state||(n.state="active",n.emit("active")),w()))}function A(T,U){D||(U.message||(U.message=T),r.ok=!1,r.status="aborting",r.errors.push(U),I=I.concat(U),x=[],p={seq:0,changes:[],docs:[]},q())}function q(){if(!(D||n.cancelled&&(r.status="cancelled",C))){r.status=r.status||"complete",r.end_time=new Date,r.last_seq=y,D=!0;var T=I.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(T.length>0){var U=I.pop();I.length>0&&(U.other_errors=I),U.result=r,dS(s,n,U,function(){dN(J,g,s,n)})}else{r.errors=I,n.emit("complete",r),n.removeAllListeners()}}}function L(T){if(n.cancelled){return q()}var U=d8(s)(T);U&&(p.seq=T.seq,p.changes.push(T),O(0===x.length&&u.live))}function S(T){if(i=!1,n.cancelled){return q()}if(T.results.length>0){u.since=T.last_seq,v(),O(!0)}else{var U=function(){j?(u.live=!0,v()):l=!0,O(!0)};H||0!==T.results.length?U():(C=!0,F.writeCheckpoint(T.last_seq,K).then(function(){C=!1,r.last_seq=y=T.last_seq,U()})["catch"](R))}}function o(T){return i=!1,n.cancelled?q():void A("changes rejected",T)}function v(){function V(){U.cancel()}function T(){n.removeListener("cancel",V)}if(!i&&!l&&x.length<P){i=!0,n._changes&&(n.removeListener("cancel",n._abortChanges),n._changes.cancel()),n.once("cancel",V);var U=J.changes(u).on("change",L);U.then(T,T),U.then(S)["catch"](o),s.retry&&(n._changes=U,n._abortChanges=V)}}function B(){z().then(function(){return n.cancelled?void q():F.getCheckpoint().then(function(T){y=T,u={since:y,limit:N,batch_size:N,style:"all_docs",doc_ids:G,return_docs:!0},s.filter&&("string"!=typeof s.filter?u.include_docs=!0:u.filter=s.filter),"heartbeat" in s&&(u.heartbeat=s.heartbeat),"timeout" in s&&(u.timeout=s.timeout),s.query_params&&(u.query_params=s.query_params),s.view&&(u.view=s.view),v()})})["catch"](function(T){A("getCheckpoint rejected with ",T)})}function R(T){throw C=!1,A("writeCheckpoint completed with error",T),T}var H,Q,F,x=[],p={seq:0,changes:[],docs:[]},C=!1,l=!1,D=!1,y=0,j=s.continuous||s.live||!1,N=s.batch_size||100,P=s.batches_limit||10,i=!1,G=s.doc_ids,I=[],k=[],K=cm();r=r||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var u={};return n.ready(J,g),n.cancelled?void q():(n._addedListeners||(n.once("cancel",q),"function"==typeof s.complete&&(n.once("error",s.complete),n.once("complete",function(T){s.complete(null,T)})),n._addedListeners=!0),void ("undefined"==typeof s.since?B():z().then(function(){return C=!0,F.writeCheckpoint(s.since,K)}).then(function(){return C=!1,n.cancelled?void q():(y=s.since,void B())})["catch"](R)))}function bz(){b6.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var g=this,h=new bm(function(i,j){g.once("complete",i),g.once("error",j)});g.then=function(i,j){return h.then(i,j)},g["catch"]=function(i){return h["catch"](i)},g["catch"](function(){})}function dU(i,h){var g=h.PouchConstructor;return"string"==typeof i?new g(i,h):i}function c6(k,i,g,j){if("function"==typeof g&&(j=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw bS(cs,"`doc_ids` filter parameter is not a list.")}g.complete=j,g=dY(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var l=new bz(g),m=dU(k,g),h=dU(i,g);return dN(m,h,g,l),l}function e9(j,h,g,i){return"function"==typeof g&&(i=g,g={}),"undefined"==typeof g&&(g={}),g=dY(g),g.PouchConstructor=g.PouchConstructor||this,j=dU(j,g),h=dU(h,g),new d5(j,h,g,i)}function d5(y,q,r,l){function p(z){w.emit("change",{direction:"pull",change:z})}function v(z){w.emit("change",{direction:"push",change:z})}function o(z){w.emit("denied",{direction:"push",doc:z})}function s(z){w.emit("denied",{direction:"pull",doc:z})}function i(){w.pushPaused=!0,w.pullPaused&&w.emit("paused")}function m(){w.pullPaused=!0,w.pushPaused&&w.emit("paused")}function x(){w.pushPaused=!1,w.pullPaused&&w.emit("active",{direction:"push"})}function u(){w.pullPaused=!1,w.pushPaused&&w.emit("active",{direction:"pull"})}function k(z){return function(D,A){var B="change"===D&&(A===p||A===v),F="denied"===D&&(A===s||A===o),C="paused"===D&&(A===m||A===i),E="active"===D&&(A===u||A===x);(B||F||C||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&w.removeAllListeners(D))}}var w=this;this.canceled=!1;var n=r.push?dc.extend({},r,r.push):r,h=r.pull?dc.extend({},r,r.pull):r;this.push=c6(y,q,n),this.pull=c6(q,y,h),this.pushPaused=!0,this.pullPaused=!0;var g={};r.live&&(this.push.on("complete",w.pull.cancel.bind(w.pull)),this.pull.on("complete",w.push.cancel.bind(w.push))),this.on("newListener",function(z){"change"===z?(w.pull.on("change",p),w.push.on("change",v)):"denied"===z?(w.pull.on("denied",s),w.push.on("denied",o)):"active"===z?(w.pull.on("active",u),w.push.on("active",x)):"paused"===z&&(w.pull.on("paused",m),w.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(w.pull.removeListener("change",p),w.push.removeListener("change",v)):"denied"===z?(w.pull.removeListener("denied",s),w.push.removeListener("denied",o)):"active"===z?(w.pull.removeListener("active",u),w.push.removeListener("active",x)):"paused"===z&&(w.pull.removeListener("paused",m),w.push.removeListener("paused",i))}),this.pull.on("removeListener",k("pull")),this.push.on("removeListener",k("push"));var j=bm.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return w.emit("complete",z),l&&l(null,z),w.removeAllListeners(),z},function(z){if(w.cancel(),l?l(z):w.emit("error",z),w.removeAllListeners(),l){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function by(g){g.replicate=c6,g.sync=e9}var fC,dc=c(9),cJ=eX(c(5)),dO=eX(c(8)),c8=eX(c(10)),cY=c(14),cf=eX(c(4)),b6=c(1),cL=eX(c(15)),ca=eX(c(16)),aC=eX(c(17)),bb=c(12),bm="function"==typeof Promise?Promise:c8,eJ=Function.prototype.toString,cz=eJ.call(Object),d4=cJ("pouchdb:api"),aZ=6;if(c4()){fC=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),fC=!!localStorage.getItem("_pouch_check_localstorage")}catch(b2){fC=!1}}dO(eC,b6.EventEmitter),eC.prototype.addListener=function(k,i,g,j){function l(){function o(){h=!1}if(m._listeners[i]){if(h){return void (h="waiting")}h=!0;var n=fD(j,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);g.changes(n).on("change",function(p){p.seq>j.since&&!j.cancelled&&(j.since=p.seq,j.onChange(p))}).on("complete",function(){"waiting"===h&&setTimeout(function(){l()},0),h=!1}).on("error",o)}}if(!this._listeners[i]){var m=this,h=!1;this._listeners[i]=l,this.on(k,l)}},eC.prototype.removeListener=function(g,h){h in this._listeners&&b6.EventEmitter.prototype.removeListener.call(this,g,this._listeners[h])},eC.prototype.notifyLocalWindows=function(g){c4()?chrome.storage.local.set({dbName:g}):dd()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},eC.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)},dO(eA,Error),eA.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var eH=new eA({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),aK=new eA({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),aX=new eA({status:404,error:"not_found",reason:"missing"}),bW=new eA({status:409,error:"conflict",reason:"Document update conflict"}),au=new eA({status:400,error:"invalid_id",reason:"_id field must contain a string"}),dF=new eA({status:412,error:"missing_id",reason:"_id is required for puts"}),kh=new eA({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),cS=new eA({status:412,error:"precondition_failed",reason:"Database not open"}),e6=new eA({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),eP=new eA({status:500,error:"badarg",reason:"Some query argument is invalid"}),eW=new eA({status:400,error:"invalid_request",reason:"Request was invalid"}),dJ=new eA({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),f7=new eA({status:500,error:"doc_validation",reason:"Bad special document member"}),cs=new eA({status:400,error:"bad_request",reason:"Something wrong with the request"}),bw=new eA({status:400,error:"bad_request",reason:"Document must be a JSON object"}),d1=new eA({status:404,error:"not_found",reason:"Database not found"}),ba=new eA({status:500,error:"indexed_db_went_bad",reason:"unknown"}),cM=new eA({status:500,error:"web_sql_went_bad",reason:"unknown"}),dP=new eA({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),df=new eA({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),bE=new eA({status:400,error:"bad_request",reason:"Invalid rev format"}),ck=new eA({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),d6=new eA({status:412,error:"missing_stub"}),f1=new eA({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),cG=[eH,aK,aX,bW,au,dF,kh,cS,e6,eP,eW,dJ,f7,cs,bw,d1,cM,dP,df,bE,ck,d6,ba,f1],cD=function(j,h,g){var i=cG.filter(function(k){return k[j]===h});return g&&i.filter(function(k){return k.message===g})[0]||i[0]},ea=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],jR="queryKey",ka=/(?:^|&)([^&=]*)=?([^&]*)/g,dw=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,kd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");dO(eM,b6.EventEmitter),eM.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},eM.prototype.doChanges=function(h){var k=this,j=h.complete;if(h=dY(h),"live" in h&&!("continuous" in h)&&(h.continuous=h.live),h.processChange=eS,"latest"===h.since&&(h.since="now"),h.since||(h.since=0),"now"===h.since){return void this.db.info().then(function(l){return k.isCancelled?void j(null,{status:"cancelled"}):(h.since=l.update_seq,void k.doChanges(h))},j)}if(h.continuous&&"now"!==h.since&&this.db.info().then(function(l){k.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),h.view&&!h.filter&&(h.filter="_view"),h.filter&&"string"==typeof h.filter&&("_view"===h.filter?h.view=eR(h.view):h.filter=eR(h.filter),"http"!==this.db.type()&&!h.doc_ids)){return this.filterChanges(h)}"descending" in h||(h.descending=!1),h.limit=0===h.limit?1:h.limit,h.complete=j;var g=this.db._changes(h);if(g&&"function"==typeof g.cancel){var i=k.cancel;k.cancel=cf(function(l){g.cancel(),i.apply(this,l)})}},eM.prototype.filterChanges=function(i){var l=this,k=i.complete;if("_view"===i.filter){if(!i.view||"string"!=typeof i.view){var h=bS(cs,"`view` filter parameter not found or invalid.");return k(h)}var j=bH(i.view);this.db.get("_design/"+j[0],function(n,m){if(l.isCancelled){return k(null,{status:"cancelled"})}if(n){return k(aL(n))}var o=m&&m.views&&m.views[j[1]]&&m.views[j[1]].map;return o?(i.filter=jY(o),void l.doChanges(i)):k(bS(aX,m.views?"missing json key: "+j[1]:"missing json key: views"))})}else{var g=bH(i.filter);if(!g){return l.doChanges(i)}this.db.get("_design/"+g[0],function(o,m){if(l.isCancelled){return k(null,{status:"cancelled"})}if(o){return k(aL(o))}var n=m&&m.filters&&m.filters[g[1]];return n?(i.filter=cI(n),void l.doChanges(i)):k(bS(aX,m&&m.filters?"missing json key: "+g[1]:"missing json key: filters"))})}},dO(e0,b6.EventEmitter),e0.prototype.post=eE("post",function(i,h,g){return"function"==typeof h&&(g=h,h={}),"object"!=typeof i||Array.isArray(i)?g(bS(bw)):void this.bulkDocs({docs:[i]},h,bP(g))}),e0.prototype.put=eE("put",cf(function(k){function n(){o||(dX("warn","db.put(doc, id, rev) has been deprecated and will be removed in a future release, please use db.put({_id: id, _rev: rev}) instead"),o=!0)}var i,g,j,l,o=!1,h=k.shift(),m="_id" in h;if("object"!=typeof h||Array.isArray(h)){return(l=k.pop())(bS(bw))}for(;;){if(i=k.shift(),g=typeof i,"string"!==g||m?"string"!==g||!m||"_rev" in h?"object"===g?j=i:"function"===g&&(l=i):(n(),h._rev=i):(n(),h._id=i,m=!0),!k.length){break}}return j=j||{},av(h._id),e5(h._id)&&"function"==typeof this._putLocal?h._deleted?this._removeLocal(h,l):this._putLocal(h,l):void this.bulkDocs({docs:[h]},j,bP(l))})),e0.prototype.putAttachment=eE("putAttachment",function(k,i,g,j,l){function m(n){var o="_rev" in n?parseInt(n._rev,10):0;return n._attachments=n._attachments||{},n._attachments[i]={content_type:l,data:j,revpos:++o},h.put(n)}var h=this;return"function"==typeof l&&(l=j,j=g,g=null),"undefined"==typeof l&&(l=j,j=g,g=null),h.get(k).then(function(n){if(n._rev!==g){throw bS(bW)}return m(n)},function(n){if(n.reason===aX.message){return m({_id:k})}throw n})}),e0.prototype.removeAttachment=eE("removeAttachment",function(h,k,j,g){var i=this;i.get(h,function(m,l){return m?void g(m):l._rev!==j?void g(bS(bW)):l._attachments?(delete l._attachments[k],0===Object.keys(l._attachments).length&&delete l._attachments,void i.put(l,g)):g()})}),e0.prototype.remove=eE("remove",function(i,l,k,h){var j;"string"==typeof l?(j={_id:i,_rev:l},"function"==typeof k&&(h=k,k={})):(j=i,"function"==typeof l?(h=l,k={}):(h=k,k=l)),k=k||{},k.was_delete=!0;var g={_id:j._id,_rev:j._rev||k.rev};return g._deleted=!0,e5(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(j,h):void this.bulkDocs({docs:[g]},k,bP(h))}),e0.prototype.revsDiff=eE("revsDiff",function(j,l,h){function n(o,p){m.has(o)||m.set(o,{missing:[]}),m.get(o).missing.push(p)}function g(q,p){var o=j[q].slice(0);fB(p,function(s,r,x,v,w){var u=r+"-"+x,y=o.indexOf(u);-1!==y&&(o.splice(y,1),"available"!==w.status&&n(q,u))}),o.forEach(function(r){n(q,r)})}"function"==typeof l&&(h=l,l={});var k=Object.keys(j);if(!k.length){return h(null,{})}var i=0,m=new cY.Map;k.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){m.set(o,{missing:j[o]})}else{if(q){return h(q)}g(o,p)}if(++i===k.length){var r={};return m.forEach(function(u,s){r[s]=u}),h(null,r)}})},this)}),e0.prototype.bulkGet=eE("bulkGet",function(g,h){eB(this,g,h)}),e0.prototype.compactDocument=eE("compactDocument",function(j,h,g){var i=this;this._getRevisionTree(j,function(n,l){if(n){return g(n)}var o=cd(l),m=[],k=[];Object.keys(o).forEach(function(p){o[p]>h&&m.push(p)}),fB(l,function(r,p,u,q,s){var v=p+"-"+u;"available"===s.status&&-1!==m.indexOf(v)&&k.push(v)}),i._doCompaction(j,k,g)})}),e0.prototype.compact=eE("compact",function(i,h){"function"==typeof i&&(h=i,i={});var g=this;i=i||{},g._compactionQueue=g._compactionQueue||[],g._compactionQueue.push({opts:i,callback:h}),1===g._compactionQueue.length&&eb(g)}),e0.prototype._compact=function(k,i){function g(n){h.push(l.compactDocument(n.id,0))}function j(n){var o=n.last_seq;bm.all(h).then(function(){return jG(l,"_local/compaction",function(p){return !p.last_seq||p.last_seq<o?(p.last_seq=o,p):!1})}).then(function(){i(null,{ok:!0})})["catch"](i)}var l=this,m={return_docs:!1,last_seq:k.last_seq||0},h=[];l.changes(m).on("change",g).on("complete",j).on("error",i)},e0.prototype.get=eE("get",function(j,l,h){function n(){var o=[],p=g.length;return p?void g.forEach(function(q){k.get(j,{rev:q,revs:l.revs,attachments:l.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||h(null,o)})}):h(null,o)}if("function"==typeof l&&(h=l,l={}),"string"!=typeof j){return h(bS(au))}if(e5(j)&&"function"==typeof this._getLocal){return this._getLocal(j,h)}var g=[],k=this;if(!l.open_revs){return this._get(j,l,function(v,s){if(v){return h(v)}var o=s.doc,w=s.metadata,B=s.ctx;if(l.conflicts){var C=e8(w);C.length&&(o._conflicts=C)}if(aT(w,o._rev)&&(o._deleted=!0),l.revs||l.revs_info){var A=dh(w.rev_tree),r=f0(A,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(o._rev.split("-")[1])}),u=r.ids.map(function(D){return D.id}).indexOf(o._rev.split("-")[1])+1,x=r.ids.length-u;if(r.ids.splice(u,x),r.ids.reverse(),l.revs&&(o._revisions={start:r.pos+r.ids.length-1,ids:r.ids.map(function(D){return D.id})}),l.revs_info){var y=r.pos+r.ids.length;o._revs_info=r.ids.map(function(D){return y--,{rev:y+"-"+D.id,status:D.opts.status}})}}if(l.attachments&&o._attachments){var z=o._attachments,p=Object.keys(z).length;if(0===p){return h(null,o)}Object.keys(z).forEach(function(D){this._getAttachment(o._id,D,z[D],{rev:o._rev,binary:l.binary,ctx:B},function(F,G){var E=o._attachments[D];E.data=G,delete E.stub,delete E.length,--p||h(null,o)})},k)}else{if(o._attachments){for(var q in o._attachments){o._attachments.hasOwnProperty(q)&&(o._attachments[q].stub=!0)}}h(null,o)}})}if("all"===l.open_revs){this._getRevisionTree(j,function(o,p){return o?h(o):(g=dH(p).map(function(q){return q.rev}),void n())})}else{if(!Array.isArray(l.open_revs)){return h(bS(e6,"function_clause"))}g=l.open_revs;for(var i=0;i<g.length;i++){var m=g[i];if("string"!=typeof m||!/^\d+-/.test(m)){return h(bS(bE))}}n()}}),e0.prototype.getAttachment=eE("getAttachment",function(h,k,j,g){var i=this;j instanceof Function&&(g=j,j={}),this._get(h,j,function(m,l){return m?g(m):l.doc._attachments&&l.doc._attachments[k]?(j.ctx=l.ctx,j.binary=!0,i._getAttachment(h,k,l.doc._attachments[k],j,g),void 0):g(bS(aX))})}),e0.prototype.allDocs=eE("allDocs",function(i,h){if("function"==typeof i&&(h=i,i={}),i.skip="undefined"!=typeof i.skip?i.skip:0,i.start_key&&(i.startkey=i.start_key),i.end_key&&(i.endkey=i.end_key),"keys" in i){if(!Array.isArray(i.keys)){return h(new TypeError("options.keys must be an array"))}var g=["startkey","endkey","key"].filter(function(j){return j in i})[0];if(g){return void h(bS(dJ,"Query parameter `"+g+"` is not compatible with multi-get"))}if("http"!==this.type()){return bV(this,i,h)}}return this._allDocs(i,h)}),e0.prototype.changes=function(g,h){return"function"==typeof g&&(h=g,g={}),new eM(this,g,h)},e0.prototype.close=eE("close",function(g){return this._closed=!0,this._close(g)}),e0.prototype.info=eE("info",function(g){var h=this;this._info(function(j,i){return j?g(j):(i.db_name=i.db_name||h._db_name,i.auto_compaction=!(!h.auto_compaction||"http"===h.type()),i.adapter=h.type(),void g(null,i))})}),e0.prototype.id=eE("id",function(g){return this._id(g)}),e0.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},e0.prototype.bulkDocs=eE("bulkDocs",function(h,k,j){if("function"==typeof k&&(j=k,k={}),k=k||{},Array.isArray(h)&&(h={docs:h}),!h||!h.docs||!Array.isArray(h.docs)){return j(bS(aK))}for(var g=0;g<h.docs.length;++g){if("object"!=typeof h.docs[g]||Array.isArray(h.docs[g])){return j(bS(bw))}}var i;return h.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){i=i||e3(m)})}),i?j(bS(cs,i)):("new_edits" in k||("new_edits" in h?k.new_edits=h.new_edits:k.new_edits=!0),k.new_edits||"http"===this.type()||h.docs.sort(dT),jQ(h.docs),this._bulkDocs(h,k,function(m,l){return m?j(m):(k.new_edits||(l=l.filter(function(n){return n.error})),void j(null,l))}))}),e0.prototype.registerDependentDatabase=eE("registerDependentDatabase",function(j,h){function g(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[j]?!1:(k.dependentDbs[j]=!0,k)}var i=new this.constructor(j,this.__opts);jG(this,"_local/_pouch_dependentDbs",g).then(function(){h(null,{db:i})})["catch"](h)}),e0.prototype.destroy=eE("destroy",function(h,k){function j(){g._destroy(h,function(l,m){return l?k(l):(g._destroyed=!0,g.emit("destroyed"),void k(null,m||{ok:!0}))})}"function"==typeof h&&(k=h,h={});var g=this,i="use_prefix" in g?g.use_prefix:!0;return"http"===g.type()?j():void g.get("_local/_pouch_dependentDbs",function(o,m){if(o){return 404!==o.status?k(o):j()}var p=m.dependentDbs,n=g.constructor,l=Object.keys(p).map(function(r){var q=i?r.replace(new RegExp("^"+n.prefix),""):r;return new n(q,g.__opts).destroy()});bm.all(l).then(j,k)})}),c9.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},c9.prototype.fail=function(g){this.failed=g,this.execute()},c9.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},c9.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},dO(aa,e0),aa.debug=cJ,aa.adapters={},aa.preferredAdapters=[],aa.prefix="_pouch_";var bF=new b6.EventEmitter;bR(aa),aa.parseAdapter=function(j,l){var h,n,g=j.match(/([a-z\-]*):\/\/(.*)/);if(g){if(j=/http(s?)/.test(g[1])?g[1]+"://"+g[2]:g[2],h=g[1],!aa.adapters[h].valid()){throw"Invalid adapter"}return{name:j,adapter:g[1]}}var k="idb" in aa.adapters&&"websql" in aa.adapters&&dd()&&localStorage["_pouch__websqldb_"+aa.prefix+j];if(l.adapter){n=l.adapter}else{if("undefined"!=typeof l&&l.db){n="leveldb"}else{for(var i=0;i<aa.preferredAdapters.length;++i){if(n=aa.preferredAdapters[i],n in aa.adapters){if(k&&"idb"===n){dX("log",'PouchDB is downgrading "'+j+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}h=aa.adapters[n];var m=h&&"use_prefix" in h?h.use_prefix:!0;return{name:m?aa.prefix+j:j,adapter:n}},aa.adapter=function(i,h,g){h.valid()&&(aa.adapters[i]=h,g&&aa.preferredAdapters.push(i))},aa.plugin=function(g){return"function"==typeof g?g(aa):Object.keys(g).forEach(function(h){aa.prototype[h]=g[h]}),aa},aa.defaults=function(g){function h(k,i,j){return this instanceof h?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=dc.extend({},g,i),void aa.call(this,k,i,j)):new h(k,i,j)}return dO(h,aa),h.preferredAdapters=aa.preferredAdapters.slice(),Object.keys(aa).forEach(function(i){i in h||(h[i]=aa[i])}),h};var eZ="5.4.4";aa.version=eZ;var eQ,c2=bq(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),cu=bq(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),fG=function(g){return atob(g)},dV=function(g){return btoa(g)},bA=bJ.setImmediate||bJ.setTimeout,bG=32768,dG=5,cA="document-store",e7="by-sequence",dW="attach-store",ag="attach-seq-store",cB="meta-store",bT="local-store",aq="detect-blob-support",kf={running:!1,queue:[]},jT=new cY.Map,a9=new eC,cN=new cY.Map;fJ.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var j6=7,dQ=cH("document-store"),aW=cH("by-sequence"),am=cH("attach-store"),cW=cH("local-store"),c7=cH("metadata-store"),dL=cH("attach-seq-store"),j5=new cY.Map,bX=new eC,dB=1,el="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+aW+" (seq, deleted)",jL="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+aW+" (doc_id, rev)",cv="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+dQ+" (winningseq)",bg="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+dL+" (seq)",bL="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+dL+" (digest, seq)",jK=aW+".seq = "+dQ+".winningseq",f2=aW+".seq AS seq, "+aW+".deleted AS deleted, "+aW+".json AS data, "+aW+".rev AS rev, "+dQ+".json AS metadata";jJ.valid=eY,jJ.use_prefix=!0;var bN=fP(),bD=function(){},ej=25,aF=50,fF={},fA=1800,cT=cJ("pouchdb:http");kc.valid=function(){return !0},jZ.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},jZ.prototype.finish=function(){return this.promise};var jS=function(g,h){return h&&g.then(function(i){dC.nextTick(function(){h(null,i)})},function(i){dC.nextTick(function(){h(i)})}),g},ax=function(g){return cf(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&jS(i,j),i})},ke=function(g,h){return g.then(function(i){return h().then(function(){return i})},function(i){return h().then(function(){throw i})})},aN=function(g,h){return function(){var j=arguments,i=this;return g.add(function(){return h.apply(i,j)})}},d7=function(i){for(var l={},k=0,h=i.length;h>k;k++){l["$"+i[k]]=!0}var j=Object.keys(l),g=new Array(j.length);for(k=0,h=j.length;h>k;k++){g[k]=j[k].substring(1)}return g},bj={},dx=new jZ,bx=50,b7=dX.bind(null,"log"),b0={_sum:function(g,h){return j3(h)},_count:function(g,h){return h.length},_stats:function(i,h){function g(k){for(var n=0,m=0,j=k.length;j>m;m++){var l=k[m];n+=l*l}return n}return{sum:j3(h),min:Math.min.apply(null,h),max:Math.max.apply(null,h),count:h.length,sumsqr:g(h)}}},cg=ax(function(){var g=this;return"http"===g.type()?kl(g):"function"==typeof g._viewCleanup?j9(g):fL(g)}),ak=function(h,k,j){"function"==typeof k&&(j=k,k={}),k=k?kb(k):{},"function"==typeof h&&(h={map:h});var g=this,i=bm.resolve().then(function(){return fI(g,h,k)});return jS(i,j),i};dO(eF,Error),dO(ac,Error),dO(jH,Error);var d9={query:ak,viewCleanup:cg},az=1,dK="pouchdb",dp=5,b3=0;b9.prototype.writeCheckpoint=function(i,h){var g=this;return this.updateTarget(i,h).then(function(){return g.updateSource(i,h)})},b9.prototype.updateTarget=function(g,h){return ec(this.target,this.id,g,h,this.returnValue)},b9.prototype.updateSource=function(i,h){var g=this;return this.readOnlySource?bm.resolve(!0):ec(this.src,this.id,i,h,this.returnValue)["catch"](function(j){if(dm(j)){return g.readOnlySource=!0,!0}throw j})};var bp={undefined:function(g,h){return 0===bb.collate(g.last_seq,h.last_seq)?h.last_seq:0},1:function(g,h){return d0(h,g).last_seq}};b9.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?bm.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return b3}var j;return j=h.version?h.version.toString():"undefined",j in bp?bp[j](h,i):b3},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:b3}).then(function(){return b3},function(j){return dm(j)?(g.readOnlySource=!0,h.last_seq):b3})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return b3})};var bZ=0;dO(bz,b6.EventEmitter),bz.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},bz.prototype.ready=function(h,k){function j(){i.cancel()}function g(){h.removeListener("destroyed",j),k.removeListener("destroyed",j)}var i=this;i._readyCalled||(i._readyCalled=!0,h.once("destroyed",j),k.once("destroyed",j),i.once("complete",g))},dO(d5,b6.EventEmitter),d5.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},aa.plugin(b4).plugin(bU).plugin(cq).plugin(d9).plugin(by),f.exports=aa}).call(this,c(2),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,14:14,15:15,16:16,17:17,2:2,4:4,5:5,8:8,9:9}],4:[function(c,f,d){function g(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}f.exports=g},{}],5:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+f.humanize(this.diff),!n){return e}var i="color: "+this.color;e=[e[0],i,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,p=0;return e[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(o++,"%c"===q&&(p=o))}),e.splice(p,0,i),e}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(6),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{6:6}],6:[function(m,c,j){function g(){return j.colors[l++%j.colors.length]}function h(e){function i(){}function n(){var s=n,u=+new Date,t=u-(p||u);s.diff=t,s.prev=p,s.curr=u,p=u,null==s.useColors&&(s.useColors=j.useColors()),null==s.color&&s.useColors&&(s.color=g());var o=Array.prototype.slice.call(arguments);o[0]=j.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var x=0;o[0]=o[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}x++;var w=j.formatters[B];if("function"==typeof w){var C=o[x];D=w.call(s,C),o.splice(x,1),x--}return D}),"function"==typeof j.formatArgs&&(o=j.formatArgs.apply(s,o));var r=n.log||j.log||console.log.bind(console);r.apply(s,o)}i.enabled=!1,n.enabled=!0;var f=j.enabled(e)?n:i;return f.namespace=e,f}function k(n){j.save(n);for(var e=(n||"").split(/[\s,]+/),i=e.length,f=0;i>f;f++){e[f]&&(n=e[f].replace(/\*/g,".*?"),"-"===n[0]?j.skips.push(new RegExp("^"+n.substr(1)+"$")):j.names.push(new RegExp("^"+n+"$")))}}function q(){j.enable("")}function d(i){var e,f;for(e=0,f=j.skips.length;f>e;e++){if(j.skips[e].test(i)){return !1}}for(e=0,f=j.names.length;f>e;e++){if(j.names[e].test(i)){return !0}}return !1}function v(e){return e instanceof Error?e.stack||e.message:e}j=c.exports=h,j.coerce=v,j.disable=q,j.enable=k,j.enabled=d,j.humanize=m(11),j.names=[],j.skips=[],j.formatters={};var p,l=0},{11:11}],7:[function(c,f,d){(function(v){function m(){t=!0;for(var n,l,i=p.length;i;){for(l=p,p=[],n=-1;++n<i;){l[n]()}i=p.length}t=!1}function h(i){1!==p.push(i)||t||j()}var j,q=v.MutationObserver||v.WebKitMutationObserver;if(q){var w=0,g=new q(m),e=v.document.createTextNode("");g.observe(e,{characterData:!0}),j=function(){e.data=w=++w%2}}else{if(v.setImmediate||"undefined"==typeof v.MessageChannel){j="document" in v&&"onreadystatechange" in v.document.createElement("script")?function(){var i=v.document.createElement("script");i.onreadystatechange=function(){m(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},v.document.documentElement.appendChild(i)}:function(){setTimeout(m,0)}}else{var k=new v.MessageChannel;k.port1.onmessage=m,j=function(){k.port2.postMessage(0)}}}var t,p=[];f.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(c,f,d){"function"==typeof Object.create?f.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:f.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],9:[function(c,f,d){(function(){var g=Array.prototype.slice,e=Array.prototype.forEach,h=function(i){if("object"!=typeof i){throw i+" is not an object"}var j=g.call(arguments,1);return e.call(j,function(l){if(l){for(var k in l){"object"==typeof l[k]&&i[k]?h.call(i,i[k],l[k]):i[k]=l[k]}}}),i};this.extend=h}).call(this)},{}],10:[function(D,k,q){function E(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=H,this.queue=[],this.outcome=void 0,e!==E&&g(this,e)}function z(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function I(f,e,h){w(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function C(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(i,m){function f(o){e||(e=!0,d.reject(i,o))}function h(o){e||(e=!0,d.resolve(i,o))}function l(){m(h,f)}var e=!1,n=G(l);"error"===n.status&&f(n.value)}function G(f,i){var h={};try{h.value=f(i),h.status="success"}catch(e){h.status="error",h.value=e}return h}function B(e){return e instanceof this?e:d.resolve(new this(E),e)}function x(f){var e=new this(E);return d.reject(e,f)}function F(n){function i(r,s){function t(u){e[s]=u,++o!==l||f||(f=!0,d.resolve(p,e))}m.resolve(r).then(t,function(u){f||(f=!0,d.reject(p,u))})}var m=this;if("[object Array]"!==Object.prototype.toString.call(n)){return this.reject(new TypeError("must be an array"))}var l=n.length,f=!1;if(!l){return this.resolve([])}for(var e=new Array(l),o=0,h=-1,p=new this(E);++h<l;){i(n[h],h)}return p}function A(i){function m(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(h,p))},function(p){e||(e=!0,d.reject(h,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(i)){return this.reject(new TypeError("must be an array"))}var l=i.length,e=!1;if(!l){return this.resolve([])}for(var n=-1,h=new this(E);++n<l;){m(i[n])}return h}var w=D(7),d={},c=["REJECTED"],J=["FULFILLED"],H=["PENDING"];k.exports=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(e,i){if("function"!=typeof e&&this.state===J||"function"!=typeof i&&this.state===c){return this}var h=new this.constructor(E);if(this.state!==H){var f=this.state===J?e:i;I(h,f,this.outcome)}else{this.queue.push(new z(h,e,i))}return h},z.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},z.prototype.otherCallFulfilled=function(e){I(this.promise,this.onFulfilled,e)},z.prototype.callRejected=function(e){d.reject(this.promise,e)},z.prototype.otherCallRejected=function(e){I(this.promise,this.onRejected,e)},d.resolve=function(h,f){var l=G(C,f);if("error"===l.status){return d.reject(h,l.value)}var m=l.value;if(m){g(h,m)}else{h.state=J,h.outcome=f;for(var i=-1,e=h.queue.length;++i<e;){h.queue[i].callFulfilled(f)}}return h},d.reject=function(f,i){f.state=c,f.outcome=i;for(var h=-1,e=f.queue.length;++h<e;){f.queue[h].callRejected(i)}return f},j.resolve=B,j.reject=x,j.all=F,j.race=A},{7:7}],11:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],12:[function(j,d,m){function C(f){if(null!==f){switch(typeof f){case"boolean":return f?1:0;case"number":return q(f);case"string":return f.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var i=Array.isArray(f),n=i?f:Object.keys(f),e=-1,o=n.length,l="";if(i){for(;++e<o;){l+=m.toIndexableString(n[e])}}else{for(;++e<o;){var h=n[e];l+=m.toIndexableString(h)+m.toIndexableString(f[h])}}return l}}return""}function c(h,o){var e,r=o,s="1"===h[o];if(s){e=0,o++}else{var f="0"===h[o];o++;var l="",p=h.substring(o,o+z),n=parseInt(p,10)+x;for(f&&(n=-n),o+=z;;){var i=h[o];if("\x00"===i){break}l+=i,o++}l=l.split("."),e=1===l.length?parseInt(l,10):parseFloat(l[0]+"."+l[1]),f&&(e-=10),0!==n&&(e=parseFloat(e+"e"+n))}return{num:e,length:o-r}}function v(n,e){var i=n.pop();if(e.length){var l=e[e.length-1];i===l.element&&(e.pop(),l=e[e.length-1]);var o=l.element,f=l.index;if(Array.isArray(o)){o.push(i)}else{if(f===n.length-2){var h=n.pop();o[h]=i}else{n.push(i)}}}}function y(l,h){for(var i=Math.min(l.length,h.length),e=0;i>e;e++){var f=m.collate(l[e],h[e]);if(0!==f){return f}}return l.length===h.length?0:l.length>h.length?1:-1}function B(f,e){return f===e?0:f>e?1:-1}function w(f,i){for(var n=Object.keys(f),e=Object.keys(i),o=Math.min(n.length,e.length),l=0;o>l;l++){var h=m.collate(n[l],e[l]);if(0!==h){return h}if(h=m.collate(f[n[l]],i[e[l]]),0!==h){return h}}return n.length===e.length?0:n.length>e.length?1:-1}function k(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function q(e){if(0===e){return"1"}var i=e.toExponential().split(/e\+?/),p=parseInt(i[1],10),n=0>e,o=n?"0":"2",r=(n?-p:p)-x,f=g.padLeft(r.toString(),"0",z);o+=A+f;var l=Math.abs(parseFloat(i[0]));n&&(l=10-l);var h=l.toFixed(20);return h=h.replace(/\.?0+$/,""),o+=A+h}var x=-324,z=3,A="",g=j(13);m.collate=function(h,e){if(h===e){return 0}h=m.normalizeKey(h),e=m.normalizeKey(e);var f=k(h),i=k(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return B(h,e)}return Array.isArray(h)?y(h,e):w(h,e)},m.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var f=0;i>f;f++){l[f]=m.normalizeKey(h[f])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var e in h){if(h.hasOwnProperty(e)){var n=h[e];"undefined"!=typeof n&&(l[e]=m.normalizeKey(n))}}}}}return l},m.toIndexableString=function(f){var e="\x00";return f=m.normalizeKey(f),k(f)+A+C(f)+e},m.parseIndexableString=function(h){for(var o=[],s=[],r=0;;){var l=h[r++];if("\x00"!==l){switch(l){case"1":o.push(null);break;case"2":o.push("1"===h[r]),r++;break;case"3":var p=c(h,r);o.push(p.num),r+=p.length;break;case"4":for(var n="";;){var i=h[r];if("\x00"===i){break}n+=i,r++}n=n.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),o.push(n);break;case"5":var f={element:[],index:o.length};o.push(f.element),s.push(f);break;case"6":var e={element:{},index:o.length};o.push(e.element),s.push(e);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+l)}}else{if(1===o.length){return o.pop()}v(o,s)}}}},{13:13}],13:[function(c,f,d){function g(i,e,k){for(var h="",j=k-i.length;h.length<j;){h+=e}return h}d.padLeft=function(h,e,j){var i=g(h,e,j);return i+h},d.padRight=function(h,e,j){var i=g(h,e,j);return h+i},d.stringLexCompare=function(p,j){var l,h=p.length,m=j.length;for(l=0;h>l;l++){if(l===m){return 1}var k=p.charAt(l),e=j.charAt(l);if(k!==e){return e>k?-1:1}}return m>h?-1:0},d.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],14:[function(c,g,f){function h(){this.store={}}function d(i){if(this.store=new h,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}f.Map=h,f.Set=d,h.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},h.prototype.unmangle=function(e){return e.substring(1)},h.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},h.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},h.prototype.has=function(i){var e=this.mangle(i);return e in this.store},h.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},h.prototype.forEach=function(k){for(var e=Object.keys(this.store),l=0,j=e.length;j>l;l++){var i=e[l],m=this.store[i];i=this.unmangle(i),k(m,i)}},d.prototype.add=function(e){return this.store.set(e,!0)},d.prototype.has=function(e){return this.store.has(e)},d.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],15:[function(c,f,d){(function(){var e={}.hasOwnProperty,g=[].slice;f.exports=function(j,i){var m,l,k,h;l=[],h=[];for(m in i){e.call(i,m)&&(k=i[m],"this"!==m&&(l.push(m),h.push(k)))}return Function.apply(null,g.call(l).concat([j])).apply(i["this"],h)}}).call(this)},{}],16:[function(e,d,c){!function(g){if("object"==typeof c){d.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(H){function D(i,h,n,m,l,g){return h=K(K(h,i),K(m,g)),K(h<<l|h>>>32-l,n)}function x(m,n,l,h,i,o,g){return D(n&l|~n&h,m,n,i,o,g)}function I(m,n,l,h,i,o,g){return D(n&h|l&~h,m,n,i,o,g)}function w(m,n,l,h,i,o,g){return D(n^l^h,m,n,i,o,g)}function B(m,n,l,h,i,o,g){return D(l^(n|~h),m,n,i,o,g)}function M(i,h){var n=i[0],m=i[1],g=i[2],l=i[3];n=x(n,m,g,l,h[0],7,-680876936),l=x(l,n,m,g,h[1],12,-389564586),g=x(g,l,n,m,h[2],17,606105819),m=x(m,g,l,n,h[3],22,-1044525330),n=x(n,m,g,l,h[4],7,-176418897),l=x(l,n,m,g,h[5],12,1200080426),g=x(g,l,n,m,h[6],17,-1473231341),m=x(m,g,l,n,h[7],22,-45705983),n=x(n,m,g,l,h[8],7,1770035416),l=x(l,n,m,g,h[9],12,-1958414417),g=x(g,l,n,m,h[10],17,-42063),m=x(m,g,l,n,h[11],22,-1990404162),n=x(n,m,g,l,h[12],7,1804603682),l=x(l,n,m,g,h[13],12,-40341101),g=x(g,l,n,m,h[14],17,-1502002290),m=x(m,g,l,n,h[15],22,1236535329),n=I(n,m,g,l,h[1],5,-165796510),l=I(l,n,m,g,h[6],9,-1069501632),g=I(g,l,n,m,h[11],14,643717713),m=I(m,g,l,n,h[0],20,-373897302),n=I(n,m,g,l,h[5],5,-701558691),l=I(l,n,m,g,h[10],9,38016083),g=I(g,l,n,m,h[15],14,-660478335),m=I(m,g,l,n,h[4],20,-405537848),n=I(n,m,g,l,h[9],5,568446438),l=I(l,n,m,g,h[14],9,-1019803690),g=I(g,l,n,m,h[3],14,-187363961),m=I(m,g,l,n,h[8],20,1163531501),n=I(n,m,g,l,h[13],5,-1444681467),l=I(l,n,m,g,h[2],9,-51403784),g=I(g,l,n,m,h[7],14,1735328473),m=I(m,g,l,n,h[12],20,-1926607734),n=w(n,m,g,l,h[5],4,-378558),l=w(l,n,m,g,h[8],11,-2022574463),g=w(g,l,n,m,h[11],16,1839030562),m=w(m,g,l,n,h[14],23,-35309556),n=w(n,m,g,l,h[1],4,-1530992060),l=w(l,n,m,g,h[4],11,1272893353),g=w(g,l,n,m,h[7],16,-155497632),m=w(m,g,l,n,h[10],23,-1094730640),n=w(n,m,g,l,h[13],4,681279174),l=w(l,n,m,g,h[0],11,-358537222),g=w(g,l,n,m,h[3],16,-722521979),m=w(m,g,l,n,h[6],23,76029189),n=w(n,m,g,l,h[9],4,-640364487),l=w(l,n,m,g,h[12],11,-421815835),g=w(g,l,n,m,h[15],16,530742520),m=w(m,g,l,n,h[2],23,-995338651),n=B(n,m,g,l,h[0],6,-198630844),l=B(l,n,m,g,h[7],10,1126891415),g=B(g,l,n,m,h[14],15,-1416354905),m=B(m,g,l,n,h[5],21,-57434055),n=B(n,m,g,l,h[12],6,1700485571),l=B(l,n,m,g,h[3],10,-1894986606),g=B(g,l,n,m,h[10],15,-1051523),m=B(m,g,l,n,h[1],21,-2054922799),n=B(n,m,g,l,h[8],6,1873313359),l=B(l,n,m,g,h[15],10,-30611744),g=B(g,l,n,m,h[6],15,-1560198380),m=B(m,g,l,n,h[13],21,1309151649),n=B(n,m,g,l,h[4],6,-145523070),l=B(l,n,m,g,h[11],10,-1120210379),g=B(g,l,n,m,h[2],15,718787259),m=B(m,g,l,n,h[9],21,-343485551),i[0]=K(n,i[0]),i[1]=K(m,i[1]),i[2]=K(g,i[2]),i[3]=K(l,i[3])}function F(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g.charCodeAt(i)+(g.charCodeAt(i+1)<<8)+(g.charCodeAt(i+2)<<16)+(g.charCodeAt(i+3)<<24)}return h}function q(g){var i,h=[];for(i=0;64>i;i+=4){h[i>>2]=g[i]+(g[i+1]<<8)+(g[i+2]<<16)+(g[i+3]<<24)}return h}function E(g){var p,h,o,r,m,l,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(p=64;i>=p;p+=64){M(n,F(g.substring(p-64,p)))}for(g=g.substring(p-64),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=0;h>p;p+=1){o[p>>2]|=g.charCodeAt(p)<<(p%4<<3)}if(o[p>>2]|=128<<(p%4<<3),p>55){for(M(n,o),p=0;16>p;p+=1){o[p]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),l=parseInt(r[1],16)||0,o[14]=m,o[15]=l,M(n,o),n}function G(g){var l,h,o,r,m,p,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(l=64;i>=l;l+=64){M(n,q(g.subarray(l-64,l)))}for(g=i>l-64?g.subarray(l-64):new Uint8Array(0),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;h>l;l+=1){o[l>>2]|=g[l]<<(l%4<<3)}if(o[l>>2]|=128<<(l%4<<3),l>55){for(M(n,o),l=0;16>l;l+=1){o[l]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),p=parseInt(r[1],16)||0,o[14]=m,o[15]=p,M(n,o),n}function A(g){var i,h="";for(i=0;4>i;i+=1){h+=L[g>>8*i+4&15]+L[g>>8*i&15]}return h}function J(h){var g;for(g=0;g<h.length;g+=1){h[g]=A(h[g])}return h.join("")}function C(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(i,h){var n,m=i.length,l=new ArrayBuffer(m),g=new Uint8Array(l);for(n=0;m>n;n+=1){g[n]=i.charCodeAt(n)}return h?g:l}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(h,g,i){var l=new Uint8Array(h.byteLength+g.byteLength);return l.set(new Uint8Array(h)),l.set(new Uint8Array(g),h.byteLength),i?l:l.buffer}function N(h){var g,i=[],l=h.length;for(g=0;l-1>g;g+=2){i.push(parseInt(h.substr(g,2),16))}return String.fromCharCode.apply(String,i)}function z(){this.reset()}var K=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==J(E("hello"))&&(K=function(h,g){var i=(65535&h)+(65535&g),l=(h>>16)+(g>>16)+(i>>16);return l<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(h,i){return h=0|h||0,0>h?Math.max(h+i,0):Math.min(h,i)}ArrayBuffer.prototype.slice=function(m,s){var h,l,o,r,n=this.byteLength,p=g(m,n),i=n;return s!==H&&(i=g(s,n)),p>i?new ArrayBuffer(0):(h=i-p,l=new ArrayBuffer(h),o=new Uint8Array(l),r=new Uint8Array(this,p,h),o.set(r),l)}}(),z.prototype.append=function(g){return this.appendBinary(C(g)),this},z.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var i,h=this._buff.length;for(i=64;h>=i;i+=64){M(this._hash,F(this._buff.substring(i-64,i)))}return this._buff=this._buff.substring(i-64),this},z.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m.charCodeAt(h)<<(h%4<<3)}return this._finish(g,l),n=J(this._hash),i&&(n=N(n)),this.reset(),n},z.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},z.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},z.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},z.prototype._finish=function(i,h){var n,m,l,g=h;if(i[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,i),g=0;16>g;g+=1){i[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(n[2],16),l=parseInt(n[1],16)||0,i[14]=m,i[15]=l,M(this._hash,i)},z.hash=function(h,g){return z.hashBinary(C(h),g)},z.hashBinary=function(h,g){var i=E(h),l=J(i);return g?N(l):l},z.ArrayBuffer=function(){this.reset()},z.ArrayBuffer.prototype.append=function(h){var g,i=f(this._buff.buffer,h,!0),l=i.length;for(this._length+=h.byteLength,g=64;l>=g;g+=64){M(this._hash,q(i.subarray(g-64,g)))}return this._buff=l>g-64?new Uint8Array(i.buffer.slice(g-64)):new Uint8Array(0),this},z.ArrayBuffer.prototype.end=function(i){var h,n,m=this._buff,l=m.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;l>h;h+=1){g[h>>2]|=m[h]<<(h%4<<3)}return this._finish(g,l),n=J(this._hash),i&&(n=N(n)),this.reset(),n},z.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},z.ArrayBuffer.prototype.getState=function(){var g=z.prototype.getState.call(this);return g.buff=j(g.buff),g},z.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),z.prototype.setState.call(this,g)},z.ArrayBuffer.prototype.destroy=z.prototype.destroy,z.ArrayBuffer.prototype._finish=z.prototype._finish,z.ArrayBuffer.hash=function(h,g){var i=G(new Uint8Array(h)),l=J(i);return g?N(l):l},z})},{}],17:[function(c,f,d){function g(p,j,l){var h=l[l.length-1];p===h.element&&(l.pop(),h=l[l.length-1]);var m=h.element,k=h.index;if(Array.isArray(m)){m.push(p)}else{if(k===j.length-2){var e=j.pop();m[e]=p}else{j.push(p)}}}d.stringify=function(A){var w=[];w.push({obj:A});for(var z,B,v,m,q,p,x,j,h,k,y,e="";z=w.pop();){if(B=z.obj,v=z.prefix||"",m=z.val||"",e+=v,m){e+=m}else{if("object"!=typeof B){e+="undefined"==typeof B?null:JSON.stringify(B)}else{if(null===B){e+="null"}else{if(Array.isArray(B)){for(w.push({val:"]"}),q=B.length-1;q>=0;q--){p=0===q?"":",",w.push({obj:B[q],prefix:p})}w.push({val:"["})}else{x=[];for(j in B){B.hasOwnProperty(j)&&x.push(j)}for(w.push({val:"}"}),q=x.length-1;q>=0;q--){h=x[q],k=B[h],y=q>0?",":"",y+=JSON.stringify(h)+":",w.push({obj:k,prefix:y})}w.push({val:"{"})}}}}}return e},d.parse=function(w){for(var k,v,q,e,y,p,m,x,z,r=[],j=[],h=0;;){if(k=w[h++],"}"!==k&&"]"!==k&&"undefined"!=typeof k){switch(k){case" ":case"	":case"\n":case":":case",":break;case"n":h+=3,g(null,r,j);break;case"t":h+=3,g(!0,r,j);break;case"f":h+=4,g(!1,r,j);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(v="",h--;;){if(q=w[h++],!/[\d\.\-e\+]/.test(q)){h--;break}v+=q}g(parseFloat(v),r,j);break;case'"':for(e="",y=void 0,p=0;;){if(m=w[h++],'"'===m&&("\\"!==y||p%2!==1)){break}e+=m,y=m,"\\"===y?p++:p=0}g(JSON.parse('"'+e+'"'),r,j);break;case"[":x={element:[],index:r.length},r.push(x.element),j.push(x);break;case"{":z={element:{},index:r.length},r.push(z.element),j.push(z);break;default:throw new Error("unexpectedly reached end of input: "+k)}}else{if(1===r.length){return r.pop()}g(r.pop(),r,j)}}}},{}]},{},[3])(3)});