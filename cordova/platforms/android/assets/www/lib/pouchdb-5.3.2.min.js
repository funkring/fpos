!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(h,c,f){function g(i,l){if(!c[i]){if(!h[i]){var k="function"==typeof require&&require;if(!l&&k){return k(i,!0)}if(d){return d(i,!0)}var e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}var m=c[i]={exports:{}};h[i][0].call(m.exports,function(o){var n=h[i][1][o];return g(n?n:o)},m,m.exports,a,h,c,f)}return c[i].exports}for(var d="function"==typeof require&&require,j=0;j<f.length;j++){g(f[j])}return g}({1:[function(c,f,d){function g(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}f.exports=g},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+f.humanize(this.diff),!n){return e}var o="color: "+this.color;e=[e[0],o,"color: inherit"].concat(Array.prototype.slice.call(e,1));var p=0,i=0;return e[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(p++,"%c"===q&&(i=p))}),e.splice(i,0,o),e}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{3:3}],3:[function(v,h,m){function k(){return m.colors[q++%m.colors.length]}function l(e){function i(){}function n(){var o=n,s=+new Date,r=s-(c||s);o.diff=r,o.prev=c,o.curr=s,c=s,null==o.useColors&&(o.useColors=m.useColors()),null==o.color&&o.useColors&&(o.color=k());var u=Array.prototype.slice.call(arguments);u[0]=m.coerce(u[0]),"string"!=typeof u[0]&&(u=["%o"].concat(u));var t=0;u[0]=u[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}t++;var w=m.formatters[B];if("function"==typeof w){var C=u[t];D=w.call(o,C),u.splice(t,1),t--}return D}),"function"==typeof m.formatArgs&&(u=m.formatArgs.apply(o,u));var x=n.log||m.log||console.log.bind(console);x.apply(o,u)}i.enabled=!1,n.enabled=!0;var f=m.enabled(e)?n:i;return f.namespace=e,f}function p(n){m.save(n);for(var e=(n||"").split(/[\s,]+/),i=e.length,f=0;i>f;f++){e[f]&&(n=e[f].replace(/\*/g,".*?"),"-"===n[0]?m.skips.push(new RegExp("^"+n.substr(1)+"$")):m.names.push(new RegExp("^"+n+"$")))}}function d(){m.enable("")}function j(i){var e,f;for(e=0,f=m.skips.length;f>e;e++){if(m.skips[e].test(i)){return !1}}for(e=0,f=m.names.length;f>e;e++){if(m.names[e].test(i)){return !0}}return !1}function g(e){return e instanceof Error?e.stack||e.message:e}m=h.exports=l,m.coerce=g,m.disable=d,m.enable=p,m.enabled=j,m.humanize=v(9),m.names=[],m.skips=[],m.formatters={};var c,q=0},{9:9}],4:[function(j,l,f){function k(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function h(e){return"number"==typeof e}function c(e){return"object"==typeof e&&null!==e}function g(e){return void 0===e}l.exports=k,k.EventEmitter=k,k.prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.prototype.setMaxListeners=function(e){if(!h(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},k.prototype.emit=function(i){var p,n,o,q,e,m;if(this._events||(this._events={}),"error"===i&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if(p=arguments[1],p instanceof Error){throw p}throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[i],g(n)){return !1}if(d(n)){switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:q=Array.prototype.slice.call(arguments,1),n.apply(this,q)}}else{if(c(n)){for(q=Array.prototype.slice.call(arguments,1),m=n.slice(),o=m.length,e=0;o>e;e++){m[e].apply(this,q)}}}return !0},k.prototype.addListener=function(m,i){var e;if(!d(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,d(i.listener)?i.listener:i),this._events[m]?c(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,c(this._events[m])&&!this._events[m].warned&&(e=g(this._maxListeners)?k.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},k.prototype.on=k.prototype.addListener,k.prototype.once=function(e,m){function i(){this.removeListener(e,i),n||(n=!0,m.apply(this,arguments))}if(!d(m)){throw TypeError("listener must be a function")}var n=!1;return i.listener=m,this.on(e,i),this},k.prototype.removeListener=function(m,p){var o,n,e,i;if(!d(p)){throw TypeError("listener must be a function")}if(!this._events||!this._events[m]){return this}if(o=this._events[m],e=o.length,n=-1,o===p||d(o.listener)&&o.listener===p){delete this._events[m],this._events.removeListener&&this.emit("removeListener",m,p)}else{if(c(o)){for(i=e;i-->0;){if(o[i]===p||o[i].listener&&o[i].listener===p){n=i;break}}if(0>n){return this}1===o.length?(o.length=0,delete this._events[m]):o.splice(n,1),this._events.removeListener&&this.emit("removeListener",m,p)}}return this},k.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],d(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},k.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?d(this._events[i])?[this._events[i]]:this._events[i].slice():[]},k.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(d(e)){return 1}if(e){return e.length}}return 0},k.listenerCount=function(i,e){return i.listenerCount(e)}},{}],5:[function(d,c,f){(function(g){function t(){e=!0;for(var l,i,n=v.length;n;){for(i=v,v=[],l=-1;++l<n;){i[l]()}n=v.length}e=!1}function m(i){1!==v.push(i)||e||p()}var p,w=g.MutationObserver||g.WebKitMutationObserver;if(w){var h=0,k=new w(t),j=g.document.createTextNode("");k.observe(j,{characterData:!0}),p=function(){j.data=h=++h%2}}else{if(g.setImmediate||"undefined"==typeof g.MessageChannel){p="document" in g&&"onreadystatechange" in g.document.createElement("script")?function(){var i=g.document.createElement("script");i.onreadystatechange=function(){t(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},g.document.documentElement.appendChild(i)}:function(){setTimeout(t,0)}}else{var q=new g.MessageChannel;q.port1.onmessage=t,p=function(){q.port2.postMessage(0)}}}var e,v=[];c.exports=m}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(d,c,f){"function"==typeof Object.create?c.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:c.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],7:[function(d,c,f){(function(e){e("object"==typeof f?f:this)}).call(this,function(h){var e=Array.prototype.slice,i=Array.prototype.forEach,g=function(j){if("object"!=typeof j){throw j+" is not an object"}var k=e.call(arguments,1);return i.call(k,function(l){if(l){for(var m in l){"object"==typeof l[m]&&j[m]?g.call(j,j[m],l[m]):j[m]=l[m]}}}),j};h.extend=g})},{}],8:[function(D,k,q){function E(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=C,this.queue=[],this.outcome=void 0,e!==E&&g(this,e)}function I(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function F(f,e,h){w(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function J(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(i,m){function f(o){e||(e=!0,d.reject(i,o))}function h(o){e||(e=!0,d.resolve(i,o))}function l(){m(h,f)}var e=!1,n=G(l);"error"===n.status&&f(n.value)}function G(f,i){var h={};try{h.value=f(i),h.status="success"}catch(e){h.status="error",h.value=e}return h}function B(e){return e instanceof this?e:d.resolve(new this(E),e)}function x(f){var e=new this(E);return d.reject(e,f)}function z(m){function e(r,s){function t(u){o[s]=u,++f!==h||l||(l=!0,d.resolve(n,o))}i.resolve(r).then(t,function(u){l||(l=!0,d.reject(n,u))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(m)){return this.reject(new TypeError("must be an array"))}var h=m.length,l=!1;if(!h){return this.resolve([])}for(var o=new Array(h),f=0,p=-1,n=new this(E);++p<h;){e(m[p],p)}return n}function A(i){function m(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(h,p))},function(p){e||(e=!0,d.reject(h,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(i)){return this.reject(new TypeError("must be an array"))}var l=i.length,e=!1;if(!l){return this.resolve([])}for(var n=-1,h=new this(E);++n<l;){m(i[n])}return h}var w=D(5),d={},c=["REJECTED"],H=["FULFILLED"],C=["PENDING"];k.exports=q=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(e,i){if("function"!=typeof e&&this.state===H||"function"!=typeof i&&this.state===c){return this}var h=new this.constructor(E);if(this.state!==C){var f=this.state===H?e:i;F(h,f,this.outcome)}else{this.queue.push(new I(h,e,i))}return h},I.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},I.prototype.otherCallFulfilled=function(e){F(this.promise,this.onFulfilled,e)},I.prototype.callRejected=function(e){d.reject(this.promise,e)},I.prototype.otherCallRejected=function(e){F(this.promise,this.onRejected,e)},d.resolve=function(h,f){var l=G(J,f);if("error"===l.status){return d.reject(h,l.value)}var m=l.value;if(m){g(h,m)}else{h.state=H,h.outcome=f;for(var i=-1,e=h.queue.length;++i<e;){h.queue[i].callFulfilled(f)}}return h},d.reject=function(f,i){f.state=c,f.outcome=i;for(var h=-1,e=f.queue.length;++h<e;){f.queue[h].callRejected(i)}return f},q.resolve=B,q.reject=x,q.all=z,q.race=A},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],10:[function(j,d,y){function C(o){if(null!==o){switch(typeof o){case"boolean":return o?1:0;case"number":return q(o);case"string":return o.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(o),e=n?o:Object.keys(o),i=-1,l=e.length,f="";if(n){for(;++i<l;){f+=y.toIndexableString(e[i])}}else{for(;++i<l;){var h=e[i];f+=y.toIndexableString(h)+y.toIndexableString(o[h])}}return f}}return""}function v(h,o){var e,r=o,s="1"===h[o];if(s){e=0,o++}else{var f="0"===h[o];o++;var l="",p=h.substring(o,o+z),n=parseInt(p,10)+x;for(f&&(n=-n),o+=z;;){var i=h[o];if("\x00"===i){break}l+=i,o++}l=l.split("."),e=1===l.length?parseInt(l,10):parseFloat(l[0]+"."+l[1]),f&&(e-=10),0!==n&&(e=parseFloat(e+"e"+n))}return{num:e,length:o-r}}function m(e,i){var n=e.pop();if(i.length){var f=i[i.length-1];n===f.element&&(i.pop(),f=i[i.length-1]);var l=f.element,o=f.index;if(Array.isArray(l)){l.push(n)}else{if(o===e.length-2){var h=e.pop();l[h]=n}else{e.push(n)}}}}function k(l,h){for(var i=Math.min(l.length,h.length),e=0;i>e;e++){var f=y.collate(l[e],h[e]);if(0!==f){return f}}return l.length===h.length?0:l.length>h.length?1:-1}function B(f,e){return f===e?0:f>e?1:-1}function w(o,n){for(var e=Object.keys(o),i=Object.keys(n),l=Math.min(e.length,i.length),f=0;l>f;f++){var h=y.collate(e[f],i[f]);if(0!==h){return h}if(h=y.collate(o[e[f]],n[i[f]]),0!==h){return h}}return e.length===i.length?0:e.length>i.length?1:-1}function c(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function q(p){if(0===p){return"1"}var f=p.toExponential().split(/e\+?/),n=parseInt(f[1],10),i=0>p,l=i?"0":"2",o=(i?-n:n)-x,r=g.padLeft(o.toString(),"0",z);l+=A+r;var h=Math.abs(parseFloat(f[0]));i&&(h=10-h);var e=h.toFixed(20);return e=e.replace(/\.?0+$/,""),l+=A+e}var x=-324,z=3,A="",g=j(11);y.collate=function(h,e){if(h===e){return 0}h=y.normalizeKey(h),e=y.normalizeKey(e);var f=c(h),i=c(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return B(h,e)}return Array.isArray(h)?k(h,e):w(h,e)},y.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var n=0;i>n;n++){l[n]=y.normalizeKey(h[n])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var f in h){if(h.hasOwnProperty(f)){var e=h[f];"undefined"!=typeof e&&(l[f]=y.normalizeKey(e))}}}}}return l},y.toIndexableString=function(f){var e="\x00";return f=y.normalizeKey(f),c(f)+A+C(f)+e},y.parseIndexableString=function(h){for(var o=[],s=[],r=0;;){var l=h[r++];if("\x00"!==l){switch(l){case"1":o.push(null);break;case"2":o.push("1"===h[r]),r++;break;case"3":var p=v(h,r);o.push(p.num),r+=p.length;break;case"4":for(var n="";;){var i=h[r];if("\x00"===i){break}n+=i,r++}n=n.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),o.push(n);break;case"5":var f={element:[],index:o.length};o.push(f.element),s.push(f);break;case"6":var e={element:{},index:o.length};o.push(e.element),s.push(e);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+l)}}else{if(1===o.length){return o.pop()}m(o,s)}}}},{11:11}],11:[function(c,f,d){function g(i,e,k){for(var h="",j=k-i.length;h.length<j;){h+=e}return h}d.padLeft=function(h,e,j){var i=g(h,e,j);return i+h},d.padRight=function(h,e,j){var i=g(h,e,j);return h+i},d.stringLexCompare=function(p,j){var m,l=p.length,h=j.length;for(m=0;l>m;m++){if(m===h){return 1}var k=p.charAt(m),e=j.charAt(m);if(k!==e){return e>k?-1:1}}return h>l?-1:0},d.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],12:[function(c,g,f){function h(){this.store={}}function d(i){if(this.store=new h,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}f.Map=h,f.Set=d,h.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},h.prototype.unmangle=function(e){return e.substring(1)},h.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},h.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},h.prototype.has=function(i){var e=this.mangle(i);return e in this.store},h.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},h.prototype.forEach=function(k){for(var e=Object.keys(this.store),l=0,j=e.length;j>l;l++){var i=e[l],m=this.store[i];i=this.unmangle(i),k(m,i)}},d.prototype.add=function(e){return this.store.set(e,!0)},d.prototype.has=function(e){return this.store.has(e)},d.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],13:[function(p,x,h){function d(){m=!1,c.length?q=c.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var e=q.length;e;){for(c=q,q=[];++j<e;){c&&c[j].run()}j=-1,e=q.length}c=null,m=!1,clearTimeout(f)}}function k(f,e){this.fun=f,this.array=e}function v(){}var c,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}q.push(new k(f,e)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(e){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(e){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(d,c,f){(function(){var e={}.hasOwnProperty,g=[].slice;c.exports=function(j,i){var m,l,k,h;l=[],h=[];for(m in i){e.call(i,m)&&(k=i[m],"this"!==m&&(l.push(m),h.push(k)))}return Function.apply(null,g.call(l).concat([j])).apply(i["this"],h)}}).call(this)},{}],15:[function(c,e,d){!function(g){if("object"==typeof d){e.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(C){function D(l,h,n,i,m,g){return h=K(K(h,l),K(i,g)),K(h<<m|h>>>32-m,n)}function x(m,i,l,n,h,o,g){return D(i&l|~i&n,m,i,h,o,g)}function F(m,i,l,n,h,o,g){return D(i&n|l&~n,m,i,h,o,g)}function w(m,i,l,n,h,o,g){return D(i^l^n,m,i,h,o,g)}function B(m,i,l,n,h,o,g){return D(l^(i|~n),m,i,h,o,g)}function M(l,h){var n=l[0],i=l[1],g=l[2],m=l[3];n=x(n,i,g,m,h[0],7,-680876936),m=x(m,n,i,g,h[1],12,-389564586),g=x(g,m,n,i,h[2],17,606105819),i=x(i,g,m,n,h[3],22,-1044525330),n=x(n,i,g,m,h[4],7,-176418897),m=x(m,n,i,g,h[5],12,1200080426),g=x(g,m,n,i,h[6],17,-1473231341),i=x(i,g,m,n,h[7],22,-45705983),n=x(n,i,g,m,h[8],7,1770035416),m=x(m,n,i,g,h[9],12,-1958414417),g=x(g,m,n,i,h[10],17,-42063),i=x(i,g,m,n,h[11],22,-1990404162),n=x(n,i,g,m,h[12],7,1804603682),m=x(m,n,i,g,h[13],12,-40341101),g=x(g,m,n,i,h[14],17,-1502002290),i=x(i,g,m,n,h[15],22,1236535329),n=F(n,i,g,m,h[1],5,-165796510),m=F(m,n,i,g,h[6],9,-1069501632),g=F(g,m,n,i,h[11],14,643717713),i=F(i,g,m,n,h[0],20,-373897302),n=F(n,i,g,m,h[5],5,-701558691),m=F(m,n,i,g,h[10],9,38016083),g=F(g,m,n,i,h[15],14,-660478335),i=F(i,g,m,n,h[4],20,-405537848),n=F(n,i,g,m,h[9],5,568446438),m=F(m,n,i,g,h[14],9,-1019803690),g=F(g,m,n,i,h[3],14,-187363961),i=F(i,g,m,n,h[8],20,1163531501),n=F(n,i,g,m,h[13],5,-1444681467),m=F(m,n,i,g,h[2],9,-51403784),g=F(g,m,n,i,h[7],14,1735328473),i=F(i,g,m,n,h[12],20,-1926607734),n=w(n,i,g,m,h[5],4,-378558),m=w(m,n,i,g,h[8],11,-2022574463),g=w(g,m,n,i,h[11],16,1839030562),i=w(i,g,m,n,h[14],23,-35309556),n=w(n,i,g,m,h[1],4,-1530992060),m=w(m,n,i,g,h[4],11,1272893353),g=w(g,m,n,i,h[7],16,-155497632),i=w(i,g,m,n,h[10],23,-1094730640),n=w(n,i,g,m,h[13],4,681279174),m=w(m,n,i,g,h[0],11,-358537222),g=w(g,m,n,i,h[3],16,-722521979),i=w(i,g,m,n,h[6],23,76029189),n=w(n,i,g,m,h[9],4,-640364487),m=w(m,n,i,g,h[12],11,-421815835),g=w(g,m,n,i,h[15],16,530742520),i=w(i,g,m,n,h[2],23,-995338651),n=B(n,i,g,m,h[0],6,-198630844),m=B(m,n,i,g,h[7],10,1126891415),g=B(g,m,n,i,h[14],15,-1416354905),i=B(i,g,m,n,h[5],21,-57434055),n=B(n,i,g,m,h[12],6,1700485571),m=B(m,n,i,g,h[3],10,-1894986606),g=B(g,m,n,i,h[10],15,-1051523),i=B(i,g,m,n,h[1],21,-2054922799),n=B(n,i,g,m,h[8],6,1873313359),m=B(m,n,i,g,h[15],10,-30611744),g=B(g,m,n,i,h[6],15,-1560198380),i=B(i,g,m,n,h[13],21,1309151649),n=B(n,i,g,m,h[4],6,-145523070),m=B(m,n,i,g,h[11],10,-1120210379),g=B(g,m,n,i,h[2],15,718787259),i=B(i,g,m,n,h[9],21,-343485551),l[0]=K(n,l[0]),l[1]=K(i,l[1]),l[2]=K(g,l[2]),l[3]=K(m,l[3])}function z(h){var g,i=[];for(g=0;64>g;g+=4){i[g>>2]=h.charCodeAt(g)+(h.charCodeAt(g+1)<<8)+(h.charCodeAt(g+2)<<16)+(h.charCodeAt(g+3)<<24)}return i}function q(h){var g,i=[];for(g=0;64>g;g+=4){i[g>>2]=h[g]+(h[g+1]<<8)+(h[g+2]<<16)+(h[g+3]<<24)}return i}function E(g){var p,h,o,r,m,l,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(p=64;i>=p;p+=64){M(n,z(g.substring(p-64,p)))}for(g=g.substring(p-64),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=0;h>p;p+=1){o[p>>2]|=g.charCodeAt(p)<<(p%4<<3)}if(o[p>>2]|=128<<(p%4<<3),p>55){for(M(n,o),p=0;16>p;p+=1){o[p]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),l=parseInt(r[1],16)||0,o[14]=m,o[15]=l,M(n,o),n}function G(g){var l,h,o,r,m,p,i=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(l=64;i>=l;l+=64){M(n,q(g.subarray(l-64,l)))}for(g=i>l-64?g.subarray(l-64):new Uint8Array(0),h=g.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=0;h>l;l+=1){o[l>>2]|=g[l]<<(l%4<<3)}if(o[l>>2]|=128<<(l%4<<3),l>55){for(M(n,o),l=0;16>l;l+=1){o[l]=0}}return r=8*i,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),p=parseInt(r[1],16)||0,o[14]=m,o[15]=p,M(n,o),n}function A(h){var g,i="";for(g=0;4>g;g+=1){i+=L[h>>8*g+4&15]+L[h>>8*g&15]}return i}function H(h){var g;for(g=0;g<h.length;g+=1){h[g]=A(h[g])}return h.join("")}function J(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(l,h){var n,i=l.length,m=new ArrayBuffer(i),g=new Uint8Array(m);for(n=0;i>n;n+=1){g[n]=l.charCodeAt(n)}return h?g:m}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(i,g,l){var h=new Uint8Array(i.byteLength+g.byteLength);return h.set(new Uint8Array(i)),h.set(new Uint8Array(g),i.byteLength),l?h:h.buffer}function N(i){var g,l=[],h=i.length;for(g=0;h-1>g;g+=2){l.push(parseInt(i.substr(g,2),16))}return String.fromCharCode.apply(String,l)}function I(){this.reset()}var K=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==H(E("hello"))&&(K=function(i,g){var l=(65535&i)+(65535&g),h=(i>>16)+(g>>16)+(l>>16);return h<<16|65535&l}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(h,i){return h=0|h||0,0>h?Math.max(h+i,0):Math.min(h,i)}ArrayBuffer.prototype.slice=function(o,l){var n,r,h,m,i=this.byteLength,s=g(o,i),p=i;return l!==C&&(p=g(l,i)),s>p?new ArrayBuffer(0):(n=p-s,r=new ArrayBuffer(n),h=new Uint8Array(r),m=new Uint8Array(this,s,n),h.set(m),r)}}(),I.prototype.append=function(g){return this.appendBinary(J(g)),this},I.prototype.appendBinary=function(h){this._buff+=h,this._length+=h.length;var g,i=this._buff.length;for(g=64;i>=g;g+=64){M(this._hash,z(this._buff.substring(g-64,g)))}return this._buff=this._buff.substring(g-64),this},I.prototype.end=function(l){var h,n,i=this._buff,m=i.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;m>h;h+=1){g[h>>2]|=i.charCodeAt(h)<<(h%4<<3)}return this._finish(g,m),n=H(this._hash),l&&(n=N(n)),this.reset(),n},I.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},I.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},I.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},I.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},I.prototype._finish=function(l,h){var n,i,m,g=h;if(l[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,l),g=0;16>g;g+=1){l[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),m=parseInt(n[1],16)||0,l[14]=i,l[15]=m,M(this._hash,l)},I.hash=function(h,g){return I.hashBinary(J(h),g)},I.hashBinary=function(i,g){var l=E(i),h=H(l);return g?N(h):h},I.ArrayBuffer=function(){this.reset()},I.ArrayBuffer.prototype.append=function(i){var g,l=f(this._buff.buffer,i,!0),h=l.length;for(this._length+=i.byteLength,g=64;h>=g;g+=64){M(this._hash,q(l.subarray(g-64,g)))}return this._buff=h>g-64?new Uint8Array(l.buffer.slice(g-64)):new Uint8Array(0),this},I.ArrayBuffer.prototype.end=function(l){var h,n,i=this._buff,m=i.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;m>h;h+=1){g[h>>2]|=i[h]<<(h%4<<3)}return this._finish(g,m),n=H(this._hash),l&&(n=N(n)),this.reset(),n},I.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},I.ArrayBuffer.prototype.getState=function(){var g=I.prototype.getState.call(this);return g.buff=j(g.buff),g},I.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),I.prototype.setState.call(this,g)},I.ArrayBuffer.prototype.destroy=I.prototype.destroy,I.ArrayBuffer.prototype._finish=I.prototype._finish,I.ArrayBuffer.hash=function(i,g){var l=G(new Uint8Array(i)),h=H(l);return g?N(h):h},I})},{}],16:[function(c,f,d){function g(p,j,m){var l=m[m.length-1];p===l.element&&(m.pop(),l=m[m.length-1]);var h=l.element,k=l.index;if(Array.isArray(h)){h.push(p)}else{if(k===j.length-2){var e=j.pop();h[e]=p}else{j.push(p)}}}d.stringify=function(q){var v=[];v.push({obj:q});for(var h,z,x,m,B,w,A,y,p,k,e,j="";h=v.pop();){if(z=h.obj,x=h.prefix||"",m=h.val||"",j+=x,m){j+=m}else{if("object"!=typeof z){j+="undefined"==typeof z?null:JSON.stringify(z)}else{if(null===z){j+="null"}else{if(Array.isArray(z)){for(v.push({val:"]"}),B=z.length-1;B>=0;B--){w=0===B?"":",",v.push({obj:z[B],prefix:w})}v.push({val:"["})}else{A=[];for(y in z){z.hasOwnProperty(y)&&A.push(y)}for(v.push({val:"}"}),B=A.length-1;B>=0;B--){p=A[B],k=z[p],e=B>0?",":"",e+=JSON.stringify(p)+":",v.push({obj:k,prefix:e})}v.push({val:"{"})}}}}}return j},d.parse=function(w){for(var k,z,q,e,y,p,m,x,v,r=[],j=[],h=0;;){if(k=w[h++],"}"!==k&&"]"!==k&&"undefined"!=typeof k){switch(k){case" ":case"	":case"\n":case":":case",":break;case"n":h+=3,g(null,r,j);break;case"t":h+=3,g(!0,r,j);break;case"f":h+=4,g(!1,r,j);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(z="",h--;;){if(q=w[h++],!/[\d\.\-e\+]/.test(q)){h--;break}z+=q}g(parseFloat(z),r,j);break;case'"':for(e="",y=void 0,p=0;;){if(m=w[h++],'"'===m&&("\\"!==y||p%2!==1)){break}e+=m,y=m,"\\"===y?p++:p=0}g(JSON.parse('"'+e+'"'),r,j);break;case"[":x={element:[],index:r.length},r.push(x.element),j.push(x);break;case"{":v={element:{},index:r.length},r.push(v.element),j.push(v);break;default:throw new Error("unexpectedly reached end of input: "+k)}}else{if(1===r.length){return r.pop()}g(r.pop(),r,j)}}}},{}],17:[function(d,c,f){(function(e2,bw){function aT(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function cl(i,l){for(var k={},h=0,j=l.length;j>h;h++){var g=l[h];g in i&&(k[g]=i[g])}return k}function fA(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function bT(j){if("function"==typeof j.slice){return j.slice(0)}var h=new ArrayBuffer(j.byteLength),g=new Uint8Array(h),i=new Uint8Array(j);return g.set(i),h}function b5(h){if(h instanceof ArrayBuffer){return bT(h)}var g=h.size,i=h.type;return"function"==typeof h.slice?h.slice(0,g,i):h.webkitSlice(0,g,i)}function bH(h){var k,j,g;if(!h||"object"!=typeof h){return h}if(Array.isArray(h)){for(k=[],j=0,g=h.length;g>j;j++){k[j]=bH(h[j])}return k}if(h instanceof Date){return h.toISOString()}if(fA(h)){return b5(h)}k={};for(j in h){if(Object.prototype.hasOwnProperty.call(h,j)){var i=bH(h[j]);"undefined"!=typeof i&&(k[j]=i)}}return k}function cw(g){var h=!1;return au(function(i){if(h){throw new Error("once called more than once")}h=!0,g.apply(this,i)})}function aH(g){return au(function(j){j=bH(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(m,n){e2.nextTick(function(){i(m,n)})});var h=new aP(function(q,p){var n;try{var m=cw(function(r,s){r?p(r):q(s)});j.push(m),n=g.apply(l,j),n&&"function"==typeof n.then&&q(n)}catch(o){p(o)}});return k&&h.then(function(m){k(null,m)},k),h})}function ds(h,g){function i(j,n,l){if(c2.enabled){for(var o=[j._db_name,n],k=0;k<l.length-1;k++){o.push(l[k])}c2.apply(null,o);var m=l[l.length-1];l[l.length-1]=function(r,p){var q=[j._db_name,n];q=q.concat(r?["error",r]:["success",p]),c2.apply(null,q),m(r,p)}}}return aH(au(function(j){if(this._closed){return aP.reject(new Error("database is closed"))}if(this._destroyed){return aP.reject(new Error("database is destroyed"))}var k=this;return i(k,h,j),this.taskqueue.isReady?g.apply(this,j):new aP(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[h].apply(k,j))})})}))}function ab(h,g,i){return new aP(function(j,k){h.get(g,function(o,m){if(o){if(404!==o.status){return k(o)}m={}}var l=m._rev,n=i(m);return n?(n._id=g,n._rev=l,void j(j1(h,n,i))):j({updated:!1,rev:l})})})}function j1(h,g,i){return h.put(g).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return ab(h,g._id,i)})}function dK(r){for(var p,g,q,s,i=r.rev_tree.slice();s=i.pop();){var n=s.ids,j=n[2],o=s.pos;if(j.length){for(var m=0,k=j.length;k>m;m++){i.push({pos:o+1,ids:j[m]})}}else{var h=!!n[1].deleted,l=n[0];p&&!(q!==h?q:g!==o?o>g:l>p)||(p=l,g=o,q=h)}}return g+"-"+p}function cp(g){return g.ids}function c3(h,k){k||(k=dK(h));for(var j,g=k.substring(k.indexOf("-")+1),i=h.rev_tree.map(cp);j=i.pop();){if(j[0]===g){return !!j[1].deleted}i=i.concat(j[2])}}function cC(g){return f3("return "+g+";",{})}function e5(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function cg(g){if(!g){return null}var h=g.split("/");return 2===h.length?h:1===h.length?[g,g]:null}function ki(g){var h=cg(g);return h?h.join("/"):null}function cK(o,h){for(var l,j=o.slice();l=j.pop();){for(var k=l.pos,m=l.ids,g=m[2],i=h(0===g.length,k,m[0],l.ctx,m[1]),n=0,p=g.length;p>n;n++){j.push({pos:k+1,ids:g[n],ctx:i})}}}function aw(g,h){return g.pos-h.pos}function kb(j){var h=[];cK(j,function(l,n,k,m,o){l&&h.push({rev:n+"-"+k,pos:n,opts:o})}),h.sort(aw).reverse();for(var g=0,i=h.length;i>g;g++){delete h[g].pos}return h}function dz(k){for(var i=dK(k),g=kb(k.rev_tree),j=[],l=0,m=g.length;m>l;l++){var h=g[l];h.rev===i||h.opts.deleted||j.push(h.rev)}return j}function bf(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function cv(j,h,g){function i(k){for(var l in j){"function"!=typeof j[l]&&(this[l]=j[l])}void 0!==g&&(this.name=g),void 0!==k&&(this.reason=k)}return i.prototype=bf.prototype,new i(h)}function aX(i){var l,k,h,j,g;return k=i.error===!0&&"string"==typeof i.name?i.name:i.error,g=i.reason,h=aj("name",k,g),i.missing||"missing"===g||"deleted"===g||"not_found"===k?h=fH:"doc_validation"===k?(h=j9,j=g):"bad_request"===k&&h.message!==g&&(h=ch),h||(h=aj("status",i.status,g)||jN),l=cv(h,g,k),j&&(l.message=j),i.id&&(l.id=i.id),i.status&&(l.status=i.status),i.missing&&(l.missing=i.missing),l}function d1(k,i,g){function j(){l.cancel()}aQ.EventEmitter.call(this);var l=this;this.db=k,i=i?bH(i):{};var m=i.complete=cw(function(n,o){n?l.emit("error",n):l.emit("complete",o),l.removeAllListeners(),k.removeListener("destroyed",j)});g&&(l.on("complete",function(n){g(null,n)}),l.on("error",g)),k.once("destroyed",j),i.onChange=function(n){i.isCancelled||(l.emit("change",n),l.startSeq&&l.startSeq<=n.seq&&(l.startSeq=!1))};var h=new aP(function(n,o){i.complete=function(p,q){p?o(p):n(q)}});l.once("cancel",function(){k.removeListener("destroyed",j),i.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){m(null,n)},m),k.taskqueue.isReady?l.doChanges(i):k.taskqueue.addTask(function(){l.isCancelled?l.emit("cancel"):l.doChanges(i)})}function dW(h,k,j){var g=[{rev:h._rev}];"all_docs"===j.style&&(g=kb(k.rev_tree).map(function(l){return{rev:l.rev}}));var i={id:k.id,changes:g,doc:h};return c3(k,h._rev)&&(i.deleted=!0),j.conflicts&&(i.doc._conflicts=dz(k),i.doc._conflicts.length||delete i.doc._conflicts),i}function e9(m,h,l){function j(){var r=[];q.forEach(function(s){s.docs.forEach(function(u){r.push({id:s.id,docs:[u]})})}),l(null,{results:r})}function k(){++o===p&&j()}function n(r,u,s){q[r]={id:u,docs:s},k()}var i=Array.isArray(h)?h:h.docs,g={};i.forEach(function(r){r.id in g?g[r.id].push(r):g[r.id]=[r]});var p=Object.keys(g).length,o=0,q=new Array(p);Object.keys(g).forEach(function(s,w){var u=g[s],r=cl(u[0],["atts_since","attachments"]);r.open_revs=u.map(function(x){return x.rev}),r.open_revs=r.open_revs.filter(function(x){return x});var v=function(x){return x};0===r.open_revs.length&&(delete r.open_revs,v=function(x){return[{ok:x}]}),["revs","attachments","binary","ajax"].forEach(function(x){x in h&&(r[x]=h[x])}),m.get(s,r,function(y,x){n(w,s,y?[{error:y}]:v(x))})})}function fF(g){return/^_local/.test(g)}function eE(r){for(var p,g=[],q=r.slice();p=q.pop();){var s=p.pos,i=p.ids,n=i[0],j=i[1],o=i[2],m=0===o.length,k=p.history?p.history.slice():[];k.push({id:n,opts:j}),m&&g.push({pos:s+1-k.length,ids:k});for(var h=0,l=o.length;l>h;h++){q.push({pos:s+1,ids:o[h],history:k})}}return g.reverse()}function el(g){return 0|Math.random()*g}function cV(j,h){h=h||c7.length;var g="",i=-1;if(j){for(;++i<j;){g+=c7[el(h)]}return g}for(;++i<36;){switch(i){case 8:case 13:case 18:case 23:g+="-";break;case 19:g+=c7[3&el(16)|8];break;default:g+=c7[el(16)]}}return g}function bR(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function bX(g){var h;if(g?"string"!=typeof g?h=cv(bW):/^_/.test(g)&&!/^_(design|local)/.test(g)&&(h=cv(b6)):h=cv(aM),h){throw h}}function dg(j){if(!/^\d+\-./.test(j)){return cv(fB)}var h=j.indexOf("-"),g=j.substring(0,h),i=j.substring(h+1);return{prefix:parseInt(g,10),id:i}}function da(k,i){for(var g=k.start-k.ids.length+1,j=k.ids,l=[j[0],i,[]],m=1,h=j.length;h>m;m++){l=[j[m],{status:"missing"},[l]]}return[{pos:g,ids:l}]}function bP(o,h){var l,j,k,m={status:"available"};if(o._deleted&&(m.deleted=!0),h){if(o._id||(o._id=cV()),j=cV(32,16).toLowerCase(),o._rev){if(k=dg(o._rev),k.error){return k}o._rev_tree=[{pos:k.prefix,ids:[k.id,{status:"missing"},[[j,m,[]]]]}],l=k.prefix+1}else{o._rev_tree=[{pos:1,ids:[j,m,[]]}],l=1}}else{if(o._revisions&&(o._rev_tree=da(o._revisions,m),l=o._revisions.start,j=o._revisions.ids[0]),!o._rev_tree){if(k=dg(o._rev),k.error){return k}l=k.prefix,j=k.id,o._rev_tree=[{pos:l,ids:[j,m,[]]}]}}bX(o._id),o._rev=l+"-"+j;var g={metadata:{},data:{}};for(var i in o){if(Object.prototype.hasOwnProperty.call(o,i)){var n="_"===i[0];if(n&&!eV[i]){var p=cv(j9,i);throw p.message=j9.message+": "+i,p}n&&!b8[i]?g.metadata[i.slice(1)]=o[i]:g.data[i]=o[i]}}return g}function cQ(g,h){return h>g?-1:g>h?1:0}function f2(h,g){for(var i=0;i<h.length;i++){if(g(h[i],i)===!0){return h[i]}}}function dh(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function eW(i){for(var l=0;l<i.length;l++){var k=i[l];if(k._deleted){delete k._attachments}else{if(k._attachments){for(var h=Object.keys(k._attachments),j=0;j<h.length;j++){var g=h[j];k._attachments[g]=cl(k._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function eL(h,k){var j=cQ(h._id,k._id);if(0!==j){return j}var g=h._revisions?h._revisions.start:0,i=k._revisions?k._revisions.start:0;return cQ(g,i)}function bl(h){var g={},i=[];return cK(h,function(l,k,m,j){var n=k+"-"+m;return l&&(g[n]=0),void 0!==j&&i.push({from:j,to:n}),n}),i.reverse(),i.forEach(function(j){void 0===g[j.from]?g[j.from]=1+g[j.to]:g[j.from]=Math.min(g[j.from],1+g[j.to])}),g}function bj(h,k,j){var g="limit" in k?k.keys.slice(k.skip,k.limit+k.skip):k.skip>0?k.keys.slice(k.skip):k.keys;if(k.descending&&g.reverse(),!g.length){return h._allDocs({limit:0},j)}var i={offset:k.skip};return aP.all(g.map(function(m){var l=ag.extend({key:m,deleted:"ok"},k);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new aP(function(n,o){h._allDocs(l,function(q,p){return q?o(q):(i.total_rows=p.total_rows,void n(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return i.rows=l,i})}function aK(j){var h=j._compactionQueue[0],i=h.opts,g=h.callback;j.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(i.last_seq=k.last_seq),j._compact(i,function(l,m){l?g(l):g(null,m),e2.nextTick(function(){j._compactionQueue.shift(),j._compactionQueue.length&&aK(j)})})})}function ea(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function ep(h,k,j,g){k.seq=k.seq||0;var i={doc_ids:["_design/"+j],limit:1,since:k.seq};h.changes(i).then(function(l){var m=l.results&&l.results.length&&l.results[0].seq;m&&m>k.seq&&(k.seq=m,delete k.promise),g()})["catch"](g)}function d2(j,h,g){j._ddocCache=j._ddocCache||{},j._ddocCache[h]=j._ddocCache[h]||{};var i=j._ddocCache[h];ep(j,i,h,function(k){return k?g(k):(i.promise||(i.promise=new aP(function(m,l){j._get("_design/"+h,{},function(o,n){if(o){return l(o)}var p={};["views","filters"].forEach(function(q){p[q]=n.doc[q]}),m(p)})})),void i.promise.then(function(l){g(null,l)})["catch"](g))})}function aJ(h,k,j,g,i){d2(h,k,function(n,m){if(n){return i(n)}var l=m[j]&&m[j][g];return l?void i(null,l):i(cv(fH))})}function aq(){aQ.EventEmitter.call(this)}function ek(){this.isReady=!1,this.failed=!1,this.queue=[]}function jD(g){g&&bw.debug&&console.error(g)}function eB(k,i){function g(){m.emit("destroyed",l)}function j(){k.removeListener("destroyed",g),k.emit("destroyed",k)}var l=i.originalName,m=k.constructor,h=m._destructionListeners;k.once("destroyed",g),h.has(l)||h.set(l,[]),h.get(l).push(j)}function dw(i,l,k){if(!(this instanceof dw)){return new dw(i,l,k)}var h=this;"function"!=typeof l&&"undefined"!=typeof l||(k=l,l={}),i&&"object"==typeof i&&(l=i,i=void 0),"undefined"==typeof k&&(k=jD),i=i||l.name,l=bH(l),delete l.name,this.__opts=l;var j=k;h.auto_compaction=l.auto_compaction,h.prefix=dw.prefix,aq.call(h),h.taskqueue=new ek;var g=new aP(function(q,o){k=function(r,s){return r?o(r):(delete s.then,void q(s))},l=bH(l);var m,p,n=l.name||i;return function(){try{if("string"!=typeof n){throw p=new Error("Missing/invalid DB name"),p.code=400,p}if(m=dw.parseAdapter(n,l),l.originalName=n,l.name=m.name,l.prefix&&"http"!==m.adapter&&"https"!==m.adapter&&(l.name=l.prefix+l.name),l.adapter=l.adapter||m.adapter,h._adapter=l.adapter,aE("pouchdb:adapter")("Picked adapter: "+l.adapter),h._db_name=n,!dw.adapters[l.adapter]){throw p=new Error("Adapter is missing"),p.code=404,p}if(!dw.adapters[l.adapter].valid()){throw p=new Error("Invalid Adapter"),p.code=404,p}}catch(r){h.taskqueue.fail(r)}}(),p?o(p):(h.adapter=l.adapter,h.replicate={},h.replicate.from=function(r,u,s){return h.constructor.replicate(r,h,u,s)},h.replicate.to=function(r,u,s){return h.constructor.replicate(h,r,u,s)},h.sync=function(r,u,s){return h.constructor.sync(h,r,u,s)},h.replicate.sync=h.sync,void dw.adapters[l.adapter].call(h,l,function(r){return r?(h.taskqueue.fail(r),void k(r)):(eB(h,l),h.emit("created",h),dw.emit("created",l.originalName),h.taskqueue.ready(h),void k(null,h))}))});g.then(function(m){j(null,m)},j),h.then=g.then.bind(g),h["catch"]=g["catch"].bind(g)}function bG(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function cd(){return bq}function ad(g){Object.keys(aQ.EventEmitter.prototype).forEach(function(i){"function"==typeof aQ.EventEmitter.prototype[i]&&(g[i]=by[i].bind(by))});var h=g._destructionListeners=new dE.Map;g.on("destroyed",function(i){h.has(i)&&(h.get(i).forEach(function(j){j()}),h["delete"](i))})}function cD(i,l){i=i||[],l=l||{};try{return new Blob(i,l)}catch(k){if("TypeError"!==k.name){throw k}for(var h="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,j=new h,g=0;g<i.length;g+=1){j.append(i[g])}return j.getBlob(l.type)}}function bN(h,g){if("undefined"==typeof FileReader){return g((new FileReaderSync).readAsArrayBuffer(h))}var i=new FileReader;i.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);g(k)},i.readAsArrayBuffer(h)}function aS(){for(var j={},h=new aP(function(k,l){j.resolve=k,j.reject=l}),g=new Array(arguments.length),i=0;i<g.length;i++){g[i]=arguments[i]}return j.promise=h,aP.resolve().then(function(){return fetch.apply(null,g)}).then(function(k){j.resolve(k)})["catch"](function(k){j.reject(k)}),j}function b7(k,i){var g,j,l,m=new Headers,h={method:k.method,credentials:"include",headers:m};return k.json&&(m.set("Accept","application/json"),m.set("Content-Type",k.headers["Content-Type"]||"application/json")),k.body&&k.body instanceof Blob?bN(k.body,function(n){h.body=n}):k.body&&k.processData&&"string"!=typeof k.body?h.body=JSON.stringify(k.body):"body" in k?h.body=k.body:h.body=null,Object.keys(k.headers).forEach(function(n){k.headers.hasOwnProperty(n)&&m.set(n,k.headers[n])}),g=aS(k.url,h),k.timeout>0&&(j=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+k.url))},k.timeout)),g.promise.then(function(n){return l={statusCode:n.status},k.timeout>0&&clearTimeout(j),l.statusCode>=200&&l.statusCode<300?k.binary?n.blob():n.text():n.json()}).then(function(n){l.statusCode>=200&&l.statusCode<300?i(null,l,n):i(n,l)})["catch"](function(n){i(n,l)}),{abort:g.reject}}function jW(l,o){var j,h,i=!1,k=function(){j.abort()},n=function(){i=!0,j.abort()};j=l.xhr?new l.xhr:new XMLHttpRequest;try{j.open(l.method,l.url)}catch(g){o(g,{statusCode:413})}j.withCredentials="withCredentials" in l?l.withCredentials:!0,"GET"===l.method?delete l.headers["Content-Type"]:l.json&&(l.headers.Accept="application/json",l.headers["Content-Type"]=l.headers["Content-Type"]||"application/json",l.body&&l.processData&&"string"!=typeof l.body&&(l.body=JSON.stringify(l.body))),l.binary&&(j.responseType="arraybuffer"),"body" in l||(l.body=null);for(var m in l.headers){l.headers.hasOwnProperty(m)&&j.setRequestHeader(m,l.headers[m])}return l.timeout>0&&(h=setTimeout(n,l.timeout),j.onprogress=function(){clearTimeout(h),4!==j.readyState&&(h=setTimeout(n,l.timeout))},"undefined"!=typeof j.upload&&(j.upload.onprogress=j.onprogress)),j.onreadystatechange=function(){if(4===j.readyState){var s={statusCode:j.status};if(j.status>=200&&j.status<300){var q;q=l.binary?cD([j.response||""],{type:j.getResponseHeader("Content-Type")}):j.responseText,o(null,s,q)}else{var p={};if(i){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(j.response)}catch(r){}}o(p,s)}}},l.body&&l.body instanceof Blob?bN(l.body,function(p){j.send(p)}):j.send(l.body),{abort:k}}function a8(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function aB(g,h){return d6||g.xhr?jW(g,h):b7(g,h)}function av(){return""}function cM(h,k){function j(m,l,n){if(!h.binary&&h.json&&"string"==typeof m){try{m=JSON.parse(m)}catch(o){return n(o)}}Array.isArray(m)&&(m=m.map(function(p){return p.error||p.missing?aX(p):p})),h.binary&&eI(m,l),n(null,m,l)}function g(l,p){var n,q;if(l.code&&l.status){var m=new Error(l.message||l.code);return m.status=l.status,p(m)}if(l.message&&"ETIMEDOUT"===l.message){return p(l)}try{n=JSON.parse(l.responseText),q=aX(n)}catch(o){q=aX(l)}p(q)}h=bH(h);var i={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return h=ag.extend(i,h),h.json&&(h.binary||(h.headers.Accept="application/json"),h.headers["Content-Type"]=h.headers["Content-Type"]||"application/json"),h.binary&&(h.encoding=null,h.json=!1),h.processData||(h.json=!1),aB(h,function(l,p,n){if(l){return l.status=p?p.statusCode:400,g(l,k)}var q,o=p.headers&&p.headers["content-type"],m=n||av();if(!h.binary&&(h.json||!h.processData)&&"object"!=typeof m&&(/json/.test(o)||/^[\s]*\{/.test(m)&&/\}[\s]*$/.test(m))){try{m=JSON.parse(m.toString())}catch(r){}}p.statusCode>=200&&p.statusCode<300?j(m,p,k):(q=aX(m),q.status=p.statusCode,k(q))})}function c4(o,h){var l=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",j=-1!==l.indexOf("safari")&&-1===l.indexOf("chrome"),k=-1!==l.indexOf("msie"),m=-1!==l.indexOf("edge"),g=j||(k||m)&&"GET"===o.method,i="cache" in o?o.cache:!0,n=/^blob:/.test(o.url);if(!n&&(g||!i)){var p=-1!==o.url.indexOf("?");o.url+=(p?"&":"?")+"_nonce="+Date.now()}return cM(o,h)}function j2(k){for(var i=dM.exec(k),g={},j=14;j--;){var l=jY[j],m=i[j]||"",h=-1!==["user","password"].indexOf(l);g[l]=h?decodeURIComponent(m):m}return g[ke]={},g[jY[12]].replace(f0,function(o,p,n){p&&(g[ke][p]=n)}),g}function fI(h){for(var k=h.length,j=new ArrayBuffer(k),g=new Uint8Array(j),i=0;k>i;i++){g[i]=h.charCodeAt(i)}return j}function cH(g,h){return cD([fI(g)],{type:h})}function bh(h,k,j){try{return !h(k,j)}catch(g){var i="Filter function threw: "+g.toString();return cv(ch,i)}}function fN(h){var g={},i=h.filter&&"function"==typeof h.filter;return g.query=h.query_params,function(k){k.doc||(k.doc={});var l=i&&bh(h.filter,k.doc,g);if("object"==typeof l){return l}if(l){return !1}if(h.include_docs){if(!h.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function cY(g,h){"console" in bw&&"info" in console&&console.info("The above "+g+" is totally normal. "+h)}function dD(h,k,j,g,i){return h.get(k)["catch"](function(l){if(404===l.status){return"http"===h.type()&&cY(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:g,_id:k,history:[],replicator:ba,version:cN}}throw l}).then(function(l){return i.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==g}),l.history.unshift({last_seq:j,session_id:g}),l.history=l.history.slice(0,c6),l.version=cN,l.replicator=ba,l.session_id=g,l.last_seq=j,h.put(l)["catch"](function(m){if(409===m.status){return dD(h,k,j,g,i)}throw m}))})}function cX(j,h,g,i){this.src=j,this.target=h,this.id=g,this.returnValue=i}function dX(j,h){if(j.session_id===h.session_id){return{last_seq:j.last_seq,history:j.history||[]}}var g=j.history||[],i=h.history||[];return eD(g,i)}function eD(j,l){var h=j[0],n=j.slice(1),g=l[0],k=l.slice(1);if(!h||0===l.length){return{last_seq:fL,history:[]}}var i=h.session_id;if(aa(i,l)){return{last_seq:h.last_seq,history:j}}var m=g.session_id;return aa(m,n)?{last_seq:g.last_seq,history:k}:eD(n,k)}function aa(j,h){var g=h[0],i=h.slice(1);return j&&0!==h.length?j===g.session_id?!0:aa(j,i):!1}function d7(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function jZ(j,h){j=parseInt(j,10)||0,h=parseInt(h,10),h!==h||j>=h?h=(j||1)<<1:h+=1;var g=Math.random(),i=h-j;return ~~(i*g+j)}function bK(g){var h=0;return g||(h=2000),jZ(g,h)}function d5(j,h,g,i){return j.retry===!1?(h.emit("error",g),void h.removeAllListeners()):("function"!=typeof j.back_off_function&&(j.back_off_function=bK),h.emit("requestError",g),"active"!==h.state&&"pending"!==h.state||(h.emit("paused",g),h.state="stopped",h.once("active",function(){j.current_back_off=a9})),j.current_back_off=j.current_back_off||a9,j.current_back_off=j.back_off_function(j.current_back_off),void setTimeout(i,j.current_back_off))}function bZ(g){return d3(g)}function aL(j,h,g,i){(g>0||i<h.byteLength)&&(h=new Uint8Array(h,g,Math.min(i,h.byteLength)-g)),j.append(h)}function dR(j,h,g,i){(g>0||i<h.length)&&(h=h.substring(g,i)),j.appendBinary(h)}function cZ(g){return Object.keys(g).sort(e3.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function kk(k,i,g){var j=g.doc_ids?g.doc_ids.sort(e3.collate):"",l=g.filter?g.filter.toString():"",m="",h="";return g.filter&&g.query_params&&(m=JSON.stringify(cZ(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),aP.all([k.id(),i.id()]).then(function(o){var n=o[0]+o[1]+l+h+m+j;return dN(n)}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function dv(g){return/^1-/.test(g)}function jE(g){var h=[];return Object.keys(g).forEach(function(j){var i=g[j].missing;i.forEach(function(k){h.push({id:j,rev:k})})}),{docs:h,revs:!0,attachments:!0,binary:!0}}function e0(m,h,l){function j(){var q=jE(h);if(q.docs.length){return m.bulkGet(q).then(function(r){if(l.cancelled){throw new Error("cancelled")}r.results.forEach(function(s){s.docs.forEach(function(u){u.ok?o.push(u.ok):void 0!==u.error&&(n=!1)})})})}}function i(q){return q._attachments&&Object.keys(q._attachments).length>0}function k(q){return m.allDocs({keys:q,include_docs:!0}).then(function(r){if(l.cancelled){throw new Error("cancelled")}r.rows.forEach(function(s){!s.deleted&&s.doc&&dv(s.value.rev)&&!i(s.doc)&&(o.push(s.doc),delete h[s.id])})})}function p(){var q=Object.keys(h).filter(function(r){var s=h[r].missing;return 1===s.length&&dv(s[0])});return q.length>0?k(q):void 0}function g(){return{ok:n,docs:o}}h=bH(h);var o=[],n=!0;return aP.resolve().then(p).then(j).then(g)}function c5(o,x,K,F,J){function Q(){return h?aP.resolve():kk(o,x,K).then(function(T){A=T,h=new cX(o,x,A,F)})}function E(){if(C=[],0!==m.docs.length){var T=m.docs;return x.bulkDocs({docs:T,new_edits:!1}).then(function(X){if(F.cancelled){throw I(),new Error("cancelled")}var U=[],W={};X.forEach(function(Z){Z.error&&(J.doc_write_failures++,U.push(Z),W[Z.id]=Z)}),n=n.concat(U),J.docs_written+=m.docs.length-U.length;var V=U.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=W[Z._id];ae?F.emit("denied",bH(ae)):C.push(Z)}),V.length>0){var Y=new Error("bulkDocs error");throw Y.other_errors=U,R("target.bulkDocs failed to write docs",Y),new Error("bulkWrite partial failure")}},function(U){throw J.doc_write_failures+=T.length,U})}}function y(){if(m.error){throw new Error("There was a problem getting docs.")}J.last_seq=l=m.seq;var T=bH(J);return C.length&&(T.docs=C,F.emit("change",T)),i=!0,h.writeCheckpoint(m.seq,p).then(function(){if(i=!1,F.cancelled){throw I(),new Error("cancelled")}m=void 0,M()})["catch"](function(U){throw i=!1,R("writeCheckpoint completed with error",U),U})}function r(){var T={};return m.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),x.revsDiff(T).then(function(U){if(F.cancelled){throw I(),new Error("cancelled")}m.diffs=U})}function j(){return e0(o,m.diffs,F).then(function(T){m.error=!T.ok,T.docs.forEach(function(U){delete m.diffs[U._id],J.docs_read++,m.docs.push(U)})})}function N(){if(!F.cancelled&&!m){if(0===O.length){return void s(!0)}m=O.shift(),r().then(j).then(E).then(y).then(N)["catch"](function(T){R("batch processing terminated with error",T)})}}function s(T){return 0===H.changes.length?void (0!==O.length||m||((P&&z.live||D)&&(F.state="pending",F.emit("paused")),D&&I())):void ((T||D||H.changes.length>=B)&&(O.push(H),H={seq:0,changes:[],docs:[]},"pending"!==F.state&&"stopped"!==F.state||(F.state="active",F.emit("active")),N()))}function R(T,U){L||(U.message||(U.message=T),J.ok=!1,J.status="aborting",J.errors.push(U),n=n.concat(U),O=[],H={seq:0,changes:[],docs:[]},I())}function I(){if(!(L||F.cancelled&&(J.status="cancelled",i))){J.status=J.status||"complete",J.end_time=new Date,J.last_seq=l,L=!0;var T=n.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(T.length>0){var U=n.pop();n.length>0&&(U.other_errors=n),U.result=J,d5(K,F,U,function(){c5(o,x,K,F)})}else{J.errors=n,F.emit("complete",J),F.removeAllListeners()}}}function q(T){if(F.cancelled){return I()}var U=fN(K)(T);U&&(H.seq=T.seq,H.changes.push(T),s(z.live))}function S(T){return u=!1,F.cancelled?I():(T.results.length>0?(z.since=T.last_seq,M()):P?(z.live=!0,M()):D=!0,void s(!0))}function G(T){return u=!1,F.cancelled?I():void R("changes rejected",T)}function M(){function U(){T.cancel()}function V(){F.removeListener("cancel",U)}if(!u&&!D&&O.length<v){u=!0,F._changes&&(F.removeListener("cancel",F._abortChanges),F._changes.cancel()),F.once("cancel",U);var T=o.changes(z).on("change",q);T.then(V,V),T.then(S)["catch"](G),K.retry&&(F._changes=T,F._abortChanges=U)}}function g(){Q().then(function(){return F.cancelled?void I():h.getCheckpoint().then(function(T){l=T,z={since:l,limit:B,batch_size:B,style:"all_docs",doc_ids:k,return_docs:!0},K.filter&&("string"!=typeof K.filter?z.include_docs=!0:z.filter=K.filter),"heartbeat" in K&&(z.heartbeat=K.heartbeat),"timeout" in K&&(z.timeout=K.timeout),K.query_params&&(z.query_params=K.query_params),K.view&&(z.view=K.view),M()})})["catch"](function(T){R("getCheckpoint rejected with ",T)})}function w(T){throw i=!1,R("writeCheckpoint completed with error",T),T}var m,A,h,O=[],H={seq:0,changes:[],docs:[]},i=!1,D=!1,L=!1,l=0,P=K.continuous||K.live||!1,B=K.batch_size||100,v=K.batches_limit||10,u=!1,k=K.doc_ids,n=[],C=[],p=cV();J=J||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var z={};return F.ready(o,x),F.cancelled?void I():(F._addedListeners||(F.once("cancel",I),"function"==typeof K.complete&&(F.once("error",K.complete),F.once("complete",function(T){K.complete(null,T)})),F._addedListeners=!0),void ("undefined"==typeof K.since?g():Q().then(function(){return i=!0,h.writeCheckpoint(K.since,p)}).then(function(){return i=!1,F.cancelled?void I():(l=K.since,void g())})["catch"](w)))}function ca(){aQ.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var g=this,h=new aP(function(i,j){g.once("complete",i),g.once("error",j)});g.then=function(i,j){return h.then(i,j)},g["catch"]=function(i){return h["catch"](i)},g["catch"](function(){})}function aU(h,g){var i=g.PouchConstructor;return"string"==typeof h?new i(h,g):h}function kf(k,i,g,j){if("function"==typeof g&&(j=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw cv(ch,"`doc_ids` filter parameter is not a list.")}g.complete=j,g=bH(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var l=new ca(g),m=aU(k,g),h=aU(i,g);return c5(m,h,g,l),l}function kh(j,h,g,i){return"function"==typeof g&&(i=g,g={}),"undefined"==typeof g&&(g={}),g=bH(g),g.PouchConstructor=g.PouchConstructor||this,j=d4.toPouch(j,g),h=d4.toPouch(h,g),new cA(j,h,g,i)}function cA(l,s,u,n){function r(z){y.emit("change",{direction:"pull",change:z})}function x(z){y.emit("change",{direction:"push",change:z})}function q(z){y.emit("denied",{direction:"push",doc:z})}function v(z){y.emit("denied",{direction:"pull",doc:z})}function i(){y.pushPaused=!0,y.pullPaused&&y.emit("paused")}function o(){y.pullPaused=!0,y.pushPaused&&y.emit("paused")}function k(){y.pushPaused=!1,y.pullPaused&&y.emit("active",{direction:"push"})}function w(){y.pullPaused=!1,y.pushPaused&&y.emit("active",{direction:"pull"})}function m(z){return function(D,B){var C="change"===D&&(B===r||B===x),F="denied"===D&&(B===v||B===q),A="paused"===D&&(B===o||B===i),E="active"===D&&(B===w||B===k);(C||F||A||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&y.removeAllListeners(D))}}var y=this;this.canceled=!1;var p=u.push?ag.extend({},u,u.push):u,h=u.pull?ag.extend({},u,u.pull):u;this.push=f8(l,s,p),this.pull=f8(s,l,h),this.pushPaused=!0,this.pullPaused=!0;var g={};u.live&&(this.push.on("complete",y.pull.cancel.bind(y.pull)),this.pull.on("complete",y.push.cancel.bind(y.push))),this.on("newListener",function(z){"change"===z?(y.pull.on("change",r),y.push.on("change",x)):"denied"===z?(y.pull.on("denied",v),y.push.on("denied",q)):"active"===z?(y.pull.on("active",w),y.push.on("active",k)):"paused"===z&&(y.pull.on("paused",o),y.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(y.pull.removeListener("change",r),y.push.removeListener("change",x)):"denied"===z?(y.pull.removeListener("denied",v),y.push.removeListener("denied",q)):"active"===z?(y.pull.removeListener("active",w),y.push.removeListener("active",k)):"paused"===z&&(y.pull.removeListener("paused",o),y.push.removeListener("paused",i))}),this.pull.on("removeListener",m("pull")),this.push.on("removeListener",m("push"));var j=aP.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return y.emit("complete",z),n&&n(null,z),y.removeAllListeners(),z},function(z){if(y.cancel(),n?n(z):y.emit("error",z),y.removeAllListeners(),n){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function f1(g,h){return cH(dZ(g),h)}function jL(h){for(var k="",j=new Uint8Array(h),g=j.byteLength,i=0;g>i;i++){k+=String.fromCharCode(j[i])}return k}function aY(j,h){if("undefined"==typeof FileReader){return h(jL((new FileReaderSync).readAsArrayBuffer(j)))}var g=new FileReader,i="function"==typeof g.readAsBinaryString;g.onloadend=function(k){var l=k.target.result||"";return i?h(l):void h(jL(l))},i?g.readAsBinaryString(j):g.readAsArrayBuffer(j)}function eJ(g){return new aP(function(h){aY(g,function(i){h(d3(i))})})}function fR(j){for(var h=[],g=0,i=j.length;i>g;g++){h=h.concat(j[g])}return h}function eZ(g){var h=g.doc&&g.doc._attachments;h&&Object.keys(h).forEach(function(i){var j=h[i];j.data=f1(j.data,j.content_type)})}function fE(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function ah(g){return g._attachments&&Object.keys(g._attachments)?aP.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?eJ(i.data).then(function(j){i.data=j}):void 0})):aP.resolve()}function cS(h){var g=j2(h);(g.user||g.password)&&(g.auth={username:g.user,password:g.password});var i=g.path.replace(/(^\/|\/$)/g,"").split("/");return g.db=i.pop(),-1===g.db.indexOf("%")&&(g.db=encodeURIComponent(g.db)),g.path=i.join("/"),g}function eS(g,h){return db(g,g.db+"/"+h)}function db(h,g){var i=h.path?"/":"";return h.protocol+"://"+h.host+(h.port?":"+h.port:"")+"/"+h.path+i+g}function eO(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function ax(j,u){function h(A,y,B){var z=A.ajax||{},x=ag.extend(bH(k),z,y);return j3(x.method+" "+x.url),cc.ajax(x,B)}function v(y,x){return new aP(function(A,z){h(y,x,function(C,B){return C?z(C):void A(B)})})}function l(y,x){return ds(y,au(function(z){p().then(function(){return x.apply(this,z)})["catch"](function(B){var A=z.pop();A(B)})}))}function p(){if(j.skipSetup||j.skip_setup){return aP.resolve()}if(q){return q}var x={method:"GET",url:r};return q=v({},x)["catch"](function(y){return y&&y.status&&404===y.status?(cY(404,"PouchDB is just detecting if the remote exists."),v({},{method:"PUT",url:r})):aP.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:aP.reject(y)}),q["catch"](function(){q=null}),q}function w(x){return x.split("/").map(encodeURIComponent).join("/")}var o=this,s=cS;j.getHost&&(s=j.getHost);var g=s(j.name,j),r=eS(g,"");j=bH(j);var k=j.ajax||{};if(o.getUrl=function(){return r},o.getHeaders=function(){return k.headers||{}},j.auth||g.auth){var n=j.auth||g.auth,m=n.username+":"+n.password,i=d3(unescape(encodeURIComponent(m)));k.headers=k.headers||{},k.headers.Authorization="Basic "+i}var q;setTimeout(function(){u(null,o)}),o.type=function(){return"http"},o.id=l("id",function(x){h({},{method:"GET",url:db(g,"")},function(z,y){var A=y&&y.uuid?y.uuid+g.db:eS(g,"");x(null,A)})}),o.request=l("request",function(y,x){y.url=eS(g,y.url),h({},y,x)}),o.compact=l("compact",function(y,x){"function"==typeof y&&(x=y,y={}),y=bH(y),h(y,{url:eS(g,"_compact"),method:"POST"},function(){function z(){o.info(function(B,A){A&&!A.compact_running?x(null,{ok:!0}):setTimeout(z,y.interval||200)})}z()})}),o.bulkGet=ds("bulkGet",function(C,y){function B(E){var F={};C.revs&&(F.revs=!0),C.attachments&&(F.attachments=!0),h({},{url:eS(g,"_bulk_get"+eO(F)),method:"POST",body:{docs:C.docs}},E)}function A(){function J(L){return function(N,M){K[L]=M.results,++E===H&&y(null,{results:fR(K)})}}for(var F=bc,H=Math.ceil(C.docs.length/F),E=0,K=new Array(H),I=0;H>I;I++){var G=cl(C,["revs","attachments"]);G.ajax=k,G.docs=C.docs.slice(I*F,Math.min(C.docs.length,(I+1)*F)),e9(z,G,J(I))}}var z=this,D=db(g,""),x=ck[D];"boolean"!=typeof x?B(function(F,G){if(F){var E=Math.floor(F.status/100);4===E||5===E?(ck[D]=!1,cY(F.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),A()):y(F)}else{ck[D]=!0,y(null,G)}}):x?B(y):A()}),o._info=function(x){p().then(function(){h({},{method:"GET",url:eS(g,"")},function(y,z){return y?x(y):(z.host=eS(g,""),void x(null,z))})})["catch"](x)},o.get=l("get",function(C,y,A){function B(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?aP.all(E.map(function(J){var I=G[J],H=fE(F._id)+"/"+w(J)+"?rev="+F._rev;return v(y,{method:"GET",url:eS(g,H),binary:!0}).then(function(K){return y.binary?K:eJ(K)}).then(function(K){delete I.stub,delete I.length,I.data=K})})):void 0}function D(E){return Array.isArray(E)?aP.all(E.map(function(F){return F.ok?B(F.ok):void 0})):B(E)}"function"==typeof y&&(A=y,y={}),y=bH(y);var z={};y.revs&&(z.revs=!0),y.revs_info&&(z.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),z.open_revs=y.open_revs),y.rev&&(z.rev=y.rev),y.conflicts&&(z.conflicts=y.conflicts),C=fE(C);var x={method:"GET",url:eS(g,C+eO(z))};v(y,x).then(function(E){return aP.resolve().then(function(){return y.attachments?D(E):void 0}).then(function(){A(null,E)})})["catch"](A)}),o.remove=l("remove",function(x,B,z,A){var y;"string"==typeof B?(y={_id:x,_rev:B},"function"==typeof z&&(A=z,z={})):(y=x,"function"==typeof B?(A=B,z={}):(A=z,z=B));var C=y._rev||z.rev;h(z,{method:"DELETE",url:eS(g,fE(y._id))+"?rev="+C},A)}),o.getAttachment=l("getAttachment",function(x,B,z,A){"function"==typeof z&&(A=z,z={});var y=z.rev?"?rev="+z.rev:"",C=eS(g,fE(x))+"/"+w(B)+y;h(z,{method:"GET",url:C,binary:!0},A)}),o.removeAttachment=l("removeAttachment",function(A,z,y,x){var B=eS(g,fE(A)+"/"+w(z))+"?rev="+y;h({},{method:"DELETE",url:B},x)}),o.putAttachment=l("putAttachment",function(E,y,z,A,B,G){"function"==typeof B&&(G=B,B=A,A=z,z=null);var H=fE(E)+"/"+w(y),F=eS(g,H);if(z&&(F+="?rev="+z),"string"==typeof A){var D;try{D=dZ(A)}catch(x){return G(cv(dm,"Attachment is not a valid base64 string"))}A=D?cH(D,B):""}var C={headers:{"Content-Type":B},method:"PUT",url:F,processData:!1,body:A,timeout:k.timeout||60000};h({},C,G)}),o._bulkDocs=function(x,y,z){x.new_edits=y.new_edits,p().then(function(){return aP.all(x.docs.map(ah))}).then(function(){h(y,{method:"POST",url:eS(g,"_bulk_docs"),body:x},function(A,B){return A?z(A):(B.forEach(function(C){C.ok=!0}),void z(null,B))})})["catch"](z)},o.allDocs=l("allDocs",function(C,y){"function"==typeof C&&(y=C,C={}),C=bH(C);var B,A={},D="GET";C.conflicts&&(A.conflicts=!0),C.descending&&(A.descending=!0),C.include_docs&&(A.include_docs=!0),C.attachments&&(A.attachments=!0),C.key&&(A.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(A.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(A.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(A.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(A.limit=C.limit),"undefined"!=typeof C.skip&&(A.skip=C.skip);var x=eO(A);if("undefined"!=typeof C.keys){var z="keys="+encodeURIComponent(JSON.stringify(C.keys));z.length+x.length+1<=aZ?x+="&"+z:(D="POST",B={keys:C.keys})}v(C,{method:D,url:eS(g,"_all_docs"+x),body:B}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(eZ),y(null,E)})["catch"](y)}),o._changes=function(J){var y="batch_size" in J?J.batch_size:cy;J=bH(J),J.timeout="timeout" in J?J.timeout:"timeout" in k?k.timeout:30000;var B,G=J.timeout?{timeout:J.timeout-5000}:{},F="undefined"!=typeof J.limit?J.limit:!1;B="return_docs" in J?J.return_docs:"returnDocs" in J?J.returnDocs:!0;var A=F;if(J.style&&(G.style=J.style),(J.include_docs||J.filter&&"function"==typeof J.filter)&&(G.include_docs=!0),J.attachments&&(G.attachments=!0),J.continuous&&(G.feed="longpoll"),J.conflicts&&(G.conflicts=!0),J.descending&&(G.descending=!0),"heartbeat" in J?J.heartbeat&&(G.heartbeat=J.heartbeat):G.heartbeat=10000,J.filter&&"string"==typeof J.filter&&(G.filter=J.filter,"_view"===J.filter&&J.view&&"string"==typeof J.view&&(G.view=J.view)),J.query_params&&"object"==typeof J.query_params){for(var L in J.query_params){J.query_params.hasOwnProperty(L)&&(G[L]=J.query_params[L])}}var H,D="GET";if(J.doc_ids){G.filter="_doc_ids";var E=JSON.stringify(J.doc_ids);E.length<aZ?G.doc_ids=E:(D="POST",H={doc_ids:J.doc_ids})}var C,z,K=function(O,N){if(!J.aborted){G.since=O,"object"==typeof G.since&&(G.since=JSON.stringify(G.since)),J.descending?F&&(G.limit=A):G.limit=!F||A>y?y:A;var M={method:D,url:eS(g,"_changes"+eO(G)),timeout:J.timeout,body:H};z=O,J.aborted||p().then(function(){C=h(J,M,N)})["catch"](N)}},x={results:[]},I=function(P,M){if(!J.aborted){var N=0;if(M&&M.results){N=M.results.length,x.last_seq=M.last_seq;var Q={};Q.query=J.query_params,M.results=M.results.filter(function(R){A--;var S=fN(J)(R);return S&&(J.include_docs&&J.attachments&&J.binary&&eZ(R),B&&x.results.push(R),J.onChange(R)),S})}else{if(P){return J.aborted=!0,void J.complete(P)}}M&&M.last_seq&&(z=M.last_seq);var O=F&&0>=A||M&&y>N||J.descending;(!J.continuous||F&&0>=A)&&O?J.complete(null,x):setTimeout(function(){K(z,I)},0)}};return K(J.since||0,I),{cancel:function(){J.aborted=!0,C&&C.abort()}}},o.revsDiff=l("revsDiff",function(x,y,z){"function"==typeof y&&(z=y,y={}),h(y,{method:"POST",url:eS(g,"_revs_diff"),body:x},z)}),o._close=function(x){x()},o._destroy=function(x,y){h(x,{url:eS(g,""),method:"DELETE"},function(A,z){return A&&A.status&&404!==A.status?y(A):(o.emit("destroyed"),o.constructor.emit("destroyed",j.name),void y(null,z))})}}function d0(){this.promise=new aP(function(g){g()})}function dx(g){return e4.hash(g)}function eR(j){var l=j.db,h=j.viewName,n=j.map,g=j.reduce,k=j.temporary,i=n.toString()+(g&&g.toString())+"undefined";if(!k&&l._cachedViews){var m=l._cachedViews[i];if(m){return aP.resolve(m)}}return l.info().then(function(p){function o(u){u.views=u.views||{};var r=h;-1===r.indexOf("/")&&(r=h+"/"+h);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(k?"temp":dx(i));return ab(l,"_local/mrviews",o).then(function(){return l.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:l,adapter:l.adapter,mapFun:n,reduceFun:g};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,k||(l._cachedViews=l._cachedViews||{},l._cachedViews[i]=r,r.db.once("destroyed",function(){delete l._cachedViews[i]})),r})})})})}function dJ(i,l,k,h,j,g){return f3("return ("+i.replace(/;\s*$/,"")+");",{emit:l,sum:k,log:h,isArray:j,toJSON:g})}function kd(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function j6(g){return 1===g.length&&/^1-/.test(g[0].rev)}function ka(h,g){try{h.emit("error",g)}catch(i){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(g)}}function f4(j,h,g){try{return{output:h.apply(null,g)}}catch(i){return ka(j,i),{error:i}}}function jR(h,g){var i=cu(h.key,g.key);return 0!==i?i:cu(h.value,g.value)}function jP(h,g,i){return i=i||0,"number"==typeof g?h.slice(i,g+i):i>0?h.slice(i):h}function cP(h){var g=h.value,i=g&&"object"==typeof g&&g._id||h.id;return i}function t(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=f1(k.data,k.content_type)})})}function jJ(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&t(h),h}}function az(g){var h="builtin "+g+" function requires map values to be numbers or number arrays";return new fD(h)}function ed(j){for(var l=0,h=0,n=j.length;n>h;h++){var g=j[h];if("number"!=typeof g){if(!Array.isArray(g)){throw az("_sum")}l="number"==typeof l?[l]:l;for(var k=0,i=g.length;i>k;k++){var m=g[k];if("number"!=typeof m){throw az("_sum")}"undefined"==typeof l[k]?l.push(m):l[k]+=m}}else{"number"==typeof l?l+=g:l[0]+=g}}return l}function ej(h,k,j,g){var i=k[h];"undefined"!=typeof i&&(g&&(i=encodeURIComponent(JSON.stringify(i))),j.push(h+"="+i))}function f9(g){if("undefined"!=typeof g){var h=Number(g);return isNaN(h)||h!==parseInt(g,10)?g:h}}function dI(g){return g.group_level=f9(g.group_level),g.limit=f9(g.limit),g.skip=f9(g.skip),g}function af(g){if(g){if("number"!=typeof g){return new dQ('Invalid value for integer: "'+g+'"')}if(0>g){return new dQ('Invalid value for positive integer: "'+g+'"')}}}function fC(j,h){var g=j.descending?"endkey":"startkey",i=j.descending?"startkey":"endkey";if("undefined"!=typeof j[g]&&"undefined"!=typeof j[i]&&cu(j[g],j[i])>0){throw new dQ("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(h.reduce&&j.reduce!==!1){if(j.include_docs){throw new dQ("{include_docs:true} is invalid for reduce")}if(j.keys&&j.keys.length>1&&!j.group&&!j.group_level){throw new dQ("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=af(j[k]);if(l){throw l}})}function bA(l,o,j){var h,i=[],k="GET";if(ej("reduce",j,i),ej("include_docs",j,i),ej("attachments",j,i),ej("limit",j,i),ej("descending",j,i),ej("group",j,i),ej("group_level",j,i),ej("skip",j,i),ej("stale",j,i),ej("conflicts",j,i),ej("startkey",j,i,!0),ej("start_key",j,i,!0),ej("endkey",j,i,!0),ej("end_key",j,i,!0),ej("inclusive_end",j,i),ej("key",j,i,!0),i=i.join("&"),i=""===i?"":"?"+i,"undefined"!=typeof j.keys){var n=2000,g="keys="+encodeURIComponent(JSON.stringify(j.keys));g.length+i.length+1<=n?i+=("?"===i[0]?"&":"?")+g:(k="POST","string"==typeof o?h={keys:j.keys}:o.keys=j.keys)}if("string"==typeof o){var m=kd(o);return l.request({method:k,url:"_design/"+m[0]+"/_view/"+m[1]+i,body:h}).then(jJ(j))}return h=h||{},Object.keys(o).forEach(function(p){Array.isArray(o[p])?h[p]=o[p]:h[p]=o[p].toString()}),l.request({method:"POST",url:"_temp_view"+i,body:h}).then(jJ(j))}function cO(h,g,i){return new aP(function(j,k){h._query(g,i,function(m,l){return m?k(m):void j(l)})})}function ac(g){return new aP(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function b9(g){return function(h){if(404===h.status){return g}throw h}}function dl(m,h,l){function j(){return j6(o)?aP.resolve(g):h.db.get(n)["catch"](b9(g))}function i(r){return r.keys.length?h.db.allDocs({keys:r.keys,include_docs:!0}):aP.resolve({rows:[]})}function k(w,z){for(var r=[],B={},s=0,u=z.rows.length;u>s;s++){var x=z.rows[s],A=x.doc;if(A&&(r.push(A),B[A._id]=!0,A._deleted=!p[A._id],!A._deleted)){var y=p[A._id];"value" in y&&(A.value=y.value)}}var v=Object.keys(p);return v.forEach(function(C){if(!B[C]){var E={_id:C},D=p[C];"value" in D&&(E.value=D.value),r.push(E)}}),w.keys=fQ(v.concat(w.keys)),r.push(w),r}var n="_local/doc_"+m,g={_id:n,keys:[]},q=l[m],p=q.indexableKeysToKeyValues,o=q.changes;return j().then(function(r){return i(r).then(function(s){return k(r,s)})})}function dC(j,h,g){var i="_local/lastSeq";return j.db.get(i)["catch"](b9({_id:i,seq:0})).then(function(k){var l=Object.keys(h);return aP.all(l.map(function(m){return dl(m,j,h)})).then(function(n){var m=fR(n);return k.seq=g,m.push(k),j.db.bulkDocs({docs:m})})})}function fP(h){var g="string"==typeof h?h:h.name,i=cG[g];return i||(i=cG[g]=new d0),i}function jQ(g){return cU(fP(g),function(){return dG(g)})()}function dG(l){function o(p,r){var q={id:i._id,key:dj(p)};"undefined"!=typeof r&&null!==r&&(q.value=dj(r)),h.push(q)}function j(q,p){return function(){return dC(l,q,p)}}var h,i,k;if("function"==typeof l.mapFun&&2===l.mapFun.length){var n=l.mapFun;k=function(p){return n(p,o)}}else{k=dJ(l.mapFun.toString(),o,ed,c8,Array.isArray,JSON.parse)}var g=l.seq||0,m=new d0;return new aP(function(p,s){function r(){m.finish().then(function(){l.seq=g,p()})}function q(){function u(v){s(v)}l.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:g,limit:aF}).on("complete",function(C){var x=C.results;if(!x.length){return r()}for(var y={},v=0,F=x.length;F>v;v++){var A=x[v];if("_"!==A.doc._id[0]){h=[],i=A.doc,i._deleted||f4(l.sourceDB,k,[i]),h.sort(jR);for(var H,z={},D=0,E=h.length;E>D;D++){var G=h[D],w=[G.key,G.id];0===cu(G.key,H)&&w.push(D);var B=cb(w);z[B]=G,H=G.key}y[A.doc._id]={indexableKeysToKeyValues:z,changes:A.changes}}g=A.seq}return m.add(j(y,g)),x.length<aF?r():q()}).on("error",u)}q()})}function j4(m,h,l){0===l.group_level&&delete l.group_level;var j,i=l.group||l.group_level;j=bJ[m.reduceFun]?bJ[m.reduceFun]:dJ(m.reduceFun.toString(),null,ed,c8,Array.isArray,JSON.parse);var k=[],n=isNaN(l.group_level)?Number.POSITIVE_INFINITY:l.group_level;h.forEach(function(r){var u=k[k.length-1],s=i?r.key:null;return i&&Array.isArray(s)&&(s=s.slice(0,n)),u&&0===cu(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void k.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),h=[];for(var g=0,q=k.length;q>g;g++){var p=k[g],o=f4(m.sourceDB,j,[p.keys,p.values,!1]);if(o.error&&o.error instanceof fD){throw o.error}h.push({value:o.error?null:o.output,key:p.groupKey})}return{rows:jP(h,l.limit,l.skip)}}function e8(g,h){return cU(fP(g),function(){return dP(g,h)})()}function dP(r,p){function g(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return s=v.total_rows,v.rows.map(function(z){if("value" in z.doc&&"object"==typeof z.doc.value&&null!==z.doc.value){var x=Object.keys(z.doc.value).sort(),w=["id","key","value"];if(!(w>x||x>w)){return z.doc.value}}var y=eQ(z.doc._id);return{key:y[0],id:y[1],value:"value" in z.doc?z.doc.value:null}})})}function q(u){var w;if(w=i?j4(r,u,p):{total_rows:s,offset:n,rows:u},p.include_docs){var v=fQ(u.map(cP));return r.sourceDB.allDocs({keys:v,include_docs:!0,conflicts:p.conflicts,attachments:p.attachments,binary:p.binary}).then(function(y){var x={};return y.rows.forEach(function(z){z.doc&&(x["$"+z.id]=z.doc)}),u.forEach(function(A){var B=cP(A),z=x["$"+B];z&&(A.doc=z)}),w})}return w}var s,i=r.reduceFun&&p.reduce!==!1,n=p.skip||0;if("undefined"==typeof p.keys||p.keys.length||(p.limit=0,delete p.keys),"undefined"!=typeof p.keys){var j=p.keys,o=j.map(function(u){var v={startkey:cb([u]),endkey:cb([u,{}])};return g(v)});return aP.all(o).then(fR).then(q)}var m={descending:p.descending};if(p.start_key&&(p.startkey=p.start_key),p.end_key&&(p.endkey=p.end_key),"undefined"!=typeof p.startkey&&(m.startkey=cb(p.descending?[p.startkey,{}]:[p.startkey])),"undefined"!=typeof p.endkey){var k=p.inclusive_end!==!1;p.descending&&(k=!k),m.endkey=cb(k?[p.endkey,{}]:[p.endkey])}if("undefined"!=typeof p.key){var h=cb([p.key]),l=cb([p.key,{}]);m.descending?(m.endkey=h,m.startkey=l):(m.startkey=h,m.endkey=l)}return i||("number"==typeof p.limit&&(m.limit=p.limit),m.skip=n),g(m).then(q)}function bU(g){return g.request({method:"POST",url:"_view_cleanup"})}function jM(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(n){var l=kd(n),m="_design/"+l[0],k=l[1];j[m]=j[m]||{},j[m][k]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(n){var k={};n.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){k[v]=k[v]||s})})});var m=Object.keys(k).filter(function(o){return !k[o]}),l=m.map(function(o){return cU(fP(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return aP.all(l).then(function(){return{ok:!0}})})},b9({ok:!0}))}function d8(g,m,j){if("http"===g.type()){return bA(g,m,j)}if("function"==typeof g._query){return cO(g,m,j)}if("string"!=typeof m){fC(j,m);var h={db:g,viewName:"temp_view/temp_view",map:m.map,reduce:m.reduce,temporary:!0};return jV.add(function(){return eR(h).then(function(o){function p(){return o.db.destroy()}return jX(jQ(o).then(function(){return e8(o,j)}),p)})}),jV.finish()}var l=m,i=kd(l),n=i[0],k=i[1];return g.getView(n,k).then(function(p){fC(j,p);var o={db:g,viewName:l,map:p.map,reduce:p.reduce};return eR(o).then(function(q){return"ok"===j.stale||"update_after"===j.stale?("update_after"===j.stale&&e2.nextTick(function(){jQ(q)}),e8(q,j)):jQ(q).then(function(){return e8(q,j)})})})}function dQ(g){this.status=400,this.name="query_parse_error",this.message=g,this.error=!0;try{Error.captureStackTrace(this,dQ)}catch(h){}}function fD(g){this.status=500,this.name="invalid_value",this.message=g,this.error=!0;try{Error.captureStackTrace(this,fD)}catch(h){}}function eA(g){return d3(jL(g))}function eH(j,l,h){function n(o){try{return dZ(o)}catch(q){var p=cv(dm,"Attachment is not a valid base64 string");return{error:p}}}function g(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=n(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===l?q.data=cH(o,q.content_type):"base64"===l?q.data=d3(o):q.data=o,dN(o).then(function(r){q.digest="md5-"+r,p()})}else{bN(q.data,function(r){"binary"===l?q.data=jL(r):"base64"===l&&(q.data=eA(r)),dN(r).then(function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function k(){m++,j.length===m&&(i?h(i):h())}if(!j.length){return h()}var i,m=0;j.forEach(function(r){function p(u){i=u,q++,q===s.length&&k()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return k()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&g(r.data._attachments[o],p)}})}function bY(g,h){return g.pos-h.pos}function bs(i,l,k){for(var h,j=0,g=i.length;g>j;){h=j+g>>>1,k(i[h],l)<0?j=h+1:g=h}return j}function eX(j,h,g){var i=bs(j,h,g);j.splice(i,0,h)}function cW(j,l){for(var h,n,g=l,k=j.length;k>g;g++){var i=j[g],m=[i.id,i.opts,[]];n?(n[2].push(m),n=m):h=n=m}return h}function df(g,h){return g[0]<h[0]?-1:1}function bO(o,h){for(var l=[{tree1:o,tree2:h}],j=!1;l.length>0;){var k=l.pop(),m=k.tree1,g=k.tree2;(m[1].status||g[1].status)&&(m[1].status="available"===m[1].status||"available"===g[1].status?"available":"missing");for(var i=0;i<g[2].length;i++){if(m[2][0]){for(var n=!1,p=0;p<m[2].length;p++){m[2][p][0]===g[2][i][0]&&(l.push({tree1:m[2][p],tree2:g[2][i]}),n=!0)}n||(j="new_branch",eX(m[2],g[2][i],df))}else{j="new_leaf",m[2][0]=g[2][i]}}}return{conflicts:j,tree:o}}function jU(m,y,z){var v,k=[],o=!1,w=!1;if(!m.length){return{tree:[y],conflicts:"new_leaf"}}for(var A=0,j=m.length;j>A;A++){var x=m[A];if(x.pos===y.pos&&x.ids[0]===y.ids[0]){v=bO(x.ids,y.ids),k.push({pos:x.pos,ids:v.tree}),o=o||v.conflicts,w=!0}else{if(z!==!0){var s=x.pos<y.pos?x:y,n=x.pos<y.pos?y:x,u=n.pos-s.pos,p=[],i=[];for(i.push({ids:s.ids,diff:u,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],q=0,r=g.length;r>q;q++){i.push({ids:g[q],diff:h.diff-1,parent:h.ids,parentIdx:q})}}else{h.ids[0]===n.ids[0]&&p.push(h)}}var l=p[0];l?(v=bO(l.ids,n.ids),l.parent[2][l.parentIdx]=v.tree,k.push({pos:s.pos,ids:s.ids}),o=o||v.conflicts,w=!0):k.push(x)}else{k.push(x)}}}return w||k.push(y),k.sort(bY),{tree:k,conflicts:o||"internal_node"}}function dk(r,p){for(var g,q=eE(r),s={},i=0,n=q.length;n>i;i++){for(var j=q[i],o=j.ids,m=Math.max(0,o.length-p),k={pos:j.pos+m,ids:cW(o,m)},h=0;m>h;h++){var l=j.pos+h+"-"+o[h].id;s[l]=!0}g=g?jU(g,k,!0).tree:[k]}return cK(g,function(w,v,u){delete s[v+"-"+u]}),{tree:g,revs:Object.keys(s)}}function e6(h,k,j){var g=jU(h,k),i=dk(g.tree,j);return{tree:i.tree,stemmedRevs:i.revs,conflicts:g.conflicts}}function eC(o,h){for(var l,j=o.slice(),k=h.split("-"),m=parseInt(k[0],10),g=k[1];l=j.pop();){if(l.pos===m&&l.ids[0]===g){return !0}for(var i=l.ids[2],n=0,p=i.length;p>n;n++){j.push({pos:l.pos+1,ids:i[n]})}}return !1}function bL(B,g,m,k,w,v,s,p){if(eC(g.rev_tree,m.metadata.rev)){return k[w]=m,v()}var l=g.winningRev||dK(g),r="deleted" in g?g.deleted:c3(g,l),A="deleted" in m.metadata?m.metadata.deleted:c3(m.metadata),i=/^1-/.test(m.metadata.rev);if(r&&!A&&p&&i){var q=m.data;q._rev=l,q._id=m.metadata.id,m=bP(q,p)}var x=e6(g.rev_tree,m.metadata.rev_tree[0],B),z=p&&(r&&A||!r&&"new_leaf"!==x.conflicts||r&&!A&&"new_branch"===x.conflicts);if(z){var j=cv(aO);return k[w]=j,v()}var n=m.metadata.rev;m.metadata.rev_tree=x.tree,m.stemmedRevs=x.stemmedRevs||[],g.rev_map&&(m.metadata.rev_map=g.rev_map);var y,h=dK(m.metadata),o=c3(m.metadata,h),u=r===o?0:o>r?-1:1;y=n===h?o:c3(m.metadata,n),s(m,h,o,y,!0,u,w,v)}function bx(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function b3(m,h,g,o,q,l,u,i,v){function s(C,B,x){var D=dK(C.metadata),z=c3(C.metadata,D);if("was_delete" in i&&z){return l[B]=cv(fH,"deleted"),x()}var A=k&&bx(C);if(A){var w=cv(aO);return l[B]=w,x()}var y=z?0:1;u(C,D,z,z,!1,y,B,x)}function n(){++j===r&&v&&v()}m=m||1000;var k=i.new_edits,p=new dE.Map,j=0,r=h.length;h.forEach(function(w,y){if(w._id&&fF(w._id)){var z=w._deleted?"_removeLocal":"_putLocal";return void g[z](w,{ctx:q},function(B,A){l[y]=B||A,n()})}var x=w.metadata.id;p.has(x)?(r--,p.get(x).push([w,y])):p.set(x,[[w,y]])}),p.forEach(function(z,x){function w(){++y<z.length?A():n()}function A(){var C=z[y],E=C[0],D=C[1];if(o.has(x)){bL(m,o.get(x),E,l,D,w,u,k)}else{var B=e6([],E.metadata.rev_tree[0],m);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],s(E,D,w)}}var y=0;A()})}function dc(g){var h=[];return cK(g.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(h.push(i+"-"+k),j.status="missing")}),h}function aW(g){try{return JSON.parse(g)}catch(h){return bM.parse(g)}}function bS(g){return g.length<50000?JSON.parse(g):aW(g)}function dL(g){try{return JSON.stringify(g)}catch(h){return bM.stringify(g)}}function bg(h,k,j,g){try{h.apply(k,j)}catch(i){g.emit("error",i)}}function cx(g){if(!cL.running&&cL.queue.length){cL.running=!0;var h=cL.queue.shift();h.action(function(i,j){bg(h.callback,this,[i,j],g),cL.running=!1,e2.nextTick(function(){cx(g)})})}}function jH(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(cv(cm,i,h.type))}}function ap(h,g,i){return{data:dL(h),winningRev:g,deletedOrLocal:i?"1":"0",seq:h.seq,id:h.id}}function jG(g){if(!g){return null}var h=bS(g.data);return h.winningRev=g.winningRev,h.deleted="1"===g.deletedOrLocal,h.seq=g.seq,h}function bm(g){if(!g){return g}var h=g._doc_id_rev.lastIndexOf(":");return g._id=g._doc_id_rev.substring(0,h-1),g._rev=g._doc_id_rev.substring(h+1),delete g._doc_id_rev,g}function ec(j,h,g,i){g?i(j?"string"!=typeof j?j:f1(j,h):cD([""],{type:h})):j?"string"!=typeof j?aY(j,function(k){i(d3(k))}):i(j):i("")}function cB(j,l,h,n){function g(){++m===i.length&&n&&n()}function k(s,q){var r=s._attachments[q],p=r.digest,o=h.objectStore(eN).get(p);o.onsuccess=function(u){r.body=u.target.result.body,g()}}var i=Object.keys(j._attachments||{});if(!i.length){return n&&n()}var m=0;i.forEach(function(o){l.attachments&&l.include_docs?k(j,o):(j._attachments[o].stub=!0,g())})}function dp(g,h){return aP.all(g.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return aP.all(j.map(function(k){var m=i.doc._attachments[k];if("body" in m){var n=m.body,l=m.content_type;return new aP(function(o){ec(n,l,h,function(p){i.doc._attachments[k]=ag.extend(cl(m,["digest","content_type"]),{data:p}),o()})})}}))}}))}function bd(o,h,l){function j(){p--,p||k()}function k(){m.length&&m.forEach(function(q){var r=n.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||i["delete"](q)}})}var m=[],g=l.objectStore(kj),i=l.objectStore(eN),n=l.objectStore(bF),p=o.length;o.forEach(function(s){var r=g.index("_doc_id_rev"),q=h+"::"+s;r.getKey(q).onsuccess=function(v){var u=v.target.result;if("number"!=typeof u){return j()}g["delete"](u);var w=n.index("seq").openCursor(IDBKeyRange.only(u));w.onsuccess=function(z){var y=z.target.result;if(y){var x=y.value.digestSeq.split("::")[0];m.push(x),n["delete"](y.primaryKey),y["continue"]()}else{j()}}}})}function dy(j,h,g){try{return{txn:j.transaction(h,g)}}catch(i){return{error:i}}}function eK(h,w,x,K,s,q,L){function G(){var Q=[cJ,kj,eN,j5,bF],P=dy(s,Q,"readwrite");return P.error?L(P.error):(y=P.txn,y.onabort=jH(L),y.ontimeout=jH(L),y.oncomplete=g,D=y.objectStore(cJ),p=y.objectStore(kj),I=y.objectStore(eN),m=y.objectStore(bF),void i(function(R){return R?(j=!0,L(R)):void B()}))}function E(){b3(h.revs_limit,o,K,k,y,l,z,x)}function B(){function Q(){++S===o.length&&E()}function V(X){var W=jG(X.target.result);W&&k.set(W.id,W),Q()}if(o.length){for(var S=0,P=0,R=o.length;R>P;P++){var U=o[P];if(U._id&&fF(U._id)){Q()}else{var T=D.get(U.metadata.id);T.onsuccess=V}}}}function g(){j||(q.notify(K._meta.name),K._meta.docCount+=r,L(null,l))}function N(Q,P){var R=I.get(Q);R.onsuccess=function(T){if(T.target.result){P()}else{var S=cv(dY,"unknown stub attachment with digest "+Q);S.status=412,P(S)}}}function i(R){function P(){++S===T.length&&R(Q)}var T=[];if(o.forEach(function(U){U.data&&U.data._attachments&&Object.keys(U.data._attachments).forEach(function(W){var V=U.data._attachments[W];V.stub&&T.push(V.digest)})}),!T.length){return R()}var Q,S=0;T.forEach(function(U){N(U,function(V){V&&!Q&&(Q=V),P()})})}function z(V,P,T,R,S,U,X,Q){r+=U,V.metadata.winningRev=P,V.metadata.deleted=T;var Y=V.data;Y._id=V.metadata.id,Y._rev=V.metadata.rev,R&&(Y._deleted=!0);var W=Y._attachments&&Object.keys(Y._attachments).length;return W?O(V,P,T,S,X,Q):void M(V,P,T,S,X,Q)}function F(Q){var P=dc(Q.metadata);bd(P,Q.metadata.id,y)}function M(U,Z,Q,P,S,X){function ae(an){P&&K.auto_compaction?F(U):U.stemmedRevs.length&&bd(U.stemmedRevs,U.metadata.id,y),R.seq=an.target.result,delete R.rev;var ai=ap(R,Z,Q),ao=D.put(ai);ao.onsuccess=W}function Y(ai){ai.preventDefault(),ai.stopPropagation();var ao=p.index("_doc_id_rev"),an=ao.getKey(T._doc_id_rev);an.onsuccess=function(at){var ar=p.put(T,at.target.result);ar.onsuccess=ae}}function W(){l[S]={ok:!0,id:R.id,rev:Z},k.set(U.metadata.id,U.metadata),H(U,R.seq,X)}var T=U.data,R=U.metadata;T._doc_id_rev=R.id+"::"+R.rev,delete T._id,delete T._rev;var V=p.put(T);V.onsuccess=ae,V.onerror=Y}function O(X,Q,U,S,T,V){function Z(){Y===W.length&&M(X,Q,U,S,T,V)}function R(){Y++,Z()}var P=X.data,Y=0,W=Object.keys(P._attachments);W.forEach(function(an){var ae=X.data._attachments[an];if(ae.stub){Y++,Z()}else{var ai=ae.data;delete ae.data,ae.revpos=parseInt(Q,10);var ao=ae.digest;A(ao,ai,R)}})}function H(T,Q,V){function S(){++P===W.length&&V()}function U(Z){var Y=T.data._attachments[Z].digest,X=m.put({seq:Q,digestSeq:Y+"::"+Q});X.onsuccess=S,X.onerror=function(ae){ae.preventDefault(),ae.stopPropagation(),S()}}var P=0,W=Object.keys(T.data._attachments||{});if(!W.length){return V()}for(var R=0;R<W.length;R++){U(W[R])}}function A(R,P,S){var Q=I.count(R);Q.onsuccess=function(T){var U=T.target.result;if(U){return S()}var W={digest:R,body:P},V=I.put(W);V.onsuccess=S}}for(var y,D,p,I,m,v,o=w.docs,r=0,n=0,J=o.length;J>n;n++){var C=o[n];C._id&&fF(C._id)||(C=o[n]=bP(C,x.new_edits),C.error&&!v&&(v=C))}if(v){return L(v)}var l=new Array(o.length),k=new dE.Map,j=!1,u=K._meta.blobSupport?"blob":"base64";eH(o,u,function(P){return P?L(P):void G()})}function bD(i,l,k,h,j){try{if(i&&l){return j?IDBKeyRange.bound(l,i,!k,!1):IDBKeyRange.bound(i,l,!1,!k)}if(i){return j?IDBKeyRange.upperBound(i):IDBKeyRange.lowerBound(i)}if(l){return j?IDBKeyRange.lowerBound(l,!k):IDBKeyRange.upperBound(l,!k)}if(h){return IDBKeyRange.only(h)}}catch(g){return{error:g}}return null}function e1(j,h,g,i){return"DataError"===g.name&&0===g.code?i(null,{total_rows:j._meta.docCount,offset:h.skip,rows:[]}):void i(cv(cm,g.name,g.message))}function j7(i,l,k,h){function j(A,J){function H(N,O,L){var M=N.id+"::"+L;D.get(M).onsuccess=function(P){O.doc=bm(P.target.result),A.conflicts&&(O.doc._conflicts=dz(N)),cB(O.doc,A,I)}}function v(P,M,L){var O={id:L.id,key:L.id,value:{rev:M}},N=L.deleted;if("ok"===A.deleted){K.push(O),N?(O.value.deleted=!0,O.doc=null):A.include_docs&&H(L,O,M)}else{if(!N&&u--<=0&&(K.push(O),A.include_docs&&H(L,O,M),0===--q)){return}}P["continue"]()}function s(L){m=l._meta.docCount;var O=L.target.result;if(O){var N=jG(O.value),M=N.winningRev;v(O,M,N)}}function G(){J(null,{total_rows:m,offset:A.skip,rows:K})}function F(){A.attachments?dp(K,A.binary).then(G):G()}var C="startkey" in A?A.startkey:!1,B="endkey" in A?A.endkey:!1,n="key" in A?A.key:!1,u=A.skip||0,q="number"==typeof A.limit?A.limit:-1,r=A.inclusive_end!==!1,y="descending" in A&&A.descending?"prev":null,z=bD(C,B,r,n,y);if(z&&z.error){return e1(l,A,z.error,J)}var E=[cJ,kj];A.attachments&&E.push(eN);var o=dy(k,E,"readonly");if(o.error){return J(o.error)}var I=o.txn,p=I.objectStore(cJ),x=I.objectStore(kj),w=y?p.openCursor(z,y):p.openCursor(z),D=x.index("_doc_id_rev"),K=[],m=0;I.oncomplete=F,w.onsuccess=s}function g(n,m){return 0===n.limit?m(null,{total_rows:l._meta.docCount,offset:n.skip,rows:[]}):void j(n,m)}g(i,h)}function cT(g){return new aP(function(h){var i=cD([""]);g.objectStore(dV).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function j8(g){bG()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):cd()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function fK(){aQ.EventEmitter.call(this),this._listeners={},j8(this)}function al(h,g){var i=this;cL.queue.push({action:function(j){aG(i,h,j)},callback:g}),cx(i.constructor)}function aG(g,q,j){function l(w){var v=w.createObjectStore(cJ,{keyPath:"id"});w.createObjectStore(kj,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),w.createObjectStore(eN,{keyPath:"digest"}),w.createObjectStore(cI,{keyPath:"id",autoIncrement:!1}),w.createObjectStore(dV),v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),w.createObjectStore(j5,{keyPath:"_id"});var x=w.createObjectStore(bF,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function n(w,v){var x=w.objectStore(cJ);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(B){var z=B.target.result;if(z){var A=z.value,y=c3(A);A.deletedOrLocal=y?"1":"0",x.put(A),z["continue"]()}else{v()}}}function o(v){v.createObjectStore(j5,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function p(y,w){var z=y.objectStore(j5),x=y.objectStore(cJ),v=y.objectStore(kj),A=x.openCursor();A.onsuccess=function(K){var H=K.target.result;if(H){var C=H.value,E=C.id,D=fF(E),M=dK(C);if(D){var J=E+"::"+M,G=E+"::",L=E+"::~",I=v.index("_doc_id_rev"),F=IDBKeyRange.bound(G,L,!1,!1),B=I.openCursor(F);B.onsuccess=function(N){if(B=N.target.result){var O=B.value;O._doc_id_rev===J&&z.put(O),v["delete"](B.primaryKey),B["continue"]()}else{x["delete"](H.primaryKey),H["continue"]()}}}else{H["continue"]()}}else{w&&w()}}}function m(w){var v=w.createObjectStore(bF,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function u(y,w){var z=y.objectStore(kj),x=y.objectStore(eN),v=y.objectStore(bF),A=x.count();A.onsuccess=function(B){var C=B.target.result;return C?void (z.openCursor().onsuccess=function(M){var I=M.target.result;if(!I){return w()}for(var H=I.value,K=I.primaryKey,E=Object.keys(H._attachments||{}),G={},F=0;F<E.length;F++){var D=H._attachments[E[F]];G[D.digest]=!0}var L=Object.keys(G);for(F=0;F<L.length;F++){var J=L[F];v.put({seq:K,digestSeq:J+"::"+K})}I["continue"]()}):w()}}function h(v){function x(A){return A.data?jG(A):(A.deleted="1"===A.deletedOrLocal,A)}var y=v.objectStore(kj),z=v.objectStore(cJ),w=z.openCursor();w.onsuccess=function(C){function D(){var H=A.id+"::",F=A.id+"::",G=y.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return A.seq=I,B()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function B(){var G=ap(A,A.winningRev,A.deleted),F=z.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var A=x(E.value);return A.winningRev=A.winningRev||dK(A),A.seq?B():void D()}}}var s=q.name,k=null;g._meta=null,g.type=function(){return"idb"},g._id=aH(function(v){v(null,g._meta.instanceId)}),g._bulkDocs=function(x,v,w){eK(q,x,v,g,k,jK,w)},g._get=function(v,y,D){function B(){D(w,{doc:C,metadata:A,ctx:z})}var C,A,w,z=y.ctx;if(!z){var x=dy(k,[cJ,kj,eN],"readonly");if(x.error){return D(x.error)}z=x.txn}z.objectStore(cJ).get(v).onsuccess=function(E){if(A=jG(E.target.result),!A){return w=cv(fH,"missing"),B()}if(c3(A)&&!y.rev){return w=cv(fH,"deleted"),B()}var G=z.objectStore(kj),H=y.rev||A.winningRev,F=A.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return C=I.target.result,C&&(C=bm(C)),C?void B():(w=cv(fH,"missing"),B())}}},g._getAttachment=function(A,y,w){var B;if(y.ctx){B=y.ctx}else{var v=dy(k,[cJ,kj,eN],"readonly");if(v.error){return w(v.error)}B=v.txn}var x=A.digest,z=A.content_type;B.objectStore(eN).get(x).onsuccess=function(C){var D=C.target.result.body;ec(D,z,y.binary,function(E){w(null,E)})}},g._info=function(y){if(null===k||!dU.has(s)){var A=new Error("db isn't open");return A.id="idbNull",y(A)}var B,w,x=dy(k,[kj],"readonly");if(x.error){return y(x.error)}var z=x.txn,v=z.objectStore(kj).openCursor(null,"prev");v.onsuccess=function(D){var C=D.target.result;B=C?C.key:0,w=g._meta.docCount},z.oncomplete=function(){y(null,{doc_count:w,update_seq:B,idb_attachment_format:g._meta.blobSupport?"binary":"base64"})}},g._allDocs=function(v,w){j7(v,g,k,w)},g._changes=function(E){function B(N){function S(){return R.seq!==T?N["continue"]():(A=T,R.winningRev===O._rev?Q(O):void P())}function P(){var U=O._id+"::"+R.winningRev,V=z.get(U);V.onsuccess=function(W){Q(bm(W.target.result))}}function Q(V){var W=E.processChange(V,R,E);W.seq=R.seq;var U=D(W);return"object"==typeof U?E.complete(U):(U&&(J++,x&&K.push(W),E.attachments&&E.include_docs?cB(V,E,L,function(){dp([W],E.binary).then(function(){E.onChange(W)})}):E.onChange(W)),void (J!==w&&N["continue"]()))}var O=bm(N.value),T=N.key;if(F&&!F.has(O._id)){return N["continue"]()}var R;return(R=y.get(O._id))?S():void (v.get(O._id).onsuccess=function(U){R=jG(U.target.result),y.set(O._id,R),S()})}function G(O){var N=O.target.result;N&&B(N)}function I(){var O=[cJ,kj];E.attachments&&O.push(eN);var N=dy(k,O,"readonly");if(N.error){return E.complete(N.error)}L=N.txn,L.onabort=jH(E.complete),L.oncomplete=M,C=L.objectStore(kj),v=L.objectStore(cJ),z=C.index("_doc_id_rev");var P;P=E.descending?C.openCursor(null,"prev"):C.openCursor(IDBKeyRange.lowerBound(E.since,!0)),P.onsuccess=G}function M(){function N(){E.complete(null,{results:K,last_seq:A})}!E.continuous&&E.attachments?dp(K).then(N):N()}if(E=bH(E),E.continuous){var H=s+":"+cV();return jK.addListener(s,H,g,E),jK.notify(s),{cancel:function(){jK.removeListener(s,H)}}}var F=E.doc_ids&&new dE.Set(E.doc_ids);E.since=E.since||0;var A=E.since,w="limit" in E?E.limit:-1;0===w&&(w=1);var x;x="return_docs" in E?E.return_docs:"returnDocs" in E?E.returnDocs:!0;var L,C,v,z,K=[],J=0,D=fN(E),y=new dE.Map;I()},g._close=function(v){return null===k?v(cv(dH)):(k.close(),dU["delete"](s),k=null,void v())},g._getRevisionTree=function(v,x){var y=dy(k,[cJ],"readonly");if(y.error){return x(y.error)}var z=y.txn,w=z.objectStore(cJ).get(v);w.onsuccess=function(B){var A=jG(B.target.result);A?x(null,A.rev_tree):x(cv(fH))}},g._doCompaction=function(A,y,w){var B=[cJ,kj,eN,bF],v=dy(k,B,"readwrite");if(v.error){return w(v.error)}var x=v.txn,z=x.objectStore(cJ);z.get(A).onsuccess=function(E){var C=jG(E.target.result);cK(C.rev_tree,function(I,K,H,J,G){var L=K+"-"+H;-1!==y.indexOf(L)&&(G.status="missing")}),bd(y,A,x);var D=C.winningRev,F=C.deleted;x.objectStore(cJ).put(ap(C,D,F))},x.onabort=jH(w),x.oncomplete=function(){w()}},g._getLocal=function(v,x){var y=dy(k,[j5],"readonly");if(y.error){return x(y.error)}var z=y.txn,w=z.objectStore(j5).get(v);w.onerror=jH(x),w.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,x(null,A)):x(cv(fH))}},g._putLocal=function(z,D,y){"function"==typeof D&&(y=D,D={}),delete z._revisions;var w=z._rev,x=z._id;w?z._rev="0-"+(parseInt(w.split("-")[1],10)+1):z._rev="0-1";var v,B=D.ctx;if(!B){var E=dy(k,[j5],"readwrite");if(E.error){return y(E.error)}B=E.txn,B.onerror=jH(y),B.oncomplete=function(){v&&y(null,v)}}var C,A=B.objectStore(j5);w?(C=A.get(x),C.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===w){var F=A.put(z);F.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)}}else{y(cv(aO))}}):(C=A.add(z),C.onerror=function(F){y(cv(aO)),F.preventDefault(),F.stopPropagation()},C.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)})},g._removeLocal=function(v,y,D){"function"==typeof y&&(D=y,y={});var B=y.ctx;if(!B){var C=dy(k,[j5],"readwrite");if(C.error){return D(C.error)}B=C.txn,B.oncomplete=function(){A&&D(null,A)}}var A,w=v._id,z=B.objectStore(j5),x=z.get(w);x.onerror=jH(D),x.onsuccess=function(F){var E=F.target.result;E&&E._rev===v._rev?(z["delete"](w),A={ok:!0,id:w,rev:"0-0"},y.ctx&&D(null,A)):D(cv(fH))}},g._destroy=function(y,w){jK.removeAllListeners(s);var v=aD.get(s);v&&v.result&&(v.result.close(),dU["delete"](s));var x=indexedDB.deleteDatabase(s);x.onsuccess=function(){aD["delete"](s),cd()&&s in localStorage&&delete localStorage[s],w(null,{ok:!0})},x.onerror=jH(w)};var i=dU.get(s);if(i){return k=i.idb,g._meta=i.global,void e2.nextTick(function(){j(null,g)})}var r;r=q.storage?aR(s,q.storage):indexedDB.open(s,eT),aD.set(s,r),r.onupgradeneeded=function(w){function v(){var B=x[A-1];A++,B&&B(z,v)}var y=w.target.result;if(w.oldVersion<1){return l(y)}var z=w.currentTarget.transaction;w.oldVersion<3&&o(y),w.oldVersion<4&&m(y);var x=[n,p,u,h],A=w.oldVersion;v()},r.onsuccess=function(x){k=x.target.result,k.onversionchange=function(){k.close(),dU["delete"](s)},k.onabort=function(B){console.error("Database has a global failure",B.target.error),k.close(),dU["delete"](s)};var w=k.transaction([cI,dV,cJ],"readwrite"),v=w.objectStore(cI).get(cI),y=null,z=null,A=null;v.onsuccess=function(D){var B=function(){null!==y&&null!==z&&null!==A&&(g._meta={name:s,instanceId:A,blobSupport:y,docCount:z},dU.set(s,{idb:k,global:g._meta}),j(null,g))},E=D.target.result||{id:cI};s+"_id" in E?(A=E[s+"_id"],B()):(A=cV(),E[s+"_id"]=A,w.objectStore(cI).put(E).onsuccess=function(){B()}),dF||(dF=cT(w)),dF.then(function(F){y=F,B()});var C=w.objectStore(cJ).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){z=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";console.error(v),j(cv(cm,v))}}function aR(h,g){try{return indexedDB.open(h,{version:eT,storage:g})}catch(i){return indexedDB.open(h,eT)}}function dq(g){return decodeURIComponent(window.escape(g))}function bE(g){return 65>g?g-48:g-55}function eg(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(bE(j.charCodeAt(h++))<<4|bE(j.charCodeAt(h++)))}return i}function fM(j,h,g){for(var i="";g>h;){i+=String.fromCharCode(bE(j.charCodeAt(h+2))<<12|bE(j.charCodeAt(h+3))<<8|bE(j.charCodeAt(h))<<4|bE(j.charCodeAt(h+1))),h+=4}return i}function eh(g,h){return"UTF-8"===h?dq(eg(g,0,g.length)):fM(g,0,g.length)}function cf(g){return"'"+g+"'"}function b0(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function e7(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function bB(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function f5(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function aV(g){return delete g._id,delete g._rev,JSON.stringify(g)}function cq(h,g,i){return h=JSON.parse(h),h._id=g,h._rev=i,h}function fJ(g){for(var h="(";g--;){h+="?",g&&(h+=",")}return h+")"}function fG(h,k,j,g,i){return"SELECT "+h+" FROM "+("string"==typeof k?k:k.join(" JOIN "))+(j?" ON "+j:"")+(g?" WHERE "+("string"==typeof g?g:g.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function bC(k,i,g){function j(){++m===k.length&&l()}function l(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+j0+" WHERE seq IN "+fJ(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+j0+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(u){var v="SELECT digest FROM "+j0+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";u.executeSql(v,s,function(x,y){for(var w=new dE.Set,z=0;z<y.rows.length;z++){w.add(y.rows.item(z).digest)}s.forEach(function(A){w.has(A)||(x.executeSql("DELETE FROM "+j0+" WHERE digest=?",[A]),x.executeSql("DELETE FROM "+bv+" WHERE digest=?",[A]))})})})}})}}if(k.length){var m=0,h=[];k.forEach(function(n){var o="SELECT seq FROM "+dO+" WHERE doc_id=? AND rev=?";g.executeSql(o,[i,n],function(q,p){if(!p.rows.length){return j()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+dO+" WHERE seq=?",[r],j)})})}}function bk(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(cv(aI,j,i))}}function ef(g){if("size" in g){return 1000000*g.size}var h="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return h?5000000:1}function jS(h,g){try{return{db:h(g)}}catch(i){return{error:i}}}function e(h){var g=cR.get(h.name);if(!g){var i=b0();g=jS(i,h),cR.set(h.name,g),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return g}function eU(s,q,g,m,n,x,h){function k(){return r?h(r):(x.notify(m._name),m._docCount=-1,void h(null,A))}function l(E,D){var F="SELECT count(*) as cnt FROM "+bv+" WHERE digest=?";p.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=cv(dY,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function u(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){l(I,function(J){J&&!E&&(E=J),D()})})}function j(M,F,P,K,I,R,H,E){function O(){function Z(ar,a0){function at(){return ++ae===ao.length&&a0(),!1}function ai(a1){var a2="INSERT INTO "+j0+" (digest, seq) VALUES (?,?)",a3=[Y._attachments[a1].digest,ar];p.executeSql(a2,a3,at,at)}var ae=0,ao=Object.keys(Y._attachments||{});if(!ao.length){return a0()}for(var an=0;an<ao.length;an++){ai(ao[an])}}var Y=M.data,T=K?1:0,W=Y._id,S=Y._rev,U=aV(Y),V="INSERT INTO "+dO+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",X=[W,S,U,T];p.executeSql(V,X,function(an,ai){var ae=ai.insertId;Z(ae,function(){N(an,ae)})},function(){var ae=fG("seq",dO,null,"doc_id=? AND rev=?");return p.executeSql(ae,[W,S],function(ar,ai){var an=ai.rows.item(0).seq,ao="UPDATE "+dO+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",at=[U,T,W,S];ar.executeSql(ao,at,function(a0){Z(an,function(){N(a0,an)})})}),!1})}function L(S){J||(S?(J=S,E(J)):D===Q.length&&O())}function G(S){D++,L(S)}function N(U,S){var V=M.metadata.id;I&&m.auto_compaction?bC(dc(M.metadata),V,U):M.stemmedRevs.length&&bC(M.stemmedRevs,V,U),M.metadata.seq=S,delete M.metadata.rev;var T=I?"UPDATE "+c9+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+dO+" WHERE doc_id="+c9+".id AND rev=?) WHERE id=?":"INSERT INTO "+c9+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",W=dL(M.metadata),X=I?[W,S,F,V]:[V,S,S,W];U.executeSql(T,X,function(){A[H]={ok:!0,id:M.metadata.id,rev:F},w.set(V,M.metadata),E()})}var J=null,D=0;M.data._id=M.metadata.id,M.data._rev=M.metadata.rev;var Q=Object.keys(M.data._attachments||{});K&&(M.data._deleted=!0),Q.forEach(function(S){var U=M.data._attachments[S];if(U.stub){D++,L()}else{var V=U.data;delete U.data,U.revpos=parseInt(F,10);var T=U.digest;B(T,V,G)}}),Q.length||O()}function z(){b3(s.revs_limit,o,m,w,p,A,j,g)}function i(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&fF(G._id)){return D()}var H=G.metadata.id;p.executeSql("SELECT json FROM "+c9+" WHERE id = ?",[H],function(J,I){if(I.rows.length){var K=bS(I.rows.item(0).json);w.set(H,K)}D()})})}function B(F,D,G){var E="SELECT digest FROM "+bv+" WHERE digest=?";p.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+bv+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,bB(D)],function(){G()},function(){return G(),!1}))})}var y=g.new_edits,C=q.docs,o=C.map(function(E){if(E._id&&fF(E._id)){return E}var D=bP(E,y);return D}),v=o.filter(function(D){return D.error});if(v.length){return h(v[0])}var p,r,A=new Array(o.length),w=new dE.Map;eH(o,"binary",function(D){return D?h(D):void n.transaction(function(E){p=E,u(function(F){F?r=F:i(z)})},bk(h),k)})}function aA(j,n,k,i,h){function l(){++o===m.length&&h&&h()}function g(r,s){var q=r._attachments[s],p={binary:n.binary,ctx:i};k._getAttachment(q,p,function(v,u){r._attachments[s]=ag.extend(cl(q,["digest","content_type"]),{data:u}),l()})}var m=Object.keys(j._attachments||{});if(!m.length){return h&&h()}var o=0;m.forEach(function(p){n.attachments&&n.include_docs?g(j,p):(j._attachments[p].stub=!0,l())})}function cE(s,g){function i(){cd()&&(window.localStorage["_pouch__websqldb_"+m._name]=!0),g(null,m)}function j(F,E){F.executeSql(cs),F.executeSql("ALTER TABLE "+dO+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(am),F.executeSql("ALTER TABLE "+c9+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+c9+" (local, id)");var G="SELECT "+c9+".winningseq AS seq, "+c9+".json AS metadata FROM "+dO+" JOIN "+c9+" ON "+dO+".seq = "+c9+".winningseq";F.executeSql(G,[],function(H,L){for(var O=[],J=[],K=0;K<L.rows.length;K++){var M=L.rows.item(K),N=M.seq,I=JSON.parse(M.metadata);c3(I)&&O.push(N),fF(I.id)&&J.push(I.id)}H.executeSql("UPDATE "+c9+"SET local = 1 WHERE id IN "+fJ(J.length),J,function(){H.executeSql("UPDATE "+dO+" SET deleted = 1 WHERE seq IN "+fJ(O.length),O,E)})})})})}function A(F,E){var G="CREATE TABLE IF NOT EXISTS "+cz+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+c9+".id AS id, "+dO+".json AS data FROM "+dO+" JOIN "+c9+" ON "+dO+".seq = "+c9+".winningseq WHERE local = 1";F.executeSql(H,[],function(L,I){function K(){if(!M.length){return E(L)}var O=M.shift(),N=JSON.parse(O.data)._rev;L.executeSql("INSERT INTO "+cz+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+c9+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+dO+" WHERE seq=?",[O.seq],function(){K()})})})}for(var M=[],J=0;J<I.rows.length;J++){M.push(I.rows.item(J))}K()})})}function B(G,E){function H(J){function I(){if(!J.length){return E(G)}var K=J.shift(),O=eh(K.hex,x),M=O.lastIndexOf("::"),P=O.substring(0,M),N=O.substring(M+2),L="UPDATE "+dO+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(L,[P,N,O],function(){I()})}I()}var F="ALTER TABLE "+dO+" ADD COLUMN doc_id";G.executeSql(F,[],function(J){var I="ALTER TABLE "+dO+" ADD COLUMN rev";J.executeSql(I,[],function(K){K.executeSql(jF,[],function(M){var L="SELECT hex(doc_id_rev) as hex FROM "+dO;M.executeSql(L,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function r(G,E){function H(I){var J="SELECT COUNT(*) AS cnt FROM "+bv;I.executeSql(J,[],function(P,L){function O(){var Q=fG(kc+", "+c9+".id AS id",[c9,dO],bV,null,c9+".id ");Q+=" LIMIT "+M+" OFFSET "+N,N+=M,P.executeSql(Q,[],function(ai,T){function W(at,ar){var ao=V[at]=V[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!T.rows.length){return E(ai)}for(var V={},an=0;an<T.rows.length;an++){for(var S=T.rows.item(an),R=cq(S.data,S.id,S.rev),X=Object.keys(R._attachments||{}),Z=0;Z<X.length;Z++){var U=R._attachments[X[Z]];W(U.digest,S.seq)}}var Y=[];if(Object.keys(V).forEach(function(ar){var ao=V[ar];ao.forEach(function(at){Y.push([ar,at])})}),!Y.length){return O()}var ae=0;Y.forEach(function(ao){var ar="INSERT INTO "+j0+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++ae===Y.length&&O()})})})}var K=L.rows.item(0).cnt;if(!K){return E(P)}var N=0,M=10;O()})}var F="CREATE TABLE IF NOT EXISTS "+j0+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(bi,[],function(J){J.executeSql(b1,[],H)})})}function h(F,E){var G="ALTER TABLE "+bv+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function y(F,E){var G="ALTER TABLE "+c9+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(H){var I="UPDATE "+c9+" SET max_seq=(SELECT MAX(seq) FROM "+dO+" WHERE doc_id=id)";H.executeSql(I,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+c9+" (max_seq)";J.executeSql(K,[],E)})})}function v(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(H,I){var G=I.rows.item(0).hex;x=2===G.length?"UTF-8":"UTF-16",E()})}function w(){for(;q.length>0;){var E=q.pop();E(null,D)}}function C(I,E){if(0===E){var M="CREATE TABLE IF NOT EXISTS "+bb+" (dbid, db_version INTEGER)",J="CREATE TABLE IF NOT EXISTS "+bv+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",H="CREATE TABLE IF NOT EXISTS "+j0+" (digest, seq INTEGER)",F="CREATE TABLE IF NOT EXISTS "+c9+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",G="CREATE TABLE IF NOT EXISTS "+dO+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",L="CREATE TABLE IF NOT EXISTS "+cz+" (id UNIQUE, rev, json)";I.executeSql(J),I.executeSql(L),I.executeSql(H,[],function(){I.executeSql(b1),I.executeSql(bi)}),I.executeSql(F,[],function(){I.executeSql(cs),I.executeSql(G,[],function(){I.executeSql(am),I.executeSql(jF),I.executeSql(M,[],function(){var Q="INSERT INTO "+bb+" (db_version, dbid) VALUES (?,?)";D=cV();var R=[d9,D];I.executeSql(Q,R,function(){w()})})})})}else{var O=function(){var R=d9>E;R&&I.executeSql("UPDATE "+bb+" SET db_version = "+d9);var Q="SELECT dbid FROM "+bb;I.executeSql(Q,[],function(T,S){D=S.rows.item(0).dbid,w()})},K=[j,A,B,r,h,y,O],N=E,P=function(Q){K[N-1](Q,P),N++};P(I)}}function p(){z.transaction(function(E){v(E,function(){o(E)})},bk(g),i)}function o(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+bb;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+bb,[],function(I,K){var J=K.rows.item(0).db_version;C(I,J)}):H.executeSql("ALTER TABLE "+bb+" ADD COLUMN db_version INTEGER",[],function(){C(H,1)}):C(H,0)})}function n(F,E){if(-1!==m._docCount){return E(m._docCount)}var G=fG("COUNT("+c9+".id) AS 'num'",[c9,dO],bV,dO+".deleted=0");F.executeSql(G,[],function(H,I){m._docCount=I.rows.item(0).num,E(m._docCount)})}var x,m=this,D=null,l=ef(s),q=[];m._docCount=-1,m._name=s.name;var u=ag.extend({},s,{size:l,version:b2}),k=e(u);if(k.error){return bk(g)(k.error)}var z=k.db;"function"!=typeof z.readTransaction&&(z.readTransaction=z.transaction),p(),m.type=function(){return"websql"},m._id=aH(function(E){E(null,D)}),m._info=function(E){z.readTransaction(function(F){n(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+dO;F.executeSql(G,[],function(K,I){var J=I.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:J,sqlite_plugin:z._sqlitePlugin,websql_encoding:x})})})},bk(E))},m._bulkDocs=function(E,G,F){eU(s,E,G,m,z,cj,F)},m._get=function(G,K,E){function L(){E(I,{doc:M,metadata:F,ctx:N})}var M,F,I,N=K.ctx;if(!N){return z.readTransaction(function(O){m._get(G,ag.extend({ctx:O},K),E)})}var J,H;K.rev?(J=fG(kc,[c9,dO],c9+".id="+dO+".doc_id",[dO+".doc_id=?",dO+".rev=?"]),H=[G,K.rev]):(J=fG(kc,[c9,dO],bV,c9+".id=?"),H=[G]),N.executeSql(J,H,function(O,P){if(!P.rows.length){return I=cv(fH,"missing"),L()}var Q=P.rows.item(0);return F=bS(Q.metadata),Q.deleted&&!K.rev?(I=cv(fH,"deleted"),L()):(M=cq(Q.data,F.id,Q.rev),void L())})},m._allDocs=function(O,I){var F,P=[],R="startkey" in O?O.startkey:!1,L="endkey" in O?O.endkey:!1,G="key" in O?O.key:!1,J="descending" in O?O.descending:!1,H="limit" in O?O.limit:-1,E="skip" in O?O.skip:0,N=O.inclusive_end!==!1,K=[],Q=[];if(G!==!1){Q.push(c9+".id = ?"),K.push(G)}else{if(R!==!1||L!==!1){if(R!==!1&&(Q.push(c9+".id "+(J?"<=":">=")+" ?"),K.push(R)),L!==!1){var M=J?">":"<";N&&(M+="="),Q.push(c9+".id "+M+" ?"),K.push(L)}G!==!1&&(Q.push(c9+".id = ?"),K.push(G))}}"ok"!==O.deleted&&Q.push(dO+".deleted = 0"),z.readTransaction(function(S){n(S,function(T){if(F=T,0!==H){var U=fG(kc,[c9,dO],bV,Q,c9+".id "+(J?"DESC":"ASC"));U+=" LIMIT "+H+" OFFSET "+E,S.executeSql(U,K,function(W,Z){for(var Y=0,ao=Z.rows.length;ao>Y;Y++){var V=Z.rows.item(Y),X=bS(V.metadata),an=X.id,ar=cq(V.data,an,V.rev),ai=ar._rev,ae={id:an,key:an,value:{rev:ai}};if(O.include_docs&&(ae.doc=ar,ae.doc._rev=ai,O.conflicts&&(ae.doc._conflicts=dz(X)),aA(ae.doc,O,m,W)),V.deleted){if("ok"!==O.deleted){continue}ae.value.deleted=!0,ae.doc=null}P.push(ae)}})}})},bk(I),function(){I(null,{total_rows:F,offset:O.skip,rows:P})})},m._changes=function(E){function F(){var S=c9+".json AS metadata, "+c9+".max_seq AS maxSeq, "+dO+".json AS winningDoc, "+dO+".rev AS winningRev ",T=c9+" JOIN "+dO,R=c9+".id="+dO+".doc_id AND "+c9+".winningseq="+dO+".seq",Q=["maxSeq > ?"],N=[E.since];E.doc_ids&&(Q.push(c9+".id IN "+fJ(E.doc_ids.length)),N=N.concat(E.doc_ids));var U="maxSeq "+(J?"DESC":"ASC"),O=fG(S,T,R,Q,U),M=fN(E);E.view||E.filter||(O+=" LIMIT "+G);var P=E.since||0;z.readTransaction(function(V){V.executeSql(O,N,function(X,Y){function at(a0){return function(){E.onChange(a0)}}for(var an=0,ai=Y.rows.length;ai>an;an++){var Z=Y.rows.item(an),W=bS(Z.metadata);P=Z.maxSeq;var ae=cq(Z.winningDoc,W.id,Z.winningRev),ar=E.processChange(ae,W,E);ar.seq=Z.maxSeq;var ao=M(ar);if("object"==typeof ao){return E.complete(ao)}if(ao&&(I++,L&&K.push(ar),E.attachments&&E.include_docs?aA(ae,E,m,X,at(ar)):at(ar)()),I===G){break}}})},bk(E.complete),function(){E.continuous||E.complete(null,{results:K,last_seq:P})})}if(E=bH(E),E.continuous){var H=m._name+":"+cV();return cj.addListener(m._name,H,m,E),cj.notify(m._name),{cancel:function(){cj.removeListener(m._name,H)}}}var J=E.descending;E.since=E.since&&!J?E.since:0;var G="limit" in E?E.limit:-1;0===G&&(G=1);var L;L="return_docs" in E?E.return_docs:"returnDocs" in E?E.returnDocs:!0;var K=[],I=0;F()},m._close=function(E){E()},m._getAttachment=function(E,F,H){var J,G=F.ctx,L=E.digest,K=E.content_type,I="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+bv+" WHERE digest=?";G.executeSql(I,[L],function(P,M){var N=M.rows.item(0),O=N.escaped?f5(N.body):eh(N.body,x);J=F.binary?cH(O,K):d3(O),H(null,J)})},m._getRevisionTree=function(F,E){z.readTransaction(function(H){var G="SELECT json AS metadata FROM "+c9+" WHERE id = ?";H.executeSql(G,[F],function(I,J){if(J.rows.length){var K=bS(J.rows.item(0).metadata);E(null,K.rev_tree)}else{E(cv(fH))}})})},m._doCompaction=function(F,E,G){return E.length?void z.transaction(function(I){var H="SELECT json AS metadata FROM "+c9+" WHERE id = ?";I.executeSql(H,[F],function(M,K){var L=bS(K.rows.item(0).metadata);cK(L.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var J="UPDATE "+c9+" SET json = ? WHERE id = ?";M.executeSql(J,[dL(L),F])}),bC(E,F,I)},bk(G),function(){G()}):G()},m._getLocal=function(F,E){z.readTransaction(function(H){var G="SELECT json, rev FROM "+cz+" WHERE id=?";H.executeSql(G,[F],function(L,J){if(J.rows.length){var K=J.rows.item(0),I=cq(K.json,F,K.rev);E(null,I)}else{E(cv(fH))}})})},m._putLocal=function(M,G,K){function I(N){var P,O;L?(P="UPDATE "+cz+" SET rev=?, json=? WHERE id=? AND rev=?",O=[J,F,E,L]):(P="INSERT INTO "+cz+" (id, rev, json) VALUES (?,?,?)",O=[E,J,F]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(H={ok:!0,id:E,rev:J},G.ctx&&K(null,H)):K(cv(aO))},function(){return K(cv(aO)),!1})}"function"==typeof G&&(K=G,G={}),delete M._revisions;var J,L=M._rev,E=M._id;J=L?M._rev="0-"+(parseInt(L.split("-")[1],10)+1):M._rev="0-1";var H,F=aV(M);G.ctx?I(G.ctx):z.transaction(I,bk(K),function(){H&&K(null,H)})},m._removeLocal=function(G,E,I){function F(L){var K="DELETE FROM "+cz+" WHERE id=? AND rev=?",J=[G._id,G._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(H={ok:!0,id:G._id,rev:"0-0"},void (E.ctx&&I(null,H))):I(cv(fH))})}"function"==typeof E&&(I=E,E={});var H;E.ctx?F(E.ctx):z.transaction(F,bk(I),function(){H&&I(null,H)})},m._destroy=function(F,E){cj.removeAllListeners(m._name),z.transaction(function(H){var G=[c9,dO,bv,bb,cz,j0];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},bk(E),function(){cd()&&(delete window.localStorage["_pouch__websqldb_"+m._name],delete window.localStorage[m._name]),E(null,{ok:!0})})}}var ag=d(7),ay=aT(ag),aE=aT(d(2)),bu=aT(d(6)),aC=aT(d(8)),dE=d(12),au=aT(d(1)),aQ=d(4),f3=aT(d(14)),e3=d(10),f6=aT(e3),e4=aT(d(15)),bM=aT(d(16)),aP="function"==typeof Promise?Promise:aC,c2=aE("pouchdb:api");bu(bf,Error),bf.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var bQ=new bf({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),bI=new bf({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),fH=new bf({status:404,error:"not_found",reason:"missing"}),aO=new bf({status:409,error:"conflict",reason:"Document update conflict"}),bW=new bf({status:400,error:"invalid_id",reason:"_id field must contain a string"}),aM=new bf({status:412,error:"missing_id",reason:"_id is required for puts"}),b6=new bf({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),dH=new bf({status:412,error:"precondition_failed",reason:"Database not open"}),jN=new bf({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),dm=new bf({status:500,error:"badarg",reason:"Some query argument is invalid"}),kg=new bf({status:400,error:"invalid_request",reason:"Request was invalid"}),eP=new bf({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),j9=new bf({status:500,error:"doc_validation",reason:"Bad special document member"}),ch=new bf({status:400,error:"bad_request",reason:"Something wrong with the request"}),dA=new bf({status:400,error:"bad_request",reason:"Document must be a JSON object"}),jT=new bf({status:404,error:"not_found",reason:"Database not found"}),cm=new bf({status:500,error:"indexed_db_went_bad",reason:"unknown"}),aI=new bf({status:500,error:"web_sql_went_bad",reason:"unknown"}),c0=new bf({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),eY=new bf({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),fB=new bf({status:400,error:"bad_request",reason:"Invalid rev format"}),dB=new bf({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),dY=new bf({status:412,error:"missing_stub"}),fO=new bf({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),eG={UNAUTHORIZED:bQ,MISSING_BULK_DOCS:bI,MISSING_DOC:fH,REV_CONFLICT:aO,INVALID_ID:bW,MISSING_ID:aM,RESERVED_ID:b6,NOT_OPEN:dH,UNKNOWN_ERROR:jN,BAD_ARG:dm,INVALID_REQUEST:kg,QUERY_PARSE_ERROR:eP,DOC_VALIDATION:j9,BAD_REQUEST:ch,NOT_AN_OBJECT:dA,DB_MISSING:jT,WSQ_ERROR:aI,LDB_ERROR:c0,FORBIDDEN:eY,INVALID_REV:fB,FILE_EXISTS:dB,MISSING_STUB:dY,IDB_ERROR:cm,INVALID_URL:fO},aj=function(h,k,j){var g=Object.keys(eG).filter(function(m){var l=eG[m];return"function"!=typeof l&&l[h]===k}),i=j&&g.filter(function(m){var l=eG[m];return l.message===j})[0]||g[0];return i?eG[i]:null};bu(d1,aQ.EventEmitter),d1.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},d1.prototype.doChanges=function(h){var k=this,j=h.complete;if(h=bH(h),"live" in h&&!("continuous" in h)&&(h.continuous=h.live),h.processChange=dW,"latest"===h.since&&(h.since="now"),h.since||(h.since=0),"now"===h.since){return void this.db.info().then(function(l){return k.isCancelled?void j(null,{status:"cancelled"}):(h.since=l.update_seq,void k.doChanges(h))},j)}if(h.continuous&&"now"!==h.since&&this.db.info().then(function(l){k.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),h.filter&&"string"==typeof h.filter&&("_view"===h.filter?h.view=ki(h.view):h.filter=ki(h.filter),"http"!==this.db.type()&&!h.doc_ids)){return this.filterChanges(h)}"descending" in h||(h.descending=!1),h.limit=0===h.limit?1:h.limit,h.complete=j;var g=this.db._changes(h);if(g&&"function"==typeof g.cancel){var i=k.cancel;k.cancel=au(function(l){g.cancel(),i.apply(this,l)})}},d1.prototype.filterChanges=function(i){var l=this,k=i.complete;if("_view"===i.filter){if(!i.view||"string"!=typeof i.view){var h=cv(ch,"`view` filter parameter not found or invalid.");return k(h)}var j=cg(i.view);this.db.getView(j[0],j[1],function(n,m){return l.isCancelled?k(null,{status:"cancelled"}):n?k(aX(n)):m.map?(i.filter=e5(m.map),void l.doChanges(i)):k(cv(fH))})}else{var g=cg(i.filter);if(!g){return l.doChanges(i)}this.db.getFilter(g[0],g[1],function(n,m){return l.isCancelled?k(null,{status:"cancelled"}):n?k(aX(n)):(i.filter=cC(m),void l.doChanges(i))})}};var c7="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),eV=bR(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),b8=bR(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);bu(aq,aQ.EventEmitter),aq.prototype.post=ds("post",function(h,g,i){return"function"==typeof g&&(i=g,g={}),"object"!=typeof h||Array.isArray(h)?i(cv(dA)):void this.bulkDocs({docs:[h]},g,dh(i))}),aq.prototype.put=ds("put",au(function(k){var i,g,j,l,m=k.shift(),h="_id" in m;if("object"!=typeof m||Array.isArray(m)){return(l=k.pop())(cv(dA))}for(;;){if(i=k.shift(),g=typeof i,"string"!==g||h?"string"!==g||!h||"_rev" in m?"object"===g?j=i:"function"===g&&(l=i):m._rev=i:(m._id=i,h=!0),!k.length){break}}return j=j||{},bX(m._id),fF(m._id)&&"function"==typeof this._putLocal?m._deleted?this._removeLocal(m,l):this._putLocal(m,l):void this.bulkDocs({docs:[m]},j,dh(l))})),aq.prototype.putAttachment=ds("putAttachment",function(k,i,g,j,l){function m(n){var o="_rev" in n?parseInt(n._rev,10):0;return n._attachments=n._attachments||{},n._attachments[i]={content_type:l,data:j,revpos:++o},h.put(n)}var h=this;return"function"==typeof l&&(l=j,j=g,g=null),"undefined"==typeof l&&(l=j,j=g,g=null),h.get(k).then(function(n){if(n._rev!==g){throw cv(aO)}return m(n)},function(n){if(n.reason===fH.message){return m({_id:k})}throw n})}),aq.prototype.removeAttachment=ds("removeAttachment",function(h,k,j,g){var i=this;i.get(h,function(m,l){return m?void g(m):l._rev!==j?void g(cv(aO)):l._attachments?(delete l._attachments[k],0===Object.keys(l._attachments).length&&delete l._attachments,void i.put(l,g)):g()})}),aq.prototype.remove=ds("remove",function(i,l,k,h){var j;"string"==typeof l?(j={_id:i,_rev:l},"function"==typeof k&&(h=k,k={})):(j=i,"function"==typeof l?(h=l,k={}):(h=k,k=l)),k=k||{},k.was_delete=!0;var g={_id:j._id,_rev:j._rev||k.rev};return g._deleted=!0,fF(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(j,h):void this.bulkDocs({docs:[g]},k,dh(h))}),aq.prototype.revsDiff=ds("revsDiff",function(j,l,h){function n(o,p){m.has(o)||m.set(o,{missing:[]}),m.get(o).missing.push(p)}function g(q,p){var o=j[q].slice(0);cK(p,function(s,r,x,v,w){var u=r+"-"+x,y=o.indexOf(u);-1!==y&&(o.splice(y,1),"available"!==w.status&&n(q,u))}),o.forEach(function(r){n(q,r)})}"function"==typeof l&&(h=l,l={});var k=Object.keys(j);if(!k.length){return h(null,{})}var i=0,m=new dE.Map;k.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){m.set(o,{missing:j[o]})}else{if(q){return h(q)}g(o,p)}if(++i===k.length){var r={};return m.forEach(function(u,s){r[s]=u}),h(null,r)}})},this)}),aq.prototype.bulkGet=ds("bulkGet",function(g,h){e9(this,g,h)}),aq.prototype.compactDocument=ds("compactDocument",function(j,h,g){var i=this;this._getRevisionTree(j,function(n,l){if(n){return g(n)}var o=bl(l),m=[],k=[];Object.keys(o).forEach(function(p){o[p]>h&&m.push(p)}),cK(l,function(p,u,r,v,q){var s=u+"-"+r;"available"===q.status&&-1!==m.indexOf(s)&&k.push(s)}),i._doCompaction(j,k,g)})}),aq.prototype.compact=ds("compact",function(h,g){"function"==typeof h&&(g=h,h={});var i=this;h=h||{},i._compactionQueue=i._compactionQueue||[],i._compactionQueue.push({opts:h,callback:g}),1===i._compactionQueue.length&&aK(i)}),aq.prototype._compact=function(k,i){function g(n){h.push(l.compactDocument(n.id,0))}function j(n){var o=n.last_seq;aP.all(h).then(function(){return ab(l,"_local/compaction",function(p){return !p.last_seq||p.last_seq<o?(p.last_seq=o,p):!1})}).then(function(){i(null,{ok:!0})})["catch"](i)}var l=this,m={return_docs:!1,last_seq:k.last_seq||0},h=[];l.changes(m).on("change",g).on("complete",j).on("error",i)},aq.prototype.get=ds("get",function(j,l,h){function n(){var o=[],p=g.length;return p?void g.forEach(function(q){k.get(j,{rev:q,revs:l.revs,attachments:l.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||h(null,o)})}):h(null,o)}if("function"==typeof l&&(h=l,l={}),"string"!=typeof j){return h(cv(bW))}if(fF(j)&&"function"==typeof this._getLocal){return this._getLocal(j,h)}var g=[],k=this;if(!l.open_revs){return this._get(j,l,function(w,v){if(w){return h(w)}var B=v.doc,s=v.metadata,C=v.ctx;if(l.conflicts){var o=dz(s);o.length&&(B._conflicts=o)}if(c3(s,B._rev)&&(B._deleted=!0),l.revs||l.revs_info){var A=eE(s.rev_tree),r=f2(A,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(B._rev.split("-")[1])}),u=r.ids.map(function(D){return D.id}).indexOf(B._rev.split("-")[1])+1,x=r.ids.length-u;if(r.ids.splice(u,x),r.ids.reverse(),l.revs&&(B._revisions={start:r.pos+r.ids.length-1,ids:r.ids.map(function(D){return D.id})}),l.revs_info){var y=r.pos+r.ids.length;B._revs_info=r.ids.map(function(D){return y--,{rev:y+"-"+D.id,status:D.opts.status}})}}if(l.attachments&&B._attachments){var z=B._attachments,p=Object.keys(z).length;if(0===p){return h(null,B)}Object.keys(z).forEach(function(D){this._getAttachment(z[D],{binary:l.binary,ctx:C},function(F,G){var E=B._attachments[D];E.data=G,delete E.stub,delete E.length,--p||h(null,B)})},k)}else{if(B._attachments){for(var q in B._attachments){B._attachments.hasOwnProperty(q)&&(B._attachments[q].stub=!0)}}h(null,B)}})}if("all"===l.open_revs){this._getRevisionTree(j,function(o,p){return o?h(o):(g=kb(p).map(function(q){return q.rev}),void n())})}else{if(!Array.isArray(l.open_revs)){return h(cv(jN,"function_clause"))}g=l.open_revs;for(var i=0;i<g.length;i++){var m=g[i];if("string"!=typeof m||!/^\d+-/.test(m)){return h(cv(fB))}}n()}}),aq.prototype.getView=ds("getView",function(h,g,i){aJ(this,h,"views",g,i)}),aq.prototype.getFilter=ds("getFilter",function(h,g,i){aJ(this,h,"filters",g,i)}),aq.prototype.getAttachment=ds("getAttachment",function(h,k,j,g){var i=this;j instanceof Function&&(g=j,j={}),this._get(h,j,function(m,l){return m?g(m):l.doc._attachments&&l.doc._attachments[k]?(j.ctx=l.ctx,j.binary=!0,i._getAttachment(l.doc._attachments[k],j,g),void 0):g(cv(fH))})}),aq.prototype.allDocs=ds("allDocs",function(h,g){if("function"==typeof h&&(g=h,h={}),h.skip="undefined"!=typeof h.skip?h.skip:0,h.start_key&&(h.startkey=h.start_key),h.end_key&&(h.endkey=h.end_key),"keys" in h){if(!Array.isArray(h.keys)){return g(new TypeError("options.keys must be an array"))}var i=["startkey","endkey","key"].filter(function(j){return j in h})[0];if(i){return void g(cv(eP,"Query parameter `"+i+"` is not compatible with multi-get"))}if("http"!==this.type()){return bj(this,h,g)}}return this._allDocs(h,g)}),aq.prototype.changes=function(g,h){return"function"==typeof g&&(h=g,g={}),new d1(this,g,h)},aq.prototype.close=ds("close",function(g){return this._closed=!0,this._close(g)}),aq.prototype.info=ds("info",function(g){var h=this;this._info(function(j,i){return j?g(j):(i.db_name=i.db_name||h._db_name,i.auto_compaction=!(!h.auto_compaction||"http"===h.type()),i.adapter=h.type(),void g(null,i))})}),aq.prototype.id=ds("id",function(g){return this._id(g)}),aq.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},aq.prototype.bulkDocs=ds("bulkDocs",function(h,k,j){if("function"==typeof k&&(j=k,k={}),k=k||{},Array.isArray(h)&&(h={docs:h}),!h||!h.docs||!Array.isArray(h.docs)){return j(cv(bI))}for(var g=0;g<h.docs.length;++g){if("object"!=typeof h.docs[g]||Array.isArray(h.docs[g])){return j(cv(dA))}}var i;return h.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){i=i||ea(m)})}),i?j(cv(ch,i)):("new_edits" in k||("new_edits" in h?k.new_edits=h.new_edits:k.new_edits=!0),k.new_edits||"http"===this.type()||h.docs.sort(eL),eW(h.docs),this._bulkDocs(h,k,function(m,l){return m?j(m):(k.new_edits||(l=l.filter(function(n){return n.error})),void j(null,l))}))}),aq.prototype.registerDependentDatabase=ds("registerDependentDatabase",function(j,h){function g(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[j]?!1:(k.dependentDbs[j]=!0,k)}var i=new this.constructor(j,this.__opts);ab(this,"_local/_pouch_dependentDbs",g).then(function(){h(null,{db:i})})["catch"](h)}),aq.prototype.destroy=ds("destroy",function(h,k){function j(){g._destroy(h,function(l,m){return l?k(l):(g._destroyed=!0,g.emit("destroyed"),void k(null,m||{ok:!0}))})}"function"==typeof h&&(k=h,h={});var g=this,i="use_prefix" in g?g.use_prefix:!0;return"http"===g.type()?j():void g.get("_local/_pouch_dependentDbs",function(o,m){if(o){return 404!==o.status?k(o):j()}var p=m.dependentDbs,n=g.constructor,l=Object.keys(p).map(function(r){var q=i?r.replace(new RegExp("^"+n.prefix),""):r;return new n(q,g.__opts).destroy()});aP.all(l).then(j,k)})}),ek.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},ek.prototype.fail=function(g){this.failed=g,this.execute()},ek.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},ek.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},bu(dw,aq),dw.debug=aE;var bq;if(bG()){bq=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),bq=!!localStorage.getItem("_pouch_check_localstorage")}catch(em){bq=!1}}dw.adapters={},dw.preferredAdapters=[],dw.prefix="_pouch_";var by=new aQ.EventEmitter;ad(dw),dw.parseAdapter=function(j,l){var h,n,g=j.match(/([a-z\-]*):\/\/(.*)/);if(g){if(j=/http(s?)/.test(g[1])?g[1]+"://"+g[2]:g[2],h=g[1],!dw.adapters[h].valid()){throw"Invalid adapter"}return{name:j,adapter:g[1]}}var k="idb" in dw.adapters&&"websql" in dw.adapters&&cd()&&localStorage["_pouch__websqldb_"+dw.prefix+j];if(l.adapter){n=l.adapter}else{if("undefined"!=typeof l&&l.db){n="leveldb"}else{for(var i=0;i<dw.preferredAdapters.length;++i){if(n=dw.preferredAdapters[i],n in dw.adapters){if(k&&"idb"===n){console.log('PouchDB is downgrading "'+j+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}h=dw.adapters[n];var m=h&&"use_prefix" in h?h.use_prefix:!0;return{name:m?dw.prefix+j:j,adapter:n}},dw.adapter=function(h,g,i){g.valid()&&(dw.adapters[h]=g,i&&dw.preferredAdapters.push(h))},dw.plugin=function(g){return Object.keys(g).forEach(function(h){dw.prototype[h]=g[h]}),dw},dw.defaults=function(g){function h(k,i,j){return this instanceof h?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=ag.extend({},g,i),void dw.call(this,k,i,j)):new h(k,i,j)}return bu(h,dw),ad(h),h.preferredAdapters=dw.preferredAdapters.slice(),Object.keys(dw).forEach(function(i){i in h||(h[i]=dw[i])}),h};var d6=a8(),eI=function(){},jY=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],ke="queryKey",f0=/(?:^|&)([^&=]*)=?([^&]*)/g,dM=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,dZ=function(g){return atob(g)},d3=function(g){return btoa(g)},jI=ay.extend,cc={ajax:c4,parseUri:j2,uuid:cV,Promise:aP,atob:dZ,btoa:d3,binaryStringToBlobOrBuffer:cH,clone:bH,extend:jI,createError:cv},eM=f6.collate,cN=1,ba="pouchdb",c6=5,fL=0;cX.prototype.writeCheckpoint=function(h,g){var i=this;return this.updateTarget(h,g).then(function(){return i.updateSource(h,g)})},cX.prototype.updateTarget=function(g,h){return dD(this.target,this.id,g,h,this.returnValue)},cX.prototype.updateSource=function(h,g){var i=this;return this.readOnlySource?aP.resolve(!0):dD(this.src,this.id,h,g,this.returnValue)["catch"](function(j){if(d7(j)){return i.readOnlySource=!0,!0}throw j})};var bp={undefined:function(g,h){return 0===eM(g.last_seq,h.last_seq)?h.last_seq:0},1:function(g,h){return dX(h,g).last_seq}};cX.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?aP.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return fL}var j;return j=h.version?h.version.toString():"undefined",j in bp?bp[j](h,i):fL},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:fL}).then(function(){return fL},function(j){return d7(j)?(g.readOnlySource=!0,h.last_seq):fL})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return fL})};var a9=0,dS=bw.setImmediate||bw.setTimeout,dT=32768,dN=aH(function(o,h){function l(){var q=i*m,u=q+m;if(i++,g>i){p(n,o,q,u),dS(l)}else{p(n,o,q,u);var r=n.end(!0),s=bZ(r);h(null,s),n.destroy()}}var j="string"==typeof o,k=j?o.length:o.byteLength,m=Math.min(dT,k),g=Math.ceil(k/m),i=0,n=j?new e4:new e4.ArrayBuffer,p=j?dR:aL;l()});bu(ca,aQ.EventEmitter),ca.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},ca.prototype.ready=function(h,k){function j(){i.cancel()}function g(){h.removeListener("destroyed",j),k.removeListener("destroyed",j)}var i=this;i._readyCalled||(i._readyCalled=!0,h.once("destroyed",j),k.once("destroyed",j),i.once("complete",g))};var d4={replicate:kf,toPouch:aU},f8=d4.replicate;bu(cA,aQ.EventEmitter),cA.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var cy=25,bc=50,ck={},aZ=1800,j3=aE("pouchdb:http");ax.valid=function(){return !0},d0.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},d0.prototype.finish=function(){return this.promise};var c8,du=function(g,h){return h&&g.then(function(i){e2.nextTick(function(){h(null,i)})},function(i){e2.nextTick(function(){h(i)})}),g},b4=function(g){return au(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&du(i,j),i})},bz=function(g,h){return g.then(function(i){return h().then(function(){return i})},function(i){return h().then(function(){throw i})})},aN=function(g,h){return function(){var j=arguments,i=this;return g.add(function(){return h.apply(i,j)})}},eF=function(i){for(var l={},k=0,h=i.length;h>k;k++){l["$"+i[k]]=!0}var j=Object.keys(l),g=new Array(j.length);for(k=0,h=j.length;h>k;k++){g[k]=j[k].substring(1)}return g},f7={uniq:eF,sequentialize:aN,fin:bz,callbackify:b4,promisedCallback:du},cu=f6.collate,cb=f6.toIndexableString,dj=f6.normalizeKey,eQ=f6.parseIndexableString;c8="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var eb=f7.callbackify,cU=f7.sequentialize,fQ=f7.uniq,jX=f7.fin,jO=f7.promisedCallback,cG={},jV=new d0,aF=50,bJ={_sum:function(g,h){return ed(h)},_count:function(g,h){return h.length},_stats:function(h,g){function i(k){for(var n=0,m=0,j=k.length;j>m;m++){var l=k[m];n+=l*l}return n}return{sum:ed(g),min:Math.min.apply(null,g),max:Math.max.apply(null,g),count:g.length,sumsqr:i(g)}}},cF=eb(function(){var g=this;return g._ddocCache&&delete g._ddocCache,"http"===g.type()?bU(g):"function"==typeof g._viewCleanup?ac(g):jM(g)}),dd=function(h,k,j){"function"==typeof k&&(j=k,k={}),k=k?dI(k):{},"function"==typeof h&&(h={map:h});var g=this,i=aP.resolve().then(function(){return d8(g,h,k)});return jO(i,j),i};bu(dQ,Error),bu(fD,Error);var c1={query:dd,viewCleanup:cF},eT=5,cJ="document-store",kj="by-sequence",eN="attach-store",bF="attach-seq-store",cI="meta-store",j5="local-store",dV="detect-blob-support",cL={running:!1,queue:[]};bu(fK,aQ.EventEmitter),fK.prototype.addListener=function(j,h,l,i){function k(){function n(){m=!1}if(g._listeners[h]){if(m){return void (m="waiting")}m=!0;var o=cl(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);l.changes(o).on("change",function(p){p.seq>i.since&&!i.cancelled&&(i.since=p.seq,i.onChange(p))}).on("complete",function(){"waiting"===m&&setTimeout(function(){k()},0),m=!1}).on("error",n)}}if(!this._listeners[h]){var g=this,m=!1;this._listeners[h]=k,this.on(j,k)}},fK.prototype.removeListener=function(g,h){h in this._listeners&&aQ.EventEmitter.prototype.removeListener.call(this,g,this._listeners[h])},fK.prototype.notifyLocalWindows=function(g){bG()?chrome.storage.local.set({dbName:g}):cd()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},fK.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var dF,dU=new dE.Map,jK=new fK,aD=new dE.Map;al.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var d9=7,c9=cf("document-store"),dO=cf("by-sequence"),bv=cf("attach-store"),cz=cf("local-store"),bb=cf("metadata-store"),j0=cf("attach-seq-store"),cR=new dE.Map,cj=new fK,b2=1,am="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+dO+" (seq, deleted)",jF="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+dO+" (doc_id, rev)",cs="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+c9+" (winningseq)",b1="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+j0+" (seq)",bi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+j0+" (digest, seq)",bV=dO+".seq = "+c9+".winningseq",kc=dO+".seq AS seq, "+dO+".deleted AS deleted, "+dO+".json AS data, "+dO+".rev AS rev, "+c9+".json AS metadata";cE.use_prefix=!("undefined"!=typeof e2&&!e2.browser),cE.valid=e7;var ak={idb:al,websql:cE};dw.ajax=c4,dw.utils=cc,dw.Errors=eG,dw.replicate=d4.replicate,dw.sync=kh,dw.version="5.3.2",dw.adapter("http",ax),dw.adapter("https",ax),dw.plugin(c1),Object.keys(ak).forEach(function(g){dw.adapter(g,ak[g],!0)}),c.exports=dw}).call(this,d(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});