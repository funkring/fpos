!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(g,j,f){function h(e,k){if(!j[e]){if(!g[e]){var i="function"==typeof require&&require;if(!k&&i){return i(e,!0)}if(d){return d(e,!0)}var m=new Error("Cannot find module '"+e+"'");throw m.code="MODULE_NOT_FOUND",m}var l=j[e]={exports:{}};g[e][0].call(l.exports,function(o){var p=g[e][1][o];return h(p?p:o)},l,l.exports,a,g,j,f)}return j[e].exports}for(var d="function"==typeof require&&require,c=0;c<f.length;c++){h(f[c])}return h}({1:[function(f,c,g){function d(h){return function(){var e=arguments.length;if(e){for(var j=[],i=-1;++i<e;){j[i]=arguments[i]}return h.call(this,j)}return h.call(this,[])}}c.exports=d},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var s=arguments,p=this.useColors;if(s[0]=(p?"%c":"")+this.namespace+(p?" %c":" ")+s[0]+(p?"%c ":" ")+"+"+f.humanize(this.diff),!p){return s}var q="color: "+this.color;s=[s[0],q,"color: inherit"].concat(Array.prototype.slice.call(s,1));var u=0,n=0;return s[0].replace(/%[a-z%]/g,function(i){"%%"!==i&&(u++,"%c"===i&&(n=u))}),s.splice(n,0,q),s}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(n){try{null==n?f.storage.removeItem("debug"):f.storage.debug=n}catch(i){}}function m(){var n;try{n=f.storage.debug}catch(i){}return n}function k(){try{return window.localStorage}catch(i){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(i){return JSON.stringify(i)},f.enable(m())},{3:3}],3:[function(l,v,h){function d(){return h.colors[k++%h.colors.length]}function g(n){function f(){}function r(){var B=r,z=+new Date,y=z-(m||z);B.diff=y,B.prev=m,B.curr=z,m=z,null==B.useColors&&(B.useColors=h.useColors()),null==B.color&&B.useColors&&(B.color=d());var o=Array.prototype.slice.call(arguments);o[0]=h.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var A=0;o[0]=o[0].replace(/%([a-z%])/g,function(s,u){if("%%"===s){return s}A++;var C=h.formatters[u];if("function"==typeof C){var e=o[A];s=C.call(B,e),o.splice(A,1),A--}return s}),"function"==typeof h.formatArgs&&(o=h.formatArgs.apply(B,o));var x=r.log||h.log||console.log.bind(console);x.apply(B,o)}f.enabled=!1,r.enabled=!0;var c=h.enabled(n)?r:f;return c.namespace=n,c}function j(i){h.save(i);for(var c=(i||"").split(/[\s,]+/),f=c.length,n=0;f>n;n++){c[n]&&(i=c[n].replace(/\*/g,".*?"),"-"===i[0]?h.skips.push(new RegExp("^"+i.substr(1)+"$")):h.names.push(new RegExp("^"+i+"$")))}}function p(){h.enable("")}function w(i){var c,f;for(c=0,f=h.skips.length;f>c;c++){if(h.skips[c].test(i)){return !1}}for(c=0,f=h.names.length;f>c;c++){if(h.names[c].test(i)){return !0}}return !1}function q(c){return c instanceof Error?c.stack||c.message:c}h=v.exports=g,h.coerce=q,h.disable=p,h.enable=j,h.enabled=w,h.humanize=l(9),h.names=[],h.skips=[],h.formatters={};var m,k=0},{9:9}],4:[function(j,f,l){function h(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function k(i){return"function"==typeof i}function d(i){return"number"==typeof i}function c(i){return"object"==typeof i&&null!==i}function g(i){return void 0===i}f.exports=h,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._maxListeners=void 0,h.defaultMaxListeners=10,h.prototype.setMaxListeners=function(i){if(!d(i)||0>i||isNaN(i)){throw TypeError("n must be a positive number")}return this._maxListeners=i,this},h.prototype.emit=function(s){var p,w,q,o,m,v;if(this._events||(this._events={}),"error"===s&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if(p=arguments[1],p instanceof Error){throw p}throw TypeError('Uncaught, unspecified "error" event.')}if(w=this._events[s],g(w)){return !1}if(k(w)){switch(arguments.length){case 1:w.call(this);break;case 2:w.call(this,arguments[1]);break;case 3:w.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),w.apply(this,o)}}else{if(c(w)){for(o=Array.prototype.slice.call(arguments,1),v=w.slice(),q=v.length,m=0;q>m;m++){v[m].apply(this,o)}}}return !0},h.prototype.addListener=function(m,i){var o;if(!k(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,k(i.listener)?i.listener:i),this._events[m]?c(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,c(this._events[m])&&!this._events[m].warned&&(o=g(this._maxListeners)?h.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[m].length>o&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},h.prototype.on=h.prototype.addListener,h.prototype.once=function(o,i){function p(){this.removeListener(o,p),m||(m=!0,i.apply(this,arguments))}if(!k(i)){throw TypeError("listener must be a function")}var m=!1;return p.listener=i,this.on(o,p),this},h.prototype.removeListener=function(u,o){var v,q,m,p;if(!k(o)){throw TypeError("listener must be a function")}if(!this._events||!this._events[u]){return this}if(v=this._events[u],m=v.length,q=-1,v===o||k(v.listener)&&v.listener===o){delete this._events[u],this._events.removeListener&&this.emit("removeListener",u,o)}else{if(c(v)){for(p=m;p-->0;){if(v[p]===o||v[p].listener&&v[p].listener===o){q=p;break}}if(0>q){return this}1===v.length?(v.length=0,delete this._events[u]):v.splice(q,1),this._events.removeListener&&this.emit("removeListener",u,o)}}return this},h.prototype.removeAllListeners=function(m){var i,o;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(o=this._events[m],k(o)){this.removeListener(m,o)}else{if(o){for(;o.length;){this.removeListener(m,o[o.length-1])}}}return delete this._events[m],this},h.prototype.listeners=function(m){var i;return i=this._events&&this._events[m]?k(this._events[m])?[this._events[m]]:this._events[m].slice():[]},h.prototype.listenerCount=function(m){if(this._events){var i=this._events[m];if(k(i)){return 1}if(i){return i.length}}return 0},h.listenerCount=function(m,i){return m.listenerCount(i)}},{}],5:[function(d,c,f){(function(q){function j(){p=!0;for(var l,i,o=k.length;o;){for(i=k,k=[],l=-1;++l<o;){i[l]()}o=k.length}p=!1}function g(i){1!==k.push(i)||p||h()}var h,m=q.MutationObserver||q.WebKitMutationObserver;if(m){var v=0,x=new m(j),w=q.document.createTextNode("");x.observe(w,{characterData:!0}),h=function(){w.data=v=++v%2}}else{if(q.setImmediate||"undefined"==typeof q.MessageChannel){h="document" in q&&"onreadystatechange" in q.document.createElement("script")?function(){var e=q.document.createElement("script");e.onreadystatechange=function(){j(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},q.document.documentElement.appendChild(e)}:function(){setTimeout(j,0)}}else{var t=new q.MessageChannel;t.port1.onmessage=j,h=function(){t.port2.postMessage(0)}}}var p,k=[];c.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(d,c,f){"function"==typeof Object.create?c.exports=function(h,g){h.super_=g,h.prototype=Object.create(g.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:c.exports=function(h,g){h.super_=g;var i=function(){};i.prototype=g.prototype,h.prototype=new i,h.prototype.constructor=h}},{}],7:[function(d,c,f){(function(g){g("object"==typeof f?f:this)}).call(this,function(i){var g=Array.prototype.slice,j=Array.prototype.forEach,h=function(k){if("object"!=typeof k){throw k+" is not an object"}var l=g.call(arguments,1);return j.call(l,function(e){if(e){for(var m in e){"object"==typeof e[m]&&k[m]?h.call(k,k[m],e[m]):k[m]=e[m]}}}),k};i.extend=h})},{}],8:[function(H,q,B){function x(){}function A(c){if("function"!=typeof c){throw new TypeError("resolver must be a function")}this.state=C,this.queue=[],this.outcome=void 0,c!==x&&k(this,c)}function E(d,c,f){this.promise=d,"function"==typeof c&&(this.onFulfilled=c,this.callFulfilled=this.otherCallFulfilled),"function"==typeof f&&(this.onRejected=f,this.callRejected=this.otherCallRejected)}function K(d,c,f){z(function(){var e;try{e=c(f)}catch(h){return j.reject(d,h)}e===d?j.reject(d,new TypeError("Cannot resolve promise with itself")):j.resolve(d,e)})}function w(d){var c=d&&d.then;return d&&"object"==typeof d&&"function"==typeof c?function(){c.apply(d,arguments)}:void 0}function k(l,f){function p(e){d||(d=!0,j.reject(l,e))}function h(e){d||(d=!0,j.resolve(l,e))}function m(){f(h,p)}var d=!1,c=J(m);"error"===c.status&&p(c.value)}function J(f,c){var h={};try{h.value=f(c),h.status="success"}catch(d){h.status="error",h.value=d}return h}function G(c){return c instanceof this?c:j.resolve(new this(x),c)}function D(d){var c=new this(x);return j.reject(c,d)}function I(l){function v(n,c){function i(o){p[c]=o,++y!==d||h||(h=!0,j.resolve(m,p))}f.resolve(n).then(i,function(o){h||(h=!0,j.reject(m,o))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var d=l.length,h=!1;if(!d){return this.resolve([])}for(var p=new Array(d),y=0,r=-1,m=new this(x);++r<d;){v(l[r],r)}return m}function F(l){function f(i){p.resolve(i).then(function(n){d||(d=!0,j.resolve(h,n))},function(n){d||(d=!0,j.reject(h,n))})}var p=this;if("[object Array]"!==Object.prototype.toString.call(l)){return this.reject(new TypeError("must be an array"))}var m=l.length,d=!1;if(!m){return this.resolve([])}for(var c=-1,h=new this(x);++c<m;){f(l[c])}return h}var z=H(5),j={},g=["REJECTED"],L=["FULFILLED"],C=["PENDING"];q.exports=B=A,A.prototype["catch"]=function(c){return this.then(null,c)},A.prototype.then=function(d,c){if("function"!=typeof d&&this.state===L||"function"!=typeof c&&this.state===g){return this}var h=new this.constructor(x);if(this.state!==C){var f=this.state===L?d:c;K(h,f,this.outcome)}else{this.queue.push(new E(h,d,c))}return h},E.prototype.callFulfilled=function(c){j.resolve(this.promise,c)},E.prototype.otherCallFulfilled=function(c){K(this.promise,this.onFulfilled,c)},E.prototype.callRejected=function(c){j.reject(this.promise,c)},E.prototype.otherCallRejected=function(c){K(this.promise,this.onRejected,c)},j.resolve=function(h,d){var m=J(w,d);if("error"===m.status){return j.reject(h,m.value)}var f=m.value;if(f){k(h,f)}else{h.state=L,h.outcome=d;for(var l=-1,c=h.queue.length;++l<c;){h.queue[l].callFulfilled(d)}}return h},j.reject=function(f,c){f.state=g,f.outcome=c;for(var h=-1,d=f.queue.length;++h<d;){f.queue[h].callRejected(c)}return f},B.resolve=G,B.reject=D,B.all=I,B.race=F},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var c=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(c){var l=parseFloat(c[1]),f=(c[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*y;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(c){return c>=m?Math.round(c/m)+"d":c>=q?Math.round(c/q)+"h":c>=w?Math.round(c/w)+"m":c>=y?Math.round(c/y)+"s":c+"ms"}function k(c){return v(c,m,"day")||v(c,q,"hour")||v(c,w,"minute")||v(c,y,"second")||c+" ms"}function v(f,c,i){return c>f?void 0:1.5*c>f?Math.floor(f/c)+" "+i:Math.ceil(f/c)+" "+i+"s"}var y=1000,w=60*y,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,c){return c=c||{},"string"==typeof f?d(f):c["long"]?k(f):g(f)}},{}],10:[function(y,D,m){function g(n){if(null!==n){switch(typeof n){case"boolean":return n?1:0;case"number":return x(n);case"string":return n.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var f=Array.isArray(n),l=f?n:Object.keys(n),p=-1,d=l.length,c="";if(f){for(;++p<d;){c+=m.toIndexableString(l[p])}}else{for(;++p<d;){var h=l[p];c+=m.toIndexableString(h)+m.toIndexableString(n[h])}}return c}}return""}function k(p,I){var h,d=I,f="1"===p[I];if(f){h=0,I++}else{var l="0"===p[I];I++;var G="",J=p.substring(I,I+z),H=parseInt(J,10)+q;for(l&&(H=-H),I+=z;;){var F=p[I];if("\x00"===F){break}G+=F,I++}G=G.split("."),h=1===G.length?parseInt(G,10):parseFloat(G[0]+"."+G[1]),l&&(h-=10),0!==H&&(h=parseFloat(h+"e"+H))}return{num:h,length:I-d}}function v(l,f){var s=l.pop();if(f.length){var h=f[f.length-1];s===h.element&&(f.pop(),h=f[f.length-1]);var p=h.element,d=h.index;if(Array.isArray(p)){p.push(s)}else{if(d===l.length-2){var c=l.pop();p[c]=s}else{l.push(s)}}}}function B(h,d){for(var f=Math.min(h.length,d.length),l=0;f>l;l++){var c=m.collate(h[l],d[l]);if(0!==c){return c}}return h.length===d.length?0:h.length>d.length?1:-1}function E(d,c){return d===c?0:d>c?1:-1}function C(n,f){for(var l=Object.keys(n),p=Object.keys(f),d=Math.min(l.length,p.length),c=0;d>c;c++){var h=m.collate(l[c],p[c]);if(0!==h){return h}if(h=m.collate(n[l[c]],f[p[c]]),0!==h){return h}}return l.length===p.length?0:l.length>p.length?1:-1}function A(d){var c=["boolean","number","string","object"],f=c.indexOf(typeof d);return ~f?null===d?1:Array.isArray(d)?5:3>f?f+2:f+3:Array.isArray(d)?5:void 0}function x(l){if(0===l){return"1"}var G=l.toExponential().split(/e\+?/),f=parseInt(G[1],10),c=0>l,d=c?"0":"2",h=(c?-f:f)-q,p=j.padLeft(h.toString(),"0",z);d+=w+p;var H=Math.abs(parseFloat(G[0]));c&&(H=10-H);var F=H.toFixed(20);return F=F.replace(/\.?0+$/,""),d+=w+F}var q=-324,z=3,w="",j=y(11);m.collate=function(f,c){if(f===c){return 0}f=m.normalizeKey(f),c=m.normalizeKey(c);var d=A(f),h=A(c);if(d-h!==0){return d-h}if(null===f){return 0}switch(typeof f){case"number":return f-c;case"boolean":return f===c?0:c>f?-1:1;case"string":return E(f,c)}return Array.isArray(f)?B(f,c):C(f,c)},m.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var f=l;if(Array.isArray(l)){var h=l.length;l=new Array(h);for(var n=0;h>n;n++){l[n]=m.normalizeKey(f[n])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var d in f){if(f.hasOwnProperty(d)){var c=f[d];"undefined"!=typeof c&&(l[d]=m.normalizeKey(c))}}}}}return l},m.toIndexableString=function(d){var c="\x00";return d=m.normalizeKey(d),A(d)+w+g(d)+c},m.parseIndexableString=function(p){for(var I=[],h=[],d=0;;){var G=p[d++];if("\x00"!==G){switch(G){case"1":I.push(null);break;case"2":I.push("1"===p[d]),d++;break;case"3":var J=k(p,d);I.push(J.num),d+=J.length;break;case"4":for(var H="";;){var F=p[d];if("\x00"===F){break}H+=F,d++}H=H.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),I.push(H);break;case"5":var o={element:[],index:I.length};I.push(o.element),h.push(o);break;case"6":var i={element:{},index:I.length};I.push(i.element),h.push(i);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+G)}}else{if(1===I.length){return I.pop()}v(I,h)}}}},{11:11}],11:[function(f,c,g){function d(j,h,l){for(var i="",k=l-j.length;i.length<k;){i+=h}return i}g.padLeft=function(i,h,k){var j=d(i,h,k);return j+i},g.padRight=function(i,h,k){var j=d(i,h,k);return i+j},g.stringLexCompare=function(m,k){var q,l=m.length,p=k.length;for(q=0;l>q;q++){if(q===p){return 1}var j=m.charAt(q),h=k.charAt(q);if(j!==h){return h>j?-1:1}}return p>l?-1:0},g.intToDecimalForm=function(j){var h=0>j,k="";do{var i=h?-Math.ceil(j%10):Math.floor(j%10);k=i+k,j=h?Math.ceil(j/10):Math.floor(j/10)}while(j);return h&&"0"!==k&&(k="-"+k),k}},{}],12:[function(f,c,h){function d(){this.store={}}function g(j){if(this.store=new d,j&&Array.isArray(j)){for(var i=0,k=j.length;k>i;i++){this.add(j[i])}}}h.Map=d,h.Set=g,d.prototype.mangle=function(i){if("string"!=typeof i){throw new TypeError("key must be a string but Got "+i)}return"$"+i},d.prototype.unmangle=function(i){return i.substring(1)},d.prototype.get=function(j){var i=this.mangle(j);return i in this.store?this.store[i]:void 0},d.prototype.set=function(j,i){var k=this.mangle(j);return this.store[k]=i,!0},d.prototype.has=function(j){var i=this.mangle(j);return i in this.store},d.prototype["delete"]=function(j){var i=this.mangle(j);return i in this.store?(delete this.store[i],!0):!1},d.prototype.forEach=function(m){for(var k=Object.keys(this.store),q=0,l=k.length;l>q;q++){var p=k[q],j=this.store[p];p=this.unmangle(p),m(j,p)}},g.prototype.add=function(i){return this.store.set(i,!0)},g.prototype.has=function(i){return this.store.has(i)},g.prototype["delete"]=function(i){return this.store["delete"](i)}},{}],13:[function(p,x,h){function d(){m=!1,y.length?q=y.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var c=q.length;c;){for(y=q,q=[];++j<c;){y&&y[j].run()}j=-1,c=q.length}y=null,m=!1,clearTimeout(f)}}function k(f,c){this.fun=f,this.array=c}function v(){}var y,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var c=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){c[i-1]=arguments[i]}}q.push(new k(f,c)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(c){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(c){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(d,c,f){(function(){var g={}.hasOwnProperty,h=[].slice;c.exports=function(k,m){var n,j,e,l;j=[],l=[];for(n in m){g.call(m,n)&&(e=m[n],"this"!==n&&(j.push(n),l.push(e)))}return Function.apply(null,h.call(j).concat([k])).apply(m["this"],l)}}).call(this)},{}],15:[function(c,e,d){!function(g){if("object"==typeof d){e.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(J){function w(l,g,p,h,m,f){return g=H(H(g,l),H(h,f)),H(g<<m|g>>>32-m,p)}function C(m,t,l,p,g,f,h){return w(t&l|~t&p,m,t,g,f,h)}function z(m,t,l,p,g,f,h){return w(t&p|l&~p,m,t,g,f,h)}function B(m,t,l,p,g,f,h){return w(t^l^p,m,t,g,f,h)}function F(m,t,l,p,g,f,h){return w(l^(t|~p),m,t,g,f,h)}function N(l,h){var f=l[0],i=l[1],g=l[2],m=l[3];f=C(f,i,g,m,h[0],7,-680876936),m=C(m,f,i,g,h[1],12,-389564586),g=C(g,m,f,i,h[2],17,606105819),i=C(i,g,m,f,h[3],22,-1044525330),f=C(f,i,g,m,h[4],7,-176418897),m=C(m,f,i,g,h[5],12,1200080426),g=C(g,m,f,i,h[6],17,-1473231341),i=C(i,g,m,f,h[7],22,-45705983),f=C(f,i,g,m,h[8],7,1770035416),m=C(m,f,i,g,h[9],12,-1958414417),g=C(g,m,f,i,h[10],17,-42063),i=C(i,g,m,f,h[11],22,-1990404162),f=C(f,i,g,m,h[12],7,1804603682),m=C(m,f,i,g,h[13],12,-40341101),g=C(g,m,f,i,h[14],17,-1502002290),i=C(i,g,m,f,h[15],22,1236535329),f=z(f,i,g,m,h[1],5,-165796510),m=z(m,f,i,g,h[6],9,-1069501632),g=z(g,m,f,i,h[11],14,643717713),i=z(i,g,m,f,h[0],20,-373897302),f=z(f,i,g,m,h[5],5,-701558691),m=z(m,f,i,g,h[10],9,38016083),g=z(g,m,f,i,h[15],14,-660478335),i=z(i,g,m,f,h[4],20,-405537848),f=z(f,i,g,m,h[9],5,568446438),m=z(m,f,i,g,h[14],9,-1019803690),g=z(g,m,f,i,h[3],14,-187363961),i=z(i,g,m,f,h[8],20,1163531501),f=z(f,i,g,m,h[13],5,-1444681467),m=z(m,f,i,g,h[2],9,-51403784),g=z(g,m,f,i,h[7],14,1735328473),i=z(i,g,m,f,h[12],20,-1926607734),f=B(f,i,g,m,h[5],4,-378558),m=B(m,f,i,g,h[8],11,-2022574463),g=B(g,m,f,i,h[11],16,1839030562),i=B(i,g,m,f,h[14],23,-35309556),f=B(f,i,g,m,h[1],4,-1530992060),m=B(m,f,i,g,h[4],11,1272893353),g=B(g,m,f,i,h[7],16,-155497632),i=B(i,g,m,f,h[10],23,-1094730640),f=B(f,i,g,m,h[13],4,681279174),m=B(m,f,i,g,h[0],11,-358537222),g=B(g,m,f,i,h[3],16,-722521979),i=B(i,g,m,f,h[6],23,76029189),f=B(f,i,g,m,h[9],4,-640364487),m=B(m,f,i,g,h[12],11,-421815835),g=B(g,m,f,i,h[15],16,530742520),i=B(i,g,m,f,h[2],23,-995338651),f=F(f,i,g,m,h[0],6,-198630844),m=F(m,f,i,g,h[7],10,1126891415),g=F(g,m,f,i,h[14],15,-1416354905),i=F(i,g,m,f,h[5],21,-57434055),f=F(f,i,g,m,h[12],6,1700485571),m=F(m,f,i,g,h[3],10,-1894986606),g=F(g,m,f,i,h[10],15,-1051523),i=F(i,g,m,f,h[1],21,-2054922799),f=F(f,i,g,m,h[8],6,1873313359),m=F(m,f,i,g,h[15],10,-30611744),g=F(g,m,f,i,h[6],15,-1560198380),i=F(i,g,m,f,h[13],21,1309151649),f=F(f,i,g,m,h[4],6,-145523070),m=F(m,f,i,g,h[11],10,-1120210379),g=F(g,m,f,i,h[2],15,718787259),i=F(i,g,m,f,h[9],21,-343485551),l[0]=H(f,l[0]),l[1]=H(i,l[1]),l[2]=H(g,l[2]),l[3]=H(m,l[3])}function x(g){var f,h=[];for(f=0;64>f;f+=4){h[f>>2]=g.charCodeAt(f)+(g.charCodeAt(f+1)<<8)+(g.charCodeAt(f+2)<<16)+(g.charCodeAt(f+3)<<24)}return h}function q(g){var f,h=[];for(f=0;64>f;f+=4){h[f>>2]=g[f]+(g[f+1]<<8)+(g[f+2]<<16)+(g[f+3]<<24)}return h}function L(s){var P,l,g,h,m,y,v=s.length,p=[1732584193,-271733879,-1732584194,271733878];for(P=64;v>=P;P+=64){N(p,x(s.substring(P-64,P)))}for(s=s.substring(P-64),l=s.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],P=0;l>P;P+=1){g[P>>2]|=s.charCodeAt(P)<<(P%4<<3)}if(g[P>>2]|=128<<(P%4<<3),P>55){for(N(p,g),P=0;16>P;P+=1){g[P]=0}}return h=8*v,h=h.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),y=parseInt(h[1],16)||0,g[14]=m,g[15]=y,N(p,g),p}function I(u){var y,l,g,h,m,P,v=u.length,p=[1732584193,-271733879,-1732584194,271733878];for(y=64;v>=y;y+=64){N(p,q(u.subarray(y-64,y)))}for(u=v>y-64?u.subarray(y-64):new Uint8Array(0),l=u.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],y=0;l>y;y+=1){g[y>>2]|=u[y]<<(y%4<<3)}if(g[y>>2]|=128<<(y%4<<3),y>55){for(N(p,g),y=0;16>y;y+=1){g[y]=0}}return h=8*v,h=h.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(h[2],16),P=parseInt(h[1],16)||0,g[14]=m,g[15]=P,N(p,g),p}function E(g){var f,h="";for(f=0;4>f;f+=1){h+=M[g>>8*f+4&15]+M[g>>8*f&15]}return h}function K(g){var f;for(f=0;f<g.length;f+=1){g[f]=E(g[f])}return g.join("")}function G(f){return/[\u0080-\uFFFF]/.test(f)&&(f=unescape(encodeURIComponent(f))),f}function A(l,g){var p,h=l.length,m=new ArrayBuffer(h),f=new Uint8Array(m);for(p=0;h>p;p+=1){f[p]=l.charCodeAt(p)}return g?f:m}function k(f){return String.fromCharCode.apply(null,new Uint8Array(f))}function j(h,f,i){var g=new Uint8Array(h.byteLength+f.byteLength);return g.set(new Uint8Array(h)),g.set(new Uint8Array(f),h.byteLength),i?g:g.buffer}function O(h){var f,i=[],g=h.length;for(f=0;g-1>f;f+=2){i.push(parseInt(h.substr(f,2),16))}return String.fromCharCode.apply(String,i)}function D(){this.reset()}var H=function(g,f){return g+f&4294967295},M=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==K(L("hello"))&&(H=function(h,f){var i=(65535&h)+(65535&f),g=(h>>16)+(f>>16)+(i>>16);return g<<16|65535&i}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function f(h,g){return h=0|h||0,0>h?Math.max(h+g,0):Math.min(h,g)}ArrayBuffer.prototype.slice=function(l,g){var h,m,v,P,y=this.byteLength,t=f(l,y),p=y;return g!==J&&(p=f(g,y)),t>p?new ArrayBuffer(0):(h=p-t,m=new ArrayBuffer(h),v=new Uint8Array(m),P=new Uint8Array(this,t,h),v.set(P),m)}}(),D.prototype.append=function(f){return this.appendBinary(G(f)),this},D.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var f,h=this._buff.length;for(f=64;h>=f;f+=64){N(this._hash,x(this._buff.substring(f-64,f)))}return this._buff=this._buff.substring(f-64),this},D.prototype.end=function(l){var g,p,h=this._buff,m=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;m>g;g+=1){f[g>>2]|=h.charCodeAt(g)<<(g%4<<3)}return this._finish(f,m),p=K(this._hash),l&&(p=O(p)),this.reset(),p},D.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},D.prototype.setState=function(f){return this._buff=f.buff,this._length=f.length,this._hash=f.hash,this},D.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},D.prototype._finish=function(l,g){var p,h,m,f=g;if(l[f>>2]|=128<<(f%4<<3),f>55){for(N(this._hash,l),f=0;16>f;f+=1){l[f]=0}}p=8*this._length,p=p.toString(16).match(/(.*?)(.{0,8})$/),h=parseInt(p[2],16),m=parseInt(p[1],16)||0,l[14]=h,l[15]=m,N(this._hash,l)},D.hash=function(g,f){return D.hashBinary(G(g),f)},D.hashBinary=function(h,f){var i=L(h),g=K(i);return f?O(g):g},D.ArrayBuffer=function(){this.reset()},D.ArrayBuffer.prototype.append=function(h){var f,i=j(this._buff.buffer,h,!0),g=i.length;for(this._length+=h.byteLength,f=64;g>=f;f+=64){N(this._hash,q(i.subarray(f-64,f)))}return this._buff=g>f-64?new Uint8Array(i.buffer.slice(f-64)):new Uint8Array(0),this},D.ArrayBuffer.prototype.end=function(l){var g,p,h=this._buff,m=h.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(g=0;m>g;g+=1){f[g>>2]|=h[g]<<(g%4<<3)}return this._finish(f,m),p=K(this._hash),l&&(p=O(p)),this.reset(),p},D.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},D.ArrayBuffer.prototype.getState=function(){var f=D.prototype.getState.call(this);return f.buff=k(f.buff),f},D.ArrayBuffer.prototype.setState=function(f){return f.buff=A(f.buff,!0),D.prototype.setState.call(this,f)},D.ArrayBuffer.prototype.destroy=D.prototype.destroy,D.ArrayBuffer.prototype._finish=D.prototype._finish,D.ArrayBuffer.hash=function(h,f){var i=I(new Uint8Array(h)),g=K(i);return f?O(g):g},D})},{}],16:[function(f,c,g){function d(m,k,q){var l=q[q.length-1];m===l.element&&(q.pop(),l=q[q.length-1]);var p=l.element,j=l.index;if(Array.isArray(p)){p.push(m)}else{if(j===k.length-2){var h=k.pop();p[h]=m}else{k.push(m)}}}g.stringify=function(x){var C=[];C.push({obj:x});for(var m,j,k,q,A,D,B,z,w,p,y,v="";m=C.pop();){if(j=m.obj,k=m.prefix||"",q=m.val||"",v+=k,q){v+=q}else{if("object"!=typeof j){v+="undefined"==typeof j?null:JSON.stringify(j)}else{if(null===j){v+="null"}else{if(Array.isArray(j)){for(C.push({val:"]"}),A=j.length-1;A>=0;A--){D=0===A?"":",",C.push({obj:j[A],prefix:D})}C.push({val:"["})}else{B=[];for(z in j){j.hasOwnProperty(z)&&B.push(z)}for(C.push({val:"}"}),A=B.length-1;A>=0;A--){w=B[A],p=j[w],y=A>0?",":"",y+=JSON.stringify(w)+":",C.push({obj:p,prefix:y})}C.push({val:"{"})}}}}}return v},g.parse=function(v){for(var A,k,j,p,y,B,z,x,r,m=[],w=[],q=0;;){if(A=v[q++],"}"!==A&&"]"!==A&&"undefined"!=typeof A){switch(A){case" ":case"	":case"\n":case":":case",":break;case"n":q+=3,d(null,m,w);break;case"t":q+=3,d(!0,m,w);break;case"f":q+=4,d(!1,m,w);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(k="",q--;;){if(j=v[q++],!/[\d\.\-e\+]/.test(j)){q--;break}k+=j}d(parseFloat(k),m,w);break;case'"':for(p="",y=void 0,B=0;;){if(z=v[q++],'"'===z&&("\\"!==y||B%2!==1)){break}p+=z,y=z,"\\"===y?B++:B=0}d(JSON.parse('"'+p+'"'),m,w);break;case"[":x={element:[],index:m.length},m.push(x.element),w.push(x);break;case"{":r={element:{},index:m.length},m.push(r.element),w.push(r);break;default:throw new Error("unexpectedly reached end of input: "+A)}}else{if(1===m.length){return m.pop()}d(m.pop(),m,w)}}}},{}],17:[function(d,c,f){(function(eG,eA){function eE(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function eO(k,h){for(var m={},j=0,l=h.length;l>j;j++){var g=h[j];g in k&&(m[g]=k[g])}return m}function eY(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function ey(i){if("function"==typeof i.slice){return i.slice(0)}var g=new ArrayBuffer(i.byteLength),j=new Uint8Array(g),h=new Uint8Array(i);return j.set(h),g}function ew(h){if(h instanceof ArrayBuffer){return ey(h)}var g=h.size,i=h.type;return"function"==typeof h.slice?h.slice(0,g,i):h.webkitSlice(0,g,i)}function eW(i){var g,k,h;if(!i||"object"!=typeof i){return i}if(Array.isArray(i)){for(g=[],k=0,h=i.length;h>k;k++){g[k]=eW(i[k])}return g}if(i instanceof Date){return i.toISOString()}if(eY(i)){return ew(i)}g={};for(k in i){if(Object.prototype.hasOwnProperty.call(i,k)){var j=eW(i[k]);"undefined"!=typeof j&&(g[k]=j)}}return g}function eT(h){var g=!1;return bx(function(i){if(g){throw new Error("once called more than once")}g=!0,h.apply(this,i)})}function eJ(g){return bx(function(k){k=eW(k);var l,m=this,j="function"==typeof k[k.length-1]?k.pop():!1;j&&(l=function(n,i){eG.nextTick(function(){j(n,i)})});var h=new dQ(function(v,u){var p;try{var o=eT(function(n,i){n?u(n):v(i)});k.push(o),p=g.apply(m,k),p&&"function"==typeof p.then&&v(p)}catch(q){u(q)}});return l&&h.then(function(i){l(null,i)},l),h})}function eV(h,g){function i(m,k,q){if(cK.enabled){for(var l=[m._db_name,k],p=0;p<q.length-1;p++){l.push(q[p])}cK.apply(null,l);var j=q[q.length-1];q[q.length-1]=function(v,s){var u=[m._db_name,k];u=u.concat(v?["error",v]:["success",s]),cK.apply(null,u),j(v,s)}}}return eJ(bx(function(j){if(this._closed){return dQ.reject(new Error("database is closed"))}if(this._destroyed){return dQ.reject(new Error("database is destroyed"))}var k=this;return i(k,h,j),this.taskqueue.isReady?g.apply(this,j):new dQ(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[h].apply(k,j))})})}))}function eQ(h,g,i){return new dQ(function(j,k){h.get(g,function(n,l){if(n){if(404!==n.status){return k(n)}l={}}var o=l._rev,m=i(l);return m?(m._id=g,m._rev=o,void j(eC(h,m,i))):j({updated:!1,rev:o})})})}function eC(h,g,i){return h.put(g).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return eQ(h,g._id,i)})}function ev(q){for(var z,j,g,h,m=q.rev_tree.slice();h=m.pop();){var x=h.ids,A=x[2],y=h.pos;if(A.length){for(var w=0,p=A.length;p>w;w++){m.push({pos:y+1,ids:A[w]})}}else{var k=!!x[1].deleted,v=x[0];z&&!(g!==k?g:j!==y?y>j:v>z)||(z=v,j=y,g=k)}}return j+"-"+z}function eq(g){return g.ids}function eZ(i,g){g||(g=ev(i));for(var k,h=g.substring(g.indexOf("-")+1),j=i.rev_tree.map(eq);k=j.pop();){if(k[0]===h){return !!k[1].deleted}j=j.concat(k[2])}}function eH(g){return dg("return "+g+";",{})}function eR(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function eX(h){if(!h){return null}var g=h.split("/");return 2===g.length?g:1===g.length?[h,h]:null}function eu(h){var g=eX(h);return g?g.join("/"):null}function fB(l,v){for(var j,g=l.slice();j=g.pop();){for(var h=j.pos,k=j.ids,p=k[2],w=v(0===p.length,h,k[0],j.ctx,k[1]),q=0,m=p.length;m>q;q++){g.push({pos:h+1,ids:p[q],ctx:w})}}}function fa(h,g){return h.pos-g.pos}function eK(i){var g=[];fB(i,function(m,q,l,p,k){m&&g.push({rev:q+"-"+l,pos:q,opts:k})}),g.sort(fa).reverse();for(var j=0,h=g.length;h>j;j++){delete g[j].pos}return g}function eB(l){for(var j=ev(l),p=eK(l.rev_tree),k=[],m=0,h=p.length;h>m;m++){var g=p[m];g.rev===j||g.opts.deleted||k.push(g.rev)}return k}function es(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function fF(i,g,j){function h(k){for(var l in i){"function"!=typeof i[l]&&(this[l]=i[l])}void 0!==j&&(this.name=j),void 0!==k&&(this.reason=k)}return h.prototype=es.prototype,new h(g)}function e8(k){var h,m,j,l,g;return m=k.error===!0&&"string"==typeof k.name?k.name:k.error,g=k.reason,j=a7("name",m,g),k.missing||"missing"===g||"deleted"===g||"not_found"===m?j=bS:"doc_validation"===m?(j=cV,l=g):"bad_request"===m&&j.message!==g&&(j=bI),j||(j=a7("status",k.status,g)||e9),h=fF(j,g,m),l&&(h.message=l),k.id&&(h.id=k.id),k.status&&(h.status=k.status),k.missing&&(h.missing=k.missing),h}function fh(l,j,p){function k(){m.cancel()}b3.EventEmitter.call(this);var m=this;this.db=l,j=j?eW(j):{};var h=j.complete=eT(function(i,o){i?m.emit("error",i):m.emit("complete",o),m.removeAllListeners(),l.removeListener("destroyed",k)});p&&(m.on("complete",function(i){p(null,i)}),m.on("error",p)),l.once("destroyed",k),j.onChange=function(i){j.isCancelled||(m.emit("change",i),m.startSeq&&m.startSeq<=i.seq&&(m.startSeq=!1))};var g=new dQ(function(i,o){j.complete=function(n,q){n?o(n):i(q)}});m.once("cancel",function(){l.removeListener("destroyed",k),j.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this["catch"]=g["catch"].bind(g),this.then(function(i){h(null,i)},h),l.taskqueue.isReady?m.doChanges(j):l.taskqueue.addTask(function(){m.isCancelled?m.emit("cancel"):m.doChanges(j)})}function eN(i,g,k){var h=[{rev:i._rev}];"all_docs"===k.style&&(h=eK(g.rev_tree).map(function(l){return{rev:l.rev}}));var j={id:g.id,changes:h,doc:i};return eZ(g,i._rev)&&(j.deleted=!0),k.conflicts&&(j.doc._conflicts=eB(g),j.doc._conflicts.length||delete j.doc._conflicts),j}function fD(m,w,i){function g(){var l=[];j.forEach(function(n){n.docs.forEach(function(o){l.push({id:n.id,docs:[o]})})}),i(null,{results:l})}function h(){++k===p&&g()}function q(o,l,r){j[o]={id:l,docs:r},h()}var x=Array.isArray(w)?w:w.docs,v={};x.forEach(function(l){l.id in v?v[l.id].push(l):v[l.id]=[l]});var p=Object.keys(v).length,k=0,j=new Array(p);Object.keys(v).forEach(function(A,u){var y=v[A],l=eO(y[0],["atts_since","attachments"]);l.open_revs=y.map(function(n){return n.rev}),l.open_revs=l.open_revs.filter(function(n){return n});var z=function(n){return n};0===l.open_revs.length&&(delete l.open_revs,z=function(n){return[{ok:n}]}),["revs","attachments","binary","ajax"].forEach(function(n){n in w&&(l[n]=w[n])}),m.get(A,l,function(o,n){q(u,A,o?[{error:o}]:z(n))})})}function fv(g){return/^_local/.test(g)}function fm(q){for(var z,j=[],g=q.slice();z=g.pop();){var h=z.pos,m=z.ids,x=m[0],A=m[1],y=m[2],w=0===y.length,p=z.history?z.history.slice():[];p.push({id:x,opts:A}),w&&j.push({pos:h+1-p.length,ids:p});for(var k=0,v=y.length;v>k;k++){g.push({pos:h+1,ids:y[k],history:p})}}return j.reverse()}function fb(g){return 0|Math.random()*g}function fC(i,g){g=g||dU.length;var j="",h=-1;if(i){for(;++h<i;){j+=dU[fb(g)]}return j}for(;++h<36;){switch(h){case 8:case 13:case 18:case 23:j+="-";break;case 19:j+=dU[3&fb(16)|8];break;default:j+=dU[fb(16)]}}return j}function fj(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function fE(h){var g;if(h?"string"!=typeof h?g=fF(fZ):/^_/.test(h)&&!/^_(design|local)/.test(h)&&(g=fF(cA)):g=fF(ac),g){throw g}}function fl(i){if(!/^\d+\-./.test(i)){return fF(fp)}var g=i.indexOf("-"),j=i.substring(0,g),h=i.substring(g+1);return{prefix:parseInt(j,10),id:h}}function fA(l,j){for(var p=l.start-l.ids.length+1,k=l.ids,m=[k[0],j,[]],h=1,g=k.length;g>h;h++){m=[k[h],{status:"missing"},[m]]}return[{pos:p,ids:m}]}function e7(l,v){var j,g,h,k={status:"available"};if(l._deleted&&(k.deleted=!0),v){if(l._id||(l._id=fC()),g=fC(32,16).toLowerCase(),l._rev){if(h=fl(l._rev),h.error){return h}l._rev_tree=[{pos:h.prefix,ids:[h.id,{status:"missing"},[[g,k,[]]]]}],j=h.prefix+1}else{l._rev_tree=[{pos:1,ids:[g,k,[]]}],j=1}}else{if(l._revisions&&(l._rev_tree=fA(l._revisions,k),j=l._revisions.start,g=l._revisions.ids[0]),!l._rev_tree){if(h=fl(l._rev),h.error){return h}j=h.prefix,g=h.id,l._rev_tree=[{pos:j,ids:[g,k,[]]}]}}fE(l._id),l._rev=j+"-"+g;var p={metadata:{},data:{}};for(var w in l){if(Object.prototype.hasOwnProperty.call(l,w)){var q="_"===w[0];if(q&&!aj[w]){var m=fF(cV,w);throw m.message=cV.message+": "+w,m}q&&!cs[w]?p.metadata[w.slice(1)]=l[w]:p.data[w]=l[w]}}return p}function ff(h,g){return g>h?-1:h>g?1:0}function fw(h,g){for(var i=0;i<h.length;i++){if(g(h[i],i)===!0){return h[i]}}}function fq(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function e4(j){for(var h=0;h<j.length;h++){var l=j[h];if(l._deleted){delete l._attachments}else{if(l._attachments){for(var i=Object.keys(l._attachments),k=0;k<i.length;k++){var g=i[k];l._attachments[g]=eO(l._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function fs(i,g){var k=ff(i._id,g._id);if(0!==k){return k}var h=i._revisions?i._revisions.start:0,j=g._revisions?g._revisions.start:0;return ff(h,j)}function e5(h){var g={},i=[];return fB(h,function(m,l,n,k){var j=l+"-"+n;return m&&(g[j]=0),void 0!==k&&i.push({from:k,to:j}),j}),i.reverse(),i.forEach(function(j){void 0===g[j.from]?g[j.from]=1+g[j.to]:g[j.from]=Math.min(g[j.from],1+g[j.to])}),g}function fy(i,g,k){var h="limit" in g?g.keys.slice(g.skip,g.limit+g.skip):g.skip>0?g.keys.slice(g.skip):g.keys;if(g.descending&&h.reverse(),!h.length){return i._allDocs({limit:0},k)}var j={offset:g.skip};return dQ.all(h.map(function(m){var l=ch.extend({key:m,deleted:"ok"},g);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new dQ(function(o,n){i._allDocs(l,function(q,p){return q?n(q):(j.total_rows=p.total_rows,void o(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return j.rows=l,j})}function e3(i){var g=i._compactionQueue[0],h=g.opts,j=g.callback;i.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(h.last_seq=k.last_seq),i._compact(h,function(l,m){l?j(l):j(null,m),eG.nextTick(function(){i._compactionQueue.shift(),i._compactionQueue.length&&e3(i)})})})}function ep(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function fc(i,g,k,h){g.seq=g.seq||0;var j={doc_ids:["_design/"+k],limit:1,since:g.seq};i.changes(j).then(function(l){var m=l.results&&l.results.length&&l.results[0].seq;m&&m>g.seq&&(g.seq=m,delete g.promise),h()})["catch"](h)}function fW(i,g,j){i._ddocCache=i._ddocCache||{},i._ddocCache[g]=i._ddocCache[g]||{};var h=i._ddocCache[g];fc(i,h,g,function(k){return k?j(k):(h.promise||(h.promise=new dQ(function(m,l){i._get("_design/"+g,{},function(p,n){if(p){return l(p)}var q={};["views","filters"].forEach(function(o){q[o]=n.doc[o]}),m(q)})})),void h.promise.then(function(l){j(null,l)})["catch"](j))})}function e2(i,g,k,h,j){fW(i,g,function(n,m){if(n){return j(n)}var l=m[k]&&m[k][h];return l?void j(null,l):j(fF(bS))})}function e1(){b3.EventEmitter.call(this)}function d9(){this.isReady=!1,this.failed=!1,this.queue=[]}function a5(g){g&&eA.debug&&console.error(g)}function cx(l,j){function p(){h.emit("destroyed",m)}function k(){l.removeListener("destroyed",p),l.emit("destroyed",l)}var m=j.originalName,h=l.constructor,g=h._destructionListeners;l.once("destroyed",p),g.has(m)||g.set(m,[]),g.get(m).push(k)}function bF(k,h,m){if(!(this instanceof bF)){return new bF(k,h,m)}var j=this;"function"!=typeof h&&"undefined"!=typeof h||(m=h,h={}),k&&"object"==typeof k&&(h=k,k=void 0),"undefined"==typeof m&&(m=a5),k=k||h.name,h=eW(h),delete h.name,this.__opts=h;var l=m;j.auto_compaction=h.auto_compaction,j.prefix=bF.prefix,e1.call(j),j.taskqueue=new d9;var g=new dQ(function(v,q){m=function(o,i){return o?q(o):(delete i.then,void v(i))},h=eW(h);var n,r,p=h.name||k;return function(){try{if("string"!=typeof p){throw r=new Error("Missing/invalid DB name"),r.code=400,r}if(n=bF.parseAdapter(p,h),h.originalName=p,h.name=n.name,h.prefix&&"http"!==n.adapter&&"https"!==n.adapter&&(h.name=h.prefix+h.name),h.adapter=h.adapter||n.adapter,j._adapter=h.adapter,bk("pouchdb:adapter")("Picked adapter: "+h.adapter),j._db_name=p,!bF.adapters[h.adapter]){throw r=new Error("Adapter is missing"),r.code=404,r}if(!bF.adapters[h.adapter].valid()){throw r=new Error("Invalid Adapter"),r.code=404,r}}catch(i){j.taskqueue.fail(i)}}(),r?q(r):(j.adapter=h.adapter,j.replicate={},j.replicate.from=function(o,i,s){return j.constructor.replicate(o,j,i,s)},j.replicate.to=function(o,i,s){return j.constructor.replicate(j,o,i,s)},j.sync=function(o,i,s){return j.constructor.sync(j,o,i,s)},j.replicate.sync=j.sync,void bF.adapters[h.adapter].call(j,h,function(i){return i?(j.taskqueue.fail(i),void m(i)):(cx(j,h),j.emit("created",j),bF.emit("created",h.originalName),j.taskqueue.ready(j),void m(null,j))}))});g.then(function(i){l(null,i)},l),j.then=g.then.bind(g),j["catch"]=g["catch"].bind(g)}function cb(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function dq(){return dk}function fV(h){Object.keys(b3.EventEmitter.prototype).forEach(function(i){"function"==typeof b3.EventEmitter.prototype[i]&&(h[i]=eg[i].bind(eg))});var g=h._destructionListeners=new ck.Map;h.on("destroyed",function(i){g.has(i)&&(g.get(i).forEach(function(j){j()}),g["delete"](i))})}function bl(k,h){k=k||[],h=h||{};try{return new Blob(k,h)}catch(m){if("TypeError"!==m.name){throw m}for(var j="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,l=new j,g=0;g<k.length;g+=1){l.append(k[g])}return l.getBlob(h.type)}}function aU(h,g){if("undefined"==typeof FileReader){return g((new FileReaderSync).readAsArrayBuffer(h))}var i=new FileReader;i.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);g(k)},i.readAsArrayBuffer(h)}function eU(){for(var i={},g=new dQ(function(k,l){i.resolve=k,i.reject=l}),j=new Array(arguments.length),h=0;h<j.length;h++){j[h]=arguments[h]}return i.promise=g,dQ.resolve().then(function(){return fetch.apply(null,j)}).then(function(k){i.resolve(k)})["catch"](function(k){i.reject(k)}),i}function dY(l,j){var p,k,m,h=new Headers,g={method:l.method,credentials:"include",headers:h};return l.json&&(h.set("Accept","application/json"),h.set("Content-Type",l.headers["Content-Type"]||"application/json")),l.body&&l.body instanceof Blob?aU(l.body,function(i){g.body=i}):l.body&&l.processData&&"string"!=typeof l.body?g.body=JSON.stringify(l.body):"body" in l?g.body=l.body:g.body=null,Object.keys(l.headers).forEach(function(i){l.headers.hasOwnProperty(i)&&h.set(i,l.headers[i])}),p=eU(l.url,g),l.timeout>0&&(k=setTimeout(function(){p.reject(new Error("Load timeout for resource: "+l.url))},l.timeout)),p.promise.then(function(i){return m={statusCode:i.status},l.timeout>0&&clearTimeout(k),m.statusCode>=200&&m.statusCode<300?l.binary?i.blob():i.text():i.json()}).then(function(i){m.statusCode>=200&&m.statusCode<300?j(null,m,i):j(i,m)})["catch"](function(i){j(i,m)}),{abort:p.reject}}function cS(l,q){var j,g,h=!1,k=function(){j.abort()},m=function(){h=!0,j.abort()};j=l.xhr?new l.xhr:new XMLHttpRequest;try{j.open(l.method,l.url)}catch(v){q(v,{statusCode:413})}j.withCredentials="withCredentials" in l?l.withCredentials:!0,"GET"===l.method?delete l.headers["Content-Type"]:l.json&&(l.headers.Accept="application/json",l.headers["Content-Type"]=l.headers["Content-Type"]||"application/json",l.body&&l.processData&&"string"!=typeof l.body&&(l.body=JSON.stringify(l.body))),l.binary&&(j.responseType="arraybuffer"),"body" in l||(l.body=null);for(var p in l.headers){l.headers.hasOwnProperty(p)&&j.setRequestHeader(p,l.headers[p])}return l.timeout>0&&(g=setTimeout(m,l.timeout),j.onprogress=function(){clearTimeout(g),4!==j.readyState&&(g=setTimeout(m,l.timeout))},"undefined"!=typeof j.upload&&(j.upload.onprogress=j.onprogress)),j.onreadystatechange=function(){if(4===j.readyState){var w={statusCode:j.status};if(j.status>=200&&j.status<300){var o;o=l.binary?bl([j.response||""],{type:j.getResponseHeader("Content-Type")}):j.responseText,q(null,w,o)}else{var n={};if(h){n=new Error("ETIMEDOUT"),w.statusCode=400}else{try{n=JSON.parse(j.response)}catch(u){}}q(n,w)}}},l.body&&l.body instanceof Blob?aU(l.body,function(i){j.send(i)}):j.send(l.body),{abort:k}}function el(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function dD(h,g){return bW||h.xhr?cS(h,g):dY(h,g)}function b0(){return""}function aJ(i,g){function k(l,q,m){if(!i.binary&&i.json&&"string"==typeof l){try{l=JSON.parse(l)}catch(p){return m(p)}}Array.isArray(l)&&(l=l.map(function(n){return n.error||n.missing?e8(n):n})),i.binary&&eL(l,q),m(null,l,q)}function h(q,m){var u,p;if(q.code&&q.status){var s=new Error(q.message||q.code);return s.status=q.status,m(s)}if(q.message&&"ETIMEDOUT"===q.message){return m(q)}try{u=JSON.parse(q.responseText),p=e8(u)}catch(l){p=e8(q)}m(p)}i=eW(i);var j={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return i=ch.extend(j,i),i.json&&(i.binary||(i.headers.Accept="application/json"),i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json"),i.binary&&(i.encoding=null,i.json=!1),i.processData||(i.json=!1),dD(i,function(r,n,l){if(r){return r.status=n?n.statusCode:400,h(r,g)}var p,m=n.headers&&n.headers["content-type"],v=l||b0();if(!i.binary&&(i.json||!i.processData)&&"object"!=typeof v&&(/json/.test(m)||/^[\s]*\{/.test(v)&&/\}[\s]*$/.test(v))){try{v=JSON.parse(v.toString())}catch(q){}}n.statusCode>=200&&n.statusCode<300?k(v,n,g):(p=e8(v),p.status=n.statusCode,g(p))})}function f3(l,v){var j=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",g=-1!==j.indexOf("safari")&&-1===j.indexOf("chrome"),h=-1!==j.indexOf("msie"),k=-1!==j.indexOf("edge"),p=g||(h||k)&&"GET"===l.method,w="cache" in l?l.cache:!0,q=/^blob:/.test(l.url);if(!q&&(p||!w)){var m=-1!==l.url.indexOf("?");l.url+=(m?"&":"?")+"_nonce="+Date.now()}return aJ(l,v)}function ap(l){for(var j=fI.exec(l),p={},k=14;k--;){var m=b7[k],h=j[k]||"",g=-1!==["user","password"].indexOf(m);p[m]=g?decodeURIComponent(h):h}return p[f5]={},p[b7[12]].replace(bM,function(o,i,n){i&&(p[f5][i]=n)}),p}function cH(i){for(var g=i.length,k=new ArrayBuffer(g),h=new Uint8Array(k),j=0;g>j;j++){h[j]=i.charCodeAt(j)}return k}function dN(h,g){return bl([cH(h)],{type:g})}function fz(i,g,k){try{return !i(g,k)}catch(h){var j="Filter function threw: "+h.toString();return fF(bI,j)}}function ay(h){var g={},i=h.filter&&"function"==typeof h.filter;return g.query=h.query_params,function(k){k.doc||(k.doc={});var l=i&&fz(h.filter,k.doc,g);if("object"==typeof l){return l}if(l){return !1}if(h.include_docs){if(!h.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function aD(h,g){"console" in eA&&"info" in console&&console.info("The above "+h+" is totally normal. "+g)}function cT(i,g,k,h,j){return i.get(g)["catch"](function(l){if(404===l.status){return"http"===i.type()&&aD(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:h,_id:g,history:[],replicator:cl,version:a2}}throw l}).then(function(l){return j.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==h}),l.history.unshift({last_seq:k,session_id:h}),l.history=l.history.slice(0,by),l.version=a2,l.replicator=cl,l.session_id=h,l.last_seq=k,i.put(l)["catch"](function(m){if(409===m.status){return cT(i,g,k,h,j)}throw m}))})}function c2(i,g,j,h){this.src=i,this.target=g,this.id=j,this.returnValue=h}function bP(i,g){if(i.session_id===g.session_id){return{last_seq:i.last_seq,history:i.history||[]}}var j=i.history||[],h=g.history||[];return ag(j,h)}function ag(m,j){var q=m[0],l=m.slice(1),p=j[0],h=j.slice(1);if(!q||0===j.length){return{last_seq:b4,history:[]}}var g=q.session_id;if(bv(g,j)){return{last_seq:q.last_seq,history:m}}var k=p.session_id;return bv(k,l)?{last_seq:p.last_seq,history:h}:ag(l,h)}function bv(i,g){var j=g[0],h=g.slice(1);return i&&0!==g.length?i===j.session_id?!0:bv(i,h):!1}function cI(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function dE(i,g){i=parseInt(i,10)||0,g=parseInt(g,10),g!==g||i>=g?g=(i||1)<<1:g+=1;var j=Math.random(),h=g-i;return ~~(h*j+i)}function dc(h){var g=0;return h||(g=2000),dE(h,g)}function aZ(i,g,j,h){return i.retry===!1?(g.emit("error",j),void g.removeAllListeners()):("function"!=typeof i.back_off_function&&(i.back_off_function=dc),g.emit("requestError",j),"active"!==g.state&&"pending"!==g.state||(g.emit("paused",j),g.state="stopped",g.once("active",function(){i.current_back_off=fN})),i.current_back_off=i.current_back_off||fN,i.current_back_off=i.back_off_function(i.current_back_off),void setTimeout(h,i.current_back_off))}function fG(g){return cf(g)}function ea(i,g,j,h){(j>0||h<g.byteLength)&&(g=new Uint8Array(g,j,Math.min(h,g.byteLength)-j)),i.append(g)}function c3(i,g,j,h){(j>0||h<g.length)&&(g=g.substring(j,h)),i.appendBinary(g)}function aO(g){return Object.keys(g).sort(fM.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function dO(l,j,p){var k=p.doc_ids?p.doc_ids.sort(fM.collate):"",m=p.filter?p.filter.toString():"",h="",g="";return p.filter&&p.query_params&&(h=JSON.stringify(aO(p.query_params))),p.filter&&"_view"===p.filter&&(g=p.view.toString()),dQ.all([l.id(),j.id()]).then(function(n){var i=n[0]+n[1]+m+g+h+k;return eD(i)}).then(function(i){return i=i.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+i})}function ba(g){return/^1-/.test(g)}function dZ(h){var g=[];return Object.keys(h).forEach(function(j){var i=h[j].missing;i.forEach(function(k){g.push({id:j,rev:k})})}),{docs:g,revs:!0,attachments:!0,binary:!0}}function aq(m,v,j){function g(){var i=dZ(v);if(i.docs.length){return m.bulkGet(i).then(function(n){if(j.cancelled){throw new Error("cancelled")}n.results.forEach(function(o){o.docs.forEach(function(r){r.ok?q.push(r.ok):void 0!==r.error&&(l=!1)})})})}}function h(i){return i._attachments&&Object.keys(i._attachments).length>0}function k(i){return m.allDocs({keys:i,include_docs:!0}).then(function(n){if(j.cancelled){throw new Error("cancelled")}n.rows.forEach(function(o){!o.deleted&&o.doc&&ba(o.value.rev)&&!h(o.doc)&&(q.push(o.doc),delete v[o.id])})})}function p(){var i=Object.keys(v).filter(function(o){var r=v[o].missing;return 1===r.length&&ba(r[0])});return i.length>0?k(i):void 0}function w(){return{ok:l,docs:q}}v=eW(v);var q=[],l=!0;return dQ.resolve().then(p).then(g).then(w)}function cy(dn,ar,bt,be,br){function cr(){return D?dQ.resolve():dO(dn,ar,bt).then(function(g){V=g,D=new c2(dn,ar,V,be)})}function ee(){if(X=[],0!==ai.docs.length){var g=ai.docs;return ar.bulkDocs({docs:g,new_edits:!1}).then(function(k){if(be.cancelled){throw bo(),new Error("cancelled")}var m=[],j={};k.forEach(function(i){i.error&&(br.doc_write_failures++,m.push(i),j[i.id]=i)}),J=J.concat(m),br.docs_written+=ai.docs.length-m.length;var h=m.filter(function(i){return"unauthorized"!==i.name&&"forbidden"!==i.name});if(g.forEach(function(n){var i=j[n._id];i?be.emit("denied",eW(i)):X.push(n)}),h.length>0){var l=new Error("bulkDocs error");throw l.other_errors=m,ct("target.bulkDocs failed to write docs",l),new Error("bulkWrite partial failure")}},function(h){throw br.doc_write_failures+=g.length,h})}}function at(){if(ai.error){throw new Error("There was a problem getting docs.")}br.last_seq=H=ai.seq;var g=eW(br);return X.length&&(g.docs=X,be.emit("change",g)),ae=!0,D.writeCheckpoint(ai.seq,K).then(function(){if(ae=!1,be.cancelled){throw bo(),new Error("cancelled")}ai=void 0,ce()})["catch"](function(h){throw ae=!1,ct("writeCheckpoint completed with error",h),h})}function ao(){var g={};return ai.changes.forEach(function(h){"_user/"!==h.id&&(g[h.id]=h.changes.map(function(i){return i.rev}))}),ar.revsDiff(g).then(function(h){if(be.cancelled){throw bo(),new Error("cancelled")}ai.diffs=h})}function di(){return aq(dn,ai.diffs,be).then(function(g){ai.error=!g.ok,g.docs.forEach(function(h){delete ai.diffs[h._id],br.docs_read++,ai.docs.push(h)})})}function ci(){if(!be.cancelled&&!ai){if(0===cn.length){return void dr(!0)}ai=cn.shift(),ao().then(di).then(ee).then(at).then(ci)["catch"](function(g){ct("batch processing terminated with error",g)})}}function dr(g){return 0===bn.changes.length?void (0!==cn.length||ai||((co&&U.live||Y)&&(be.state="pending",be.emit("paused")),Y&&bo())):void ((g||Y||bn.changes.length>=W)&&(cn.push(bn),bn={seq:0,changes:[],docs:[]},"pending"!==be.state&&"stopped"!==be.state||(be.state="active",be.emit("active")),ci()))}function ct(h,g){z||(g.message||(g.message=h),br.ok=!1,br.status="aborting",br.errors.push(g),J=J.concat(g),cn=[],bn={seq:0,changes:[],docs:[]},bo())}function bo(){if(!(z||be.cancelled&&(br.status="cancelled",ae))){br.status=br.status||"complete",br.end_time=new Date,br.last_seq=H,z=!0;var h=J.filter(function(i){return"unauthorized"!==i.name&&"forbidden"!==i.name});if(h.length>0){var g=J.pop();J.length>0&&(g.other_errors=J),g.result=br,aZ(bt,be,g,function(){cy(dn,ar,bt,be)})}else{br.errors=J,be.emit("complete",br),be.removeAllListeners()}}}function an(h){if(be.cancelled){return bo()}var g=ay(bt)(h);g&&(bn.seq=h.seq,bn.changes.push(h),dr(U.live))}function Z(g){return P=!1,be.cancelled?bo():(g.results.length>0?(U.since=g.last_seq,ce()):co?(U.live=!0,ce()):Y=!0,void dr(!0))}function ei(g){return P=!1,be.cancelled?bo():void ct("changes rejected",g)}function ce(){function h(){g.cancel()}function j(){be.removeListener("cancel",h)}if(!P&&!Y&&cn.length<Q){P=!0,be._changes&&(be.removeListener("cancel",be._abortChanges),be._changes.cancel()),be.once("cancel",h);var g=dn.changes(U).on("change",an);g.then(j,j),g.then(Z)["catch"](ei),bt.retry&&(be._changes=g,be._abortChanges=h)}}function de(){cr().then(function(){return be.cancelled?void bo():D.getCheckpoint().then(function(g){H=g,U={since:H,limit:W,batch_size:W,style:"all_docs",doc_ids:G,return_docs:!0},bt.filter&&("string"!=typeof bt.filter?U.include_docs=!0:U.filter=bt.filter),"heartbeat" in bt&&(U.heartbeat=bt.heartbeat),"timeout" in bt&&(U.timeout=bt.timeout),bt.query_params&&(U.query_params=bt.query_params),bt.view&&(U.view=bt.view),ce()})})["catch"](function(g){ct("getCheckpoint rejected with ",g)})}function dt(g){throw ae=!1,ct("writeCheckpoint completed with error",g),g}var ai,V,D,cn=[],bn={seq:0,changes:[],docs:[]},ae=!1,Y=!1,z=!1,H=0,co=bt.continuous||bt.live||!1,W=bt.batch_size||100,Q=bt.batches_limit||10,P=!1,G=bt.doc_ids,J=[],X=[],K=fC();br=br||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var U={};return be.ready(dn,ar),be.cancelled?void bo():(be._addedListeners||(be.once("cancel",bo),"function"==typeof bt.complete&&(be.once("error",bt.complete),be.once("complete",function(g){bt.complete(null,g)})),be._addedListeners=!0),void ("undefined"==typeof bt.since?de():cr().then(function(){return ae=!0,D.writeCheckpoint(bt.since,K)}).then(function(){return ae=!1,be.cancelled?void bo():(H=bt.since,void de())})["catch"](dt)))}function ds(){b3.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var h=this,g=new dQ(function(i,j){h.once("complete",i),h.once("error",j)});h.then=function(i,j){return g.then(i,j)},h["catch"]=function(i){return g["catch"](i)},h["catch"](function(){})}function fX(h,g){var i=g.PouchConstructor;return"string"==typeof h?new i(h,g):h}function em(l,j,p,k){if("function"==typeof p&&(k=p,p={}),"undefined"==typeof p&&(p={}),p.doc_ids&&!Array.isArray(p.doc_ids)){throw fF(bI,"`doc_ids` filter parameter is not a list.")}p.complete=k,p=eW(p),p.continuous=p.continuous||p.live,p.retry="retry" in p?p.retry:!1,p.PouchConstructor=p.PouchConstructor||this;var m=new ds(p),h=fX(l,p),g=fX(j,p);return cy(h,g,p,m),m}function b1(i,g,j,h){return"function"==typeof j&&(h=j,j={}),"undefined"==typeof j&&(j={}),j=eW(j),j.PouchConstructor=j.PouchConstructor||this,i=dR.toPouch(i,j),g=dR.toPouch(g,j),new e0(i,g,j,h)}function e0(F,m,A,w){function z(h){D.emit("change",{direction:"pull",change:h})}function C(h){D.emit("change",{direction:"push",change:h})}function I(h){D.emit("denied",{direction:"push",doc:h})}function q(h){D.emit("denied",{direction:"pull",doc:h})}function k(){D.pushPaused=!0,D.pullPaused&&D.emit("paused")}function H(){D.pullPaused=!0,D.pushPaused&&D.emit("paused")}function E(){D.pushPaused=!1,D.pullPaused&&D.emit("active",{direction:"push"})}function B(){D.pullPaused=!1,D.pushPaused&&D.emit("active",{direction:"pull"})}function G(h){return function(l,y){var o="change"===l&&(y===z||y===C),u="denied"===l&&(y===q||y===I),s="paused"===l&&(y===H||y===k),i="active"===l&&(y===B||y===E);(o||u||s||i)&&(l in g||(g[l]={}),g[l][h]=!0,2===Object.keys(g[l]).length&&D.removeAllListeners(l))}}var D=this;this.canceled=!1;var x=A.push?ch.extend({},A,A.push):A,j=A.pull?ch.extend({},A,A.pull):A;this.push=cL(F,m,x),this.pull=cL(m,F,j),this.pushPaused=!0,this.pullPaused=!0;var g={};A.live&&(this.push.on("complete",D.pull.cancel.bind(D.pull)),this.pull.on("complete",D.push.cancel.bind(D.push))),this.on("newListener",function(h){"change"===h?(D.pull.on("change",z),D.push.on("change",C)):"denied"===h?(D.pull.on("denied",q),D.push.on("denied",I)):"active"===h?(D.pull.on("active",B),D.push.on("active",E)):"paused"===h&&(D.pull.on("paused",H),D.push.on("paused",k))}),this.on("removeListener",function(h){"change"===h?(D.pull.removeListener("change",z),D.push.removeListener("change",C)):"denied"===h?(D.pull.removeListener("denied",q),D.push.removeListener("denied",I)):"active"===h?(D.pull.removeListener("active",B),D.push.removeListener("active",E)):"paused"===h&&(D.pull.removeListener("paused",H),D.push.removeListener("paused",k))}),this.pull.on("removeListener",G("pull")),this.push.on("removeListener",G("push"));var J=dQ.all([this.push,this.pull]).then(function(i){var h={push:i[0],pull:i[1]};return D.emit("complete",h),w&&w(null,h),D.removeAllListeners(),h},function(h){if(D.cancel(),w?w(h):D.emit("error",h),D.removeAllListeners(),w){throw h}});this.then=function(i,h){return J.then(i,h)},this["catch"]=function(h){return J["catch"](h)}}function cc(h,g){return dN(c9(h),g)}function f8(i){for(var g="",k=new Uint8Array(i),h=k.byteLength,j=0;h>j;j++){g+=String.fromCharCode(k[j])}return g}function bQ(i,g){if("undefined"==typeof FileReader){return g(f8((new FileReaderSync).readAsArrayBuffer(i)))}var j=new FileReader,h="function"==typeof j.readAsBinaryString;j.onloadend=function(k){var l=k.target.result||"";return h?g(l):void g(f8(l))},h?j.readAsBinaryString(i):j.readAsArrayBuffer(i)}function fP(g){return new dQ(function(h){bQ(g,function(i){h(cf(i))})})}function dd(i){for(var g=[],j=0,h=i.length;h>j;j++){g=g.concat(i[j])}return g}function cp(h){var g=h.doc&&h.doc._attachments;g&&Object.keys(g).forEach(function(i){var j=g[i];j.data=cc(j.data,j.content_type)})}function bG(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function bu(g){return g._attachments&&Object.keys(g._attachments)?dQ.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?fP(i.data).then(function(j){i.data=j}):void 0})):dQ.resolve()}function d0(h){var g=ap(h);(g.user||g.password)&&(g.auth={username:g.user,password:g.password});var i=g.path.replace(/(^\/|\/$)/g,"").split("/");return g.db=i.pop(),-1===g.db.indexOf("%")&&(g.db=encodeURIComponent(g.db)),g.path=i.join("/"),g}function a0(h,g){return cj(h,h.db+"/"+g)}function cj(h,g){var i=h.path?"/":"";return h.protocol+"://"+h.host+(h.port?":"+h.port:"")+"/"+h.path+i+g}function bw(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function b2(A,G){function k(m,h,s){var l=m.ajax||{},p=ch.extend(eW(i),l,h);return ad(p.method+" "+p.url),bh.ajax(p,s)}function g(l,h){return new dQ(function(m,n){k(l,h,function(p,o){return p?n(p):void m(o)})})}function j(l,h){return eV(l,bx(function(m){C().then(function(){return h.apply(this,m)})["catch"](function(o){var p=m.pop();p(o)})}))}function C(){if(A.skipSetup||A.skip_setup){return dQ.resolve()}if(q){return q}var h={method:"GET",url:x};return q=g({},h)["catch"](function(l){return l&&l.status&&404===l.status?(aD(404,"PouchDB is just detecting if the remote exists."),g({},{method:"PUT",url:x})):dQ.reject(l)})["catch"](function(l){return l&&l.status&&412===l.status?!0:dQ.reject(l)}),q["catch"](function(){q=null}),q}function H(h){return h.split("/").map(encodeURIComponent).join("/")}var F=this,z=d0;A.getHost&&(z=A.getHost);var w=z(A.name,A),x=a0(w,"");A=eW(A);var i=A.ajax||{};if(F.getUrl=function(){return x},F.getHeaders=function(){return i.headers||{}},A.auth||w.auth){var E=A.auth||w.auth,B=E.username+":"+E.password,D=cf(unescape(encodeURIComponent(B)));i.headers=i.headers||{},i.headers.Authorization="Basic "+D}var q;setTimeout(function(){G(null,F)}),F.type=function(){return"http"},F.id=j("id",function(h){k({},{method:"GET",url:cj(w,"")},function(l,o){var m=o&&o.uuid?o.uuid+w.db:a0(w,"");h(null,m)})}),F.request=j("request",function(l,h){l.url=a0(w,l.url),k({},l,h)}),F.compact=j("compact",function(l,h){"function"==typeof l&&(h=l,l={}),l=eW(l),k(l,{url:a0(w,"_compact"),method:"POST"},function(){function m(){F.info(function(n,p){p&&!p.compact_running?h(null,{ok:!0}):setTimeout(m,l.interval||200)})}m()})}),F.bulkGet=eV("bulkGet",function(v,m){function p(o){var s={};v.revs&&(s.revs=!0),v.attachments&&(s.attachments=!0),k({},{url:a0(w,"_bulk_get"+bw(s)),method:"POST",body:{docs:v.docs}},o)}function y(){function O(o){return function(u,s){I[o]=s.results,++J===M&&m(null,{results:dd(I)})}}for(var K=bT,M=Math.ceil(v.docs.length/K),J=0,I=new Array(M),N=0;M>N;N++){var L=eO(v,["revs","attachments"]);L.ajax=i,L.docs=v.docs.slice(N*K,Math.min(v.docs.length,(N+1)*K)),fD(h,L,O(N))}}var h=this,n=cj(w,""),l=aG[n];"boolean"!=typeof l?p(function(s,u){if(s){var o=Math.floor(s.status/100);4===o||5===o?(aG[n]=!1,aD(s.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),y()):m(s)}else{aG[n]=!0,m(null,u)}}):l?p(m):y()}),F._info=function(h){C().then(function(){k({},{method:"GET",url:a0(w,"")},function(l,m){return l?h(l):(m.host=a0(w,""),void h(null,m))})})["catch"](h)},F.get=j("get",function(r,p,v){function s(u){var I=u._attachments,y=I&&Object.keys(I);return I&&y.length?dQ.all(y.map(function(K){var J=I[K],n=bG(u._id)+"/"+H(K)+"?rev="+u._rev;return g(p,{method:"GET",url:a0(w,n),binary:!0}).then(function(o){return p.binary?o:fP(o)}).then(function(o){delete J.stub,delete J.length,J.data=o})})):void 0}function m(n){return Array.isArray(n)?dQ.all(n.map(function(o){return o.ok?s(o.ok):void 0})):s(n)}"function"==typeof p&&(v=p,p={}),p=eW(p);var h={};p.revs&&(h.revs=!0),p.revs_info&&(h.revs_info=!0),p.open_revs&&("all"!==p.open_revs&&(p.open_revs=JSON.stringify(p.open_revs)),h.open_revs=p.open_revs),p.rev&&(h.rev=p.rev),p.conflicts&&(h.conflicts=p.conflicts),r=bG(r);var l={method:"GET",url:a0(w,r+bw(h))};g(p,l).then(function(n){return dQ.resolve().then(function(){return p.attachments?m(n):void 0}).then(function(){v(null,n)})})["catch"](v)}),F.remove=j("remove",function(p,m,n,s){var l;"string"==typeof m?(l={_id:p,_rev:m},"function"==typeof n&&(s=n,n={})):(l=p,"function"==typeof m?(s=m,n={}):(s=n,n=m));var h=l._rev||n.rev;k(n,{method:"DELETE",url:a0(w,bG(l._id))+"?rev="+h},s)}),F.getAttachment=j("getAttachment",function(p,m,n,s){"function"==typeof n&&(s=n,n={});var l=n.rev?"?rev="+n.rev:"",h=a0(w,bG(p))+"/"+H(m)+l;k(n,{method:"GET",url:h,binary:!0},s)}),F.removeAttachment=j("removeAttachment",function(n,l,m,p){var h=a0(w,bG(n)+"/"+H(l))+"?rev="+m;k({},{method:"DELETE",url:h},p)}),F.putAttachment=j("putAttachment",function(v,L,l,m,n,J){"function"==typeof n&&(J=n,n=m,m=l,l=null);var K=bG(v)+"/"+H(L),I=a0(w,K);if(l&&(I+="?rev="+l),"string"==typeof m){var s;try{s=c9(m)}catch(y){return J(fF(av,"Attachment is not a valid base64 string"))}m=s?dN(s,n):""}var p={headers:{"Content-Type":n},method:"PUT",url:I,processData:!1,body:m,timeout:i.timeout||60000};k({},p,J)}),F._bulkDocs=function(m,h,l){m.new_edits=h.new_edits,C().then(function(){return dQ.all(m.docs.map(bu))}).then(function(){k(h,{method:"POST",url:a0(w,"_bulk_docs"),body:m},function(o,n){return o?l(o):(n.forEach(function(p){p.ok=!0}),void l(null,n))})})["catch"](l)},F.allDocs=j("allDocs",function(r,m){"function"==typeof r&&(m=r,r={}),r=eW(r);var v,u={},l="GET";r.conflicts&&(u.conflicts=!0),r.descending&&(u.descending=!0),r.include_docs&&(u.include_docs=!0),r.attachments&&(u.attachments=!0),r.key&&(u.key=JSON.stringify(r.key)),r.start_key&&(r.startkey=r.start_key),r.startkey&&(u.startkey=JSON.stringify(r.startkey)),r.end_key&&(r.endkey=r.end_key),r.endkey&&(u.endkey=JSON.stringify(r.endkey)),"undefined"!=typeof r.inclusive_end&&(u.inclusive_end=!!r.inclusive_end),"undefined"!=typeof r.limit&&(u.limit=r.limit),"undefined"!=typeof r.skip&&(u.skip=r.skip);var h=bw(u);if("undefined"!=typeof r.keys){var p="keys="+encodeURIComponent(JSON.stringify(r.keys));p.length+h.length+1<=f0?h+="&"+p:(l="POST",v={keys:r.keys})}g(r,{method:l,url:a0(w,"_all_docs"+h),body:v}).then(function(o){r.include_docs&&r.attachments&&r.binary&&o.rows.forEach(cp),m(null,o)})["catch"](m)}),F._changes=function(M){var S="batch_size" in M?M.batch_size:dw;M=eW(M),M.timeout="timeout" in M?M.timeout:"timeout" in i?i.timeout:30000;var l,n=M.timeout?{timeout:M.timeout-5000}:{},I="undefined"!=typeof M.limit?M.limit:!1;l="return_docs" in M?M.return_docs:"returnDocs" in M?M.returnDocs:!0;var T=I;if(M.style&&(n.style=M.style),(M.include_docs||M.filter&&"function"==typeof M.filter)&&(n.include_docs=!0),M.attachments&&(n.attachments=!0),M.continuous&&(n.feed="longpoll"),M.conflicts&&(n.conflicts=!0),M.descending&&(n.descending=!0),"heartbeat" in M?M.heartbeat&&(n.heartbeat=M.heartbeat):n.heartbeat=10000,M.filter&&"string"==typeof M.filter&&(n.filter=M.filter,"_view"===M.filter&&M.view&&"string"==typeof M.view&&(n.view=M.view)),M.query_params&&"object"==typeof M.query_params){for(var R in M.query_params){M.query_params.hasOwnProperty(R)&&(n[R]=M.query_params[R])}}var L,N="GET";if(M.doc_ids){n.filter="_doc_ids";var J=JSON.stringify(M.doc_ids);J.length<f0?n.doc_ids=J:(N="POST",L={doc_ids:M.doc_ids})}var Q,O,P=function(m,h){if(!M.aborted){n.since=m,"object"==typeof n.since&&(n.since=JSON.stringify(n.since)),M.descending?I&&(n.limit=T):n.limit=!I||T>S?S:T;var o={method:N,url:a0(w,"_changes"+bw(n)),timeout:M.timeout,body:L};O=m,M.aborted||C().then(function(){Q=k(M,o,h)})["catch"](h)}},p={results:[]},K=function(v,r){if(!M.aborted){var h=0;if(r&&r.results){h=r.results.length,p.last_seq=r.last_seq;var m={};m.query=M.query_params,r.results=r.results.filter(function(o){T--;var u=ay(M)(o);return u&&(M.include_docs&&M.attachments&&M.binary&&cp(o),l&&p.results.push(o),M.onChange(o)),u})}else{if(v){return M.aborted=!0,void M.complete(v)}}r&&r.last_seq&&(O=r.last_seq);var s=I&&0>=T||r&&S>h||M.descending;(!M.continuous||I&&0>=T)&&s?M.complete(null,p):setTimeout(function(){P(O,K)},0)}};return P(M.since||0,K),{cancel:function(){M.aborted=!0,Q&&Q.abort()}}},F.revsDiff=j("revsDiff",function(m,h,l){"function"==typeof h&&(l=h,h={}),k(h,{method:"POST",url:a0(w,"_revs_diff"),body:m},l)}),F._close=function(h){h()},F._destroy=function(h,l){k(h,{url:a0(w,""),method:"DELETE"},function(m,o){return m&&m.status&&404!==m.status?l(m):(F.emit("destroyed"),F.constructor.emit("destroyed",A.name),void l(null,o))})}}function df(){this.promise=new dQ(function(g){g()})}function fL(g){return aQ.hash(g)}function bb(m){var j=m.db,q=m.viewName,l=m.map,p=m.reduce,h=m.temporary,g=l.toString()+(p&&p.toString())+"undefined";if(!h&&j._cachedViews){var k=j._cachedViews[g];if(k){return dQ.resolve(k)}}return j.info().then(function(o){function n(v){v.views=v.views||{};var s=q;-1===s.indexOf("/")&&(s=q+"/"+q);var u=v.views[s]=v.views[s]||{};if(!u[i]){return u[i]=!0,v}}var i=o.db_name+"-mrview-"+(h?"temp":fL(g));return eQ(j,"_local/mrviews",n).then(function(){return j.registerDependentDatabase(i).then(function(u){var v=u.db;v.auto_compaction=!0;var r={name:i,db:v,sourceDB:j,adapter:j.adapter,mapFun:l,reduceFun:p};return r.db.get("_local/lastSeq")["catch"](function(s){if(404!==s.status){throw s}}).then(function(s){return r.seq=s?s.seq:0,h||(j._cachedViews=j._cachedViews||{},j._cachedViews[g]=r,r.db.once("destroyed",function(){delete j._cachedViews[g]})),r})})})})}function aP(k,h,m,j,l,g){return dg("return ("+k.replace(/;\s*$/,"")+");",{emit:h,sum:m,log:j,isArray:l,toJSON:g})}function ex(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function dP(g){return 1===g.length&&/^1-/.test(g[0].rev)}function cJ(h,g){try{h.emit("error",g)}catch(i){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(g)}}function eb(i,g,j){try{return{output:g.apply(null,j)}}catch(h){return cJ(i,h),{error:h}}}function du(h,g){var i=bJ(h.key,g.key);return 0!==i?i:bJ(h.value,g.value)}function bR(h,g,i){return i=i||0,"number"==typeof g?h.slice(i,g+i):i>0?h.slice(i):h}function aE(h){var g=h.value,i=g&&"object"==typeof g&&g._id||h.id;return i}function fY(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=cc(k.data,k.content_type)})})}function ab(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&fY(h),h}}function cz(h){var g="builtin "+h+" function requires map values to be numbers or number arrays";return new dj(g)}function dF(m){for(var j=0,q=0,l=m.length;l>q;q++){var p=m[q];if("number"!=typeof p){if(!Array.isArray(p)){throw cz("_sum")}j="number"==typeof j?[j]:j;for(var h=0,g=p.length;g>h;h++){var k=p[h];if("number"!=typeof k){throw cz("_sum")}"undefined"==typeof j[h]?j.push(k):j[h]+=k}}else{"number"==typeof j?j+=p:j[0]+=p}}return j}function e6(i,g,k,h){var j=g[i];"undefined"!=typeof j&&(h&&(j=encodeURIComponent(JSON.stringify(j))),k.push(i+"="+j))}function au(h){if("undefined"!=typeof h){var g=Number(h);return isNaN(g)||g!==parseInt(h,10)?h:g}}function az(g){return g.group_level=au(g.group_level),g.limit=au(g.limit),g.skip=au(g.skip),g}function cN(g){if(g){if("number"!=typeof g){return new cq('Invalid value for integer: "'+g+'"')}if(0>g){return new cq('Invalid value for positive integer: "'+g+'"')}}}function cU(i,g){var j=i.descending?"endkey":"startkey",h=i.descending?"startkey":"endkey";if("undefined"!=typeof i[j]&&"undefined"!=typeof i[h]&&bJ(i[j],i[h])>0){throw new cq("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(g.reduce&&i.reduce!==!1){if(i.include_docs){throw new cq("{include_docs:true} is invalid for reduce")}if(i.keys&&i.keys.length>1&&!i.group&&!i.group_level){throw new cq("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=cN(i[k]);if(l){throw l}})}function bH(l,q,j){var g,h=[],k="GET";if(e6("reduce",j,h),e6("include_docs",j,h),e6("attachments",j,h),e6("limit",j,h),e6("descending",j,h),e6("group",j,h),e6("group_level",j,h),e6("skip",j,h),e6("stale",j,h),e6("conflicts",j,h),e6("startkey",j,h,!0),e6("start_key",j,h,!0),e6("endkey",j,h,!0),e6("end_key",j,h,!0),e6("inclusive_end",j,h),e6("key",j,h,!0),h=h.join("&"),h=""===h?"":"?"+h,"undefined"!=typeof j.keys){var m=2000,v="keys="+encodeURIComponent(JSON.stringify(j.keys));v.length+h.length+1<=m?h+=("?"===h[0]?"&":"?")+v:(k="POST","string"==typeof q?g={keys:j.keys}:q.keys=j.keys)}if("string"==typeof q){var p=ex(q);return l.request({method:k,url:"_design/"+p[0]+"/_view/"+p[1]+h,body:g}).then(ab(j))}return g=g||{},Object.keys(q).forEach(function(i){Array.isArray(q[i])?g[i]=q[i]:g[i]=q[i].toString()}),l.request({method:"POST",url:"_temp_view"+h,body:g}).then(ab(j))}function f9(h,g,i){return new dQ(function(j,k){h._query(g,i,function(m,l){return m?k(m):void j(l)})})}function bm(g){return new dQ(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function cD(g){return function(h){if(404===h.status){return g}throw h}}function dy(m,w,j){function g(){return dP(l)?dQ.resolve(x):w.db.get(q)["catch"](cD(x))}function h(i){return i.keys.length?w.db.allDocs({keys:i.keys,include_docs:!0}):dQ.resolve({rows:[]})}function k(D,G){for(var A=[],y={},z=0,B=G.rows.length;B>z;z++){var E=G.rows[z],H=E.doc;if(H&&(A.push(H),y[H._id]=!0,H._deleted=!p[H._id],!H._deleted)){var F=p[H._id];"value" in F&&(H.value=F.value)}}var C=Object.keys(p);return C.forEach(function(n){if(!y[n]){var i={_id:n},r=p[n];"value" in r&&(i.value=r.value),A.push(i)}}),D.keys=aX(C.concat(D.keys)),A.push(D),A}var q="_local/doc_"+m,x={_id:q,keys:[]},v=j[m],p=v.indexableKeysToKeyValues,l=v.changes;return g().then(function(i){return h(i).then(function(n){return k(i,n)})})}function c4(i,g,j){var h="_local/lastSeq";return i.db.get(h)["catch"](cD({_id:h,seq:0})).then(function(k){var l=Object.keys(g);return dQ.all(l.map(function(m){return dy(m,i,g)})).then(function(m){var n=dd(m);return k.seq=j,n.push(k),i.db.bulkDocs({docs:n})})})}function aV(h){var g="string"==typeof h?h:h.name,i=c0[g];return i||(i=c0[g]=new df),i}function fk(g){return c6(aV(g),function(){return d4(g)})()}function d4(l){function q(o,i){var r={id:h._id,key:bq(o)};"undefined"!=typeof i&&null!==i&&(r.value=bq(i)),g.push(r)}function j(i,o){return function(){return c4(l,i,o)}}var g,h,k;if("function"==typeof l.mapFun&&2===l.mapFun.length){var m=l.mapFun;k=function(i){return m(i,q)}}else{k=aP(l.mapFun.toString(),q,dF,cB,Array.isArray,JSON.parse)}var v=l.seq||0,p=new df;return new dQ(function(n,i){function r(){p.finish().then(function(){l.seq=v,n()})}function o(){function s(u){i(u)}l.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:v,limit:dL}).on("complete",function(J){var F=J.results;if(!F.length){return r()}for(var z={},C=0,A=F.length;A>C;C++){var u=F[C];if("_"!==u.doc._id[0]){g=[],h=u.doc,h._deleted||eb(l.sourceDB,k,[h]),g.sort(du);for(var I,E={},H=0,x=g.length;x>H;H++){var B=g[H],D=[B.key,B.id];0===bJ(B.key,I)&&D.push(H);var G=t(D);E[G]=B,I=B.key}z[u.doc._id]={indexableKeysToKeyValues:E,changes:u.changes}}v=u.seq}return p.add(j(z,v)),F.length<dL?r():o()}).on("error",s)}o()})}function cY(m,w,j){0===j.group_level&&delete j.group_level;var g,h=j.group||j.group_level;g=a8[m.reduceFun]?a8[m.reduceFun]:aP(m.reduceFun.toString(),null,dF,cB,Array.isArray,JSON.parse);var k=[],q=isNaN(j.group_level)?Number.POSITIVE_INFINITY:j.group_level;w.forEach(function(o){var i=k[k.length-1],r=h?o.key:null;return h&&Array.isArray(r)&&(r=r.slice(0,q)),i&&0===bJ(i.groupKey,r)?(i.keys.push([o.key,o.id]),void i.values.push(o.value)):void k.push({keys:[[o.key,o.id]],values:[o.value],groupKey:r})}),w=[];for(var x=0,v=k.length;v>x;x++){var p=k[x],l=eb(m.sourceDB,g,[p.keys,p.values,!1]);if(l.error&&l.error instanceof dj){throw l.error}w.push({value:l.error?null:l.output,key:p.groupKey})}return{rows:bR(w,j.limit,j.skip)}}function aK(h,g){return c6(aV(h),function(){return dJ(h,g)})()}function dJ(q,z){function j(i){return i.include_docs=!0,q.db.allDocs(i).then(function(l){return h=l.total_rows,l.rows.map(function(u){if("value" in u.doc&&"object"==typeof u.doc.value&&null!==u.doc.value){var o=Object.keys(u.doc.value).sort(),B=["id","key","value"];if(!(B>o||o>B)){return u.doc.value}}var s=cF(u.doc._id);return{key:s[0],id:s[1],value:"value" in u.doc?u.doc.value:null}})})}function g(o){var l;if(l=m?cY(q,o,z):{total_rows:h,offset:x,rows:o},z.include_docs){var i=aX(o.map(aE));return q.sourceDB.allDocs({keys:i,include_docs:!0,conflicts:z.conflicts,attachments:z.attachments,binary:z.binary}).then(function(r){var n={};return r.rows.forEach(function(s){s.doc&&(n["$"+s.id]=s.doc)}),o.forEach(function(u){var B=aE(u),s=n["$"+B];s&&(u.doc=s)}),l})}return l}var h,m=q.reduceFun&&z.reduce!==!1,x=z.skip||0;if("undefined"==typeof z.keys||z.keys.length||(z.limit=0,delete z.keys),"undefined"!=typeof z.keys){var A=z.keys,y=A.map(function(l){var i={startkey:t([l]),endkey:t([l,{}])};return j(i)});return dQ.all(y).then(dd).then(g)}var w={descending:z.descending};if(z.start_key&&(z.startkey=z.start_key),z.end_key&&(z.endkey=z.end_key),"undefined"!=typeof z.startkey&&(w.startkey=t(z.descending?[z.startkey,{}]:[z.startkey])),"undefined"!=typeof z.endkey){var p=z.inclusive_end!==!1;z.descending&&(p=!p),w.endkey=t(p?[z.endkey,{}]:[z.endkey])}if("undefined"!=typeof z.key){var k=t([z.key]),v=t([z.key,{}]);w.descending?(w.endkey=k,w.startkey=v):(w.startkey=k,w.endkey=v)}return m||("number"==typeof z.limit&&(w.limit=z.limit),w.skip=x),j(w).then(g)}function a6(g){return g.request({method:"POST",url:"_view_cleanup"})}function dT(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(m){var k=ex(m),l="_design/"+k[0],n=k[1];j[l]=j[l]||{},j[l][n]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(m){var n={};m.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(v){var r=o+"/"+v;h.views[r]||(r=v);var q=Object.keys(h.views[r]),u=p.doc&&p.doc.views&&p.doc.views[v];q.forEach(function(s){n[s]=n[s]||u})})});var l=Object.keys(n).filter(function(o){return !n[o]}),k=l.map(function(o){return c6(aV(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return dQ.all(k).then(function(){return{ok:!0}})})},cD({ok:!0}))}function ah(n,k,m){if("http"===n.type()){return bH(n,k,m)}if("function"==typeof n._query){return f9(n,k,m)}if("string"!=typeof k){cU(m,k);var p={db:n,viewName:"temp_view/temp_view",map:k.map,reduce:k.reduce,temporary:!0};return aM.add(function(){return bb(p).then(function(o){function i(){return o.db.destroy()}return fu(fk(o).then(function(){return aK(o,m)}),i)})}),aM.finish()}var j=k,g=ex(j),l=g[0],h=g[1];return n.getView(l,h).then(function(i){cU(m,i);var q={db:n,viewName:j,map:i.map,reduce:i.reduce};return bb(q).then(function(o){return"ok"===m.stale||"update_after"===m.stale?("update_after"===m.stale&&eG.nextTick(function(){fk(o)}),aK(o,m)):fk(o).then(function(){return aK(o,m)})})})}function cq(h){this.status=400,this.name="query_parse_error",this.message=h,this.error=!0;try{Error.captureStackTrace(this,cq)}catch(g){}}function dj(h){this.status=500,this.name="invalid_value",this.message=h,this.error=!0;try{Error.captureStackTrace(this,dj)}catch(g){}}function fQ(g){return cf(f8(g))}function ef(m,j,q){function l(o){try{return c9(o)}catch(i){var r=fF(av,"Attachment is not a valid base64 string");return{error:r}}}function p(i,s){if(i.stub){return s()}if("string"==typeof i.data){var r=l(i.data);if(r.error){return s(r.error)}i.length=r.length,"blob"===j?i.data=dN(r,i.content_type):"base64"===j?i.data=cf(r):i.data=r,eD(r).then(function(n){i.digest="md5-"+n,s()})}else{aU(i.data,function(n){"binary"===j?i.data=f8(n):"base64"===j&&(i.data=fQ(n)),eD(n).then(function(o){i.digest="md5-"+o,i.length=n.byteLength,s()})})}}function h(){k++,m.length===k&&(g?q(g):q())}if(!m.length){return q()}var g,k=0;m.forEach(function(v){function i(n){g=n,u++,u===w.length&&h()}var w=v.data&&v.data._attachments?Object.keys(v.data._attachments):[],u=0;if(!w.length){return h()}for(var o in v.data._attachments){v.data._attachments.hasOwnProperty(o)&&p(v.data._attachments[o],i)}})}function bV(h,g){return h.pos-g.pos}function eI(k,h,m){for(var j,l=0,g=k.length;g>l;){j=l+g>>>1,m(k[j],h)<0?l=j+1:g=j}return l}function b6(i,g,j){var h=eI(i,g,j);i.splice(h,0,g)}function f4(m,j){for(var q,l,p=j,h=m.length;h>p;p++){var g=m[p],k=[g.id,g.opts,[]];l?(l[2].push(k),l=k):q=l=k}return q}function bL(h,g){return h[0]<g[0]?-1:1}function fH(l,v){for(var j=[{tree1:l,tree2:v}],g=!1;j.length>0;){var h=j.pop(),k=h.tree1,p=h.tree2;(k[1].status||p[1].status)&&(k[1].status="available"===k[1].status||"available"===p[1].status?"available":"missing");for(var w=0;w<p[2].length;w++){if(k[2][0]){for(var q=!1,m=0;m<k[2].length;m++){k[2][m][0]===p[2][w][0]&&(j.push({tree1:k[2][m],tree2:p[2][w]}),q=!0)}q||(g="new_branch",b6(k[2],p[2][w],bL))}else{g="new_leaf",k[2][0]=p[2][w]}}}return{conflicts:g,tree:l}}function c8(J,w,C){var z,B=[],F=!1,M=!1;if(!J.length){return{tree:[w],conflicts:"new_leaf"}}for(var x=0,q=J.length;q>x;x++){var L=J[x];if(L.pos===w.pos&&L.ids[0]===w.ids[0]){z=fH(L.ids,w.ids),B.push({pos:L.pos,ids:z.tree}),F=F||z.conflicts,M=!0}else{if(C!==!0){var I=L.pos<w.pos?L:w,E=L.pos<w.pos?w:L,K=E.pos-I.pos,G=[],A=[];for(A.push({ids:I.ids,diff:K,parent:null,parentIdx:null});A.length>0;){var k=A.pop();if(0!==k.diff){for(var j=k.ids[2],N=0,D=j.length;D>N;N++){A.push({ids:j[N],diff:k.diff-1,parent:k.ids,parentIdx:N})}}else{k.ids[0]===E.ids[0]&&G.push(k)}}var H=G[0];H?(z=fH(H.ids,E.ids),H.parent[2][H.parentIdx]=z.tree,B.push({pos:I.pos,ids:I.ids}),F=F||z.conflicts,M=!0):B.push(L)}else{B.push(L)}}}return M||B.push(w),B.sort(bV),{tree:B,conflicts:F||"internal_node"}}function cd(q,z){for(var j,g=fm(q),h={},m=0,x=g.length;x>m;m++){for(var A=g[m],y=A.ids,w=Math.max(0,y.length-z),p={pos:A.pos+w,ids:f4(y,w)},k=0;w>k;k++){var v=A.pos+k+"-"+y[k].id;h[v]=!0}j=j?c8(j,p,!0).tree:[p]}return fB(j,function(l,i,o){delete h[i+"-"+o]}),{tree:j,revs:Object.keys(h)}}function bA(i,g,k){var h=c8(i,g),j=cd(h.tree,k);return{tree:j.tree,stemmedRevs:j.revs,conflicts:h.conflicts}}function bg(l,v){for(var j,g=l.slice(),h=v.split("-"),k=parseInt(h[0],10),p=h[1];j=g.pop();){if(j.pos===k&&j.ids[0]===p){return !0}for(var w=j.ids[2],q=0,m=w.length;m>q;q++){g.push({pos:j.pos+1,ids:w[q]})}}return !1}function d3(L,x,D,A,C,H,P,z){if(bg(x.rev_tree,D.metadata.rev)){return A[C]=D,H()}var q=x.winningRev||ev(x),N="deleted" in x?x.deleted:eZ(x,q),K="deleted" in D.metadata?D.metadata.deleted:eZ(D.metadata),G=/^1-/.test(D.metadata.rev);if(N&&!K&&z&&G){var M=D.data;M._rev=q,M._id=D.metadata.id,D=e7(M,z)}var I=bA(x.rev_tree,D.metadata.rev_tree[0],L),B=z&&(N&&K||!N&&"new_leaf"!==I.conflicts||N&&!K&&"new_branch"===I.conflicts);if(B){var j=fF(aF);return A[C]=j,H()}var F=D.metadata.rev;D.metadata.rev_tree=I.tree,D.stemmedRevs=I.stemmedRevs||[],x.rev_map&&(D.metadata.rev_map=x.rev_map);var J,O=ev(D.metadata),k=eZ(D.metadata,O),v=N===k?0:k>N?-1:1;J=F===O?k:eZ(D.metadata,F),P(D,O,k,J,!0,v,C,H)}function a3(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function cm(y,D,m,g,k,v,B,E,C){function A(s,i,H){var l=ev(s.metadata),F=eZ(s.metadata,l);if("was_delete" in E&&F){return v[i]=fF(bS,"deleted"),H()}var h=q&&a3(s);if(h){var G=fF(aF);return v[i]=G,H()}var p=F?0:1;B(s,l,F,F,!1,p,i,H)}function x(){++w===j&&C&&C()}y=y||1000;var q=E.new_edits,z=new ck.Map,w=0,j=D.length;D.forEach(function(n,i){if(n._id&&fv(n._id)){var l=n._deleted?"_removeLocal":"_putLocal";return void m[l](n,{ctx:k},function(o,p){v[i]=o||p,x()})}var h=n.metadata.id;z.has(h)?(j--,z.get(h).push([n,i])):z.set(h,[[n,i]])}),z.forEach(function(i,r){function p(){++h<i.length?l():x()}function l(){var o=i[h],u=o[0],F=o[1];if(g.has(r)){d3(y,g.get(r),u,v,F,p,B,q)}else{var n=bA([],u.metadata.rev_tree[0],y);u.metadata.rev_tree=n.tree,u.stemmedRevs=n.stemmedRevs||[],A(u,F,p)}}var h=0;l()})}function bz(h){var g=[];return fB(h.rev_tree,function(l,p,k,m,j){"available"!==j.status||l||(g.push(p+"-"+k),j.status="missing")}),g}function b5(h){try{return JSON.parse(h)}catch(g){return ez.parse(h)}}function fO(g){return g.length<50000?JSON.parse(g):b5(g)}function bf(h){try{return JSON.stringify(h)}catch(g){return ez.stringify(h)}}function aS(i,g,k,h){try{i.apply(g,k)}catch(j){h.emit("error",j)}}function eF(h){if(!fJ.running&&fJ.queue.length){fJ.running=!0;var g=fJ.queue.shift();g.action(function(i,j){aS(g.callback,this,[i,j],h),fJ.running=!1,eG.nextTick(function(){eF(h)})})}}function dS(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(fF(cE,i,h.type))}}function cM(h,g,i){return{data:bf(h),winningRev:g,deletedOrLocal:i?"1":"0",seq:h.seq,id:h.id}}function ed(h){if(!h){return null}var g=fO(h.data);return g.winningRev=h.winningRev,g.deleted="1"===h.deletedOrLocal,g.seq=h.seq,g}function dx(h){if(!h){return h}var g=h._doc_id_rev.lastIndexOf(":");return h._id=h._doc_id_rev.substring(0,g-1),h._rev=h._doc_id_rev.substring(g+1),delete h._doc_id_rev,h}function bU(i,g,j,h){j?h(i?"string"!=typeof i?i:cc(i,g):bl([""],{type:g})):i?"string"!=typeof i?bQ(i,function(k){h(cf(k))}):h(i):h("")}function aH(m,j,q,l){function p(){++k===g.length&&l&&l()}function h(v,s){var u=v._attachments[s],o=u.digest,n=q.objectStore(bY).get(o);n.onsuccess=function(i){u.body=i.target.result.body,p()}}var g=Object.keys(m._attachments||{});if(!g.length){return l&&l()}var k=0;g.forEach(function(i){j.attachments&&j.include_docs?h(m,i):(m._attachments[i].stub=!0,p())})}function f1(h,g){return dQ.all(h.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return dQ.all(j.map(function(p){var l=i.doc._attachments[p];if("body" in l){var m=l.body,k=l.content_type;return new dQ(function(n){bU(m,k,g,function(o){i.doc._attachments[p]=ch.extend(eO(l,["digest","content_type"]),{data:o}),n()})})}}))}}))}function af(l,v,j){function g(){m--,m||h()}function h(){k.length&&k.forEach(function(n){var i=q.index("digestSeq").count(IDBKeyRange.bound(n+"::",n+"::",!1,!1));i.onsuccess=function(o){var r=o.target.result;r||w["delete"](n)}})}var k=[],p=j.objectStore(ej),w=j.objectStore(bY),q=j.objectStore(eP),m=l.length;l.forEach(function(i){var s=p.index("_doc_id_rev"),r=v+"::"+i;s.getKey(r).onsuccess=function(u){var o=u.target.result;if("number"!=typeof o){return g()}p["delete"](o);var x=q.index("seq").openCursor(IDBKeyRange.only(o));x.onsuccess=function(z){var y=z.target.result;if(y){var A=y.value.digestSeq.split("::")[0];k.push(A),q["delete"](y.primaryKey),y["continue"]()}else{g()}}}})}function cC(i,g,j){try{return{txn:i.transaction(g,j)}}catch(h){return{error:h}}}function dI(br,P,ae,W,Z,at,cn){function U(){var h=[fT,ej,bY,f6,eP],g=cC(Z,h,"readwrite");return g.error?cn(g.error):(bn=g.txn,bn.onabort=dS(cn),bn.ontimeout=dS(cn),bn.oncomplete=bo,ci=bn.objectStore(fT),J=bn.objectStore(ej),N=bn.objectStore(bY),A=bn.objectStore(eP),void bt(function(i){return i?(B=!0,cn(i)):void ce()}))}function M(){cm(br.revs_limit,X,W,G,bn,V,be,ae)}function ce(){function l(){++p===X.length&&M()}function j(i){var o=ed(i.target.result);o&&G.set(o.id,o),l()}if(X.length){for(var p=0,k=0,m=X.length;m>k;k++){var h=X[k];if(h._id&&fv(h._id)){l()}else{var g=ci.get(h.metadata.id);g.onsuccess=j}}}}function bo(){B||(at.notify(W._meta.name),W._meta.docCount+=I,cn(null,V))}function an(h,g){var i=N.get(h);i.onsuccess=function(k){if(k.target.result){g()}else{var j=fF(cZ,"unknown stub attachment with digest "+h);j.status=412,g(j)}}}function bt(i){function g(){++j===k.length&&i(h)}var k=[];if(X.forEach(function(l){l.data&&l.data._attachments&&Object.keys(l.data._attachments).forEach(function(m){var n=l.data._attachments[m];n.stub&&k.push(n.digest)})}),!k.length){return i()}var h,j=0;k.forEach(function(l){an(l,function(m){m&&!h&&(h=m),g()})})}function be(l,v,j,g,h,k,p,w){I+=k,l.metadata.winningRev=v,l.metadata.deleted=j;var q=l.data;q._id=l.metadata.id,q._rev=l.metadata.rev,g&&(q._deleted=!0);var m=q._attachments&&Object.keys(q._attachments).length;return m?H(l,v,j,h,p,w):void K(l,v,j,h,p,w)}function Y(h){var g=bz(h.metadata);af(g,h.metadata.id,bn)}function K(p,x,h,g,k,v){function y(n){g&&W.auto_compaction?Y(p):p.stemmedRevs.length&&af(p.stemmedRevs,p.metadata.id,bn),j.seq=n.target.result,delete j.rev;var l=cM(j,x,h),o=ci.put(l);o.onsuccess=r}function w(l){l.preventDefault(),l.stopPropagation();var i=J.index("_doc_id_rev"),o=i.getKey(m._doc_id_rev);o.onsuccess=function(s){var n=J.put(m,s.target.result);n.onsuccess=y}}function r(){V[k]={ok:!0,id:j.id,rev:x},G.set(p.metadata.id,p.metadata),co(p,j.seq,v)}var m=p.data,j=p.metadata;m._doc_id_rev=j.id+"::"+j.rev,delete m._id,delete m._rev;var q=J.put(m);q.onsuccess=y,q.onerror=w}function H(m,w,j,g,h,k){function q(){p===l.length&&K(m,w,j,g,h,k)}function x(){p++,q()}var v=m.data,p=0,l=Object.keys(v._attachments);l.forEach(function(C){var u=m.data._attachments[C];if(u.stub){p++,q()}else{var y=u.data;delete u.data,u.revpos=parseInt(w,10);var s=u.digest;ai(s,y,x)}})}function co(m,j,q){function l(){++h===g.length&&q()}function p(u){var s=m.data._attachments[u].digest,r=A.put({seq:j,digestSeq:s+"::"+j});r.onsuccess=l,r.onerror=function(i){i.preventDefault(),i.stopPropagation(),l()}}var h=0,g=Object.keys(m.data._attachments||{});if(!g.length){return q()}for(var k=0;k<g.length;k++){p(g[k])}}function ai(i,g,j){var h=N.count(i);h.onsuccess=function(m){var n=m.target.result;if(n){return j()}var l={digest:i,body:g},k=N.put(l);k.onsuccess=j}}for(var bn,ci,J,N,A,ao,X=P.docs,I=0,z=0,F=X.length;F>z;z++){var ar=X[z];ar._id&&fv(ar._id)||(ar=X[z]=e7(ar,ae.new_edits),ar.error&&!ao&&(ao=ar))}if(ao){return cn(ao)}var V=new Array(X.length),G=new ck.Map,B=!1,Q=W._meta.blobSupport?"blob":"base64";ef(X,Q,function(g){return g?cn(g):void U()})}function fg(k,h,m,j,l){try{if(k&&h){return l?IDBKeyRange.bound(h,k,!m,!1):IDBKeyRange.bound(k,h,!1,!m)}if(k){return l?IDBKeyRange.upperBound(k):IDBKeyRange.lowerBound(k)}if(h){return l?IDBKeyRange.lowerBound(h,!m):IDBKeyRange.upperBound(h,!m)}if(j){return IDBKeyRange.only(j)}}catch(g){return{error:g}}return null}function ax(i,g,j,h){return"DataError"===j.name&&0===j.code?h(null,{total_rows:i._meta.docCount,offset:g.skip,rows:[]}):void h(fF(cE,j.name,j.message))}function aC(k,h,m,j){function l(Q,G){function I(i,u,p){var s=i.id+"::"+p;n.get(s).onsuccess=function(o){u.doc=dx(o.target.result),Q.conflicts&&(u.doc._conflicts=eB(i)),aH(u.doc,Q,O)}}function M(s,v,u){var p={id:u.id,key:u.id,value:{rev:v}},o=u.deleted;if("ok"===Q.deleted){L.push(p),o?(p.value.deleted=!0,p.doc=null):Q.include_docs&&I(u,p,v)}else{if(!o&&R--<=0&&(L.push(p),Q.include_docs&&I(u,p,v),0===--N)){return}}s["continue"]()}function V(p){z=h._meta.docCount;var u=p.target.result;if(u){var i=ed(u.value),s=i.winningRev;M(u,s,i)}}function F(){G(null,{total_rows:z,offset:Q.skip,rows:L})}function C(){Q.attachments?f1(L,Q.binary).then(F):F()}var T="startkey" in Q?Q.startkey:!1,P="endkey" in Q?Q.endkey:!1,K="key" in Q?Q.key:!1,R=Q.skip||0,N="number"==typeof Q.limit?Q.limit:-1,H=Q.inclusive_end!==!1,B="descending" in Q&&Q.descending?"prev":null,q=fg(T,P,H,K,B);if(q&&q.error){return ax(h,Q,q.error,G)}var W=[fT,ej];Q.attachments&&W.push(bY);var J=cC(m,W,"readonly");if(J.error){return G(J.error)}var O=J.txn,U=O.objectStore(fT),A=O.objectStore(ej),D=B?U.openCursor(q,B):U.openCursor(q),n=A.index("_doc_id_rev"),L=[],z=0;O.oncomplete=C,D.onsuccess=V}function g(i,o){return 0===i.limit?o(null,{total_rows:h._meta.docCount,offset:i.skip,rows:[]}):void l(i,o)}g(k,j)}function cR(g){return new dQ(function(h){var i=bl([""]);g.objectStore(bN).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function cX(g){cb()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):dq()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function bK(){b3.EventEmitter.call(this),this._listeners={},cX(this)}function aa(h,g){var i=this;fJ.queue.push({action:function(j){bs(i,h,j)},callback:g}),eF(i.constructor)}function bs(w,C,g){function k(i){var h=i.createObjectStore(fT,{keyPath:"id"});i.createObjectStore(ej,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),i.createObjectStore(bY,{keyPath:"digest"}),i.createObjectStore(b9,{keyPath:"id",autoIncrement:!1}),i.createObjectStore(bN),h.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),i.createObjectStore(f6,{keyPath:"_id"});var m=i.createObjectStore(eP,{autoIncrement:!0});m.createIndex("seq","seq"),m.createIndex("digestSeq","digestSeq",{unique:!0})}function n(i,h){var m=i.objectStore(fT);m.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),m.openCursor().onsuccess=function(u){var s=u.target.result;if(s){var y=s.value,p=eZ(y);y.deletedOrLocal=p?"1":"0",m.put(y),s["continue"]()}else{h()}}}function A(h){h.createObjectStore(f6,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function D(s,m){var y=s.objectStore(f6),p=s.objectStore(fT),u=s.objectStore(ej),h=p.openCursor();h.onsuccess=function(H){var E=H.target.result;if(E){var L=E.value,N=L.id,M=fv(N),J=ev(L);if(M){var G=N+"::"+J,r=N+"::",I=N+"::~",F=u.index("_doc_id_rev"),o=IDBKeyRange.bound(r,I,!1,!1),K=F.openCursor(o);K.onsuccess=function(O){if(K=O.target.result){var i=K.value;i._doc_id_rev===G&&y.put(i),u["delete"](K.primaryKey),K["continue"]()}else{p["delete"](E.primaryKey),E["continue"]()}}}else{E["continue"]()}}else{m&&m()}}}function B(i){var h=i.createObjectStore(eP,{autoIncrement:!0});h.createIndex("seq","seq"),h.createIndex("digestSeq","digestSeq",{unique:!0})}function v(s,m){var y=s.objectStore(ej),p=s.objectStore(bY),u=s.objectStore(eP),h=p.count();h.onsuccess=function(o){var i=o.target.result;return i?void (y.openCursor().onsuccess=function(J){var F=J.target.result;if(!F){return m()}for(var E=F.value,H=F.primaryKey,L=Object.keys(E._attachments||{}),N={},M=0;M<L.length;M++){var K=E._attachments[L[M]];N[K.digest]=!0}var I=Object.keys(N);for(M=0;M<I.length;M++){var G=I[M];u.put({seq:H,digestSeq:G+"::"+H})}F["continue"]()}):m()}}function x(m){function h(o){return o.data?ed(o):(o.deleted="1"===o.deletedOrLocal,o)}var s=m.objectStore(ej),i=m.objectStore(fT),p=i.openCursor();p.onsuccess=function(E){function F(){var I=y.id+"::",G=y.id+"::",H=s.index("_doc_id_rev").openCursor(IDBKeyRange.bound(I,G)),J=0;H.onsuccess=function(K){var o=K.target.result;if(!o){return y.seq=J,u()}var L=o.primaryKey;L>J&&(J=L),o["continue"]()}}function u(){var G=cM(y,y.winningRev,y.deleted),o=i.put(G);o.onsuccess=function(){r["continue"]()}}var r=E.target.result;if(r){var y=h(r.value);return y.winningRev=y.winningRev||ev(y),y.seq?u():void F()}}}var q=C.name,j=null;w._meta=null,w.type=function(){return"idb"},w._id=eJ(function(h){h(null,w._meta.instanceId)}),w._bulkDocs=function(m,h,i){dI(C,m,h,w,j,bD,i)},w._get=function(E,H,p){function h(){p(F,{doc:m,metadata:y,ctx:I})}var m,y,F,I=H.ctx;if(!I){var G=cC(j,[fT,ej,bY],"readonly");if(G.error){return p(G.error)}I=G.txn}I.objectStore(fT).get(E).onsuccess=function(o){if(y=ed(o.target.result),!y){return F=fF(bS,"missing"),h()}if(eZ(y)&&!H.rev){return F=fF(bS,"deleted"),h()}var s=I.objectStore(ej),i=H.rev||y.winningRev,r=y.id+"::"+i;s.index("_doc_id_rev").get(r).onsuccess=function(u){return m=u.target.result,m&&(m=dx(m)),m?void h():(F=fF(bS,"missing"),h())}}},w._getAttachment=function(u,p,E){var s;if(p.ctx){s=p.ctx}else{var y=cC(j,[fT,ej,bY],"readonly");if(y.error){return E(y.error)}s=y.txn}var m=u.digest,h=u.content_type;s.objectStore(bY).get(m).onsuccess=function(o){var i=o.target.result.body;bU(i,h,p.binary,function(r){E(null,r)})}},w._info=function(p){if(null===j||!cg.has(q)){var F=new Error("db isn't open");return F.id="idbNull",p(F)}var y,E,m=cC(j,[ej],"readonly");if(m.error){return p(m.error)}var h=m.txn,u=h.objectStore(ej).openCursor(null,"prev");u.onsuccess=function(i){var o=i.target.result;y=o?o.key:0,E=w._meta.docCount},h.oncomplete=function(){p(null,{doc_count:E,update_seq:y,idb_attachment_format:w._meta.blobSupport?"binary":"base64"})}},w._allDocs=function(h,i){aC(h,w,j,i)},w._changes=function(G){function K(y){function W(){return V.seq!==m?y["continue"]():(F=m,V.winningRev===s._rev?U(s):void u())}function u(){var o=s._id+"::"+V.winningRev,i=T.get(o);i.onsuccess=function(r){U(dx(r.target.result))}}function U(Y){var i=G.processChange(Y,V,G);i.seq=V.seq;var X=R(i);return"object"==typeof X?G.complete(X):(X&&(O++,M&&L.push(i),G.attachments&&G.include_docs?aH(Y,G,Q,function(){f1([i],G.binary).then(function(){G.onChange(i)})}):G.onChange(i)),void (O!==P&&y["continue"]()))}var s=dx(y.value),m=y.key;if(H&&!H.has(s._id)){return y["continue"]()}var V;return(V=p.get(s._id))?W():void (h.get(s._id).onsuccess=function(i){V=ed(i.target.result),p.set(s._id,V),W()})}function I(m){var i=m.target.result;i&&K(i)}function J(){var i=[fT,ej];G.attachments&&i.push(bY);var r=cC(j,i,"readonly");if(r.error){return G.complete(r.error)}Q=r.txn,Q.onabort=dS(G.complete),Q.oncomplete=N,E=Q.objectStore(ej),h=Q.objectStore(fT),T=E.index("_doc_id_rev");var m;m=G.descending?E.openCursor(null,"prev"):E.openCursor(IDBKeyRange.lowerBound(G.since,!0)),m.onsuccess=I}function N(){function i(){G.complete(null,{results:L,last_seq:F})}!G.continuous&&G.attachments?f1(L).then(i):i()}if(G=eW(G),G.continuous){var S=q+":"+fC();return bD.addListener(q,S,w,G),bD.notify(q),{cancel:function(){bD.removeListener(q,S)}}}var H=G.doc_ids&&new ck.Set(G.doc_ids);G.since=G.since||0;var F=G.since,P="limit" in G?G.limit:-1;0===P&&(P=1);var M;M="return_docs" in G?G.return_docs:"returnDocs" in G?G.returnDocs:!0;var Q,E,h,T,L=[],O=0,R=ay(G),p=new ck.Map;J()},w._close=function(h){return null===j?h(fF(dG)):(j.close(),cg["delete"](q),j=null,void h())},w._getRevisionTree=function(m,h){var s=cC(j,[fT],"readonly");if(s.error){return h(s.error)}var i=s.txn,p=i.objectStore(fT).get(m);p.onsuccess=function(o){var r=ed(o.target.result);r?h(null,r.rev_tree):h(fF(bS))}},w._doCompaction=function(u,p,E){var s=[fT,ej,bY,eP],y=cC(j,s,"readwrite");if(y.error){return E(y.error)}var m=y.txn,h=m.objectStore(fT);h.get(u).onsuccess=function(H){var F=ed(H.target.result);fB(F.rev_tree,function(L,N,K,M,J){var I=N+"-"+K;-1!==p.indexOf(I)&&(J.status="missing")}),af(p,u,m);var G=F.winningRev,i=F.deleted;m.objectStore(fT).put(cM(F,G,i))},m.onabort=dS(E),m.oncomplete=function(){E()}},w._getLocal=function(m,h){var s=cC(j,[f6],"readonly");if(s.error){return h(s.error)}var i=s.txn,p=i.objectStore(f6).get(m);p.onerror=dS(h),p.onsuccess=function(o){var r=o.target.result;r?(delete r._doc_id_rev,h(null,r)):h(fF(bS))}},w._putLocal=function(E,I,p){"function"==typeof I&&(p=I,I={}),delete E._revisions;var h=E._rev,m=E._id;h?E._rev="0-"+(parseInt(h.split("-")[1],10)+1):E._rev="0-1";var y,G=I.ctx;if(!G){var J=cC(j,[f6],"readwrite");if(J.error){return p(J.error)}G=J.txn,G.onerror=dS(p),G.oncomplete=function(){y&&p(null,y)}}var H,F=G.objectStore(f6);h?(H=F.get(m),H.onsuccess=function(u){var i=u.target.result;if(i&&i._rev===h){var r=F.put(E);r.onsuccess=function(){y={ok:!0,id:E._id,rev:E._rev},I.ctx&&p(null,y)}}else{p(fF(aF))}}):(H=F.add(E),H.onerror=function(i){p(fF(aF)),i.preventDefault(),i.stopPropagation()},H.onsuccess=function(){y={ok:!0,id:E._id,rev:E._rev},I.ctx&&p(null,y)})},w._removeLocal=function(E,H,p){"function"==typeof H&&(p=H,H={});var h=H.ctx;if(!h){var m=cC(j,[f6],"readwrite");if(m.error){return p(m.error)}h=m.txn,h.oncomplete=function(){y&&p(null,y)}}var y,F=E._id,I=h.objectStore(f6),G=I.get(F);G.onerror=dS(p),G.onsuccess=function(i){var s=i.target.result;s&&s._rev===E._rev?(I["delete"](F),y={ok:!0,id:F,rev:"0-0"},H.ctx&&p(null,y)):p(fF(bS))}},w._destroy=function(m,h){bD.removeAllListeners(q);var o=bj.get(q);o&&o.result&&(o.result.close(),cg["delete"](q));var i=indexedDB.deleteDatabase(q);i.onsuccess=function(){bj["delete"](q),dq()&&q in localStorage&&delete localStorage[q],h(null,{ok:!0})},i.onerror=dS(h)};var z=cg.get(q);if(z){return j=z.idb,w._meta=z.global,void eG.nextTick(function(){g(null,w)})}var l;l=C.storage?cG(q,C.storage):indexedDB.open(q,dm),bj.set(q,l),l.onupgradeneeded=function(o){function i(){var r=p[h-1];h++,r&&r(m,i)}var s=o.target.result;if(o.oldVersion<1){return k(s)}var m=o.currentTarget.transaction;o.oldVersion<3&&A(s),o.oldVersion<4&&B(s);var p=[n,D,v,x],h=o.oldVersion;i()},l.onsuccess=function(p){j=p.target.result,j.onversionchange=function(){j.close(),cg["delete"](q)},j.onabort=function(i){console.error("Database has a global failure",i.target.error),j.close(),cg["delete"](q)};var y=j.transaction([b9,bN,fT],"readwrite"),u=y.objectStore(b9).get(b9),m=null,h=null,r=null;u.onsuccess=function(s){var E=function(){null!==m&&null!==h&&null!==r&&(w._meta={name:q,instanceId:r,blobSupport:m,docCount:h},cg.set(q,{idb:j,global:w._meta}),g(null,w))},i=s.target.result||{id:b9};q+"_id" in i?(r=i[q+"_id"],E()):(r=fC(),i[q+"_id"]=r,y.objectStore(b9).put(i).onsuccess=function(){E()}),da||(da=cR(y)),da.then(function(o){m=o,E()});var F=y.objectStore(fT).index("deletedOrLocal");F.count(IDBKeyRange.only("0")).onsuccess=function(o){h=o.target.result,E()}}},l.onerror=function(){var h="Failed to open indexedDB, are you in private browsing mode?";console.error(h),g(fF(cE,h))}}function cG(h,g){try{return indexedDB.open(h,{version:dm,storage:g})}catch(i){return indexedDB.open(h,dm)}}function dC(g){return decodeURIComponent(window.escape(g))}function c7(g){return 65>g?g-48:g-55}function aY(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(c7(i.charCodeAt(g++))<<4|c7(i.charCodeAt(g++)))}return h}function fx(i,g,j){for(var h="";j>g;){h+=String.fromCharCode(c7(i.charCodeAt(g+2))<<12|c7(i.charCodeAt(g+3))<<8|c7(i.charCodeAt(g))<<4|c7(i.charCodeAt(g+1))),g+=4}return h}function d8(h,g){return"UTF-8"===g?dC(aY(h,0,h.length)):fx(h,0,h.length)}function c1(g){return"'"+g+"'"}function aN(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function dM(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function a9(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function dX(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function am(g){return delete g._id,delete g._rev,JSON.stringify(g)}function cw(h,g,i){return h=JSON.parse(h),h._id=g,h._rev=i,h}function dp(h){for(var g="(";h--;){g+="?",h&&(g+=",")}return g+")"}function fU(i,g,k,h,j){return"SELECT "+i+" FROM "+("string"==typeof g?g:g.join(" JOIN "))+(k?" ON "+k:"")+(h?" WHERE "+("string"==typeof h?h:h.join(" AND ")):"")+(j?" ORDER BY "+j:"")}function ek(l,j,p){function k(){++h===l.length&&m()}function m(){if(g.length){var i="SELECT DISTINCT digest AS digest FROM "+fS+" WHERE seq IN "+dp(g.length);p.executeSql(i,g,function(u,q){for(var w=[],s=0;s<q.rows.length;s++){w.push(q.rows.item(s).digest)}if(w.length){var v="DELETE FROM "+fS+" WHERE seq IN ("+g.map(function(){return"?"}).join(",")+")";u.executeSql(v,g,function(o){var n="SELECT digest FROM "+fS+" WHERE digest IN ("+w.map(function(){return"?"}).join(",")+")";o.executeSql(n,w,function(z,x){for(var y=new ck.Set,A=0;A<x.rows.length;A++){y.add(x.rows.item(A).digest)}w.forEach(function(r){y.has(r)||(z.executeSql("DELETE FROM "+fS+" WHERE digest=?",[r]),z.executeSql("DELETE FROM "+bC+" WHERE digest=?",[r]))})})})}})}}if(l.length){var h=0,g=[];l.forEach(function(i){var n="SELECT seq FROM "+cu+" WHERE doc_id=? AND rev=?";p.executeSql(n,[j,i],function(q,o){if(!o.rows.length){return k()}var r=o.rows.item(0).seq;g.push(r),q.executeSql("DELETE FROM "+cu+" WHERE seq=?",[r],k)})})}}function bZ(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(fF(dz,j,i))}}function eS(h){if("size" in h){return 1000000*h.size}var g="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return g?5000000:1}function ca(h,g){try{return{db:h(g)}}catch(i){return{error:i}}}function f7(h){var g=bi.get(h.name);if(!g){var i=aN();g=ca(i,h),bi.set(h.name,g),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return g}function bO(L,z,E,B,D,H,P){function A(){return J?P(J):(H.notify(B._name),B._docCount=-1,void P(null,O))}function x(h,g){var i="SELECT count(*) as cnt FROM "+bC+" WHERE digest=?";F.executeSql(i,[h],function(p,l){if(0===l.rows.item(0).cnt){var m=fF(cZ,"unknown stub attachment with digest "+h);g(m)}else{g()}})}function N(i){function g(){++l===m.length&&i(h)}var m=[];if(j.forEach(function(n){n.data&&n.data._attachments&&Object.keys(n.data._attachments).forEach(function(o){var p=n.data._attachments[o];p.stub&&m.push(p.digest)})}),!m.length){return i()}var h,l=0;m.forEach(function(n){x(n,function(o){o&&!h&&(h=o),g()})})}function K(S,Z,m,h,w,W,ae,Y){function U(){function v(bn,ar){function be(){return ++u===n.length&&ar(),!1}function bo(br){var bt="INSERT INTO "+fS+" (digest, seq) VALUES (?,?)",s=[ao._attachments[br].digest,bn];F.executeSql(bt,s,be,be)}var u=0,n=Object.keys(ao._attachments||{});if(!n.length){return ar()}for(var at=0;at<n.length;at++){bo(n[at])}}var ao=S.data,ai=h?1:0,p=ao._id,l=ao._rev,y=am(ao),o="INSERT INTO "+cu+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",an=[p,l,y,ai];F.executeSql(o,an,function(s,u){var i=u.insertId;v(i,function(){T(s,i)})},function(){var i=fU("seq",cu,null,"doc_id=? AND rev=?");return F.executeSql(i,[p,l],function(ar,bn){var at=bn.rows.item(0).seq,s="UPDATE "+cu+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",be=[y,ai,p,l];ar.executeSql(s,be,function(n){v(at,function(){T(n,at)})})}),!1})}function R(i){g||(i?(g=i,Y(g)):X===V.length&&U())}function r(i){X++,R(i)}function T(y,u){var p=S.metadata.id;w&&B.auto_compaction?ek(bz(S.metadata),p,y):S.stemmedRevs.length&&ek(S.stemmedRevs,p,y),S.metadata.seq=u,delete S.metadata.rev;var v=w?"UPDATE "+a4+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+cu+" WHERE doc_id="+a4+".id AND rev=?) WHERE id=?":"INSERT INTO "+a4+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",s=bf(S.metadata),i=w?[s,u,Z,p]:[p,u,u,s];y.executeSql(v,i,function(){O[ae]={ok:!0,id:S.metadata.id,rev:Z},k.set(p,S.metadata),Y()})}var g=null,X=0;S.data._id=S.metadata.id,S.data._rev=S.metadata.rev;var V=Object.keys(S.data._attachments||{});h&&(S.data._deleted=!0),V.forEach(function(u){var p=S.data._attachments[u];if(p.stub){X++,R()}else{var s=p.data;delete p.data,p.revpos=parseInt(Z,10);var l=p.digest;I(l,s,r)}}),V.length||U()}function G(){cm(L.revs_limit,j,B,k,F,O,K,E)}function M(h){function g(){++i===j.length&&h()}if(!j.length){return h()}var i=0;j.forEach(function(l){if(l._id&&fv(l._id)){return g()}var m=l.metadata.id;F.executeSql("SELECT json FROM "+a4+" WHERE id = ?",[m],function(p,n){if(n.rows.length){var s=fO(n.rows.item(0).json);k.set(m,s)}g()})})}function I(i,g,l){var h="SELECT digest FROM "+bC+" WHERE digest=?";F.executeSql(h,[i],function(n,m){return m.rows.length?l():(h="INSERT INTO "+bC+" (digest, body, escaped) VALUES (?,?,1)",void n.executeSql(h,[i,a9(g)],function(){l()},function(){return l(),!1}))})}var C=E.new_edits,q=z.docs,j=q.map(function(h){if(h._id&&fv(h._id)){return h}var g=e7(h,C);return g}),Q=j.filter(function(g){return g.error});if(Q.length){return P(Q[0])}var F,J,O=new Array(j.length),k=new ck.Map;ef(j,"binary",function(g){return g?P(g):void D.transaction(function(h){F=h,N(function(i){i?J=i:M(G)})},bZ(P),A)})}function fK(j,p,i,g,h){function l(){++k===m.length&&h&&h()}function q(v,w){var r=v._attachments[w],n={binary:p.binary,ctx:g};i._getAttachment(r,n,function(o,s){v._attachments[w]=ch.extend(eO(r,["digest","content_type"]),{data:s}),l()})}var m=Object.keys(j._attachments||{});if(!m.length){return h&&h()}var k=0;m.forEach(function(o){p.attachments&&p.include_docs?q(j,o):(j._attachments[o].stub=!0,l())})}function db(P,D){function I(){dq()&&(window.localStorage["_pouch__websqldb_"+N._name]=!0),D(null,N)}function F(h,g){h.executeSql(eh),h.executeSql("ALTER TABLE "+cu+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){h.executeSql(dV),h.executeSql("ALTER TABLE "+a4+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){h.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+a4+" (local, id)");var i="SELECT "+a4+".winningseq AS seq, "+a4+".json AS metadata FROM "+cu+" JOIN "+a4+" ON "+cu+".seq = "+a4+".winningseq";h.executeSql(i,[],function(x,S){for(var w=[],y=[],p=0;p<S.rows.length;p++){var k=S.rows.item(p),v=k.seq,m=JSON.parse(k.metadata);eZ(m)&&w.push(v),fv(m.id)&&y.push(m.id)}x.executeSql("UPDATE "+a4+"SET local = 1 WHERE id IN "+dp(y.length),y,function(){x.executeSql("UPDATE "+cu+" SET deleted = 1 WHERE seq IN "+dp(w.length),w,g)})})})})}function H(h,g){var i="CREATE TABLE IF NOT EXISTS "+b8+" (id UNIQUE, rev, json)";h.executeSql(i,[],function(){var k="SELECT "+a4+".id AS id, "+cu+".json AS data FROM "+cu+" JOIN "+a4+" ON "+cu+".seq = "+a4+".winningseq WHERE local = 1";h.executeSql(k,[],function(s,v){function p(){if(!u.length){return g(s)}var r=u.shift(),o=JSON.parse(r.data)._rev;s.executeSql("INSERT INTO "+b8+" (id, rev, json) VALUES (?,?,?)",[r.id,o,r.data],function(n){n.executeSql("DELETE FROM "+a4+" WHERE id=?",[r.id],function(w){w.executeSql("DELETE FROM "+cu+" WHERE seq=?",[r.seq],function(){p()})})})}for(var u=[],m=0;m<v.rows.length;m++){u.push(v.rows.item(m))}p()})})}function L(i,g){function k(o){function m(){if(!o.length){return g(i)}var w=o.shift(),r=d8(w.hex,J),n=r.lastIndexOf("::"),v=r.substring(0,n),p=r.substring(n+2),x="UPDATE "+cu+" SET doc_id=?, rev=? WHERE doc_id_rev=?";i.executeSql(x,[v,p,r],function(){m()})}m()}var h="ALTER TABLE "+cu+" ADD COLUMN doc_id";i.executeSql(h,[],function(n){var m="ALTER TABLE "+cu+" ADD COLUMN rev";n.executeSql(m,[],function(o){o.executeSql(cP,[],function(r){var p="SELECT hex(doc_id_rev) as hex FROM "+cu;r.executeSql(p,[],function(v,s){for(var u=[],w=0;w<s.rows.length;w++){u.push(s.rows.item(w))}k(u)})})})})}function U(i,g){function k(m){var o="SELECT COUNT(*) AS cnt FROM "+bC;m.executeSql(o,[],function(v,x){function u(){var r=fU(f2+", "+a4+".id AS id",[a4,cu],aI,null,a4+".id ");r+=" LIMIT "+p+" OFFSET "+s,s+=p,v.executeSql(r,[],function(Y,S){function y(at,ar){var be=V[at]=V[at]||[];-1===be.indexOf(ar)&&be.push(ar)}if(!S.rows.length){return g(Y)}for(var V={},ai=0;ai<S.rows.length;ai++){for(var ao=S.rows.item(ai),an=cw(ao.data,ao.id,ao.rev),ae=Object.keys(an._attachments||{}),X=0;X<ae.length;X++){var T=an._attachments[ae[X]];y(T.digest,ao.seq)}}var Z=[];if(Object.keys(V).forEach(function(ar){var n=V[ar];n.forEach(function(at){Z.push([ar,at])})}),!Z.length){return u()}var W=0;Z.forEach(function(ar){var at="INSERT INTO "+fS+" (digest, seq) VALUES (?,?)";Y.executeSql(at,ar,function(){++W===Z.length&&u()})})})}var w=x.rows.item(0).cnt;if(!w){return g(v)}var s=0,p=10;u()})}var h="CREATE TABLE IF NOT EXISTS "+fS+" (digest, seq INTEGER)";i.executeSql(h,[],function(m){m.executeSql(bX,[],function(n){n.executeSql(dA,[],k)})})}function E(h,g){var i="ALTER TABLE "+bC+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";h.executeSql(i,[],g)}function C(h,g){var i="ALTER TABLE "+a4+" ADD COLUMN max_seq INTEGER";h.executeSql(i,[],function(k){var m="UPDATE "+a4+" SET max_seq=(SELECT MAX(seq) FROM "+cu+" WHERE doc_id=id)";k.executeSql(m,[],function(o){var p="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+a4+" (max_seq)";o.executeSql(p,[],g)})})}function O(h,g){h.executeSql('SELECT HEX("a") AS hex',[],function(k,m){var i=m.rows.item(0).hex;J=2===i.length?"UTF-8":"UTF-16",g()})}function Q(){for(;l.length>0;){var g=l.pop();g(null,R)}}function M(u,V){if(0===V){var i="CREATE TABLE IF NOT EXISTS "+dl+" (dbid, db_version INTEGER)",w="CREATE TABLE IF NOT EXISTS "+bC+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",s="CREATE TABLE IF NOT EXISTS "+fS+" (digest, seq INTEGER)",o="CREATE TABLE IF NOT EXISTS "+a4+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",r="CREATE TABLE IF NOT EXISTS "+cu+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",g="CREATE TABLE IF NOT EXISTS "+b8+" (id UNIQUE, rev, json)";u.executeSql(w),u.executeSql(g),u.executeSql(s,[],function(){u.executeSql(dA),u.executeSql(bX)}),u.executeSql(o,[],function(){u.executeSql(eh),u.executeSql(r,[],function(){u.executeSql(dV),u.executeSql(cP),u.executeSql(i,[],function(){var h="INSERT INTO "+dl+" (db_version, dbid) VALUES (?,?)";R=fC();var m=[d6,R];u.executeSql(h,m,function(){Q()})})})})}else{var T=function(){var m=d6>V;m&&u.executeSql("UPDATE "+dl+" SET db_version = "+d6);var h="SELECT dbid FROM "+dl;u.executeSql(h,[],function(p,n){R=n.rows.item(0).dbid,Q()})},x=[F,H,L,U,E,C,T],S=V,k=function(h){x[S-1](h,k),S++};k(u)}}function G(){j.transaction(function(g){O(g,function(){B(g)})},bZ(D),I)}function B(h){var g="SELECT sql FROM sqlite_master WHERE tbl_name = "+dl;h.executeSql(g,[],function(k,i){i.rows.length?/db_version/.test(i.rows.item(0).sql)?k.executeSql("SELECT db_version FROM "+dl,[],function(o,m){var p=m.rows.item(0).db_version;M(o,p)}):k.executeSql("ALTER TABLE "+dl+" ADD COLUMN db_version INTEGER",[],function(){M(k,1)}):M(k,0)})}function q(h,g){if(-1!==N._docCount){return g(N._docCount)}var i=fU("COUNT("+a4+".id) AS 'num'",[a4,cu],aI,cu+".deleted=0");h.executeSql(i,[],function(k,m){N._docCount=m.rows.item(0).num,g(N._docCount)})}var J,N=this,R=null,A=eS(P),l=[];N._docCount=-1,N._name=P.name;var K=ch.extend({},P,{size:A,version:eM}),z=f7(K);if(z.error){return bZ(D)(z.error)}var j=z.db;"function"!=typeof j.readTransaction&&(j.readTransaction=j.transaction),G(),N.type=function(){return"websql"},N._id=eJ(function(g){g(null,R)}),N._info=function(g){j.readTransaction(function(h){q(h,function(k){var i="SELECT MAX(seq) AS seq FROM "+cu;h.executeSql(i,[],function(m,n){var p=n.rows.item(0).seq||0;g(null,{doc_count:k,update_seq:p,sqlite_plugin:j._sqlitePlugin,websql_encoding:J})})})},bZ(g))},N._bulkDocs=function(g,i,h){bO(P,g,i,N,j,aT,h)},N._get=function(p,y,k){function g(){k(w,{doc:h,metadata:m,ctx:S})}var h,m,w,S=y.ctx;if(!S){return j.readTransaction(function(i){N._get(p,ch.extend({ctx:i},y),k)})}var x,v;y.rev?(x=fU(f2,[a4,cu],a4+".id="+cu+".doc_id",[cu+".doc_id=?",cu+".rev=?"]),v=[p,y.rev]):(x=fU(f2,[a4,cu],aI,a4+".id=?"),v=[p]),S.executeSql(x,v,function(o,r){if(!r.rows.length){return w=fF(bS,"missing"),g()}var i=r.rows.item(0);return m=fO(i.metadata),i.deleted&&!y.rev?(w=fF(bS,"deleted"),g()):(h=cw(i.data,m.id,i.rev),void g())})},N._allDocs=function(y,X){var m,g=[],k="startkey" in y?y.startkey:!1,v="endkey" in y?y.endkey:!1,V="key" in y?y.key:!1,Y="descending" in y?y.descending:!1,W="limit" in y?y.limit:-1,T="skip" in y?y.skip:0,x=y.inclusive_end!==!1,p=[],S=[];if(V!==!1){S.push(a4+".id = ?"),p.push(V)}else{if(k!==!1||v!==!1){if(k!==!1&&(S.push(a4+".id "+(Y?"<=":">=")+" ?"),p.push(k)),v!==!1){var w=Y?">":"<";x&&(w+="="),S.push(a4+".id "+w+" ?"),p.push(v)}V!==!1&&(S.push(a4+".id = ?"),p.push(V))}}"ok"!==y.deleted&&S.push(cu+".deleted = 0"),j.readTransaction(function(h){q(h,function(r){if(m=r,0!==W){var n=fU(f2,[a4,cu],aI,S,a4+".id "+(Y?"DESC":"ASC"));n+=" LIMIT "+W+" OFFSET "+T,h.executeSql(n,p,function(bn,ae){for(var Z=0,an=ae.rows.length;an>Z;Z++){var at=ae.rows.item(Z),bo=fO(at.metadata),be=bo.id,ar=cw(at.data,be,at.rev),ao=ar._rev,ai={id:be,key:be,value:{rev:ao}};if(y.include_docs&&(ai.doc=ar,ai.doc._rev=ao,y.conflicts&&(ai.doc._conflicts=eB(bo)),fK(ai.doc,y,N,bn)),at.deleted){if("ok"!==y.deleted){continue}ai.value.deleted=!0,ai.doc=null}g.push(ai)}})}})},bZ(X),function(){X(null,{total_rows:m,offset:y.skip,rows:g})})},N._changes=function(u){function k(){var V=a4+".json AS metadata, "+a4+".max_seq AS maxSeq, "+cu+".json AS winningDoc, "+cu+".rev AS winningRev ",o=a4+" JOIN "+cu,T=a4+".id="+cu+".doc_id AND "+a4+".winningseq="+cu+".seq",S=["maxSeq > ?"],x=[u.since];u.doc_ids&&(S.push(a4+".id IN "+dp(u.doc_ids.length)),x=x.concat(u.doc_ids));var r="maxSeq "+(p?"DESC":"ASC"),y=fU(V,o,T,S,r),s=ay(u);u.view||u.filter||(y+=" LIMIT "+v);var i=u.since||0;j.readTransaction(function(n){n.executeSql(y,x,function(at,X){function W(be){return function(){u.onChange(be)}}for(var ar=0,ai=X.rows.length;ai>ar;ar++){var Z=X.rows.item(ar),Y=fO(Z.metadata);i=Z.maxSeq;var ae=cw(Z.winningDoc,Y.id,Z.winningRev),ao=u.processChange(ae,Y,u);ao.seq=Z.maxSeq;var an=s(ao);if("object"==typeof an){return u.complete(an)}if(an&&(m++,h&&g.push(ao),u.attachments&&u.include_docs?fK(ae,u,N,at,W(ao)):W(ao)()),m===v){break}}})},bZ(u.complete),function(){u.continuous||u.complete(null,{results:g,last_seq:i})})}if(u=eW(u),u.continuous){var w=N._name+":"+fC();return aT.addListener(N._name,w,N,u),aT.notify(N._name),{cancel:function(){aT.removeListener(N._name,w)}}}var p=u.descending;u.since=u.since&&!p?u.since:0;var v="limit" in u?u.limit:-1;0===v&&(v=1);var h;h="return_docs" in u?u.return_docs:"returnDocs" in u?u.returnDocs:!0;var g=[],m=0;k()},N._close=function(g){g()},N._getAttachment=function(u,k,w){var p,v=k.ctx,h=u.digest,g=u.content_type,m="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+bC+" WHERE digest=?";v.executeSql(m,[h],function(x,y){var n=y.rows.item(0),r=n.escaped?dX(n.body):d8(n.body,J);p=k.binary?dN(r,g):cf(r),w(null,p)})},N._getRevisionTree=function(h,g){j.readTransaction(function(k){var i="SELECT json AS metadata FROM "+a4+" WHERE id = ?";k.executeSql(i,[h],function(o,p){if(p.rows.length){var m=fO(p.rows.item(0).metadata);g(null,m.rev_tree)}else{g(fF(bS))}})})},N._doCompaction=function(h,g,i){return g.length?void j.transaction(function(m){var k="SELECT json AS metadata FROM "+a4+" WHERE id = ?";m.executeSql(k,[h],function(v,s){var u=fO(s.rows.item(0).metadata);fB(u.rev_tree,function(S,V,y,T,x){var w=V+"-"+y;-1!==g.indexOf(w)&&(x.status="missing")});var p="UPDATE "+a4+" SET json = ? WHERE id = ?";v.executeSql(p,[bf(u),h])}),ek(g,h,m)},bZ(i),function(){i()}):i()},N._getLocal=function(h,g){j.readTransaction(function(k){var i="SELECT json, rev FROM "+b8+" WHERE id=?";k.executeSql(i,[h],function(u,p){if(p.rows.length){var s=p.rows.item(0),m=cw(s.json,h,s.rev);g(null,m)}else{g(fF(bS))}})})},N._putLocal=function(p,x,k){function g(n){var i,o;m?(i="UPDATE "+b8+" SET rev=?, json=? WHERE id=? AND rev=?",o=[h,w,v,m]):(i="INSERT INTO "+b8+" (id, rev, json) VALUES (?,?,?)",o=[v,h,w]),n.executeSql(i,o,function(u,s){s.rowsAffected?(y={ok:!0,id:v,rev:h},x.ctx&&k(null,y)):k(fF(aF))},function(){return k(fF(aF)),!1})}"function"==typeof x&&(k=x,x={}),delete p._revisions;var h,m=p._rev,v=p._id;h=m?p._rev="0-"+(parseInt(m.split("-")[1],10)+1):p._rev="0-1";var y,w=am(p);x.ctx?g(x.ctx):j.transaction(g,bZ(k),function(){y&&k(null,y)})},N._removeLocal=function(i,g,m){function h(p){var o="DELETE FROM "+b8+" WHERE id=? AND rev=?",n=[i._id,i._rev];p.executeSql(o,n,function(u,s){return s.rowsAffected?(k={ok:!0,id:i._id,rev:"0-0"},void (g.ctx&&m(null,k))):m(fF(bS))})}"function"==typeof g&&(m=g,g={});var k;g.ctx?h(g.ctx):j.transaction(h,bZ(m),function(){k&&m(null,k)})},N._destroy=function(h,g){aT.removeAllListeners(N._name),j.transaction(function(k){var i=[a4,cu,bC,dl,b8,fS];i.forEach(function(m){k.executeSql("DROP TABLE IF EXISTS "+m,[])})},bZ(g),function(){dq()&&(delete window.localStorage["_pouch__websqldb_"+N._name],delete window.localStorage[N._name]),g(null,{ok:!0})})}}var ch=d(7),bE=eE(ch),bk=eE(d(2)),d1=eE(d(6)),a1=eE(d(8)),ck=d(12),bx=eE(d(1)),b3=d(4),dg=eE(d(14)),fM=d(10),bc=eE(fM),aQ=eE(d(15)),ez=eE(d(16)),dQ="function"==typeof Promise?Promise:a1,cK=bk("pouchdb:api");d1(es,Error),es.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var ec=new es({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),dv=new es({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),bS=new es({status:404,error:"not_found",reason:"missing"}),aF=new es({status:409,error:"conflict",reason:"Document update conflict"}),fZ=new es({status:400,error:"invalid_id",reason:"_id field must contain a string"}),ac=new es({status:412,error:"missing_id",reason:"_id is required for puts"}),cA=new es({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),dG=new es({status:412,error:"precondition_failed",reason:"Database not open"}),e9=new es({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),av=new es({status:500,error:"badarg",reason:"Some query argument is invalid"}),aA=new es({status:400,error:"invalid_request",reason:"Request was invalid"}),cO=new es({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),cV=new es({status:500,error:"doc_validation",reason:"Bad special document member"}),bI=new es({status:400,error:"bad_request",reason:"Something wrong with the request"}),e=new es({status:400,error:"bad_request",reason:"Document must be a JSON object"}),bp=new es({status:404,error:"not_found",reason:"Database not found"}),cE=new es({status:500,error:"indexed_db_went_bad",reason:"unknown"}),dz=new es({status:500,error:"web_sql_went_bad",reason:"unknown"}),c5=new es({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),aW=new es({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),fp=new es({status:400,error:"bad_request",reason:"Invalid rev format"}),d5=new es({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),cZ=new es({status:412,error:"missing_stub"}),aL=new es({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),dK={UNAUTHORIZED:ec,MISSING_BULK_DOCS:dv,MISSING_DOC:bS,REV_CONFLICT:aF,INVALID_ID:fZ,MISSING_ID:ac,RESERVED_ID:cA,NOT_OPEN:dG,UNKNOWN_ERROR:e9,BAD_ARG:av,INVALID_REQUEST:aA,QUERY_PARSE_ERROR:cO,DOC_VALIDATION:cV,BAD_REQUEST:bI,NOT_AN_OBJECT:e,DB_MISSING:bp,WSQ_ERROR:dz,LDB_ERROR:c5,FORBIDDEN:aW,INVALID_REV:fp,FILE_EXISTS:d5,MISSING_STUB:cZ,IDB_ERROR:cE,INVALID_URL:aL},a7=function(i,g,k){var h=Object.keys(dK).filter(function(m){var l=dK[m];return"function"!=typeof l&&l[i]===g}),j=k&&h.filter(function(m){var l=dK[m];return l.message===k})[0]||h[0];return j?dK[j]:null};d1(fh,b3.EventEmitter),fh.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},fh.prototype.doChanges=function(i){var g=this,k=i.complete;if(i=eW(i),"live" in i&&!("continuous" in i)&&(i.continuous=i.live),i.processChange=eN,"latest"===i.since&&(i.since="now"),i.since||(i.since=0),"now"===i.since){return void this.db.info().then(function(l){return g.isCancelled?void k(null,{status:"cancelled"}):(i.since=l.update_seq,void g.doChanges(i))},k)}if(i.continuous&&"now"!==i.since&&this.db.info().then(function(l){g.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),i.filter&&"string"==typeof i.filter&&("_view"===i.filter?i.view=eu(i.view):i.filter=eu(i.filter),"http"!==this.db.type()&&!i.doc_ids)){return this.filterChanges(i)}"descending" in i||(i.descending=!1),i.limit=0===i.limit?1:i.limit,i.complete=k;var h=this.db._changes(i);if(h&&"function"==typeof h.cancel){var j=g.cancel;g.cancel=bx(function(l){h.cancel(),j.apply(this,l)})}},fh.prototype.filterChanges=function(k){var h=this,m=k.complete;if("_view"===k.filter){if(!k.view||"string"!=typeof k.view){var j=fF(bI,"`view` filter parameter not found or invalid.");return m(j)}var l=eX(k.view);this.db.getView(l[0],l[1],function(i,n){return h.isCancelled?m(null,{status:"cancelled"}):i?m(e8(i)):n.map?(k.filter=eR(n.map),void h.doChanges(k)):m(fF(bS))})}else{var g=eX(k.filter);if(!g){return h.doChanges(k)}this.db.getFilter(g[0],g[1],function(i,n){return h.isCancelled?m(null,{status:"cancelled"}):i?m(e8(i)):(k.filter=eH(n),void h.doChanges(k))})}};var dU="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),aj=fj(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),cs=fj(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);d1(e1,b3.EventEmitter),e1.prototype.post=eV("post",function(h,g,i){return"function"==typeof g&&(i=g,g={}),"object"!=typeof h||Array.isArray(h)?i(fF(e)):void this.bulkDocs({docs:[h]},g,fq(i))}),e1.prototype.put=eV("put",bx(function(l){var j,p,k,m,h=l.shift(),g="_id" in h;if("object"!=typeof h||Array.isArray(h)){return(m=l.pop())(fF(e))}for(;;){if(j=l.shift(),p=typeof j,"string"!==p||g?"string"!==p||!g||"_rev" in h?"object"===p?k=j:"function"===p&&(m=j):h._rev=j:(h._id=j,g=!0),!l.length){break}}return k=k||{},fE(h._id),fv(h._id)&&"function"==typeof this._putLocal?h._deleted?this._removeLocal(h,m):this._putLocal(h,m):void this.bulkDocs({docs:[h]},k,fq(m))})),e1.prototype.putAttachment=eV("putAttachment",function(l,j,p,k,m){function h(i){var o="_rev" in i?parseInt(i._rev,10):0;return i._attachments=i._attachments||{},i._attachments[j]={content_type:m,data:k,revpos:++o},g.put(i)}var g=this;return"function"==typeof m&&(m=k,k=p,p=null),"undefined"==typeof m&&(m=k,k=p,p=null),g.get(l).then(function(i){if(i._rev!==p){throw fF(aF)}return h(i)},function(i){if(i.reason===bS.message){return h({_id:l})}throw i})}),e1.prototype.removeAttachment=eV("removeAttachment",function(i,g,k,h){var j=this;j.get(i,function(m,l){return m?void h(m):l._rev!==k?void h(fF(aF)):l._attachments?(delete l._attachments[g],0===Object.keys(l._attachments).length&&delete l._attachments,void j.put(l,h)):h()})}),e1.prototype.remove=eV("remove",function(k,h,m,j){var l;"string"==typeof h?(l={_id:k,_rev:h},"function"==typeof m&&(j=m,m={})):(l=k,"function"==typeof h?(j=h,m={}):(j=m,m=h)),m=m||{},m.was_delete=!0;var g={_id:l._id,_rev:l._rev||m.rev};return g._deleted=!0,fv(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(l,j):void this.bulkDocs({docs:[g]},m,fq(j))}),e1.prototype.revsDiff=eV("revsDiff",function(m,j,q){function l(n,i){k.has(n)||k.set(n,{missing:[]}),k.get(n).missing.push(i)}function p(i,s){var r=m[i].slice(0);fB(s,function(y,A,w,o,x){var v=A+"-"+w,z=r.indexOf(v);-1!==z&&(r.splice(z,1),"available"!==x.status&&l(i,v))}),r.forEach(function(n){l(i,n)})}"function"==typeof j&&(q=j,j={});var h=Object.keys(m);if(!h.length){return q(null,{})}var g=0,k=new ck.Map;h.map(function(i){this._getRevisionTree(i,function(o,n){if(o&&404===o.status&&"missing"===o.message){k.set(i,{missing:m[i]})}else{if(o){return q(o)}p(i,n)}if(++g===h.length){var s={};return k.forEach(function(u,r){s[r]=u}),q(null,s)}})},this)}),e1.prototype.bulkGet=eV("bulkGet",function(h,g){fD(this,h,g)}),e1.prototype.compactDocument=eV("compactDocument",function(i,g,j){var h=this;this._getRevisionTree(i,function(p,m){if(p){return j(p)}var k=e5(m),n=[],l=[];Object.keys(k).forEach(function(o){k[o]>g&&n.push(o)}),fB(m,function(v,s,x,u,w){var q=s+"-"+x;"available"===w.status&&-1!==n.indexOf(q)&&l.push(q)}),h._doCompaction(i,l,j)})}),e1.prototype.compact=eV("compact",function(h,g){"function"==typeof h&&(g=h,h={});var i=this;h=h||{},i._compactionQueue=i._compactionQueue||[],i._compactionQueue.push({opts:h,callback:g}),1===i._compactionQueue.length&&e3(i)}),e1.prototype._compact=function(l,j){function p(i){g.push(m.compactDocument(i.id,0))}function k(i){var o=i.last_seq;dQ.all(g).then(function(){return eQ(m,"_local/compaction",function(n){return !n.last_seq||n.last_seq<o?(n.last_seq=o,n):!1})}).then(function(){j(null,{ok:!0})})["catch"](j)}var m=this,h={return_docs:!1,last_seq:l.last_seq||0},g=[];m.changes(h).on("change",p).on("complete",k).on("error",j)},e1.prototype.get=eV("get",function(m,j,q){function l(){var n=[],i=p.length;return i?void p.forEach(function(r){h.get(m,{rev:r,revs:j.revs,attachments:j.attachments},function(s,o){s?n.push({missing:r}):n.push({ok:o}),i--,i||q(null,n)})}):q(null,n)}if("function"==typeof j&&(q=j,j={}),"string"!=typeof m){return q(fF(fZ))}if(fv(m)&&"function"==typeof this._getLocal){return this._getLocal(m,q)}var p=[],h=this;if(!j.open_revs){return this._get(m,j,function(B,i){if(B){return q(B)}var w=i.doc,F=i.metadata,I=i.ctx;if(j.conflicts){var H=eB(F);H.length&&(w._conflicts=H)}if(eZ(F,w._rev)&&(w._deleted=!0),j.revs||j.revs_info){var D=fm(F.rev_tree),A=fw(D,function(o){return -1!==o.ids.map(function(r){return r.id}).indexOf(w._rev.split("-")[1])}),x=A.ids.map(function(o){return o.id}).indexOf(w._rev.split("-")[1])+1,C=A.ids.length-x;if(A.ids.splice(x,C),A.ids.reverse(),j.revs&&(w._revisions={start:A.pos+A.ids.length-1,ids:A.ids.map(function(o){return o.id})}),j.revs_info){var z=A.pos+A.ids.length;w._revs_info=A.ids.map(function(o){return z--,{rev:z+"-"+o.id,status:o.opts.status}})}}if(j.attachments&&w._attachments){var n=w._attachments,G=Object.keys(n).length;if(0===G){return q(null,w)}Object.keys(n).forEach(function(o){this._getAttachment(n[o],{binary:j.binary,ctx:I},function(u,v){var s=w._attachments[o];s.data=v,delete s.stub,delete s.length,--G||q(null,w)})},h)}else{if(w._attachments){for(var E in w._attachments){w._attachments.hasOwnProperty(E)&&(w._attachments[E].stub=!0)}}q(null,w)}})}if("all"===j.open_revs){this._getRevisionTree(m,function(n,i){return n?q(n):(p=eK(i).map(function(o){return o.rev}),void l())})}else{if(!Array.isArray(j.open_revs)){return q(fF(e9,"function_clause"))}p=j.open_revs;for(var g=0;g<p.length;g++){var k=p[g];if("string"!=typeof k||!/^\d+-/.test(k)){return q(fF(fp))}}l()}}),e1.prototype.getView=eV("getView",function(h,g,i){e2(this,h,"views",g,i)}),e1.prototype.getFilter=eV("getFilter",function(h,g,i){e2(this,h,"filters",g,i)}),e1.prototype.getAttachment=eV("getAttachment",function(i,g,k,h){var j=this;k instanceof Function&&(h=k,k={}),this._get(i,k,function(m,l){return m?h(m):l.doc._attachments&&l.doc._attachments[g]?(k.ctx=l.ctx,k.binary=!0,j._getAttachment(l.doc._attachments[g],k,h),void 0):h(fF(bS))})}),e1.prototype.allDocs=eV("allDocs",function(h,g){if("function"==typeof h&&(g=h,h={}),h.skip="undefined"!=typeof h.skip?h.skip:0,h.start_key&&(h.startkey=h.start_key),h.end_key&&(h.endkey=h.end_key),"keys" in h){if(!Array.isArray(h.keys)){return g(new TypeError("options.keys must be an array"))}var i=["startkey","endkey","key"].filter(function(j){return j in h})[0];if(i){return void g(fF(cO,"Query parameter `"+i+"` is not compatible with multi-get"))}if("http"!==this.type()){return fy(this,h,g)}}return this._allDocs(h,g)}),e1.prototype.changes=function(h,g){return"function"==typeof h&&(g=h,h={}),new fh(this,h,g)},e1.prototype.close=eV("close",function(g){return this._closed=!0,this._close(g)}),e1.prototype.info=eV("info",function(h){var g=this;this._info(function(j,i){return j?h(j):(i.db_name=i.db_name||g._db_name,i.auto_compaction=!(!g.auto_compaction||"http"===g.type()),i.adapter=g.type(),void h(null,i))})}),e1.prototype.id=eV("id",function(g){return this._id(g)}),e1.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},e1.prototype.bulkDocs=eV("bulkDocs",function(i,g,k){if("function"==typeof g&&(k=g,g={}),g=g||{},Array.isArray(i)&&(i={docs:i}),!i||!i.docs||!Array.isArray(i.docs)){return k(fF(dv))}for(var h=0;h<i.docs.length;++h){if("object"!=typeof i.docs[h]||Array.isArray(i.docs[h])){return k(fF(e))}}var j;return i.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){j=j||ep(m)})}),j?k(fF(bI,j)):("new_edits" in g||("new_edits" in i?g.new_edits=i.new_edits:g.new_edits=!0),g.new_edits||"http"===this.type()||i.docs.sort(fs),e4(i.docs),this._bulkDocs(i,g,function(m,l){return m?k(m):(g.new_edits||(l=l.filter(function(n){return n.error})),void k(null,l))}))}),e1.prototype.registerDependentDatabase=eV("registerDependentDatabase",function(i,g){function j(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[i]?!1:(k.dependentDbs[i]=!0,k)}var h=new this.constructor(i,this.__opts);eQ(this,"_local/_pouch_dependentDbs",j).then(function(){g(null,{db:h})})["catch"](g)}),e1.prototype.destroy=eV("destroy",function(i,g){function k(){h._destroy(i,function(l,m){return l?g(l):(h._destroyed=!0,h.emit("destroyed"),void g(null,m||{ok:!0}))})}"function"==typeof i&&(g=i,i={});var h=this,j="use_prefix" in h?h.use_prefix:!0;return"http"===h.type()?k():void h.get("_local/_pouch_dependentDbs",function(p,n){if(p){return 404!==p.status?g(p):k()}var l=n.dependentDbs,o=h.constructor,m=Object.keys(l).map(function(r){var q=j?r.replace(new RegExp("^"+o.prefix),""):r;return new o(q,h.__opts).destroy()});dQ.all(m).then(k,g)})}),d9.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},d9.prototype.fail=function(g){this.failed=g,this.execute()},d9.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},d9.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},d1(bF,e1),bF.debug=bk;var dk;if(cb()){dk=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),dk=!!localStorage.getItem("_pouch_check_localstorage")}catch(fR){dk=!1}}bF.adapters={},bF.preferredAdapters=[],bF.prefix="_pouch_";var eg=new b3.EventEmitter;fV(bF),bF.parseAdapter=function(m,j){var q,l,p=m.match(/([a-z\-]*):\/\/(.*)/);if(p){if(m=/http(s?)/.test(p[1])?p[1]+"://"+p[2]:p[2],q=p[1],!bF.adapters[q].valid()){throw"Invalid adapter"}return{name:m,adapter:p[1]}}var h="idb" in bF.adapters&&"websql" in bF.adapters&&dq()&&localStorage["_pouch__websqldb_"+bF.prefix+m];if(j.adapter){l=j.adapter}else{if("undefined"!=typeof j&&j.db){l="leveldb"}else{for(var g=0;g<bF.preferredAdapters.length;++g){if(l=bF.preferredAdapters[g],l in bF.adapters){if(h&&"idb"===l){console.log('PouchDB is downgrading "'+m+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}q=bF.adapters[l];var k=q&&"use_prefix" in q?q.use_prefix:!0;return{name:k?bF.prefix+m:m,adapter:l}},bF.adapter=function(h,g,i){g.valid()&&(bF.adapters[h]=g,i&&bF.preferredAdapters.push(h))},bF.plugin=function(g){return Object.keys(g).forEach(function(h){bF.prototype[h]=g[h]}),bF},bF.defaults=function(h){function g(k,i,j){return this instanceof g?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=ch.extend({},h,i),void bF.call(this,k,i,j)):new g(k,i,j)}return d1(g,bF),fV(g),g.preferredAdapters=bF.preferredAdapters.slice(),Object.keys(bF).forEach(function(i){i in g||(g[i]=bF[i])}),g};var bW=el(),eL=function(){},b7=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],f5="queryKey",bM=/(?:^|&)([^&=]*)=?([^&]*)/g,fI=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,c9=function(g){return atob(g)},cf=function(g){return btoa(g)},bB=bE.extend,bh={ajax:f3,parseUri:ap,uuid:fC,Promise:dQ,atob:c9,btoa:cf,binaryStringToBlobOrBuffer:dN,clone:eW,extend:bB,createError:fF},d2=bc.collate,a2=1,cl="pouchdb",by=5,b4=0;c2.prototype.writeCheckpoint=function(h,g){var i=this;return this.updateTarget(h,g).then(function(){return i.updateSource(h,g)})},c2.prototype.updateTarget=function(h,g){return cT(this.target,this.id,h,g,this.returnValue)},c2.prototype.updateSource=function(h,g){var i=this;return this.readOnlySource?dQ.resolve(!0):cT(this.src,this.id,h,g,this.returnValue)["catch"](function(j){if(cI(j)){return i.readOnlySource=!0,!0}throw j})};var dh={undefined:function(h,g){return 0===d2(h.last_seq,g.last_seq)?g.last_seq:0},1:function(h,g){return bP(g,h).last_seq}};c2.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?dQ.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return b4}var j;return j=h.version?h.version.toString():"undefined",j in dh?dh[j](h,i):b4},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:b4}).then(function(){return b4},function(j){return cI(j)?(g.readOnlySource=!0,h.last_seq):b4})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return b4})};var fN=0,bd=eA.setImmediate||eA.setTimeout,aR=32768,eD=eJ(function(l,v){function j(){var n=w*k,u=n+k;if(w++,p>w){m(q,l,n,u),bd(j)}else{m(q,l,n,u);var s=q.end(!0),i=fG(s);v(null,i),q.destroy()}}var g="string"==typeof l,h=g?l.length:l.byteLength,k=Math.min(aR,h),p=Math.ceil(h/k),w=0,q=g?new aQ:new aQ.ArrayBuffer,m=g?c3:ea;j()});d1(ds,b3.EventEmitter),ds.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},ds.prototype.ready=function(i,g){function k(){j.cancel()}function h(){i.removeListener("destroyed",k),g.removeListener("destroyed",k)}var j=this;j._readyCalled||(j._readyCalled=!0,i.once("destroyed",k),g.once("destroyed",k),j.once("complete",h))};var dR={replicate:em,toPouch:fX},cL=dR.replicate;d1(e0,b3.EventEmitter),e0.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var dw=25,bT=50,aG={},f0=1800,ad=bk("pouchdb:http");b2.valid=function(){return !0},df.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},df.prototype.finish=function(){return this.promise};var cB,dH=function(h,g){return g&&h.then(function(i){eG.nextTick(function(){g(null,i)})},function(i){eG.nextTick(function(){g(i)})}),h},fd=function(g){return bx(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&dH(i,j),i})},aw=function(h,g){return h.then(function(i){return g().then(function(){return i})},function(i){return g().then(function(){throw i})})},aB=function(h,g){return function(){var j=arguments,i=this;return h.add(function(){return g.apply(i,j)})}},cQ=function(k){for(var h={},m=0,j=k.length;j>m;m++){h["$"+k[m]]=!0}var l=Object.keys(h),g=new Array(l.length);for(m=0,j=l.length;j>m;m++){g[m]=l[m].substring(1)}return g},cW={uniq:cQ,sequentialize:aB,fin:aw,callbackify:fd,promisedCallback:dH},bJ=bc.collate,t=bc.toIndexableString,bq=bc.normalizeKey,cF=bc.parseIndexableString;cB="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var dB=cW.callbackify,c6=cW.sequentialize,aX=cW.uniq,fu=cW.fin,d7=cW.promisedCallback,c0={},aM=new df,dL=50,a8={_sum:function(h,g){return dF(g)},_count:function(h,g){return g.length},_stats:function(h,g){function i(l){for(var j=0,p=0,k=l.length;k>p;p++){var m=l[p];j+=m*m}return j}return{sum:dF(g),min:Math.min.apply(null,g),max:Math.max.apply(null,g),count:g.length,sumsqr:i(g)}}},dW=dB(function(){var g=this;return g._ddocCache&&delete g._ddocCache,"http"===g.type()?a6(g):"function"==typeof g._viewCleanup?bm(g):dT(g)}),al=function(i,g,k){"function"==typeof g&&(k=g,g={}),g=g?az(g):{},"function"==typeof i&&(i={map:i});var h=this,j=dQ.resolve().then(function(){return ah(h,i,g)});return d7(j,k),j};d1(cq,Error),d1(dj,Error);var cv={query:al,viewCleanup:dW},dm=5,fT="document-store",ej="by-sequence",bY="attach-store",eP="attach-seq-store",b9="meta-store",f6="local-store",bN="detect-blob-support",fJ={running:!1,queue:[]};d1(bK,b3.EventEmitter),bK.prototype.addListener=function(k,h,m,j){function l(){function o(){i=!1}if(g._listeners[h]){if(i){return void (i="waiting")}i=!0;var n=eO(j,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);m.changes(n).on("change",function(p){p.seq>j.since&&!j.cancelled&&(j.since=p.seq,j.onChange(p))}).on("complete",function(){"waiting"===i&&setTimeout(function(){l()},0),i=!1}).on("error",o)}}if(!this._listeners[h]){var g=this,i=!1;this._listeners[h]=l,this.on(k,l)}},bK.prototype.removeListener=function(h,g){g in this._listeners&&b3.EventEmitter.prototype.removeListener.call(this,h,this._listeners[g])},bK.prototype.notifyLocalWindows=function(g){cb()?chrome.storage.local.set({dbName:g}):dq()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},bK.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var da,cg=new ck.Map,bD=new bK,bj=new ck.Map;aa.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var d6=7,a4=c1("document-store"),cu=c1("by-sequence"),bC=c1("attach-store"),b8=c1("local-store"),dl=c1("metadata-store"),fS=c1("attach-seq-store"),bi=new ck.Map,aT=new bK,eM=1,dV="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+cu+" (seq, deleted)",cP="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+cu+" (doc_id, rev)",eh="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+a4+" (winningseq)",dA="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+fS+" (seq)",bX="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+fS+" (digest, seq)",aI=cu+".seq = "+a4+".winningseq",f2=cu+".seq AS seq, "+cu+".deleted AS deleted, "+cu+".json AS data, "+cu+".rev AS rev, "+a4+".json AS metadata";db.use_prefix=!("undefined"!=typeof eG&&!eG.browser),db.valid=dM;var ak={idb:aa,websql:db};bF.ajax=f3,bF.utils=bh,bF.Errors=dK,bF.replicate=dR.replicate,bF.sync=b1,bF.version="5.3.2",bF.adapter("http",b2),bF.adapter("https",b2),bF.plugin(cv),Object.keys(ak).forEach(function(g){bF.adapter(g,ak[g],!0)}),c.exports=bF}).call(this,d(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});