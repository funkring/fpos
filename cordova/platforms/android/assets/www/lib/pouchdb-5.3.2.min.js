!function(b){if("object"==typeof exports&&"undefined"!=typeof module){module.exports=b()}else{if("function"==typeof define&&define.amd){define([],b)}else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.PouchDB=b()}}}(function(){var b;return function a(h,c,f){function g(k,m){if(!c[k]){if(!h[k]){var l="function"==typeof require&&require;if(!m&&l){return l(k,!0)}if(d){return d(k,!0)}var i=new Error("Cannot find module '"+k+"'");throw i.code="MODULE_NOT_FOUND",i}var e=c[k]={exports:{}};h[k][0].call(e.exports,function(o){var n=h[k][1][o];return g(n?n:o)},e,e.exports,a,h,c,f)}return c[k].exports}for(var d="function"==typeof require&&require,j=0;j<f.length;j++){g(f[j])}return g}({1:[function(c,f,d){function g(e){return function(){var h=arguments.length;if(h){for(var j=[],i=-1;++i<h;){j[i]=arguments[i]}return e.call(this,j)}return e.call(this,[])}}f.exports=g},{}],2:[function(h,l,f){function c(){return"WebkitAppearance" in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function d(){var p=arguments,n=this.useColors;if(p[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+p[0]+(n?"%c ":" ")+"+"+f.humanize(this.diff),!n){return p}var o="color: "+this.color;p=[p[0],o,"color: inherit"].concat(Array.prototype.slice.call(p,1));var e=0,i=0;return p[0].replace(/%[a-z%]/g,function(q){"%%"!==q&&(e++,"%c"===q&&(i=e))}),p.splice(i,0,o),p}function g(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function j(e){try{null==e?f.storage.removeItem("debug"):f.storage.debug=e}catch(i){}}function m(){var e;try{e=f.storage.debug}catch(i){}return e}function k(){try{return window.localStorage}catch(e){}}f=l.exports=h(3),f.log=g,f.formatArgs=d,f.save=j,f.load=m,f.useColors=c,f.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:k(),f.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],f.formatters.j=function(e){return JSON.stringify(e)},f.enable(m())},{3:3}],3:[function(c,j,p){function l(){return p.colors[v++%p.colors.length]}function m(i){function e(){}function f(){var o=f,s=+new Date,r=s-(d||s);o.diff=r,o.prev=d,o.curr=s,d=s,null==o.useColors&&(o.useColors=p.useColors()),null==o.color&&o.useColors&&(o.color=l());var u=Array.prototype.slice.call(arguments);u[0]=p.coerce(u[0]),"string"!=typeof u[0]&&(u=["%o"].concat(u));var t=0;u[0]=u[0].replace(/%([a-z%])/g,function(D,B){if("%%"===D){return D}t++;var w=p.formatters[B];if("function"==typeof w){var C=u[t];D=w.call(o,C),u.splice(t,1),t--}return D}),"function"==typeof p.formatArgs&&(u=p.formatArgs.apply(o,u));var x=f.log||p.log||console.log.bind(console);x.apply(o,u)}e.enabled=!1,f.enabled=!0;var n=p.enabled(i)?f:e;return n.namespace=i,n}function q(f){p.save(f);for(var i=(f||"").split(/[\s,]+/),e=i.length,n=0;e>n;n++){i[n]&&(f=i[n].replace(/\*/g,".*?"),"-"===f[0]?p.skips.push(new RegExp("^"+f.substr(1)+"$")):p.names.push(new RegExp("^"+f+"$")))}}function g(){p.enable("")}function k(i){var e,f;for(e=0,f=p.skips.length;f>e;e++){if(p.skips[e].test(i)){return !1}}for(e=0,f=p.names.length;f>e;e++){if(p.names[e].test(i)){return !0}}return !1}function h(e){return e instanceof Error?e.stack||e.message:e}p=j.exports=m,p.coerce=h,p.disable=g,p.enable=q,p.enabled=k,p.humanize=c(9),p.names=[],p.skips=[],p.formatters={};var d,v=0},{9:9}],4:[function(j,l,f){function k(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(e){return"function"==typeof e}function h(e){return"number"==typeof e}function c(e){return"object"==typeof e&&null!==e}function g(e){return void 0===e}l.exports=k,k.EventEmitter=k,k.prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.prototype.setMaxListeners=function(e){if(!h(e)||0>e||isNaN(e)){throw TypeError("n must be a positive number")}return this._maxListeners=e,this},k.prototype.emit=function(n){var p,q,i,m,o,e;if(this._events||(this._events={}),"error"===n&&(!this._events.error||c(this._events.error)&&!this._events.error.length)){if(p=arguments[1],p instanceof Error){throw p}throw TypeError('Uncaught, unspecified "error" event.')}if(q=this._events[n],g(q)){return !1}if(d(q)){switch(arguments.length){case 1:q.call(this);break;case 2:q.call(this,arguments[1]);break;case 3:q.call(this,arguments[1],arguments[2]);break;default:m=Array.prototype.slice.call(arguments,1),q.apply(this,m)}}else{if(c(q)){for(m=Array.prototype.slice.call(arguments,1),e=q.slice(),i=e.length,o=0;i>o;o++){e[o].apply(this,m)}}}return !0},k.prototype.addListener=function(m,i){var e;if(!d(i)){throw TypeError("listener must be a function")}return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",m,d(i.listener)?i.listener:i),this._events[m]?c(this._events[m])?this._events[m].push(i):this._events[m]=[this._events[m],i]:this._events[m]=i,c(this._events[m])&&!this._events[m].warned&&(e=g(this._maxListeners)?k.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[m].length>e&&(this._events[m].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[m].length),"function"==typeof console.trace&&console.trace())),this},k.prototype.on=k.prototype.addListener,k.prototype.once=function(m,e){function n(){this.removeListener(m,n),i||(i=!0,e.apply(this,arguments))}if(!d(e)){throw TypeError("listener must be a function")}var i=!1;return n.listener=e,this.on(m,n),this},k.prototype.removeListener=function(m,p){var o,n,e,i;if(!d(p)){throw TypeError("listener must be a function")}if(!this._events||!this._events[m]){return this}if(o=this._events[m],e=o.length,n=-1,o===p||d(o.listener)&&o.listener===p){delete this._events[m],this._events.removeListener&&this.emit("removeListener",m,p)}else{if(c(o)){for(i=e;i-->0;){if(o[i]===p||o[i].listener&&o[i].listener===p){n=i;break}}if(0>n){return this}1===o.length?(o.length=0,delete this._events[m]):o.splice(n,1),this._events.removeListener&&this.emit("removeListener",m,p)}}return this},k.prototype.removeAllListeners=function(m){var i,e;if(!this._events){return this}if(!this._events.removeListener){return 0===arguments.length?this._events={}:this._events[m]&&delete this._events[m],this}if(0===arguments.length){for(i in this._events){"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[m],d(e)){this.removeListener(m,e)}else{if(e){for(;e.length;){this.removeListener(m,e[e.length-1])}}}return delete this._events[m],this},k.prototype.listeners=function(i){var e;return e=this._events&&this._events[i]?d(this._events[i])?[this._events[i]]:this._events[i].slice():[]},k.prototype.listenerCount=function(i){if(this._events){var e=this._events[i];if(d(e)){return 1}if(e){return e.length}}return 0},k.listenerCount=function(i,e){return i.listenerCount(e)}},{}],5:[function(d,c,f){(function(h){function v(){g=!0;for(var l,i,n=w.length;n;){for(i=w,w=[],l=-1;++l<n;){i[l]()}n=w.length}g=!1}function p(i){1!==w.push(i)||g||q()}var q,e=h.MutationObserver||h.WebKitMutationObserver;if(e){var j=0,m=new e(v),k=h.document.createTextNode("");m.observe(k,{characterData:!0}),q=function(){k.data=j=++j%2}}else{if(h.setImmediate||"undefined"==typeof h.MessageChannel){q="document" in h&&"onreadystatechange" in h.document.createElement("script")?function(){var i=h.document.createElement("script");i.onreadystatechange=function(){v(),i.onreadystatechange=null,i.parentNode.removeChild(i),i=null},h.document.documentElement.appendChild(i)}:function(){setTimeout(v,0)}}else{var t=new h.MessageChannel;t.port1.onmessage=v,q=function(){t.port2.postMessage(0)}}}var g,w=[];c.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(d,c,f){"function"==typeof Object.create?c.exports=function(g,e){g.super_=e,g.prototype=Object.create(e.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}})}:c.exports=function(g,e){g.super_=e;var h=function(){};h.prototype=e.prototype,g.prototype=new h,g.prototype.constructor=g}},{}],7:[function(d,c,f){(function(e){e("object"==typeof f?f:this)}).call(this,function(h){var e=Array.prototype.slice,i=Array.prototype.forEach,g=function(j){if("object"!=typeof j){throw j+" is not an object"}var k=e.call(arguments,1);return i.call(k,function(l){if(l){for(var m in l){"object"==typeof l[m]&&j[m]?g.call(j,j[m],l[m]):j[m]=l[m]}}}),j};h.extend=g})},{}],8:[function(q,k,E){function x(){}function j(e){if("function"!=typeof e){throw new TypeError("resolver must be a function")}this.state=C,this.queue=[],this.outcome=void 0,e!==x&&g(this,e)}function I(f,e,h){this.promise=f,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof h&&(this.onRejected=h,this.callRejected=this.otherCallRejected)}function F(f,e,h){B(function(){var i;try{i=e(h)}catch(l){return d.reject(f,l)}i===f?d.reject(f,new TypeError("Cannot resolve promise with itself")):d.resolve(f,i)})}function J(f){var e=f&&f.then;return f&&"object"==typeof f&&"function"==typeof e?function(){e.apply(f,arguments)}:void 0}function g(m,i){function f(o){e||(e=!0,d.reject(m,o))}function l(o){e||(e=!0,d.resolve(m,o))}function h(){i(l,f)}var e=!1,n=A(h);"error"===n.status&&f(n.value)}function A(i,f){var e={};try{e.value=i(f),e.status="success"}catch(h){e.status="error",e.value=h}return e}function G(e){return e instanceof this?e:d.resolve(new this(x),e)}function D(f){var e=new this(x);return d.reject(e,f)}function z(h){function n(r,s){function t(u){m[s]=u,++i!==o||e||(e=!0,d.resolve(l,m))}p.resolve(r).then(t,function(u){e||(e=!0,d.reject(l,u))})}var p=this;if("[object Array]"!==Object.prototype.toString.call(h)){return this.reject(new TypeError("must be an array"))}var o=h.length,e=!1;if(!o){return this.resolve([])}for(var m=new Array(o),i=0,f=-1,l=new this(x);++f<o;){n(h[f],f)}return l}function w(m){function i(o){f.resolve(o).then(function(p){e||(e=!0,d.resolve(l,p))},function(p){e||(e=!0,d.reject(l,p))})}var f=this;if("[object Array]"!==Object.prototype.toString.call(m)){return this.reject(new TypeError("must be an array"))}var h=m.length,e=!1;if(!h){return this.resolve([])}for(var n=-1,l=new this(x);++n<h;){i(m[n])}return l}var B=q(5),d={},c=["REJECTED"],H=["FULFILLED"],C=["PENDING"];k.exports=E=j,j.prototype["catch"]=function(e){return this.then(null,e)},j.prototype.then=function(h,f){if("function"!=typeof h&&this.state===H||"function"!=typeof f&&this.state===c){return this}var e=new this.constructor(x);if(this.state!==C){var i=this.state===H?h:f;F(e,i,this.outcome)}else{this.queue.push(new I(e,h,f))}return e},I.prototype.callFulfilled=function(e){d.resolve(this.promise,e)},I.prototype.otherCallFulfilled=function(e){F(this.promise,this.onFulfilled,e)},I.prototype.callRejected=function(e){d.reject(this.promise,e)},I.prototype.otherCallRejected=function(e){F(this.promise,this.onRejected,e)},d.resolve=function(l,f){var h=A(J,f);if("error"===h.status){return d.reject(l,h.value)}var i=h.value;if(i){g(l,i)}else{l.state=H,l.outcome=f;for(var m=-1,e=l.queue.length;++m<e;){l.queue[m].callFulfilled(f)}}return l},d.reject=function(i,f){i.state=c,i.outcome=f;for(var e=-1,h=i.queue.length;++e<h;){i.queue[e].callRejected(f)}return i},E.resolve=G,E.reject=D,E.all=z,E.race=w},{5:5}],9:[function(p,x,h){function d(i){if(i=""+i,!(i.length>10000)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(e){var l=parseFloat(e[1]),f=(e[2]||"ms").toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return l*j;case"days":case"day":case"d":return l*m;case"hours":case"hour":case"hrs":case"hr":case"h":return l*q;case"minutes":case"minute":case"mins":case"min":case"m":return l*w;case"seconds":case"second":case"secs":case"sec":case"s":return l*c;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l}}}}function g(e){return e>=m?Math.round(e/m)+"d":e>=q?Math.round(e/q)+"h":e>=w?Math.round(e/w)+"m":e>=c?Math.round(e/c)+"s":e+"ms"}function k(e){return v(e,m,"day")||v(e,q,"hour")||v(e,w,"minute")||v(e,c,"second")||e+" ms"}function v(f,e,i){return e>f?void 0:1.5*e>f?Math.floor(f/e)+" "+i:Math.ceil(f/e)+" "+i+"s"}var c=1000,w=60*c,q=60*w,m=24*q,j=365.25*m;x.exports=function(f,e){return e=e||{},"string"==typeof f?d(f):e["long"]?k(f):g(f)}},{}],10:[function(k,z,c){function q(o){if(null!==o){switch(typeof o){case"boolean":return o?1:0;case"number":return g(o);case"string":return o.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var n=Array.isArray(o),e=n?o:Object.keys(o),i=-1,l=e.length,h="";if(n){for(;++i<l;){h+=c.toIndexableString(e[i])}}else{for(;++i<l;){var f=e[i];h+=c.toIndexableString(f)+c.toIndexableString(o[f])}}return h}}return""}function y(o,e){var l,h=e,i="1"===o[e];if(i){l=0,e++}else{var n="0"===o[e];e++;var r="",f=o.substring(e,e+m),s=parseInt(f,10)+x;for(n&&(s=-s),e+=m;;){var p=o[e];if("\x00"===p){break}r+=p,e++}r=r.split("."),l=1===r.length?parseInt(r,10):parseFloat(r[0]+"."+r[1]),n&&(l-=10),0!==s&&(l=parseFloat(l+"e"+s))}return{num:l,length:e-h}}function j(e,i){var n=e.pop();if(i.length){var f=i[i.length-1];n===f.element&&(i.pop(),f=i[i.length-1]);var l=f.element,h=f.index;if(Array.isArray(l)){l.push(n)}else{if(h===e.length-2){var o=e.pop();l[o]=n}else{e.push(n)}}}}function d(e,i){for(var l=Math.min(e.length,i.length),f=0;l>f;f++){var h=c.collate(e[f],i[f]);if(0!==h){return h}}return e.length===i.length?0:e.length>i.length?1:-1}function B(f,e){return f===e?0:f>e?1:-1}function w(o,n){for(var e=Object.keys(o),i=Object.keys(n),l=Math.min(e.length,i.length),h=0;l>h;h++){var f=c.collate(e[h],i[h]);if(0!==f){return f}if(f=c.collate(o[e[h]],n[i[h]]),0!==f){return f}}return e.length===i.length?0:e.length>i.length?1:-1}function C(f){var e=["boolean","number","string","object"],h=e.indexOf(typeof f);return ~h?null===f?1:Array.isArray(f)?5:3>h?h+2:h+3:Array.isArray(f)?5:void 0}function g(l){if(0===l){return"1"}var p=l.toExponential().split(/e\+?/),h=parseInt(p[1],10),e=0>l,f=e?"0":"2",i=(e?-h:h)-x,n=v.padLeft(i.toString(),"0",m);f+=A+n;var r=Math.abs(parseFloat(p[0]));e&&(r=10-r);var o=r.toFixed(20);return o=o.replace(/\.?0+$/,""),f+=A+o}var x=-324,m=3,A="",v=k(11);c.collate=function(h,e){if(h===e){return 0}h=c.normalizeKey(h),e=c.normalizeKey(e);var f=C(h),i=C(e);if(f-i!==0){return f-i}if(null===h){return 0}switch(typeof h){case"number":return h-e;case"boolean":return h===e?0:e>h?-1:1;case"string":return B(h,e)}return Array.isArray(h)?d(h,e):w(h,e)},c.normalizeKey=function(l){switch(typeof l){case"undefined":return null;case"number":return l===1/0||l===-(1/0)||isNaN(l)?null:l;case"object":var h=l;if(Array.isArray(l)){var i=l.length;l=new Array(i);for(var n=0;i>n;n++){l[n]=c.normalizeKey(h[n])}}else{if(l instanceof Date){return l.toJSON()}if(null!==l){l={};for(var f in h){if(h.hasOwnProperty(f)){var e=h[f];"undefined"!=typeof e&&(l[f]=c.normalizeKey(e))}}}}}return l},c.toIndexableString=function(f){var e="\x00";return f=c.normalizeKey(f),C(f)+A+q(f)+e},c.parseIndexableString=function(o){for(var e=[],i=[],h=0;;){var r=o[h++];if("\x00"!==r){switch(r){case"1":e.push(null);break;case"2":e.push("1"===o[h]),h++;break;case"3":var f=y(o,h);e.push(f.num),h+=f.length;break;case"4":for(var s="";;){var p=o[h];if("\x00"===p){break}s+=p,h++}s=s.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(s);break;case"5":var n={element:[],index:e.length};e.push(n.element),i.push(n);break;case"6":var l={element:{},index:e.length};e.push(l.element),i.push(l);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+r)}}else{if(1===e.length){return e.pop()}j(e,i)}}}},{11:11}],11:[function(c,f,d){function g(j,h,e){for(var i="",k=e-j.length;i.length<k;){i+=h}return i}d.padLeft=function(h,e,j){var i=g(h,e,j);return i+h},d.padRight=function(h,e,j){var i=g(h,e,j);return h+i},d.stringLexCompare=function(p,m){var j,l=p.length,k=m.length;for(j=0;l>j;j++){if(j===k){return 1}var h=p.charAt(j),e=m.charAt(j);if(h!==e){return e>h?-1:1}}return k>l?-1:0},d.intToDecimalForm=function(i){var e=0>i,j="";do{var h=e?-Math.ceil(i%10):Math.floor(i%10);j=h+j,i=e?Math.ceil(i/10):Math.floor(i/10)}while(i);return e&&"0"!==j&&(j="-"+j),j}},{}],12:[function(g,d,c){function f(){this.store={}}function h(i){if(this.store=new f,i&&Array.isArray(i)){for(var e=0,j=i.length;j>e;e++){this.add(i[e])}}}c.Map=f,c.Set=h,f.prototype.mangle=function(e){if("string"!=typeof e){throw new TypeError("key must be a string but Got "+e)}return"$"+e},f.prototype.unmangle=function(e){return e.substring(1)},f.prototype.get=function(i){var e=this.mangle(i);return e in this.store?this.store[e]:void 0},f.prototype.set=function(i,e){var j=this.mangle(i);return this.store[j]=e,!0},f.prototype.has=function(i){var e=this.mangle(i);return e in this.store},f.prototype["delete"]=function(i){var e=this.mangle(i);return e in this.store?(delete this.store[e],!0):!1},f.prototype.forEach=function(k){for(var e=Object.keys(this.store),l=0,j=e.length;j>l;l++){var i=e[l],m=this.store[i];i=this.unmangle(i),k(m,i)}},h.prototype.add=function(e){return this.store.set(e,!0)},h.prototype.has=function(e){return this.store.has(e)},h.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],13:[function(p,x,h){function d(){m=!1,c.length?q=c.concat(q):j=-1,q.length&&g()}function g(){if(!m){var f=setTimeout(d);m=!0;for(var e=q.length;e;){for(c=q,q=[];++j<e;){c&&c[j].run()}j=-1,e=q.length}c=null,m=!1,clearTimeout(f)}}function k(f,e){this.fun=f,this.array=e}function v(){}var c,w=x.exports={},q=[],m=!1,j=-1;w.nextTick=function(f){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}q.push(new k(f,e)),1!==q.length||m||setTimeout(g,0)},k.prototype.run=function(){this.fun.apply(null,this.array)},w.title="browser",w.browser=!0,w.env={},w.argv=[],w.version="",w.versions={},w.on=v,w.addListener=v,w.once=v,w.off=v,w.removeListener=v,w.removeAllListeners=v,w.emit=v,w.binding=function(e){throw new Error("process.binding is not supported")},w.cwd=function(){return"/"},w.chdir=function(e){throw new Error("process.chdir is not supported")},w.umask=function(){return 0}},{}],14:[function(d,c,f){(function(){var e={}.hasOwnProperty,g=[].slice;c.exports=function(i,m){var l,k,h,j;k=[],j=[];for(l in m){e.call(m,l)&&(h=m[l],"this"!==l&&(k.push(l),j.push(h)))}return Function.apply(null,g.call(k).concat([i])).apply(m["this"],j)}}).call(this)},{}],15:[function(c,e,d){!function(g){if("object"==typeof d){e.exports=g()}else{if("function"==typeof b&&b.amd){b(g)}else{var h;try{h=window}catch(f){h=self}h.SparkMD5=g()}}}(function(C){function q(l,h,n,i,m,g){return h=x(x(h,l),x(i,g)),x(h<<m|h>>>32-m,n)}function D(m,i,l,n,h,o,g){return q(i&l|~i&n,m,i,h,o,g)}function F(m,i,l,n,h,o,g){return q(i&n|l&~n,m,i,h,o,g)}function B(m,i,l,n,h,o,g){return q(i^l^n,m,i,h,o,g)}function G(m,i,l,n,h,o,g){return q(l^(i|~n),m,i,h,o,g)}function M(l,h){var n=l[0],i=l[1],g=l[2],m=l[3];n=D(n,i,g,m,h[0],7,-680876936),m=D(m,n,i,g,h[1],12,-389564586),g=D(g,m,n,i,h[2],17,606105819),i=D(i,g,m,n,h[3],22,-1044525330),n=D(n,i,g,m,h[4],7,-176418897),m=D(m,n,i,g,h[5],12,1200080426),g=D(g,m,n,i,h[6],17,-1473231341),i=D(i,g,m,n,h[7],22,-45705983),n=D(n,i,g,m,h[8],7,1770035416),m=D(m,n,i,g,h[9],12,-1958414417),g=D(g,m,n,i,h[10],17,-42063),i=D(i,g,m,n,h[11],22,-1990404162),n=D(n,i,g,m,h[12],7,1804603682),m=D(m,n,i,g,h[13],12,-40341101),g=D(g,m,n,i,h[14],17,-1502002290),i=D(i,g,m,n,h[15],22,1236535329),n=F(n,i,g,m,h[1],5,-165796510),m=F(m,n,i,g,h[6],9,-1069501632),g=F(g,m,n,i,h[11],14,643717713),i=F(i,g,m,n,h[0],20,-373897302),n=F(n,i,g,m,h[5],5,-701558691),m=F(m,n,i,g,h[10],9,38016083),g=F(g,m,n,i,h[15],14,-660478335),i=F(i,g,m,n,h[4],20,-405537848),n=F(n,i,g,m,h[9],5,568446438),m=F(m,n,i,g,h[14],9,-1019803690),g=F(g,m,n,i,h[3],14,-187363961),i=F(i,g,m,n,h[8],20,1163531501),n=F(n,i,g,m,h[13],5,-1444681467),m=F(m,n,i,g,h[2],9,-51403784),g=F(g,m,n,i,h[7],14,1735328473),i=F(i,g,m,n,h[12],20,-1926607734),n=B(n,i,g,m,h[5],4,-378558),m=B(m,n,i,g,h[8],11,-2022574463),g=B(g,m,n,i,h[11],16,1839030562),i=B(i,g,m,n,h[14],23,-35309556),n=B(n,i,g,m,h[1],4,-1530992060),m=B(m,n,i,g,h[4],11,1272893353),g=B(g,m,n,i,h[7],16,-155497632),i=B(i,g,m,n,h[10],23,-1094730640),n=B(n,i,g,m,h[13],4,681279174),m=B(m,n,i,g,h[0],11,-358537222),g=B(g,m,n,i,h[3],16,-722521979),i=B(i,g,m,n,h[6],23,76029189),n=B(n,i,g,m,h[9],4,-640364487),m=B(m,n,i,g,h[12],11,-421815835),g=B(g,m,n,i,h[15],16,530742520),i=B(i,g,m,n,h[2],23,-995338651),n=G(n,i,g,m,h[0],6,-198630844),m=G(m,n,i,g,h[7],10,1126891415),g=G(g,m,n,i,h[14],15,-1416354905),i=G(i,g,m,n,h[5],21,-57434055),n=G(n,i,g,m,h[12],6,1700485571),m=G(m,n,i,g,h[3],10,-1894986606),g=G(g,m,n,i,h[10],15,-1051523),i=G(i,g,m,n,h[1],21,-2054922799),n=G(n,i,g,m,h[8],6,1873313359),m=G(m,n,i,g,h[15],10,-30611744),g=G(g,m,n,i,h[6],15,-1560198380),i=G(i,g,m,n,h[13],21,1309151649),n=G(n,i,g,m,h[4],6,-145523070),m=G(m,n,i,g,h[11],10,-1120210379),g=G(g,m,n,i,h[2],15,718787259),i=G(i,g,m,n,h[9],21,-343485551),l[0]=x(n,l[0]),l[1]=x(i,l[1]),l[2]=x(g,l[2]),l[3]=x(m,l[3])}function z(h){var g,i=[];for(g=0;64>g;g+=4){i[g>>2]=h.charCodeAt(g)+(h.charCodeAt(g+1)<<8)+(h.charCodeAt(g+2)<<16)+(h.charCodeAt(g+3)<<24)}return i}function E(h){var g,i=[];for(g=0;64>g;g+=4){i[g>>2]=h[g]+(h[g+1]<<8)+(h[g+2]<<16)+(h[g+3]<<24)}return i}function I(g){var p,l,i,r,m,h,o=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(p=64;o>=p;p+=64){M(n,z(g.substring(p-64,p)))}for(g=g.substring(p-64),l=g.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=0;l>p;p+=1){i[p>>2]|=g.charCodeAt(p)<<(p%4<<3)}if(i[p>>2]|=128<<(p%4<<3),p>55){for(M(n,i),p=0;16>p;p+=1){i[p]=0}}return r=8*o,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),h=parseInt(r[1],16)||0,i[14]=m,i[15]=h,M(n,i),n}function A(g){var h,l,i,r,m,p,o=g.length,n=[1732584193,-271733879,-1732584194,271733878];for(h=64;o>=h;h+=64){M(n,E(g.subarray(h-64,h)))}for(g=o>h-64?g.subarray(h-64):new Uint8Array(0),l=g.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=0;l>h;h+=1){i[h>>2]|=g[h]<<(h%4<<3)}if(i[h>>2]|=128<<(h%4<<3),h>55){for(M(n,i),h=0;16>h;h+=1){i[h]=0}}return r=8*o,r=r.toString(16).match(/(.*?)(.{0,8})$/),m=parseInt(r[2],16),p=parseInt(r[1],16)||0,i[14]=m,i[15]=p,M(n,i),n}function w(h){var g,i="";for(g=0;4>g;g+=1){i+=L[h>>8*g+4&15]+L[h>>8*g&15]}return i}function H(h){var g;for(g=0;g<h.length;g+=1){h[g]=w(h[g])}return h.join("")}function J(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function k(l,h){var n,i=l.length,m=new ArrayBuffer(i),g=new Uint8Array(m);for(n=0;i>n;n+=1){g[n]=l.charCodeAt(n)}return h?g:m}function j(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function f(i,g,l){var h=new Uint8Array(i.byteLength+g.byteLength);return h.set(new Uint8Array(i)),h.set(new Uint8Array(g),i.byteLength),l?h:h.buffer}function N(i){var g,l=[],h=i.length;for(g=0;h-1>g;g+=2){l.push(parseInt(i.substr(g,2),16))}return String.fromCharCode.apply(String,l)}function K(){this.reset()}var x=function(h,g){return h+g&4294967295},L=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==H(I("hello"))&&(x=function(i,g){var l=(65535&i)+(65535&g),h=(i>>16)+(g>>16)+(l>>16);return h<<16|65535&l}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function g(h,i){return h=0|h||0,0>h?Math.max(h+i,0):Math.min(h,i)}ArrayBuffer.prototype.slice=function(i,o){var s,r,p,n,l=this.byteLength,m=g(i,l),h=l;return o!==C&&(h=g(o,l)),m>h?new ArrayBuffer(0):(s=h-m,r=new ArrayBuffer(s),p=new Uint8Array(r),n=new Uint8Array(this,m,s),p.set(n),r)}}(),K.prototype.append=function(g){return this.appendBinary(J(g)),this},K.prototype.appendBinary=function(h){this._buff+=h,this._length+=h.length;var g,i=this._buff.length;for(g=64;i>=g;g+=64){M(this._hash,z(this._buff.substring(g-64,g)))}return this._buff=this._buff.substring(g-64),this},K.prototype.end=function(l){var h,n,i=this._buff,m=i.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;m>h;h+=1){g[h>>2]|=i.charCodeAt(h)<<(h%4<<3)}return this._finish(g,m),n=H(this._hash),l&&(n=N(n)),this.reset(),n},K.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},K.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},K.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},K.prototype._finish=function(l,h){var n,i,m,g=h;if(l[g>>2]|=128<<(g%4<<3),g>55){for(M(this._hash,l),g=0;16>g;g+=1){l[g]=0}}n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(n[2],16),m=parseInt(n[1],16)||0,l[14]=i,l[15]=m,M(this._hash,l)},K.hash=function(h,g){return K.hashBinary(J(h),g)},K.hashBinary=function(i,g){var l=I(i),h=H(l);return g?N(h):h},K.ArrayBuffer=function(){this.reset()},K.ArrayBuffer.prototype.append=function(i){var g,l=f(this._buff.buffer,i,!0),h=l.length;for(this._length+=i.byteLength,g=64;h>=g;g+=64){M(this._hash,E(l.subarray(g-64,g)))}return this._buff=h>g-64?new Uint8Array(l.buffer.slice(g-64)):new Uint8Array(0),this},K.ArrayBuffer.prototype.end=function(l){var h,n,i=this._buff,m=i.length,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(h=0;m>h;h+=1){g[h>>2]|=i[h]<<(h%4<<3)}return this._finish(g,m),n=H(this._hash),l&&(n=N(n)),this.reset(),n},K.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},K.ArrayBuffer.prototype.getState=function(){var g=K.prototype.getState.call(this);return g.buff=j(g.buff),g},K.ArrayBuffer.prototype.setState=function(g){return g.buff=k(g.buff,!0),K.prototype.setState.call(this,g)},K.ArrayBuffer.prototype.destroy=K.prototype.destroy,K.ArrayBuffer.prototype._finish=K.prototype._finish,K.ArrayBuffer.hash=function(i,g){var l=A(new Uint8Array(i)),h=H(l);return g?N(h):h},K})},{}],16:[function(c,f,d){function g(p,m,j){var l=j[j.length-1];p===l.element&&(j.pop(),l=j[j.length-1]);var k=l.element,h=l.index;if(Array.isArray(k)){k.push(p)}else{if(h===m.length-2){var e=m.pop();k[e]=p}else{m.push(p)}}}d.stringify=function(h){var w=[];w.push({obj:h});for(var x,e,z,m,q,B,A,y,p,k,v,j="";x=w.pop();){if(e=x.obj,z=x.prefix||"",m=x.val||"",j+=z,m){j+=m}else{if("object"!=typeof e){j+="undefined"==typeof e?null:JSON.stringify(e)}else{if(null===e){j+="null"}else{if(Array.isArray(e)){for(w.push({val:"]"}),q=e.length-1;q>=0;q--){B=0===q?"":",",w.push({obj:e[q],prefix:B})}w.push({val:"["})}else{A=[];for(y in e){e.hasOwnProperty(y)&&A.push(y)}for(w.push({val:"}"}),q=A.length-1;q>=0;q--){p=A[q],k=e[p],v=q>0?",":"",v+=JSON.stringify(p)+":",w.push({obj:k,prefix:v})}w.push({val:"{"})}}}}}return j},d.parse=function(z){for(var r,j,m,v,x,w,y,k,h,q=[],p=[],e=0;;){if(r=z[e++],"}"!==r&&"]"!==r&&"undefined"!=typeof r){switch(r){case" ":case"	":case"\n":case":":case",":break;case"n":e+=3,g(null,q,p);break;case"t":e+=3,g(!0,q,p);break;case"f":e+=4,g(!1,q,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(j="",e--;;){if(m=z[e++],!/[\d\.\-e\+]/.test(m)){e--;break}j+=m}g(parseFloat(j),q,p);break;case'"':for(v="",x=void 0,w=0;;){if(y=z[e++],'"'===y&&("\\"!==x||w%2!==1)){break}v+=y,x=y,"\\"===x?w++:w=0}g(JSON.parse('"'+v+'"'),q,p);break;case"[":k={element:[],index:q.length},q.push(k.element),p.push(k);break;case"{":h={element:{},index:q.length},q.push(h.element),p.push(h);break;default:throw new Error("unexpectedly reached end of input: "+r)}}else{if(1===q.length){return q.pop()}g(q.pop(),q,p)}}}},{}],17:[function(d,c,f){(function(df,dQ){function dJ(g){return g&&"object"==typeof g&&"default" in g?g["default"]:g}function dv(h,k){for(var j={},l=0,i=k.length;i>l;l++){var g=k[l];g in h&&(j[g]=h[g])}return j}function kh(g){return g instanceof ArrayBuffer||"undefined"!=typeof Blob&&g instanceof Blob}function j7(h){if("function"==typeof h.slice){return h.slice(0)}var j=new ArrayBuffer(h.byteLength),i=new Uint8Array(j),g=new Uint8Array(h);return i.set(g),j}function af(h){if(h instanceof ArrayBuffer){return j7(h)}var g=h.size,i=h.type;return"function"==typeof h.slice?h.slice(0,g,i):h.webkitSlice(0,g,i)}function cl(g){var j,i,k;if(!g||"object"!=typeof g){return g}if(Array.isArray(g)){for(j=[],i=0,k=g.length;k>i;i++){j[i]=cl(g[i])}return j}if(g instanceof Date){return g.toISOString()}if(kh(g)){return af(g)}j={};for(i in g){if(Object.prototype.hasOwnProperty.call(g,i)){var h=cl(g[i]);"undefined"!=typeof h&&(j[i]=h)}}return j}function dx(g){var h=!1;return ap(function(i){if(h){throw new Error("once called more than once")}h=!0,g.apply(this,i)})}function fP(g){return ap(function(j){j=cl(j);var k,l=this,i="function"==typeof j[j.length-1]?j.pop():!1;i&&(k=function(m,n){df.nextTick(function(){i(m,n)})});var h=new e7(function(p,o){var m;try{var q=dx(function(r,s){r?o(r):p(s)});j.push(q),m=g.apply(l,j),m&&"function"==typeof m.then&&p(m)}catch(n){o(n)}});return k&&h.then(function(m){k(null,m)},k),h})}function bG(h,g){function i(j,n,l){if(b4.enabled){for(var o=[j._db_name,n],k=0;k<l.length-1;k++){o.push(l[k])}b4.apply(null,o);var m=l[l.length-1];l[l.length-1]=function(r,p){var q=[j._db_name,n];q=q.concat(r?["error",r]:["success",p]),b4.apply(null,q),m(r,p)}}}return fP(ap(function(j){if(this._closed){return e7.reject(new Error("database is closed"))}if(this._destroyed){return e7.reject(new Error("database is destroyed"))}var k=this;return i(k,h,j),this.taskqueue.isReady?g.apply(this,j):new e7(function(l,m){k.taskqueue.addTask(function(n){n?m(n):l(k[h].apply(k,j))})})}))}function t(h,g,i){return new e7(function(j,k){h.get(g,function(m,o){if(m){if(404!==m.status){return k(m)}o={}}var n=o._rev,l=i(o);return l?(l._id=g,l._rev=n,void j(ed(h,l,i))):j({updated:!1,rev:n})})})}function ed(h,g,i){return h.put(g).then(function(j){return{updated:!0,rev:j.rev}},function(j){if(409!==j.status){throw j}return t(h,g._id,i)})}function ac(r){for(var p,g,q,s,i=r.rev_tree.slice();s=i.pop();){var n=s.ids,j=n[2],o=s.pos;if(j.length){for(var m=0,k=j.length;k>m;m++){i.push({pos:o+1,ids:j[m]})}}else{var h=!!n[1].deleted,l=n[0];p&&!(q!==h?q:g!==o?o>g:l>p)||(p=l,g=o,q=h)}}return g+"-"+p}function jQ(g){return g.ids}function eE(g,j){j||(j=ac(g));for(var i,k=j.substring(j.indexOf("-")+1),h=g.rev_tree.map(jQ);i=h.pop();){if(i[0]===k){return !!i[1].deleted}h=h.concat(i[2])}}function ab(g){return f5("return "+g+";",{})}function bx(g){return new Function("doc",["var emitted = false;","var emit = function (a, b) {","  emitted = true;","};","var view = "+g+";","view(doc);","if (emitted) {","  return true;","}"].join("\n"))}function cX(g){if(!g){return null}var h=g.split("/");return 2===h.length?h:1===h.length?[g,g]:null}function f4(g){var h=cX(g);return h?h.join("/"):null}function jU(h,j){for(var o,l=h.slice();o=l.pop();){for(var m=o.pos,g=o.ids,i=g[2],k=j(0===i.length,m,g[0],o.ctx,g[1]),n=0,p=i.length;p>n;n++){l.push({pos:m+1,ids:i[n],ctx:k})}}}function ka(g,h){return g.pos-h.pos}function d7(h){var j=[];jU(h,function(k,m,o,l,n){k&&j.push({rev:m+"-"+o,pos:m,opts:n})}),j.sort(ka).reverse();for(var i=0,g=j.length;g>i;i++){delete j[i].pos}return j}function eW(j){for(var m=ac(j),g=d7(j.rev_tree),i=[],k=0,l=g.length;l>k;k++){var h=g[k];h.rev===m||h.opts.deleted||i.push(h.rev)}return i}function jT(g){Error.call(this,g.reason),this.status=g.status,this.name=g.error,this.message=g.reason,this.error=!0}function f1(h,j,i){function g(k){for(var l in h){"function"!=typeof h[l]&&(this[l]=h[l])}void 0!==i&&(this.name=i),void 0!==k&&(this.reason=k)}return g.prototype=jT.prototype,new g(j)}function ba(h){var k,j,l,i,g;return j=h.error===!0&&"string"==typeof h.name?h.name:h.error,g=h.reason,l=jL("name",j,g),h.missing||"missing"===g||"deleted"===g||"not_found"===j?l=aA:"doc_validation"===j?(l=aI,i=g):"bad_request"===j&&l.message!==g&&(l=aE),l||(l=jL("status",h.status,g)||aW),k=f1(l,g,j),i&&(k.message=i),h.id&&(k.id=h.id),h.status&&(k.status=h.status),h.missing&&(k.missing=h.missing),k}function d5(j,m,g){function i(){k.cancel()}aS.EventEmitter.call(this);var k=this;this.db=j,m=m?cl(m):{};var l=m.complete=dx(function(n,o){n?k.emit("error",n):k.emit("complete",o),k.removeAllListeners(),j.removeListener("destroyed",i)});g&&(k.on("complete",function(n){g(null,n)}),k.on("error",g)),j.once("destroyed",i),m.onChange=function(n){m.isCancelled||(k.emit("change",n),k.startSeq&&k.startSeq<=n.seq&&(k.startSeq=!1))};var h=new e7(function(n,o){m.complete=function(p,q){p?o(p):n(q)}});k.once("cancel",function(){j.removeListener("destroyed",i),m.complete(null,{status:"cancelled"})}),this.then=h.then.bind(h),this["catch"]=h["catch"].bind(h),this.then(function(n){l(null,n)},l),j.taskqueue.isReady?k.doChanges(m):j.taskqueue.addTask(function(){k.isCancelled?k.emit("cancel"):k.doChanges(m)})}function eL(g,j,i){var k=[{rev:g._rev}];"all_docs"===i.style&&(k=d7(j.rev_tree).map(function(l){return{rev:l.rev}}));var h={id:j.id,changes:k,doc:g};return eE(j,g._rev)&&(h.deleted=!0),i.conflicts&&(h.doc._conflicts=eW(j),h.doc._conflicts.length||delete h.doc._conflicts),h}function eJ(g,k,p){function m(){var r=[];q.forEach(function(s){s.docs.forEach(function(u){r.push({id:s.id,docs:[u]})})}),p(null,{results:r})}function n(){++o===i&&m()}function h(r,u,s){q[r]={id:u,docs:s},n()}var l=Array.isArray(k)?k:k.docs,j={};l.forEach(function(r){r.id in j?j[r.id].push(r):j[r.id]=[r]});var i=Object.keys(j).length,o=0,q=new Array(i);Object.keys(j).forEach(function(v,s){var w=j[v],u=dv(w[0],["atts_since","attachments"]);u.open_revs=w.map(function(x){return x.rev}),u.open_revs=u.open_revs.filter(function(x){return x});var r=function(x){return x};0===u.open_revs.length&&(delete u.open_revs,r=function(x){return[{ok:x}]}),["revs","attachments","binary","ajax"].forEach(function(x){x in k&&(u[x]=k[x])}),g.get(v,u,function(y,x){h(s,v,y?[{error:y}]:r(x))})})}function f8(g){return/^_local/.test(g)}function cU(r){for(var p,g=[],q=r.slice();p=q.pop();){var s=p.pos,i=p.ids,n=i[0],j=i[1],o=i[2],m=0===o.length,k=p.history?p.history.slice():[];k.push({id:n,opts:j}),m&&g.push({pos:s+1-k.length,ids:k});for(var h=0,l=o.length;l>h;h++){q.push({pos:s+1,ids:o[h],history:k})}}return g.reverse()}function kc(g){return 0|Math.random()*g}function f9(h,j){j=j||bd.length;var i="",g=-1;if(h){for(;++g<h;){i+=bd[kc(j)]}return i}for(;++g<36;){switch(g){case 8:case 13:case 18:case 23:i+="-";break;case 19:i+=bd[3&kc(16)|8];break;default:i+=bd[kc(16)]}}return i}function ea(g){return g.reduce(function(i,h){return i[h]=!0,i},{})}function jP(g){var h;if(g?"string"!=typeof g?h=f1(j6):/^_/.test(g)&&!/^_(design|local)/.test(g)&&(h=f1(dM)):h=f1(cx),h){throw h}}function eK(h){if(!/^\d+\-./.test(h)){return f1(bw)}var j=h.indexOf("-"),i=h.substring(0,j),g=h.substring(j+1);return{prefix:parseInt(i,10),id:g}}function fM(j,m){for(var g=j.start-j.ids.length+1,i=j.ids,k=[i[0],m,[]],l=1,h=i.length;h>l;l++){k=[i[l],{status:"missing"},[k]]}return[{pos:g,ids:k}]}function dh(h,j){var o,l,m,g={status:"available"};if(h._deleted&&(g.deleted=!0),j){if(h._id||(h._id=f9()),l=f9(32,16).toLowerCase(),h._rev){if(m=eK(h._rev),m.error){return m}h._rev_tree=[{pos:m.prefix,ids:[m.id,{status:"missing"},[[l,g,[]]]]}],o=m.prefix+1}else{h._rev_tree=[{pos:1,ids:[l,g,[]]}],o=1}}else{if(h._revisions&&(h._rev_tree=fM(h._revisions,g),o=h._revisions.start,l=h._revisions.ids[0]),!h._rev_tree){if(m=eK(h._rev),m.error){return m}o=m.prefix,l=m.id,h._rev_tree=[{pos:o,ids:[l,g,[]]}]}}jP(h._id),h._rev=o+"-"+l;var i={metadata:{},data:{}};for(var k in h){if(Object.prototype.hasOwnProperty.call(h,k)){var n="_"===k[0];if(n&&!d2[k]){var p=f1(aI,k);throw p.message=aI.message+": "+k,p}n&&!eG[k]?i.metadata[k.slice(1)]=h[k]:i.data[k]=h[k]}}return i}function fL(g,h){return h>g?-1:g>h?1:0}function jF(h,g){for(var i=0;i<h.length;i++){if(g(h[i],i)===!0){return h[i]}}}function bH(g){return function(h,i){h||i[0]&&i[0].error?g(h||i[0]):g(null,i.length?i[0]:i)}}function ec(h){for(var k=0;k<h.length;k++){var j=h[k];if(j._deleted){delete j._attachments}else{if(j._attachments){for(var l=Object.keys(j._attachments),i=0;i<l.length;i++){var g=l[i];j._attachments[g]=dv(j._attachments[g],["data","digest","content_type","length","revpos","stub"])}}}}}function bN(g,j){var i=fL(g._id,j._id);if(0!==i){return i}var k=g._revisions?g._revisions.start:0,h=j._revisions?j._revisions.start:0;return fL(k,h)}function j8(h){var g={},i=[];return jU(h,function(k,j,l,n){var m=j+"-"+l;return k&&(g[m]=0),void 0!==n&&i.push({from:n,to:m}),m}),i.reverse(),i.forEach(function(j){void 0===g[j.from]?g[j.from]=1+g[j.to]:g[j.from]=Math.min(g[j.from],1+g[j.to])}),g}function bs(g,j,i){var k="limit" in j?j.keys.slice(j.skip,j.limit+j.skip):j.skip>0?j.keys.slice(j.skip):j.keys;if(j.descending&&k.reverse(),!k.length){return g._allDocs({limit:0},i)}var h={offset:j.skip};return e7.all(k.map(function(m){var l=eA.extend({key:m,deleted:"ok"},j);return["limit","skip","keys"].forEach(function(n){delete l[n]}),new e7(function(n,o){g._allDocs(l,function(q,p){return q?o(q):(h.total_rows=p.total_rows,void n(p.rows[0]||{key:m,error:"not_found"}))})})})).then(function(l){return h.rows=l,h})}function dK(h){var j=h._compactionQueue[0],g=j.opts,i=j.callback;h.get("_local/compaction")["catch"](function(){return !1}).then(function(k){k&&k.last_seq&&(g.last_seq=k.last_seq),h._compact(g,function(l,m){l?i(l):i(null,m),df.nextTick(function(){h._compactionQueue.shift(),h._compactionQueue.length&&dK(h)})})})}function j0(g){return"_"===g.charAt(0)?g+"is not a valid attachment name, attachment names cannot start with '_'":!1}function kd(g,j,i,k){j.seq=j.seq||0;var h={doc_ids:["_design/"+i],limit:1,since:j.seq};g.changes(h).then(function(l){var m=l.results&&l.results.length&&l.results[0].seq;m&&m>j.seq&&(j.seq=m,delete j.promise),k()})["catch"](k)}function aa(h,j,i){h._ddocCache=h._ddocCache||{},h._ddocCache[j]=h._ddocCache[j]||{};var g=h._ddocCache[j];kd(h,g,j,function(k){return k?i(k):(g.promise||(g.promise=new e7(function(m,l){h._get("_design/"+j,{},function(o,n){if(o){return l(o)}var p={};["views","filters"].forEach(function(q){p[q]=n.doc[q]}),m(p)})})),void g.promise.then(function(l){i(null,l)})["catch"](i))})}function bD(g,j,i,k,h){aa(g,j,function(n,m){if(n){return h(n)}var l=m[i]&&m[i][k];return l?void h(null,l):h(f1(aA))})}function ek(){aS.EventEmitter.call(this)}function cd(){this.isReady=!1,this.failed=!1,this.queue=[]}function fN(g){g&&dQ.debug&&console.error(g)}function aN(j,m){function g(){l.emit("destroyed",k)}function i(){j.removeListener("destroyed",g),j.emit("destroyed",j)}var k=m.originalName,l=j.constructor,h=l._destructionListeners;j.once("destroyed",g),h.has(k)||h.set(k,[]),h.get(k).push(i)}function bL(h,k,j){if(!(this instanceof bL)){return new bL(h,k,j)}var l=this;"function"!=typeof k&&"undefined"!=typeof k||(j=k,k={}),h&&"object"==typeof h&&(k=h,h=void 0),"undefined"==typeof j&&(j=fN),h=h||k.name,k=cl(k),delete k.name,this.__opts=k;var i=j;l.auto_compaction=k.auto_compaction,l.prefix=bL.prefix,ek.call(l),l.taskqueue=new cd;var g=new e7(function(p,n){j=function(r,s){return r?n(r):(delete s.then,void p(s))},k=cl(k);var q,o,m=k.name||h;return function(){try{if("string"!=typeof m){throw o=new Error("Missing/invalid DB name"),o.code=400,o}if(q=bL.parseAdapter(m,k),k.originalName=m,k.name=q.name,k.prefix&&"http"!==q.adapter&&"https"!==q.adapter&&(k.name=k.prefix+k.name),k.adapter=k.adapter||q.adapter,l._adapter=k.adapter,aG("pouchdb:adapter")("Picked adapter: "+k.adapter),l._db_name=m,!bL.adapters[k.adapter]){throw o=new Error("Adapter is missing"),o.code=404,o}if(!bL.adapters[k.adapter].valid()){throw o=new Error("Invalid Adapter"),o.code=404,o}}catch(r){l.taskqueue.fail(r)}}(),o?n(o):(l.adapter=k.adapter,l.replicate={},l.replicate.from=function(r,u,s){return l.constructor.replicate(r,l,u,s)},l.replicate.to=function(r,u,s){return l.constructor.replicate(l,r,u,s)},l.sync=function(r,u,s){return l.constructor.sync(l,r,u,s)},l.replicate.sync=l.sync,void bL.adapters[k.adapter].call(l,k,function(r){return r?(l.taskqueue.fail(r),void j(r)):(aN(l,k),l.emit("created",l),bL.emit("created",k.originalName),l.taskqueue.ready(l),void j(null,l))}))});g.then(function(m){i(null,m)},i),l.then=g.then.bind(g),l["catch"]=g["catch"].bind(g)}function dz(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function fO(){return d3}function f2(g){Object.keys(aS.EventEmitter.prototype).forEach(function(i){"function"==typeof aS.EventEmitter.prototype[i]&&(g[i]=kg[i].bind(kg))});var h=g._destructionListeners=new dS.Map;g.on("destroyed",function(i){h.has(i)&&(h.get(i).forEach(function(j){j()}),h["delete"](i))})}function cM(h,k){h=h||[],k=k||{};try{return new Blob(h,k)}catch(j){if("TypeError"!==j.name){throw j}for(var l="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,i=new l,g=0;g<h.length;g+=1){i.append(h[g])}return i.getBlob(k.type)}}function dG(h,g){if("undefined"==typeof FileReader){return g((new FileReaderSync).readAsArrayBuffer(h))}var i=new FileReader;i.onloadend=function(j){var k=j.target.result||new ArrayBuffer(0);g(k)},i.readAsArrayBuffer(h)}function e6(){for(var h={},j=new e7(function(k,l){h.resolve=k,h.reject=l}),i=new Array(arguments.length),g=0;g<i.length;g++){i[g]=arguments[g]}return h.promise=j,e7.resolve().then(function(){return fetch.apply(null,i)}).then(function(k){h.resolve(k)})["catch"](function(k){h.reject(k)}),h}function dA(j,m){var g,i,k,l=new Headers,h={method:j.method,credentials:"include",headers:l};return j.json&&(l.set("Accept","application/json"),l.set("Content-Type",j.headers["Content-Type"]||"application/json")),j.body&&j.body instanceof Blob?dG(j.body,function(n){h.body=n}):j.body&&j.processData&&"string"!=typeof j.body?h.body=JSON.stringify(j.body):"body" in j?h.body=j.body:h.body=null,Object.keys(j.headers).forEach(function(n){j.headers.hasOwnProperty(n)&&l.set(n,j.headers[n])}),g=e6(j.url,h),j.timeout>0&&(i=setTimeout(function(){g.reject(new Error("Load timeout for resource: "+j.url))},j.timeout)),g.promise.then(function(n){return k={statusCode:n.status},j.timeout>0&&clearTimeout(i),k.statusCode>=200&&k.statusCode<300?j.binary?n.blob():n.text():n.json()}).then(function(n){k.statusCode>=200&&k.statusCode<300?m(null,k,n):m(n,k)})["catch"](function(n){m(n,k)}),{abort:g.reject}}function aM(n,h){var m,k,l=!1,o=function(){m.abort()},g=function(){l=!0,m.abort()};m=n.xhr?new n.xhr:new XMLHttpRequest;try{m.open(n.method,n.url)}catch(j){h(j,{statusCode:413})}m.withCredentials="withCredentials" in n?n.withCredentials:!0,"GET"===n.method?delete n.headers["Content-Type"]:n.json&&(n.headers.Accept="application/json",n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.body&&n.processData&&"string"!=typeof n.body&&(n.body=JSON.stringify(n.body))),n.binary&&(m.responseType="arraybuffer"),"body" in n||(n.body=null);for(var i in n.headers){n.headers.hasOwnProperty(i)&&m.setRequestHeader(i,n.headers[i])}return n.timeout>0&&(k=setTimeout(g,n.timeout),m.onprogress=function(){clearTimeout(k),4!==m.readyState&&(k=setTimeout(g,n.timeout))},"undefined"!=typeof m.upload&&(m.upload.onprogress=m.onprogress)),m.onreadystatechange=function(){if(4===m.readyState){var s={statusCode:m.status};if(m.status>=200&&m.status<300){var q;q=n.binary?cM([m.response||""],{type:m.getResponseHeader("Content-Type")}):m.responseText,h(null,s,q)}else{var p={};if(l){p=new Error("ETIMEDOUT"),s.statusCode=400}else{try{p=JSON.parse(m.response)}catch(r){}}h(p,s)}}},n.body&&n.body instanceof Blob?dG(n.body,function(p){m.send(p)}):m.send(n.body),{abort:o}}function aT(){try{return new XMLHttpRequest,!0}catch(g){return !1}}function fG(g,h){return c8||g.xhr?aM(g,h):dA(g,h)}function cY(){return""}function cq(g,j){function i(o,n,l){if(!g.binary&&g.json&&"string"==typeof o){try{o=JSON.parse(o)}catch(m){return l(m)}}Array.isArray(o)&&(o=o.map(function(p){return p.error||p.missing?ba(p):p})),g.binary&&fD(o,n),l(null,o,n)}function k(l,p){var n,q;if(l.code&&l.status){var m=new Error(l.message||l.code);return m.status=l.status,p(m)}if(l.message&&"ETIMEDOUT"===l.message){return p(l)}try{n=JSON.parse(l.responseText),q=ba(n)}catch(o){q=ba(l)}p(q)}g=cl(g);var h={method:"GET",headers:{},json:!0,processData:!0,timeout:10000,cache:!1};return g=eA.extend(h,g),g.json&&(g.binary||(g.headers.Accept="application/json"),g.headers["Content-Type"]=g.headers["Content-Type"]||"application/json"),g.binary&&(g.encoding=null,g.json=!1),g.processData||(g.json=!1),fG(g,function(m,q,o){if(m){return m.status=q?q.statusCode:400,k(m,j)}var r,p=q.headers&&q.headers["content-type"],n=o||cY();if(!g.binary&&(g.json||!g.processData)&&"object"!=typeof n&&(/json/.test(p)||/^[\s]*\{/.test(n)&&/\}[\s]*$/.test(n))){try{n=JSON.parse(n.toString())}catch(l){}}q.statusCode>=200&&q.statusCode<300?i(n,q,j):(r=ba(n),r.status=q.statusCode,j(r))})}function ke(h,j){var o=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",l=-1!==o.indexOf("safari")&&-1===o.indexOf("chrome"),m=-1!==o.indexOf("msie"),g=-1!==o.indexOf("edge"),i=l||(m||g)&&"GET"===h.method,k="cache" in h?h.cache:!0,n=/^blob:/.test(h.url);if(!n&&(i||!k)){var p=-1!==h.url.indexOf("?");h.url+=(p?"&":"?")+"_nonce="+Date.now()}return cq(h,j)}function bp(j){for(var m=cy.exec(j),g={},i=14;i--;){var k=bk[i],l=m[i]||"",h=-1!==["user","password"].indexOf(k);g[k]=h?decodeURIComponent(l):l}return g[dH]={},g[bk[12]].replace(au,function(o,p,n){p&&(g[dH][p]=n)}),g}function cH(g){for(var j=g.length,i=new ArrayBuffer(j),k=new Uint8Array(i),h=0;j>h;h++){k[h]=g.charCodeAt(h)}return i}function bX(g,h){return cM([cH(g)],{type:h})}function fI(g,j,i){try{return !g(j,i)}catch(k){var h="Filter function threw: "+k.toString();return f1(aE,h)}}function eF(h){var g={},i=h.filter&&"function"==typeof h.filter;return g.query=h.query_params,function(k){k.doc||(k.doc={});var l=i&&fI(h.filter,k.doc,g);if("object"==typeof l){return l}if(l){return !1}if(h.include_docs){if(!h.attachments){for(var j in k.doc._attachments){k.doc._attachments.hasOwnProperty(j)&&(k.doc._attachments[j].stub=!0)}}}else{delete k.doc}return !0}}function aB(g,h){"console" in dQ&&"info" in console&&console.info("The above "+g+" is totally normal. "+h)}function bK(g,j,i,k,h){return g.get(j)["catch"](function(l){if(404===l.status){return"http"===g.type()&&aB(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:k,_id:j,history:[],replicator:aQ,version:d4}}throw l}).then(function(l){return h.cancelled?void 0:(l.history=(l.history||[]).filter(function(m){return m.session_id!==k}),l.history.unshift({last_seq:i,session_id:k}),l.history=l.history.slice(0,c6),l.version=d4,l.replicator=aQ,l.session_id=k,l.last_seq=i,g.put(l)["catch"](function(m){if(409===m.status){return bK(g,j,i,k,h)}throw m}))})}function al(h,j,i,g){this.src=h,this.target=j,this.id=i,this.returnValue=g}function d9(h,j){if(h.session_id===j.session_id){return{last_seq:h.last_seq,history:h.history||[]}}var i=h.history||[],g=j.history||[];return aF(i,g)}function aF(n,g){var k=n[0],h=n.slice(1),i=g[0],j=g.slice(1);if(!k||0===g.length){return{last_seq:a9,history:[]}}var m=k.session_id;if(jH(m,g)){return{last_seq:k.last_seq,history:n}}var l=i.session_id;return jH(l,h)?{last_seq:i.last_seq,history:j}:aF(h,j)}function jH(h,j){var i=j[0],g=j.slice(1);return h&&0!==j.length?h===i.session_id?!0:jH(h,g):!1}function aU(g){return"number"==typeof g.status&&4===Math.floor(g.status/100)}function d0(h,j){h=parseInt(h,10)||0,j=parseInt(j,10),j!==j||h>=j?j=(h||1)<<1:j+=1;var i=Math.random(),g=j-h;return ~~(g*i+h)}function fF(g){var h=0;return g||(h=2000),d0(g,h)}function cg(h,j,i,g){return h.retry===!1?(j.emit("error",i),void j.removeAllListeners()):("function"!=typeof h.back_off_function&&(h.back_off_function=fF),j.emit("requestError",i),"active"!==j.state&&"pending"!==j.state||(j.emit("paused",i),j.state="stopped",j.once("active",function(){h.current_back_off=bc})),h.current_back_off=h.current_back_off||bc,h.current_back_off=h.back_off_function(h.current_back_off),void setTimeout(g,h.current_back_off))}function ag(g){return jY(g)}function cp(h,j,i,g){(i>0||g<j.byteLength)&&(j=new Uint8Array(j,i,Math.min(g,j.byteLength)-i)),h.append(j)}function av(h,j,i,g){(i>0||g<j.length)&&(j=j.substring(i,g)),h.appendBinary(j)}function c3(g){return Object.keys(g).sort(b0.collate).reduce(function(h,i){return h[i]=g[i],h},{})}function cj(j,m,g){var i=g.doc_ids?g.doc_ids.sort(b0.collate):"",k=g.filter?g.filter.toString():"",l="",h="";return g.filter&&g.query_params&&(l=JSON.stringify(c3(g.query_params))),g.filter&&"_view"===g.filter&&(h=g.view.toString()),e7.all([j.id(),m.id()]).then(function(o){var n=o[0]+o[1]+k+h+l+i;return jS(n)}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function ah(g){return/^1-/.test(g)}function cD(g){var h=[];return Object.keys(g).forEach(function(j){var i=g[j].missing;i.forEach(function(k){h.push({id:j,rev:k})})}),{docs:h,revs:!0,attachments:!0,binary:!0}}function aw(g,j,o){function l(){var q=cD(j);if(q.docs.length){return g.bulkGet(q).then(function(r){if(o.cancelled){throw new Error("cancelled")}r.results.forEach(function(s){s.docs.forEach(function(u){u.ok?h.push(u.ok):void 0!==u.error&&(n=!1)})})})}}function m(q){return q._attachments&&Object.keys(q._attachments).length>0}function p(q){return g.allDocs({keys:q,include_docs:!0}).then(function(r){if(o.cancelled){throw new Error("cancelled")}r.rows.forEach(function(s){!s.deleted&&s.doc&&ah(s.value.rev)&&!m(s.doc)&&(h.push(s.doc),delete j[s.id])})})}function i(){var q=Object.keys(j).filter(function(r){var s=j[r].missing;return 1===s.length&&ah(s[0])});return q.length>0?p(q):void 0}function k(){return{ok:n,docs:h}}j=cl(j);var h=[],n=!0;return e7.resolve().then(i).then(l).then(k)}function cw(l,u,H,C,G){function N(){return Q?e7.resolve():cj(l,u,H).then(function(T){x=T,Q=new al(l,u,x,C)})}function B(){if(z=[],0!==j.docs.length){var T=j.docs;return u.bulkDocs({docs:T,new_edits:!1}).then(function(V){if(C.cancelled){throw F(),new Error("cancelled")}var X=[],U={};V.forEach(function(Z){Z.error&&(G.doc_write_failures++,X.push(Z),U[Z.id]=Z)}),k=k.concat(X),G.docs_written+=j.docs.length-X.length;var Y=X.filter(function(Z){return"unauthorized"!==Z.name&&"forbidden"!==Z.name});if(T.forEach(function(Z){var ae=U[Z._id];ae?C.emit("denied",cl(ae)):z.push(Z)}),Y.length>0){var W=new Error("bulkDocs error");throw W.other_errors=X,O("target.bulkDocs failed to write docs",W),new Error("bulkWrite partial failure")}},function(U){throw G.doc_write_failures+=T.length,U})}}function v(){if(j.error){throw new Error("There was a problem getting docs.")}G.last_seq=i=j.seq;var T=cl(G);return z.length&&(T.docs=z,C.emit("change",T)),R=!0,Q.writeCheckpoint(j.seq,m).then(function(){if(R=!1,C.cancelled){throw F(),new Error("cancelled")}j=void 0,J()})["catch"](function(U){throw R=!1,O("writeCheckpoint completed with error",U),U})}function o(){var T={};return j.changes.forEach(function(U){"_user/"!==U.id&&(T[U.id]=U.changes.map(function(V){return V.rev}))}),u.revsDiff(T).then(function(U){if(C.cancelled){throw F(),new Error("cancelled")}j.diffs=U})}function g(){return aw(l,j.diffs,C).then(function(T){j.error=!T.ok,T.docs.forEach(function(U){delete j.diffs[U._id],G.docs_read++,j.docs.push(U)})})}function K(){if(!C.cancelled&&!j){if(0===L.length){return void p(!0)}j=L.shift(),o().then(g).then(B).then(v).then(K)["catch"](function(T){O("batch processing terminated with error",T)})}}function p(T){return 0===E.changes.length?void (0!==L.length||j||((M&&w.live||A)&&(C.state="pending",C.emit("paused")),A&&F())):void ((T||A||E.changes.length>=y)&&(L.push(E),E={seq:0,changes:[],docs:[]},"pending"!==C.state&&"stopped"!==C.state||(C.state="active",C.emit("active")),K()))}function O(T,U){I||(U.message||(U.message=T),G.ok=!1,G.status="aborting",G.errors.push(U),k=k.concat(U),L=[],E={seq:0,changes:[],docs:[]},F())}function F(){if(!(I||C.cancelled&&(G.status="cancelled",R))){G.status=G.status||"complete",G.end_time=new Date,G.last_seq=i,I=!0;var T=k.filter(function(V){return"unauthorized"!==V.name&&"forbidden"!==V.name});if(T.length>0){var U=k.pop();k.length>0&&(U.other_errors=k),U.result=G,cg(H,C,U,function(){cw(l,u,H,C)})}else{G.errors=k,C.emit("complete",G),C.removeAllListeners()}}}function n(T){if(C.cancelled){return F()}var U=eF(H)(T);U&&(E.seq=T.seq,E.changes.push(T),p(w.live))}function S(T){return q=!1,C.cancelled?F():(T.results.length>0?(w.since=T.last_seq,J()):M?(w.live=!0,J()):A=!0,void p(!0))}function D(T){return q=!1,C.cancelled?F():void O("changes rejected",T)}function J(){function U(){T.cancel()}function V(){C.removeListener("cancel",U)}if(!q&&!A&&L.length<r){q=!0,C._changes&&(C.removeListener("cancel",C._abortChanges),C._changes.cancel()),C.once("cancel",U);var T=l.changes(w).on("change",n);T.then(V,V),T.then(S)["catch"](D),H.retry&&(C._changes=T,C._abortChanges=U)}}function P(){N().then(function(){return C.cancelled?void F():Q.getCheckpoint().then(function(T){i=T,w={since:i,limit:y,batch_size:y,style:"all_docs",doc_ids:h,return_docs:!0},H.filter&&("string"!=typeof H.filter?w.include_docs=!0:w.filter=H.filter),"heartbeat" in H&&(w.heartbeat=H.heartbeat),"timeout" in H&&(w.timeout=H.timeout),H.query_params&&(w.query_params=H.query_params),H.view&&(w.view=H.view),J()})})["catch"](function(T){O("getCheckpoint rejected with ",T)})}function s(T){throw R=!1,O("writeCheckpoint completed with error",T),T}var j,x,Q,L=[],E={seq:0,changes:[],docs:[]},R=!1,A=!1,I=!1,i=0,M=H.continuous||H.live||!1,y=H.batch_size||100,r=H.batches_limit||10,q=!1,h=H.doc_ids,k=[],z=[],m=f9();G=G||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var w={};return C.ready(l,u),C.cancelled?void F():(C._addedListeners||(C.once("cancel",F),"function"==typeof H.complete&&(C.once("error",H.complete),C.once("complete",function(T){H.complete(null,T)})),C._addedListeners=!0),void ("undefined"==typeof H.since?P():N().then(function(){return R=!0,Q.writeCheckpoint(H.since,m)}).then(function(){return R=!1,C.cancelled?void F():(i=H.since,void P())})["catch"](s)))}function eb(){aS.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var g=this,h=new e7(function(i,j){g.once("complete",i),g.once("error",j)});g.then=function(i,j){return h.then(i,j)},g["catch"]=function(i){return h["catch"](i)},g["catch"](function(){})}function kf(h,g){var i=g.PouchConstructor;return"string"==typeof h?new i(h,g):h}function eS(j,m,g,i){if("function"==typeof g&&(i=g,g={}),"undefined"==typeof g&&(g={}),g.doc_ids&&!Array.isArray(g.doc_ids)){throw f1(aE,"`doc_ids` filter parameter is not a list.")}g.complete=i,g=cl(g),g.continuous=g.continuous||g.live,g.retry="retry" in g?g.retry:!1,g.PouchConstructor=g.PouchConstructor||this;var k=new eb(g),l=kf(j,g),h=kf(m,g);return cw(l,h,g,k),k}function ds(h,j,i,g){return"function"==typeof i&&(g=i,i={}),"undefined"==typeof i&&(i={}),i=cl(i),i.PouchConstructor=i.PouchConstructor||this,h=dq.toPouch(h,i),j=dq.toPouch(j,i),new bj(h,j,i,g)}function bj(u,m,n,w){function l(z){r.emit("change",{direction:"pull",change:z})}function q(z){r.emit("change",{direction:"push",change:z})}function k(z){r.emit("denied",{direction:"push",doc:z})}function o(z){r.emit("denied",{direction:"pull",doc:z})}function i(){r.pushPaused=!0,r.pullPaused&&r.emit("paused")}function x(){r.pullPaused=!0,r.pushPaused&&r.emit("paused")}function s(){r.pushPaused=!1,r.pullPaused&&r.emit("active",{direction:"push"})}function p(){r.pullPaused=!1,r.pushPaused&&r.emit("active",{direction:"pull"})}function v(z){return function(D,B){var C="change"===D&&(B===l||B===q),F="denied"===D&&(B===o||B===k),A="paused"===D&&(B===x||B===i),E="active"===D&&(B===p||B===s);(C||F||A||E)&&(D in g||(g[D]={}),g[D][z]=!0,2===Object.keys(g[D]).length&&r.removeAllListeners(D))}}var r=this;this.canceled=!1;var y=n.push?eA.extend({},n,n.push):n,h=n.pull?eA.extend({},n,n.pull):n;this.push=eY(u,m,y),this.pull=eY(m,u,h),this.pushPaused=!0,this.pullPaused=!0;var g={};n.live&&(this.push.on("complete",r.pull.cancel.bind(r.pull)),this.pull.on("complete",r.push.cancel.bind(r.push))),this.on("newListener",function(z){"change"===z?(r.pull.on("change",l),r.push.on("change",q)):"denied"===z?(r.pull.on("denied",o),r.push.on("denied",k)):"active"===z?(r.pull.on("active",p),r.push.on("active",s)):"paused"===z&&(r.pull.on("paused",x),r.push.on("paused",i))}),this.on("removeListener",function(z){"change"===z?(r.pull.removeListener("change",l),r.push.removeListener("change",q)):"denied"===z?(r.pull.removeListener("denied",o),r.push.removeListener("denied",k)):"active"===z?(r.pull.removeListener("active",p),r.push.removeListener("active",s)):"paused"===z&&(r.pull.removeListener("paused",x),r.push.removeListener("paused",i))}),this.pull.on("removeListener",v("pull")),this.push.on("removeListener",v("push"));var j=e7.all([this.push,this.pull]).then(function(A){var z={push:A[0],pull:A[1]};return r.emit("complete",z),w&&w(null,z),r.removeAllListeners(),z},function(z){if(r.cancel(),w?w(z):r.emit("error",z),r.removeAllListeners(),w){throw z}});this.then=function(A,z){return j.then(A,z)},this["catch"]=function(z){return j["catch"](z)}}function bP(g,h){return bX(dZ(g),h)}function jE(g){for(var j="",i=new Uint8Array(g),k=i.byteLength,h=0;k>h;h++){j+=String.fromCharCode(i[h])}return j}function aq(h,j){if("undefined"==typeof FileReader){return j(jE((new FileReaderSync).readAsArrayBuffer(h)))}var i=new FileReader,g="function"==typeof i.readAsBinaryString;i.onloadend=function(k){var l=k.target.result||"";return g?j(l):void j(jE(l))},g?i.readAsBinaryString(h):i.readAsArrayBuffer(h)}function e9(g){return new e7(function(h){aq(g,function(i){h(jY(i))})})}function db(h){for(var j=[],i=0,g=h.length;g>i;i++){j=j.concat(h[i])}return j}function bR(g){var h=g.doc&&g.doc._attachments;h&&Object.keys(h).forEach(function(i){var j=h[i];j.data=bP(j.data,j.content_type)})}function bh(g){return/^_design/.test(g)?"_design/"+encodeURIComponent(g.slice(8)):/^_local/.test(g)?"_local/"+encodeURIComponent(g.slice(7)):encodeURIComponent(g)}function e5(g){return g._attachments&&Object.keys(g._attachments)?e7.all(Object.keys(g._attachments).map(function(h){var i=g._attachments[h];return i.data&&"string"!=typeof i.data?e9(i.data).then(function(j){i.data=j}):void 0})):e7.resolve()}function dV(h){var g=bp(h);(g.user||g.password)&&(g.auth={username:g.user,password:g.password});var i=g.path.replace(/(^\/|\/$)/g,"").split("/");return g.db=i.pop(),-1===g.db.indexOf("%")&&(g.db=encodeURIComponent(g.db)),g.path=i.join("/"),g}function ki(g,h){return jJ(g,g.db+"/"+h)}function jJ(h,g){var i=h.path?"/":"";return h.protocol+"://"+h.host+(h.port?":"+h.port:"")+"/"+h.path+i+g}function am(g){return"?"+Object.keys(g).map(function(h){return h+"="+encodeURIComponent(g[h])}).join("&")}function b7(m,v){function j(A,y,B){var z=A.ajax||{},x=eA.extend(cl(k),z,y);return bM(x.method+" "+x.url),bS.ajax(x,B)}function i(y,x){return new e7(function(A,z){j(y,x,function(C,B){return C?z(C):void A(B)})})}function l(y,x){return bG(y,ap(function(z){p().then(function(){return x.apply(this,z)})["catch"](function(B){var A=z.pop();A(B)})}))}function p(){if(m.skipSetup||m.skip_setup){return e7.resolve()}if(q){return q}var x={method:"GET",url:u};return q=i({},x)["catch"](function(y){return y&&y.status&&404===y.status?(aB(404,"PouchDB is just detecting if the remote exists."),i({},{method:"PUT",url:u})):e7.reject(y)})["catch"](function(y){return y&&y.status&&412===y.status?!0:e7.reject(y)}),q["catch"](function(){q=null}),q}function w(x){return x.split("/").map(encodeURIComponent).join("/")}var s=this,h=dV;m.getHost&&(h=m.getHost);var g=h(m.name,m),u=ki(g,"");m=cl(m);var k=m.ajax||{};if(s.getUrl=function(){return u},s.getHeaders=function(){return k.headers||{}},m.auth||g.auth){var r=m.auth||g.auth,o=r.username+":"+r.password,n=jY(unescape(encodeURIComponent(o)));k.headers=k.headers||{},k.headers.Authorization="Basic "+n}var q;setTimeout(function(){v(null,s)}),s.type=function(){return"http"},s.id=l("id",function(x){j({},{method:"GET",url:jJ(g,"")},function(z,y){var A=y&&y.uuid?y.uuid+g.db:ki(g,"");x(null,A)})}),s.request=l("request",function(y,x){y.url=ki(g,y.url),j({},y,x)}),s.compact=l("compact",function(y,x){"function"==typeof y&&(x=y,y={}),y=cl(y),j(y,{url:ki(g,"_compact"),method:"POST"},function(){function z(){s.info(function(B,A){A&&!A.compact_running?x(null,{ok:!0}):setTimeout(z,y.interval||200)})}z()})}),s.bulkGet=bG("bulkGet",function(C,B){function y(E){var F={};C.revs&&(F.revs=!0),C.attachments&&(F.attachments=!0),j({},{url:ki(g,"_bulk_get"+am(F)),method:"POST",body:{docs:C.docs}},E)}function A(){function H(L){return function(N,M){I[L]=M.results,++J===F&&B(null,{results:db(I)})}}for(var K=cm,F=Math.ceil(C.docs.length/K),J=0,I=new Array(F),G=0;F>G;G++){var E=dv(C,["revs","attachments"]);E.ajax=k,E.docs=C.docs.slice(G*K,Math.min(C.docs.length,(G+1)*K)),eJ(z,E,H(G))}}var z=this,D=jJ(g,""),x=aC[D];"boolean"!=typeof x?y(function(F,G){if(F){var E=Math.floor(F.status/100);4===E||5===E?(aC[D]=!1,aB(F.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),A()):B(F)}else{aC[D]=!0,B(null,G)}}):x?y(B):A()}),s._info=function(x){p().then(function(){j({},{method:"GET",url:ki(g,"")},function(y,z){return y?x(y):(z.host=ki(g,""),void x(null,z))})})["catch"](x)},s.get=l("get",function(C,y,A){function B(F){var G=F._attachments,E=G&&Object.keys(G);return G&&E.length?e7.all(E.map(function(J){var I=G[J],H=bh(F._id)+"/"+w(J)+"?rev="+F._rev;return i(y,{method:"GET",url:ki(g,H),binary:!0}).then(function(K){return y.binary?K:e9(K)}).then(function(K){delete I.stub,delete I.length,I.data=K})})):void 0}function D(E){return Array.isArray(E)?e7.all(E.map(function(F){return F.ok?B(F.ok):void 0})):B(E)}"function"==typeof y&&(A=y,y={}),y=cl(y);var z={};y.revs&&(z.revs=!0),y.revs_info&&(z.revs_info=!0),y.open_revs&&("all"!==y.open_revs&&(y.open_revs=JSON.stringify(y.open_revs)),z.open_revs=y.open_revs),y.rev&&(z.rev=y.rev),y.conflicts&&(z.conflicts=y.conflicts),C=bh(C);var x={method:"GET",url:ki(g,C+am(z))};i(y,x).then(function(E){return e7.resolve().then(function(){return y.attachments?D(E):void 0}).then(function(){A(null,E)})})["catch"](A)}),s.remove=l("remove",function(x,B,z,A){var y;"string"==typeof B?(y={_id:x,_rev:B},"function"==typeof z&&(A=z,z={})):(y=x,"function"==typeof B?(A=B,z={}):(A=z,z=B));var C=y._rev||z.rev;j(z,{method:"DELETE",url:ki(g,bh(y._id))+"?rev="+C},A)}),s.getAttachment=l("getAttachment",function(x,B,z,A){"function"==typeof z&&(A=z,z={});var y=z.rev?"?rev="+z.rev:"",C=ki(g,bh(x))+"/"+w(B)+y;j(z,{method:"GET",url:C,binary:!0},A)}),s.removeAttachment=l("removeAttachment",function(A,z,y,x){var B=ki(g,bh(A)+"/"+w(z))+"?rev="+y;j({},{method:"DELETE",url:B},x)}),s.putAttachment=l("putAttachment",function(B,G,H,x,y,D){"function"==typeof y&&(D=y,y=x,x=H,H=null);var E=bh(B)+"/"+w(G),C=ki(g,E);if(H&&(C+="?rev="+H),"string"==typeof x){var A;try{A=dZ(x)}catch(F){return D(f1(d6,"Attachment is not a valid base64 string"))}x=A?bX(A,y):""}var z={headers:{"Content-Type":y},method:"PUT",url:C,processData:!1,body:x,timeout:k.timeout||60000};j({},z,D)}),s._bulkDocs=function(x,y,z){x.new_edits=y.new_edits,p().then(function(){return e7.all(x.docs.map(e5))}).then(function(){j(y,{method:"POST",url:ki(g,"_bulk_docs"),body:x},function(A,B){return A?z(A):(B.forEach(function(C){C.ok=!0}),void z(null,B))})})["catch"](z)},s.allDocs=l("allDocs",function(C,B){"function"==typeof C&&(B=C,C={}),C=cl(C);var y,A={},D="GET";C.conflicts&&(A.conflicts=!0),C.descending&&(A.descending=!0),C.include_docs&&(A.include_docs=!0),C.attachments&&(A.attachments=!0),C.key&&(A.key=JSON.stringify(C.key)),C.start_key&&(C.startkey=C.start_key),C.startkey&&(A.startkey=JSON.stringify(C.startkey)),C.end_key&&(C.endkey=C.end_key),C.endkey&&(A.endkey=JSON.stringify(C.endkey)),"undefined"!=typeof C.inclusive_end&&(A.inclusive_end=!!C.inclusive_end),"undefined"!=typeof C.limit&&(A.limit=C.limit),"undefined"!=typeof C.skip&&(A.skip=C.skip);var x=am(A);if("undefined"!=typeof C.keys){var z="keys="+encodeURIComponent(JSON.stringify(C.keys));z.length+x.length+1<=aZ?x+="&"+z:(D="POST",y={keys:C.keys})}i(C,{method:D,url:ki(g,"_all_docs"+x),body:y}).then(function(E){C.include_docs&&C.attachments&&C.binary&&E.rows.forEach(bR),B(null,E)})["catch"](B)}),s._changes=function(F){var y="batch_size" in F?F.batch_size:eV;F=cl(F),F.timeout="timeout" in F?F.timeout:"timeout" in k?k.timeout:30000;var B,z=F.timeout?{timeout:F.timeout-5000}:{},x="undefined"!=typeof F.limit?F.limit:!1;B="return_docs" in F?F.return_docs:"returnDocs" in F?F.returnDocs:!0;var A=x;if(F.style&&(z.style=F.style),(F.include_docs||F.filter&&"function"==typeof F.filter)&&(z.include_docs=!0),F.attachments&&(z.attachments=!0),F.continuous&&(z.feed="longpoll"),F.conflicts&&(z.conflicts=!0),F.descending&&(z.descending=!0),"heartbeat" in F?F.heartbeat&&(z.heartbeat=F.heartbeat):z.heartbeat=10000,F.filter&&"string"==typeof F.filter&&(z.filter=F.filter,"_view"===F.filter&&F.view&&"string"==typeof F.view&&(z.view=F.view)),F.query_params&&"object"==typeof F.query_params){for(var L in F.query_params){F.query_params.hasOwnProperty(L)&&(z[L]=F.query_params[L])}}var H,J="GET";if(F.doc_ids){z.filter="_doc_ids";var K=JSON.stringify(F.doc_ids);K.length<aZ?z.doc_ids=K:(J="POST",H={doc_ids:F.doc_ids})}var I,G,D=function(O,N){if(!F.aborted){z.since=O,"object"==typeof z.since&&(z.since=JSON.stringify(z.since)),F.descending?x&&(z.limit=A):z.limit=!x||A>y?y:A;var M={method:J,url:ki(g,"_changes"+am(z)),timeout:F.timeout,body:H};G=O,F.aborted||p().then(function(){I=j(F,M,N)})["catch"](N)}},E={results:[]},C=function(P,M){if(!F.aborted){var N=0;if(M&&M.results){N=M.results.length,E.last_seq=M.last_seq;var Q={};Q.query=F.query_params,M.results=M.results.filter(function(R){A--;var S=eF(F)(R);return S&&(F.include_docs&&F.attachments&&F.binary&&bR(R),B&&E.results.push(R),F.onChange(R)),S})}else{if(P){return F.aborted=!0,void F.complete(P)}}M&&M.last_seq&&(G=M.last_seq);var O=x&&0>=A||M&&y>N||F.descending;(!F.continuous||x&&0>=A)&&O?F.complete(null,E):setTimeout(function(){D(G,C)},0)}};return D(F.since||0,C),{cancel:function(){F.aborted=!0,I&&I.abort()}}},s.revsDiff=l("revsDiff",function(x,y,z){"function"==typeof y&&(z=y,y={}),j(y,{method:"POST",url:ki(g,"_revs_diff"),body:x},z)}),s._close=function(x){x()},s._destroy=function(x,y){j(x,{url:ki(g,""),method:"DELETE"},function(A,z){return A&&A.status&&404!==A.status?y(A):(s.emit("destroyed"),s.constructor.emit("destroyed",m.name),void y(null,z))})}}function fE(){this.promise=new e7(function(g){g()})}function bT(g){return b6.hash(g)}function c5(n){var g=n.db,k=n.viewName,h=n.map,i=n.reduce,j=n.temporary,m=h.toString()+(i&&i.toString())+"undefined";if(!j&&g._cachedViews){var l=g._cachedViews[m];if(l){return e7.resolve(l)}}return g.info().then(function(p){function o(u){u.views=u.views||{};var r=k;-1===r.indexOf("/")&&(r=k+"/"+k);var s=u.views[r]=u.views[r]||{};if(!s[q]){return s[q]=!0,u}}var q=p.db_name+"-mrview-"+(j?"temp":bT(m));return t(g,"_local/mrviews",o).then(function(){return g.registerDependentDatabase(q).then(function(s){var u=s.db;u.auto_compaction=!0;var r={name:q,db:u,sourceDB:g,adapter:g.adapter,mapFun:h,reduceFun:i};return r.db.get("_local/lastSeq")["catch"](function(v){if(404!==v.status){throw v}}).then(function(v){return r.seq=v?v.seq:0,j||(g._cachedViews=g._cachedViews||{},g._cachedViews[m]=r,r.db.once("destroyed",function(){delete g._cachedViews[m]})),r})})})})}function b2(h,k,j,l,i,g){return f5("return ("+h.replace(/;\s*$/,"")+");",{emit:k,sum:j,log:l,isArray:i,toJSON:g})}function kk(g){return -1===g.indexOf("/")?[g,g]:g.split("/")}function jZ(g){return 1===g.length&&/^1-/.test(g[0].rev)}function dD(h,g){try{h.emit("error",g)}catch(i){console.error("The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),console.error(g)}}function jG(h,j,i){try{return{output:j.apply(null,i)}}catch(g){return dD(h,g),{error:g}}}function fR(h,g){var i=cJ(h.key,g.key);return 0!==i?i:cJ(h.value,g.value)}function ay(h,g,i){return i=i||0,"number"==typeof g?h.slice(i,g+i):i>0?h.slice(i):h}function aL(h){var g=h.value,i=g&&"object"==typeof g&&g._id||h.id;return i}function j5(g){g.rows.forEach(function(i){var h=i.doc&&i.doc._attachments;h&&Object.keys(h).forEach(function(j){var k=h[j];h[j].data=bP(k.data,k.content_type)})})}function bA(g){return function(h){return g.include_docs&&g.attachments&&g.binary&&j5(h),h}}function e2(g){var h="builtin "+g+" function requires map values to be numbers or number arrays";return new dw(h)}function ca(n){for(var g=0,k=0,h=n.length;h>k;k++){var i=n[k];if("number"!=typeof i){if(!Array.isArray(i)){throw e2("_sum")}g="number"==typeof g?[g]:g;for(var j=0,m=i.length;m>j;j++){var l=i[j];if("number"!=typeof l){throw e2("_sum")}"undefined"==typeof g[j]?g.push(l):g[j]+=l}}else{"number"==typeof g?g+=i:g[0]+=i}}return g}function dF(g,j,i,k){var h=j[g];"undefined"!=typeof h&&(k&&(h=encodeURIComponent(JSON.stringify(h))),i.push(g+"="+h))}function eD(g){if("undefined"!=typeof g){var h=Number(g);return isNaN(h)||h!==parseInt(g,10)?g:h}}function cZ(g){return g.group_level=eD(g.group_level),g.limit=eD(g.limit),g.skip=eD(g.skip),g}function jI(g){if(g){if("number"!=typeof g){return new eX('Invalid value for integer: "'+g+'"')}if(0>g){return new eX('Invalid value for positive integer: "'+g+'"')}}}function b9(h,j){var i=h.descending?"endkey":"startkey",g=h.descending?"startkey":"endkey";if("undefined"!=typeof h[i]&&"undefined"!=typeof h[g]&&cJ(h[i],h[g])>0){throw new eX("No rows can match your key range, reverse your start_key and end_key or set {descending : true}")}if(j.reduce&&h.reduce!==!1){if(h.include_docs){throw new eX("{include_docs:true} is invalid for reduce")}if(h.keys&&h.keys.length>1&&!h.group&&!h.group_level){throw new eX("Multi-key fetches for reduce views must use {group: true}")}}["group_level","limit","skip"].forEach(function(k){var l=jI(h[k]);if(l){throw l}})}function cG(n,h,m){var k,l=[],o="GET";if(dF("reduce",m,l),dF("include_docs",m,l),dF("attachments",m,l),dF("limit",m,l),dF("descending",m,l),dF("group",m,l),dF("group_level",m,l),dF("skip",m,l),dF("stale",m,l),dF("conflicts",m,l),dF("startkey",m,l,!0),dF("start_key",m,l,!0),dF("endkey",m,l,!0),dF("end_key",m,l,!0),dF("inclusive_end",m,l),dF("key",m,l,!0),l=l.join("&"),l=""===l?"":"?"+l,"undefined"!=typeof m.keys){var g=2000,j="keys="+encodeURIComponent(JSON.stringify(m.keys));j.length+l.length+1<=g?l+=("?"===l[0]?"&":"?")+j:(o="POST","string"==typeof h?k={keys:m.keys}:h.keys=m.keys)}if("string"==typeof h){var i=kk(h);return n.request({method:o,url:"_design/"+i[0]+"/_view/"+i[1]+l,body:k}).then(bA(m))}return k=k||{},Object.keys(h).forEach(function(p){Array.isArray(h[p])?k[p]=h[p]:k[p]=h[p].toString()}),n.request({method:"POST",url:"_temp_view"+l,body:k}).then(bA(m))}function dj(h,g,i){return new e7(function(j,k){h._query(g,i,function(m,l){return m?k(m):void j(l)})})}function cK(g){return new e7(function(h,i){g._viewCleanup(function(k,j){return k?i(k):void h(j)})})}function dl(g){return function(h){if(404===h.status){return g}throw h}}function j4(g,k,p){function m(){return jZ(o)?e7.resolve(l):k.db.get(h)["catch"](dl(l))}function n(r){return r.keys.length?k.db.allDocs({keys:r.keys,include_docs:!0}):e7.resolve({rows:[]})}function q(B,s){for(var x=[],u={},w=0,z=s.rows.length;z>w;w++){var A=s.rows[w],v=A.doc;if(v&&(x.push(v),u[v._id]=!0,v._deleted=!i[v._id],!v._deleted)){var r=i[v._id];"value" in r&&(v.value=r.value)}}var y=Object.keys(i);return y.forEach(function(C){if(!u[C]){var E={_id:C},D=i[C];"value" in D&&(E.value=D.value),x.push(E)}}),B.keys=cC(y.concat(B.keys)),x.push(B),x}var h="_local/doc_"+g,l={_id:h,keys:[]},j=p[g],i=j.indexableKeysToKeyValues,o=j.changes;return m().then(function(r){return n(r).then(function(s){return q(r,s)})})}function dL(h,j,i){var g="_local/lastSeq";return h.db.get(g)["catch"](dl({_id:g,seq:0})).then(function(k){var l=Object.keys(j);return e7.all(l.map(function(m){return j4(m,h,j)})).then(function(n){var m=db(n);return k.seq=i,m.push(k),h.db.bulkDocs({docs:m})})})}function bz(h){var g="string"==typeof h?h:h.name,i=e0[g];return i||(i=e0[g]=new fE),i}function ep(g){return j2(bz(g),function(){return dd(g)})()}function dd(n){function h(p,r){var q={id:l._id,key:dC(p)};"undefined"!=typeof r&&null!==r&&(q.value=dC(r)),k.push(q)}function m(q,p){return function(){return dL(n,q,p)}}var k,l,o;if("function"==typeof n.mapFun&&2===n.mapFun.length){var g=n.mapFun;o=function(p){return g(p,h)}}else{o=b2(n.mapFun.toString(),h,ca,by,Array.isArray,JSON.parse)}var j=n.seq||0,i=new fE;return new e7(function(p,s){function r(){i.finish().then(function(){n.seq=j,p()})}function q(){function u(v){s(v)}n.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:j,limit:cL}).on("complete",function(v){var C=v.results;if(!C.length){return r()}for(var z={},A=0,x=C.length;x>A;A++){var E=C[A];if("_"!==E.doc._id[0]){k=[],l=E.doc,l._deleted||jG(n.sourceDB,o,[l]),k.sort(fR);for(var H,D={},G=0,w=k.length;w>G;G++){var y=k[G],B=[y.key,y.id];0===cJ(y.key,H)&&B.push(G);var F=cA(B);D[F]=y,H=y.key}z[E.doc._id]={indexableKeysToKeyValues:D,changes:E.changes}}j=E.seq}return i.add(m(z,j)),C.length<cL?r():q()}).on("error",u)}q()})}function az(g,k,p){0===p.group_level&&delete p.group_level;var m,n=p.group||p.group_level;m=jM[g.reduceFun]?jM[g.reduceFun]:b2(g.reduceFun.toString(),null,ca,by,Array.isArray,JSON.parse);var q=[],h=isNaN(p.group_level)?Number.POSITIVE_INFINITY:p.group_level;k.forEach(function(r){var u=q[q.length-1],s=n?r.key:null;return n&&Array.isArray(s)&&(s=s.slice(0,h)),u&&0===cJ(u.groupKey,s)?(u.keys.push([r.key,r.id]),void u.values.push(r.value)):void q.push({keys:[[r.key,r.id]],values:[r.value],groupKey:s})}),k=[];for(var l=0,j=q.length;j>l;l++){var i=q[l],o=jG(g.sourceDB,m,[i.keys,i.values,!1]);if(o.error&&o.error instanceof dw){throw o.error}k.push({value:o.error?null:o.output,key:i.groupKey})}return{rows:ay(k,p.limit,p.skip)}}function cQ(g,h){return j2(bz(g),function(){return e8(g,h)})()}function e8(r,p){function g(u){return u.include_docs=!0,r.db.allDocs(u).then(function(v){return s=v.total_rows,v.rows.map(function(z){if("value" in z.doc&&"object"==typeof z.doc.value&&null!==z.doc.value){var x=Object.keys(z.doc.value).sort(),w=["id","key","value"];if(!(w>x||x>w)){return z.doc.value}}var y=ej(z.doc._id);return{key:y[0],id:y[1],value:"value" in z.doc?z.doc.value:null}})})}function q(u){var w;if(w=i?az(r,u,p):{total_rows:s,offset:n,rows:u},p.include_docs){var v=cC(u.map(aL));return r.sourceDB.allDocs({keys:v,include_docs:!0,conflicts:p.conflicts,attachments:p.attachments,binary:p.binary}).then(function(y){var x={};return y.rows.forEach(function(z){z.doc&&(x["$"+z.id]=z.doc)}),u.forEach(function(A){var B=aL(A),z=x["$"+B];z&&(A.doc=z)}),w})}return w}var s,i=r.reduceFun&&p.reduce!==!1,n=p.skip||0;if("undefined"==typeof p.keys||p.keys.length||(p.limit=0,delete p.keys),"undefined"!=typeof p.keys){var j=p.keys,o=j.map(function(u){var v={startkey:cA([u]),endkey:cA([u,{}])};return g(v)});return e7.all(o).then(db).then(q)}var m={descending:p.descending};if(p.start_key&&(p.startkey=p.start_key),p.end_key&&(p.endkey=p.end_key),"undefined"!=typeof p.startkey&&(m.startkey=cA(p.descending?[p.startkey,{}]:[p.startkey])),"undefined"!=typeof p.endkey){var k=p.inclusive_end!==!1;p.descending&&(k=!k),m.endkey=cA(k?[p.endkey,{}]:[p.endkey])}if("undefined"!=typeof p.key){var h=cA([p.key]),l=cA([p.key,{}]);m.descending?(m.endkey=h,m.startkey=l):(m.startkey=h,m.endkey=l)}return i||("number"==typeof p.limit&&(m.limit=p.limit),m.skip=n),g(m).then(q)}function jK(g){return g.request({method:"POST",url:"_view_cleanup"})}function dp(g){return g.get("_local/mrviews").then(function(h){var j={};Object.keys(h.views).forEach(function(l){var n=kk(l),k="_design/"+n[0],m=n[1];j[k]=j[k]||{},j[k][m]=!0});var i={keys:Object.keys(j),include_docs:!0};return g.allDocs(i).then(function(l){var m={};l.rows.forEach(function(p){var o=p.key.substring(8);Object.keys(j[p.key]).forEach(function(u){var r=o+"/"+u;h.views[r]||(r=u);var q=Object.keys(h.views[r]),s=p.doc&&p.doc.views&&p.doc.views[u];q.forEach(function(v){m[v]=m[v]||s})})});var k=Object.keys(m).filter(function(o){return !m[o]}),n=k.map(function(o){return j2(bz(o),function(){return new g.constructor(o,g.__opts).destroy()})()});return e7.all(n).then(function(){return{ok:!0}})})},dl({ok:!0}))}function aK(i,l,n){if("http"===i.type()){return cG(i,l,n)}if("function"==typeof i._query){return dj(i,l,n)}if("string"!=typeof l){b9(n,l);var k={db:i,viewName:"temp_view/temp_view",map:l.map,reduce:l.reduce,temporary:!0};return eZ.add(function(){return c5(k).then(function(o){function p(){return o.db.destroy()}return f7(ep(o).then(function(){return cQ(o,n)}),p)})}),eZ.finish()}var g=l,m=kk(g),h=m[0],j=m[1];return i.getView(h,j).then(function(p){b9(n,p);var o={db:i,viewName:g,map:p.map,reduce:p.reduce};return c5(o).then(function(q){return"ok"===n.stale||"update_after"===n.stale?("update_after"===n.stale&&df.nextTick(function(){ep(q)}),cQ(q,n)):ep(q).then(function(){return cQ(q,n)})})})}function eX(g){this.status=400,this.name="query_parse_error",this.message=g,this.error=!0;try{Error.captureStackTrace(this,eX)}catch(h){}}function dw(g){this.status=500,this.name="invalid_value",this.message=g,this.error=!0;try{Error.captureStackTrace(this,dw)}catch(h){}}function jX(g){return jY(jE(g))}function f6(n,g,k){function h(o){try{return dZ(o)}catch(q){var p=f1(d6,"Attachment is not a valid base64 string");return{error:p}}}function i(q,p){if(q.stub){return p()}if("string"==typeof q.data){var o=h(q.data);if(o.error){return p(o.error)}q.length=o.length,"blob"===g?q.data=bX(o,q.content_type):"base64"===g?q.data=jY(o):q.data=o,jS(o).then(function(r){q.digest="md5-"+r,p()})}else{dG(q.data,function(r){"binary"===g?q.data=jE(r):"base64"===g&&(q.data=jX(r)),jS(r).then(function(s){q.digest="md5-"+s,q.length=r.byteLength,p()})})}}function j(){l++,n.length===l&&(m?k(m):k())}if(!n.length){return k()}var m,l=0;n.forEach(function(r){function p(u){m=u,q++,q===s.length&&j()}var s=r.data&&r.data._attachments?Object.keys(r.data._attachments):[],q=0;if(!s.length){return j()}for(var o in r.data._attachments){r.data._attachments.hasOwnProperty(o)&&i(r.data._attachments[o],p)}})}function eg(g,h){return g.pos-h.pos}function e3(h,k,j){for(var l,i=0,g=h.length;g>i;){l=i+g>>>1,j(h[l],k)<0?i=l+1:g=l}return i}function dB(h,j,i){var g=e3(h,j,i);h.splice(g,0,j)}function jD(n,g){for(var k,h,i=g,j=n.length;j>i;i++){var m=n[i],l=[m.id,m.opts,[]];h?(h[2].push(l),h=l):k=h=l}return k}function bm(g,h){return g[0]<h[0]?-1:1}function fK(h,j){for(var o=[{tree1:h,tree2:j}],l=!1;o.length>0;){var m=o.pop(),g=m.tree1,i=m.tree2;(g[1].status||i[1].status)&&(g[1].status="available"===g[1].status||"available"===i[1].status?"available":"missing");for(var k=0;k<i[2].length;k++){if(g[2][0]){for(var n=!1,p=0;p<g[2].length;p++){g[2][p][0]===i[2][k][0]&&(o.push({tree1:g[2][p],tree2:i[2][k]}),n=!0)}n||(l="new_branch",dB(g[2],i[2][k],bm))}else{l="new_leaf",g[2][0]=i[2][k]}}}return{conflicts:l,tree:h}}function c4(A,w,o){var m,k=[],s=!1,u=!1;if(!A.length){return{tree:[w],conflicts:"new_leaf"}}for(var y=0,j=A.length;j>y;y++){var n=A[y];if(n.pos===w.pos&&n.ids[0]===w.ids[0]){m=fK(n.ids,w.ids),k.push({pos:n.pos,ids:m.tree}),s=s||m.conflicts,u=!0}else{if(o!==!0){var z=n.pos<w.pos?n:w,q=n.pos<w.pos?w:n,r=q.pos-z.pos,v=[],i=[];for(i.push({ids:z.ids,diff:r,parent:null,parentIdx:null});i.length>0;){var h=i.pop();if(0!==h.diff){for(var g=h.ids[2],l=0,p=g.length;p>l;l++){i.push({ids:g[l],diff:h.diff-1,parent:h.ids,parentIdx:l})}}else{h.ids[0]===q.ids[0]&&v.push(h)}}var x=v[0];x?(m=fK(x.ids,q.ids),x.parent[2][x.parentIdx]=m.tree,k.push({pos:z.pos,ids:z.ids}),s=s||m.conflicts,u=!0):k.push(n)}else{k.push(n)}}}return u||k.push(w),k.sort(eg),{tree:k,conflicts:s||"internal_node"}}function dk(r,p){for(var g,q=cU(r),s={},i=0,n=q.length;n>i;i++){for(var j=q[i],o=j.ids,m=Math.max(0,o.length-p),k={pos:j.pos+m,ids:jD(o,m)},h=0;m>h;h++){var l=j.pos+h+"-"+o[h].id;s[l]=!0}g=g?c4(g,k,!0).tree:[k]}return jU(g,function(w,v,u){delete s[v+"-"+u]}),{tree:g,revs:Object.keys(s)}}function eB(g,j,i){var k=c4(g,j),h=dk(k.tree,i);return{tree:h.tree,stemmedRevs:h.revs,conflicts:k.conflicts}}function eC(h,j){for(var o,l=h.slice(),m=j.split("-"),g=parseInt(m[0],10),i=m[1];o=l.pop();){if(o.pos===g&&o.ids[0]===i){return !0}for(var k=o.ids[2],n=0,p=k.length;p>n;n++){l.push({pos:o.pos+1,ids:k[n]})}}return !1}function cf(u,z,m,p,i,y,j,l){if(eC(z.rev_tree,m.metadata.rev)){return p[i]=m,y()}var g=z.winningRev||ac(z),v="deleted" in z?z.deleted:eE(z,g),r="deleted" in m.metadata?m.metadata.deleted:eE(m.metadata),s=/^1-/.test(m.metadata.rev);if(v&&!r&&l&&s){var k=m.data;k._rev=g,k._id=m.metadata.id,m=dh(k,l)}var A=eB(z.rev_tree,m.metadata.rev_tree[0],u),h=l&&(v&&r||!v&&"new_leaf"!==A.conflicts||v&&!r&&"new_branch"===A.conflicts);if(h){var q=f1(aO);return p[i]=q,y()}var n=m.metadata.rev;m.metadata.rev_tree=A.tree,m.stemmedRevs=A.stemmedRevs||[],z.rev_map&&(m.metadata.rev_map=z.rev_map);var B,w=ac(m.metadata),o=eE(m.metadata,w),x=v===o?0:o>v?-1:1;B=n===w?o:eE(m.metadata,n),j(m,w,o,B,!0,x,i,y)}function eI(g){return"missing"===g.metadata.rev_tree[0].ids[1].status}function bE(v,m,k,u,j,q,l,p,n){function i(C,B,x){var w=ac(C.metadata),A=eE(C.metadata,w);if("was_delete" in p&&A){return q[B]=f1(aA,"deleted"),x()}var z=o&&eI(C);if(z){var y=f1(aO);return q[B]=y,x()}var D=A?0:1;l(C,w,A,A,!1,D,B,x)}function s(){++r===h&&n&&n()}v=v||1000;var o=p.new_edits,g=new dS.Map,r=0,h=m.length;m.forEach(function(w,y){if(w._id&&f8(w._id)){var z=w._deleted?"_removeLocal":"_putLocal";return void k[z](w,{ctx:j},function(B,A){q[y]=B||A,s()})}var x=w.metadata.id;g.has(x)?(h--,g.get(x).push([w,y])):g.set(x,[[w,y]])}),g.forEach(function(z,x){function w(){++y<z.length?A():s()}function A(){var C=z[y],E=C[0],D=C[1];if(u.has(x)){cf(v,u.get(x),E,q,D,w,l,o)}else{var B=eB([],E.metadata.rev_tree[0],v);E.metadata.rev_tree=B.tree,E.stemmedRevs=B.stemmedRevs||[],i(E,D,w)}}var y=0;A()})}function eh(g){var h=[];return jU(g.rev_tree,function(l,i,k,m,j){"available"!==j.status||l||(h.push(i+"-"+k),j.status="missing")}),h}function bg(g){try{return JSON.parse(g)}catch(h){return j9.parse(g)}}function eU(g){return g.length<50000?JSON.parse(g):bg(g)}function dW(g){try{return JSON.stringify(g)}catch(h){return j9.stringify(g)}}function bf(g,j,i,k){try{g.apply(j,i)}catch(h){k.emit("error",h)}}function ad(g){if(!bJ.running&&bJ.queue.length){bJ.running=!0;var h=bJ.queue.shift();h.action(function(i,j){bf(h.callback,this,[i,j],g),bJ.running=!1,df.nextTick(function(){ad(g)})})}}function eO(g){return function(h){var i="unknown_error";h.target&&h.target.error&&(i=h.target.error.name||h.target.error.message),g(f1(dc,i,h.type))}}function cB(h,g,i){return{data:dW(h),winningRev:g,deletedOrLocal:i?"1":"0",seq:h.seq,id:h.id}}function fQ(g){if(!g){return null}var h=eU(g.data);return h.winningRev=g.winningRev,h.deleted="1"===g.deletedOrLocal,h.seq=g.seq,h}function jW(g){if(!g){return g}var h=g._doc_id_rev.lastIndexOf(":");return g._id=g._doc_id_rev.substring(0,h-1),g._rev=g._doc_id_rev.substring(h+1),delete g._doc_id_rev,g}function da(h,j,i,g){i?g(h?"string"!=typeof h?h:bP(h,j):cM([""],{type:j})):h?"string"!=typeof h?aq(h,function(k){g(jY(k))}):g(h):g("")}function aJ(n,g,k,h){function i(){++l===m.length&&h&&h()}function j(s,q){var r=s._attachments[q],p=r.digest,o=k.objectStore(aX).get(p);o.onsuccess=function(u){r.body=u.target.result.body,i()}}var m=Object.keys(n._attachments||{});if(!m.length){return h&&h()}var l=0;m.forEach(function(o){g.attachments&&g.include_docs?j(n,o):(n._attachments[o].stub=!0,i())})}function b5(g,h){return e7.all(g.map(function(i){if(i.doc&&i.doc._attachments){var j=Object.keys(i.doc._attachments);return e7.all(j.map(function(m){var k=i.doc._attachments[m];if("body" in k){var l=k.body,n=k.content_type;return new e7(function(o){da(l,n,h,function(p){i.doc._attachments[m]=eA.extend(dv(k,["digest","content_type"]),{data:p}),o()})})}}))}}))}function aR(h,j,o){function l(){p--,p||m()}function m(){g.length&&g.forEach(function(q){var r=n.index("digestSeq").count(IDBKeyRange.bound(q+"::",q+"::",!1,!1));r.onsuccess=function(s){var u=s.target.result;u||k["delete"](q)}})}var g=[],i=o.objectStore(cb),k=o.objectStore(aX),n=o.objectStore(bF),p=h.length;h.forEach(function(s){var r=i.index("_doc_id_rev"),q=j+"::"+s;r.getKey(q).onsuccess=function(v){var u=v.target.result;if("number"!=typeof u){return l()}i["delete"](u);var w=n.index("seq").openCursor(IDBKeyRange.only(u));w.onsuccess=function(z){var y=z.target.result;if(y){var x=y.value.digestSeq.split("::")[0];g.push(x),n["delete"](y.primaryKey),y["continue"]()}else{l()}}}})}function e1(h,j,i){try{return{txn:h.transaction(j,i)}}catch(g){return{error:g}}}function fH(h,z,m,N,B,L,o){function I(){var Q=[jV,cb,aX,fC,bF],P=e1(B,Q,"readwrite");return P.error?o(P.error):(p=P.txn,p.onabort=eO(o),p.ontimeout=eO(o),p.oncomplete=g,s=p.objectStore(jV),y=p.objectStore(cb),l=p.objectStore(aX),n=p.objectStore(bF),void i(function(R){return R?(F=!0,o(R)):void G()}))}function K(){bE(h.revs_limit,O,N,j,p,M,D,m)}function G(){function V(){++Q===O.length&&K()}function T(X){var W=fQ(X.target.result);W&&j.set(W.id,W),V()}if(O.length){for(var Q=0,U=0,P=O.length;P>U;U++){var S=O[U];if(S._id&&f8(S._id)){V()}else{var R=s.get(S.metadata.id);R.onsuccess=T}}}}function g(){F||(L.notify(N._meta.name),N._meta.docCount+=C,o(null,M))}function E(Q,P){var R=l.get(Q);R.onsuccess=function(T){if(T.target.result){P()}else{var S=f1(dE,"unknown stub attachment with digest "+Q);S.status=412,P(S)}}}function i(R){function P(){++S===T.length&&R(Q)}var T=[];if(O.forEach(function(U){U.data&&U.data._attachments&&Object.keys(U.data._attachments).forEach(function(W){var V=U.data._attachments[W];V.stub&&T.push(V.digest)})}),!T.length){return R()}var Q,S=0;T.forEach(function(U){E(U,function(V){V&&!Q&&(Q=V),P()})})}function D(V,P,T,R,S,U,X,Q){C+=U,V.metadata.winningRev=P,V.metadata.deleted=T;var Y=V.data;Y._id=V.metadata.id,Y._rev=V.metadata.rev,R&&(Y._deleted=!0);var W=Y._attachments&&Object.keys(Y._attachments).length;return W?q(V,P,T,S,X,Q):void w(V,P,T,S,X,Q)}function v(Q){var P=eh(Q.metadata);aR(P,Q.metadata.id,p)}function w(ae,T,W,V,Y,R){function U(an){V&&N.auto_compaction?v(ae):ae.stemmedRevs.length&&aR(ae.stemmedRevs,ae.metadata.id,p),X.seq=an.target.result,delete X.rev;var ai=cB(X,T,W),ao=s.put(ai);ao.onsuccess=Q}function S(ai){ai.preventDefault(),ai.stopPropagation();var ao=y.index("_doc_id_rev"),an=ao.getKey(Z._doc_id_rev);an.onsuccess=function(at){var ar=y.put(Z,at.target.result);ar.onsuccess=U}}function Q(){M[Y]={ok:!0,id:X.id,rev:T},j.set(ae.metadata.id,ae.metadata),A(ae,X.seq,R)}var Z=ae.data,X=ae.metadata;Z._doc_id_rev=X.id+"::"+X.rev,delete Z._id,delete Z._rev;var P=y.put(Z);P.onsuccess=U,P.onerror=S}function q(X,Q,U,S,T,V){function Z(){Y===W.length&&w(X,Q,U,S,T,V)}function R(){Y++,Z()}var P=X.data,Y=0,W=Object.keys(P._attachments);W.forEach(function(ae){var an=X.data._attachments[ae];if(an.stub){Y++,Z()}else{var ao=an.data;delete an.data,an.revpos=parseInt(Q,10);var ai=an.digest;x(ai,ao,R)}})}function A(V,S,P){function U(){++R===Q.length&&P()}function W(Z){var Y=V.data._attachments[Z].digest,X=n.put({seq:S,digestSeq:Y+"::"+S});X.onsuccess=U,X.onerror=function(ae){ae.preventDefault(),ae.stopPropagation(),U()}}var R=0,Q=Object.keys(V.data._attachments||{});if(!Q.length){return P()}for(var T=0;T<Q.length;T++){W(Q[T])}}function x(R,P,S){var Q=l.count(R);Q.onsuccess=function(V){var W=V.target.result;if(W){return S()}var U={digest:R,body:P},T=l.put(U);T.onsuccess=S}}for(var p,s,y,l,n,H,O=z.docs,C=0,k=0,J=O.length;J>k;k++){var r=O[k];r._id&&f8(r._id)||(r=O[k]=dh(r,m.new_edits),r.error&&!H&&(H=r))}if(H){return o(H)}var M=new Array(O.length),j=new dS.Map,F=!1,u=N._meta.blobSupport?"blob":"base64";f6(O,u,function(P){return P?o(P):void I()})}function d1(h,k,j,l,i){try{if(h&&k){return i?IDBKeyRange.bound(k,h,!j,!1):IDBKeyRange.bound(h,k,!1,!j)}if(h){return i?IDBKeyRange.upperBound(h):IDBKeyRange.lowerBound(h)}if(k){return i?IDBKeyRange.lowerBound(k,!j):IDBKeyRange.upperBound(k,!j)}if(l){return IDBKeyRange.only(l)}}catch(g){return{error:g}}return null}function bZ(h,j,i,g){return"DataError"===i.name&&0===i.code?g(null,{total_rows:h._meta.docCount,offset:j.skip,rows:[]}):void g(f1(dc,i.name,i.message))}function d8(h,k,j,l){function i(m,q){function E(L,M,N){var O=L.id+"::"+N;w.get(O).onsuccess=function(P){M.doc=jW(P.target.result),m.conflicts&&(M.doc._conflicts=eW(L)),aJ(M.doc,m,I)}}function v(L,N,M){var P={id:M.id,key:M.id,value:{rev:N}},O=M.deleted;if("ok"===m.deleted){z.push(P),O?(P.value.deleted=!0,P.doc=null):m.include_docs&&E(M,P,N)}else{if(!O&&F--<=0&&(z.push(P),m.include_docs&&E(M,P,N),0===--s)){return}}L["continue"]()}function C(N){D=k._meta.docCount;var M=N.target.result;if(M){var L=fQ(M.value),O=L.winningRev;v(M,O,L)}}function H(){q(null,{total_rows:D,offset:m.skip,rows:z})}function B(){m.attachments?b5(z,m.binary).then(H):H()}var n="startkey" in m?m.startkey:!1,p="endkey" in m?m.endkey:!1,A="key" in m?m.key:!1,F=m.skip||0,s="number"==typeof m.limit?m.limit:-1,u=m.inclusive_end!==!1,y="descending" in m&&m.descending?"prev":null,o=d1(n,p,u,A,y);if(o&&o.error){return bZ(k,m,o.error,q)}var J=[jV,cb];m.attachments&&J.push(aX);var r=e1(j,J,"readonly");if(r.error){return q(r.error)}var I=r.txn,x=I.objectStore(jV),K=I.objectStore(cb),G=y?x.openCursor(o,y):x.openCursor(o),w=K.index("_doc_id_rev"),z=[],D=0;I.oncomplete=B,G.onsuccess=C}function g(n,m){return 0===n.limit?m(null,{total_rows:k._meta.docCount,offset:n.skip,rows:[]}):void i(n,m)}g(h,l)}function bq(g){return new e7(function(h){var i=cM([""]);g.objectStore(cu).put(i,"key"),g.onabort=function(j){j.preventDefault(),j.stopPropagation(),h(!1)},g.oncomplete=function(){var j=navigator.userAgent.match(/Chrome\/(\d+)/),k=navigator.userAgent.match(/Edge\//);h(k||!j||parseInt(j[1],10)>=43)}})["catch"](function(){return !1})}function cE(g){dz()?chrome.storage.onChanged.addListener(function(h){null!=h.db_name&&g.emit(h.dbName.newValue)}):fO()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(h){g.emit(h.key)}):window.attachEvent("storage",function(h){g.emit(h.key)}))}function c7(){aS.EventEmitter.call(this),this._listeners={},cE(this)}function bQ(h,g){var i=this;bJ.queue.push({action:function(j){b8(i,h,j)},callback:g}),ad(i.constructor)}function b8(o,l,s){function g(w){var v=w.createObjectStore(jV,{keyPath:"id"});w.createObjectStore(cb,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),w.createObjectStore(aX,{keyPath:"digest"}),w.createObjectStore(c9,{keyPath:"id",autoIncrement:!1}),w.createObjectStore(cu),v.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),w.createObjectStore(fC,{keyPath:"_id"});var x=w.createObjectStore(bF,{autoIncrement:!0});x.createIndex("seq","seq"),x.createIndex("digestSeq","digestSeq",{unique:!0})}function i(w,v){var x=w.objectStore(jV);x.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),x.openCursor().onsuccess=function(B){var z=B.target.result;if(z){var A=z.value,y=eE(A);A.deletedOrLocal=y?"1":"0",x.put(A),z["continue"]()}else{v()}}}function j(v){v.createObjectStore(fC,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function k(w,z){var A=w.objectStore(fC),v=w.objectStore(jV),y=w.objectStore(cb),x=v.openCursor();x.onsuccess=function(E){var B=E.target.result;if(B){var I=B.value,K=I.id,J=f8(K),G=ac(I);if(J){var D=K+"::"+G,M=K+"::",F=K+"::~",C=y.index("_doc_id_rev"),L=IDBKeyRange.bound(M,F,!1,!1),H=C.openCursor(L);H.onsuccess=function(N){if(H=N.target.result){var O=H.value;O._doc_id_rev===D&&A.put(O),y["delete"](H.primaryKey),H["continue"]()}else{v["delete"](B.primaryKey),B["continue"]()}}}else{B["continue"]()}}else{z&&z()}}}function h(w){var v=w.createObjectStore(bF,{autoIncrement:!0});v.createIndex("seq","seq"),v.createIndex("digestSeq","digestSeq",{unique:!0})}function n(w,z){var A=w.objectStore(cb),v=w.objectStore(aX),y=w.objectStore(bF),x=v.count();x.onsuccess=function(B){var C=B.target.result;return C?void (A.openCursor().onsuccess=function(K){var G=K.target.result;if(!G){return z()}for(var F=G.value,I=G.primaryKey,M=Object.keys(F._attachments||{}),E={},D=0;D<M.length;D++){var L=F._attachments[M[D]];E[L.digest]=!0}var J=Object.keys(E);for(D=0;D<J.length;D++){var H=J[D];y.put({seq:I,digestSeq:H+"::"+I})}G["continue"]()}):z()}}function p(y){function v(A){return A.data?fQ(A):(A.deleted="1"===A.deletedOrLocal,A)}var w=y.objectStore(cb),x=y.objectStore(jV),z=x.openCursor();z.onsuccess=function(C){function D(){var H=A.id+"::",F=A.id+"::",G=w.index("_doc_id_rev").openCursor(IDBKeyRange.bound(H,F)),I=0;G.onsuccess=function(K){var J=K.target.result;if(!J){return A.seq=I,B()}var L=J.primaryKey;L>I&&(I=L),J["continue"]()}}function B(){var G=cB(A,A.winningRev,A.deleted),F=x.put(G);F.onsuccess=function(){E["continue"]()}}var E=C.target.result;if(E){var A=v(E.value);return A.winningRev=A.winningRev||ac(A),A.seq?B():void D()}}}var m=l.name,u=null;o._meta=null,o.type=function(){return"idb"},o._id=fP(function(v){v(null,o._meta.instanceId)}),o._bulkDocs=function(x,v,w){fH(l,x,v,o,u,eQ,w)},o._get=function(y,B,x){function v(){x(z,{doc:w,metadata:D,ctx:C})}var w,D,z,C=B.ctx;if(!C){var A=e1(u,[jV,cb,aX],"readonly");if(A.error){return x(A.error)}C=A.txn}C.objectStore(jV).get(y).onsuccess=function(E){if(D=fQ(E.target.result),!D){return z=f1(aA,"missing"),v()}if(eE(D)&&!B.rev){return z=f1(aA,"deleted"),v()}var G=C.objectStore(cb),H=B.rev||D.winningRev,F=D.id+"::"+H;G.index("_doc_id_rev").get(F).onsuccess=function(I){return w=I.target.result,w&&(w=jW(w)),w?void v():(z=f1(aA,"missing"),v())}}},o._getAttachment=function(A,y,w){var B;if(y.ctx){B=y.ctx}else{var v=e1(u,[jV,cb,aX],"readonly");if(v.error){return w(v.error)}B=v.txn}var x=A.digest,z=A.content_type;B.objectStore(aX).get(x).onsuccess=function(C){var D=C.target.result.body;da(D,z,y.binary,function(E){w(null,E)})}},o._info=function(y){if(null===u||!jO.has(m)){var A=new Error("db isn't open");return A.id="idbNull",y(A)}var B,w,x=e1(u,[cb],"readonly");if(x.error){return y(x.error)}var z=x.txn,v=z.objectStore(cb).openCursor(null,"prev");v.onsuccess=function(D){var C=D.target.result;B=C?C.key:0,w=o._meta.docCount},z.oncomplete=function(){y(null,{doc_count:w,update_seq:B,idb_attachment_format:o._meta.blobSupport?"binary":"base64"})}},o._allDocs=function(v,w){d8(v,o,u,w)},o._changes=function(B){function x(N){function S(){return R.seq!==T?N["continue"]():(G=T,R.winningRev===O._rev?Q(O):void P())}function P(){var U=O._id+"::"+R.winningRev,V=y.get(U);V.onsuccess=function(W){Q(jW(W.target.result))}}function Q(V){var W=B.processChange(V,R,B);W.seq=R.seq;var U=v(W);return"object"==typeof U?B.complete(U):(U&&(F++,E&&A.push(W),B.attachments&&B.include_docs?aJ(V,B,J,function(){b5([W],B.binary).then(function(){B.onChange(W)})}):B.onChange(W)),void (F!==L&&N["continue"]()))}var O=jW(N.value),T=N.key;if(z&&!z.has(O._id)){return N["continue"]()}var R;return(R=C.get(O._id))?S():void (I.get(O._id).onsuccess=function(U){R=fQ(U.target.result),C.set(O._id,R),S()})}function M(O){var N=O.target.result;N&&x(N)}function H(){var O=[jV,cb];B.attachments&&O.push(aX);var N=e1(u,O,"readonly");if(N.error){return B.complete(N.error)}J=N.txn,J.onabort=eO(B.complete),J.oncomplete=K,w=J.objectStore(cb),I=J.objectStore(jV),y=w.index("_doc_id_rev");var P;P=B.descending?w.openCursor(null,"prev"):w.openCursor(IDBKeyRange.lowerBound(B.since,!0)),P.onsuccess=M}function K(){function N(){B.complete(null,{results:A,last_seq:G})}!B.continuous&&B.attachments?b5(A).then(N):N()}if(B=cl(B),B.continuous){var D=m+":"+f9();return eQ.addListener(m,D,o,B),eQ.notify(m),{cancel:function(){eQ.removeListener(m,D)}}}var z=B.doc_ids&&new dS.Set(B.doc_ids);B.since=B.since||0;var G=B.since,L="limit" in B?B.limit:-1;0===L&&(L=1);var E;E="return_docs" in B?B.return_docs:"returnDocs" in B?B.returnDocs:!0;var J,w,I,y,A=[],F=0,v=eF(B),C=new dS.Map;H()},o._close=function(v){return null===u?v(f1(eH)):(u.close(),jO["delete"](m),u=null,void v())},o._getRevisionTree=function(y,v){var w=e1(u,[jV],"readonly");if(w.error){return v(w.error)}var x=w.txn,z=x.objectStore(jV).get(y);z.onsuccess=function(B){var A=fQ(B.target.result);A?v(null,A.rev_tree):v(f1(aA))}},o._doCompaction=function(A,y,w){var B=[jV,cb,aX,bF],v=e1(u,B,"readwrite");if(v.error){return w(v.error)}var x=v.txn,z=x.objectStore(jV);z.get(A).onsuccess=function(E){var C=fQ(E.target.result);jU(C.rev_tree,function(I,K,H,J,G){var L=K+"-"+H;-1!==y.indexOf(L)&&(G.status="missing")}),aR(y,A,x);var D=C.winningRev,F=C.deleted;x.objectStore(jV).put(cB(C,D,F))},x.onabort=eO(w),x.oncomplete=function(){w()}},o._getLocal=function(y,v){var w=e1(u,[fC],"readonly");if(w.error){return v(w.error)}var x=w.txn,z=x.objectStore(fC).get(y);z.onerror=eO(v),z.onsuccess=function(B){var A=B.target.result;A?(delete A._doc_id_rev,v(null,A)):v(f1(aA))}},o._putLocal=function(z,D,y){"function"==typeof D&&(y=D,D={}),delete z._revisions;var w=z._rev,x=z._id;w?z._rev="0-"+(parseInt(w.split("-")[1],10)+1):z._rev="0-1";var v,B=D.ctx;if(!B){var E=e1(u,[fC],"readwrite");if(E.error){return y(E.error)}B=E.txn,B.onerror=eO(y),B.oncomplete=function(){v&&y(null,v)}}var C,A=B.objectStore(fC);w?(C=A.get(x),C.onsuccess=function(H){var G=H.target.result;if(G&&G._rev===w){var F=A.put(z);F.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)}}else{y(f1(aO))}}):(C=A.add(z),C.onerror=function(F){y(f1(aO)),F.preventDefault(),F.stopPropagation()},C.onsuccess=function(){v={ok:!0,id:z._id,rev:z._rev},D.ctx&&y(null,v)})},o._removeLocal=function(y,B,x){"function"==typeof B&&(x=B,B={});var v=B.ctx;if(!v){var w=e1(u,[fC],"readwrite");if(w.error){return x(w.error)}v=w.txn,v.oncomplete=function(){D&&x(null,D)}}var D,z=y._id,C=v.objectStore(fC),A=C.get(z);A.onerror=eO(x),A.onsuccess=function(F){var E=F.target.result;E&&E._rev===y._rev?(C["delete"](z),D={ok:!0,id:z,rev:"0-0"},B.ctx&&x(null,D)):x(f1(aA))}},o._destroy=function(w,y){eQ.removeAllListeners(m);var x=aD.get(m);x&&x.result&&(x.result.close(),jO["delete"](m));var v=indexedDB.deleteDatabase(m);v.onsuccess=function(){aD["delete"](m),fO()&&m in localStorage&&delete localStorage[m],y(null,{ok:!0})},v.onerror=eO(y)};var q=jO.get(m);if(q){return u=q.idb,o._meta=q.global,void df.nextTick(function(){s(null,o)})}var r;r=l.storage?b3(m,l.storage):indexedDB.open(m,dI),aD.set(m,r),r.onupgradeneeded=function(z){function y(){var B=v[x-1];x++,B&&B(A,y)}var w=z.target.result;if(z.oldVersion<1){return g(w)}var A=z.currentTarget.transaction;z.oldVersion<3&&j(w),z.oldVersion<4&&h(w);var v=[i,k,n,p],x=z.oldVersion;y()},r.onsuccess=function(v){u=v.target.result,u.onversionchange=function(){u.close(),jO["delete"](m)},u.onabort=function(B){console.error("Database has a global failure",B.target.error),u.close(),jO["delete"](m)};var z=u.transaction([c9,cu,jV],"readwrite"),y=z.objectStore(c9).get(c9),w=null,x=null,A=null;y.onsuccess=function(D){var B=function(){null!==w&&null!==x&&null!==A&&(o._meta={name:m,instanceId:A,blobSupport:w,docCount:x},jO.set(m,{idb:u,global:o._meta}),s(null,o))},E=D.target.result||{id:c9};m+"_id" in E?(A=E[m+"_id"],B()):(A=f9(),E[m+"_id"]=A,z.objectStore(c9).put(E).onsuccess=function(){B()}),el||(el=bq(z)),el.then(function(F){w=F,B()});var C=z.objectStore(jV).index("deletedOrLocal");C.count(IDBKeyRange.only("0")).onsuccess=function(F){x=F.target.result,B()}}},r.onerror=function(){var v="Failed to open indexedDB, are you in private browsing mode?";console.error(v),s(f1(dc,v))}}function b3(h,g){try{return indexedDB.open(h,{version:dI,storage:g})}catch(i){return indexedDB.open(h,dI)}}function aj(g){return decodeURIComponent(window.escape(g))}function j3(g){return 65>g?g-48:g-55}function dm(h,j,i){for(var g="";i>j;){g+=String.fromCharCode(j3(h.charCodeAt(j++))<<4|j3(h.charCodeAt(j++)))}return g}function cV(h,j,i){for(var g="";i>j;){g+=String.fromCharCode(j3(h.charCodeAt(j+2))<<12|j3(h.charCodeAt(j+3))<<8|j3(h.charCodeAt(j))<<4|j3(h.charCodeAt(j+1))),j+=4}return g}function cv(g,h){return"UTF-8"===h?aj(dm(g,0,g.length)):cV(g,0,g.length)}function eP(g){return"'"+g+"'"}function fA(){return"undefined"!=typeof sqlitePlugin?sqlitePlugin.openDatabase.bind(sqlitePlugin):"undefined"!=typeof openDatabase?function(g){return openDatabase(g.name,g.version,g.description,g.size)}:void 0}function dR(){return"undefined"!=typeof openDatabase||"undefined"!=typeof SQLitePlugin}function jN(g){return g.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function ch(g){return g.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function cN(g){return delete g._id,delete g._rev,JSON.stringify(g)}function aH(h,g,i){return h=JSON.parse(h),h._id=g,h._rev=i,h}function a8(g){for(var h="(";g--;){h+="?",g&&(h+=",")}return h+")"}function f0(g,j,i,k,h){return"SELECT "+g+" FROM "+("string"==typeof j?j:j.join(" JOIN "))+(i?" ON "+i:"")+(k?" WHERE "+("string"==typeof k?k:k.join(" AND ")):"")+(h?" ORDER BY "+h:"")}function bB(j,m,g){function i(){++l===j.length&&k()}function k(){if(h.length){var n="SELECT DISTINCT digest AS digest FROM "+jR+" WHERE seq IN "+a8(h.length);g.executeSql(n,h,function(q,o){for(var s=[],p=0;p<o.rows.length;p++){s.push(o.rows.item(p).digest)}if(s.length){var r="DELETE FROM "+jR+" WHERE seq IN ("+h.map(function(){return"?"}).join(",")+")";q.executeSql(r,h,function(u){var v="SELECT digest FROM "+jR+" WHERE digest IN ("+s.map(function(){return"?"}).join(",")+")";u.executeSql(v,s,function(x,y){for(var w=new dS.Set,z=0;z<y.rows.length;z++){w.add(y.rows.item(z).digest)}s.forEach(function(A){w.has(A)||(x.executeSql("DELETE FROM "+jR+" WHERE digest=?",[A]),x.executeSql("DELETE FROM "+bb+" WHERE digest=?",[A]))})})})}})}}if(j.length){var l=0,h=[];j.forEach(function(n){var o="SELECT seq FROM "+cF+" WHERE doc_id=? AND rev=?";g.executeSql(o,[m,n],function(q,p){if(!p.rows.length){return i()}var r=p.rows.item(0).seq;h.push(r),q.executeSql("DELETE FROM "+cF+" WHERE seq=?",[r],i)})})}}function dX(g){return function(h){console.error("WebSQL threw an error",h);var k=h&&h.constructor.toString().match(/function ([^\(]+)/),i=k&&k[1]||h.type,j=h.target||h.message;g(f1(kb,j,i))}}function bW(g){if("size" in g){return 1000000*g.size}var h="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return h?5000000:1}function e4(h,g){try{return{db:h(g)}}catch(i){return{error:i}}}function dY(h){var g=bV.get(h.name);if(!g){var i=fA();g=e4(i,h),bV.set(h.name,g),g.db&&(g.db._sqlitePlugin="undefined"!=typeof sqlitePlugin)}return g}function fB(v,r,i,n,g,z,A){function m(){return l?A(l):(z.notify(n._name),n._docCount=-1,void A(null,y))}function B(E,D){var F="SELECT count(*) as cnt FROM "+bb+" WHERE digest=?";j.executeSql(F,[E],function(G,H){if(0===H.rows.item(0).cnt){var I=f1(dE,"unknown stub attachment with digest "+E);D(I)}else{D()}})}function s(F){function D(){++G===H.length&&F(E)}var H=[];if(o.forEach(function(I){I.data&&I.data._attachments&&Object.keys(I.data._attachments).forEach(function(J){var K=I.data._attachments[J];K.stub&&H.push(K.digest)})}),!H.length){return F()}var E,G=0;H.forEach(function(I){B(I,function(J){J&&!E&&(E=J),D()})})}function u(P,I,D,N,L,F,K,H){function R(){function T(a0,ar){function ai(){return ++at===ao.length&&ar(),!1}function ae(a1){var a2="INSERT INTO "+jR+" (digest, seq) VALUES (?,?)",a3=[S._attachments[a1].digest,a0];j.executeSql(a2,a3,ai,ai)}var at=0,ao=Object.keys(S._attachments||{});if(!ao.length){return ar()}for(var an=0;an<ao.length;an++){ae(ao[an])}}var S=P.data,V=N?1:0,Y=S._id,U=S._rev,W=cN(S),X="INSERT INTO "+cF+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",Z=[Y,U,W,V];j.executeSql(X,Z,function(an,ai){var ae=ai.insertId;T(ae,function(){Q(an,ae)})},function(){var ae=f0("seq",cF,null,"doc_id=? AND rev=?");return j.executeSql(ae,[Y,U],function(an,ao){var ar=ao.rows.item(0).seq,ai="UPDATE "+cF+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",at=[W,V,Y,U];an.executeSql(ai,at,function(a0){T(ar,function(){Q(a0,ar)})})}),!1})}function O(S){M||(S?(M=S,H(M)):G===E.length&&R())}function J(S){G++,O(S)}function Q(U,S){var V=P.metadata.id;L&&n.auto_compaction?bB(eh(P.metadata),V,U):P.stemmedRevs.length&&bB(P.stemmedRevs,V,U),P.metadata.seq=S,delete P.metadata.rev;var T=L?"UPDATE "+cR+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+cF+" WHERE doc_id="+cR+".id AND rev=?) WHERE id=?":"INSERT INTO "+cR+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",W=dW(P.metadata),X=L?[W,S,I,V]:[V,S,S,W];U.executeSql(T,X,function(){y[K]={ok:!0,id:P.metadata.id,rev:I},w.set(V,P.metadata),H()})}var M=null,G=0;P.data._id=P.metadata.id,P.data._rev=P.metadata.rev;var E=Object.keys(P.data._attachments||{});N&&(P.data._deleted=!0),E.forEach(function(S){var U=P.data._attachments[S];if(U.stub){G++,O()}else{var V=U.data;delete U.data,U.revpos=parseInt(I,10);var T=U.digest;C(T,V,J)}}),E.length||R()}function x(){bE(v.revs_limit,o,n,w,j,y,u,i)}function k(E){function D(){++F===o.length&&E()}if(!o.length){return E()}var F=0;o.forEach(function(G){if(G._id&&f8(G._id)){return D()}var H=G.metadata.id;j.executeSql("SELECT json FROM "+cR+" WHERE id = ?",[H],function(J,I){if(I.rows.length){var K=eU(I.rows.item(0).json);w.set(H,K)}D()})})}function C(F,D,G){var E="SELECT digest FROM "+bb+" WHERE digest=?";j.executeSql(E,[F],function(H,I){return I.rows.length?G():(E="INSERT INTO "+bb+" (digest, body, escaped) VALUES (?,?,1)",void H.executeSql(E,[F,jN(D)],function(){G()},function(){return G(),!1}))})}var p=i.new_edits,q=r.docs,o=q.map(function(E){if(E._id&&f8(E._id)){return E}var D=dh(E,p);return D}),h=o.filter(function(D){return D.error});if(h.length){return A(h[0])}var j,l,y=new Array(o.length),w=new dS.Map;f6(o,"binary",function(D){return D?A(D):void g.transaction(function(E){j=E,s(function(F){F?l=F:k(x)})},dX(A),m)})}function bY(m,i,l,j,k){function n(){++o===g.length&&k&&k()}function h(r,s){var q=r._attachments[s],p={binary:i.binary,ctx:j};l._getAttachment(q,p,function(v,u){r._attachments[s]=eA.extend(dv(q,["digest","content_type"]),{data:u}),n()})}var g=Object.keys(m._attachments||{});if(!g.length){return k&&k()}var o=0;g.forEach(function(p){i.attachments&&i.include_docs?h(m,p):(m._attachments[p].stub=!0,n())})}function dy(y,n){function C(){fO()&&(window.localStorage["_pouch__websqldb_"+j._name]=!0),n(null,j)}function g(F,E){F.executeSql(cs),F.executeSql("ALTER TABLE "+cF+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){F.executeSql(c1),F.executeSql("ALTER TABLE "+cR+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){F.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+cR+" (local, id)");var G="SELECT "+cR+".winningseq AS seq, "+cR+".json AS metadata FROM "+cF+" JOIN "+cR+" ON "+cF+".seq = "+cR+".winningseq";F.executeSql(G,[],function(J,N){for(var I=[],L=[],M=0;M<N.rows.length;M++){var O=N.rows.item(M),H=O.seq,K=JSON.parse(O.metadata);eE(K)&&I.push(H),f8(K.id)&&L.push(K.id)}J.executeSql("UPDATE "+cR+"SET local = 1 WHERE id IN "+a8(L.length),L,function(){J.executeSql("UPDATE "+cF+" SET deleted = 1 WHERE seq IN "+a8(I.length),I,E)})})})})}function A(F,E){var G="CREATE TABLE IF NOT EXISTS "+bi+" (id UNIQUE, rev, json)";F.executeSql(G,[],function(){var H="SELECT "+cR+".id AS id, "+cF+".json AS data FROM "+cF+" JOIN "+cR+" ON "+cF+".seq = "+cR+".winningseq WHERE local = 1";F.executeSql(H,[],function(J,L){function I(){if(!K.length){return E(J)}var O=K.shift(),N=JSON.parse(O.data)._rev;J.executeSql("INSERT INTO "+bi+" (id, rev, json) VALUES (?,?,?)",[O.id,N,O.data],function(P){P.executeSql("DELETE FROM "+cR+" WHERE id=?",[O.id],function(Q){Q.executeSql("DELETE FROM "+cF+" WHERE seq=?",[O.seq],function(){I()})})})}for(var K=[],M=0;M<L.rows.length;M++){K.push(L.rows.item(M))}I()})})}function w(G,E){function H(J){function I(){if(!J.length){return E(G)}var K=J.shift(),O=cv(K.hex,l),M=O.lastIndexOf("::"),P=O.substring(0,M),N=O.substring(M+2),L="UPDATE "+cF+" SET doc_id=?, rev=? WHERE doc_id_rev=?";G.executeSql(L,[P,N,O],function(){I()})}I()}var F="ALTER TABLE "+cF+" ADD COLUMN doc_id";G.executeSql(F,[],function(J){var I="ALTER TABLE "+cF+" ADD COLUMN rev";J.executeSql(I,[],function(K){K.executeSql(eT,[],function(M){var L="SELECT hex(doc_id_rev) as hex FROM "+cF;M.executeSql(L,[],function(P,N){for(var O=[],Q=0;Q<N.rows.length;Q++){O.push(N.rows.item(Q))}H(O)})})})})}function r(G,E){function H(I){var J="SELECT COUNT(*) AS cnt FROM "+bb;I.executeSql(J,[],function(P,L){function O(){var Q=f0(kj+", "+cR+".id AS id",[cR,cF],dU,null,cR+".id ");Q+=" LIMIT "+M+" OFFSET "+N,N+=M,P.executeSql(Q,[],function(ai,W){function an(at,ar){var ao=Z[at]=Z[at]||[];-1===ao.indexOf(ar)&&ao.push(ar)}if(!W.rows.length){return E(ai)}for(var Z={},T=0;T<W.rows.length;T++){for(var V=W.rows.item(T),U=aH(V.data,V.id,V.rev),R=Object.keys(U._attachments||{}),Y=0;Y<R.length;Y++){var X=U._attachments[R[Y]];an(X.digest,V.seq)}}var S=[];if(Object.keys(Z).forEach(function(ar){var ao=Z[ar];ao.forEach(function(at){S.push([ar,at])})}),!S.length){return O()}var ae=0;S.forEach(function(ao){var ar="INSERT INTO "+jR+" (digest, seq) VALUES (?,?)";ai.executeSql(ar,ao,function(){++ae===S.length&&O()})})})}var K=L.rows.item(0).cnt;if(!K){return E(P)}var N=0,M=10;O()})}var F="CREATE TABLE IF NOT EXISTS "+jR+" (digest, seq INTEGER)";G.executeSql(F,[],function(I){I.executeSql(bv,[],function(J){J.executeSql(cI,[],H)})})}function o(F,E){var G="ALTER TABLE "+bb+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";F.executeSql(G,[],E)}function s(F,E){var G="ALTER TABLE "+cR+" ADD COLUMN max_seq INTEGER";F.executeSql(G,[],function(H){var I="UPDATE "+cR+" SET max_seq=(SELECT MAX(seq) FROM "+cF+" WHERE doc_id=id)";H.executeSql(I,[],function(J){var K="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+cR+" (max_seq)";J.executeSql(K,[],E)})})}function v(F,E){F.executeSql('SELECT HEX("a") AS hex',[],function(H,I){var G=I.rows.item(0).hex;l=2===G.length?"UTF-8":"UTF-16",E()})}function B(){for(;i.length>0;){var E=i.pop();E(null,D)}}function x(O,K){if(0===K){var G="CREATE TABLE IF NOT EXISTS "+cz+" (dbid, db_version INTEGER)",P="CREATE TABLE IF NOT EXISTS "+bb+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",N="CREATE TABLE IF NOT EXISTS "+jR+" (digest, seq INTEGER)",L="CREATE TABLE IF NOT EXISTS "+cR+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",M="CREATE TABLE IF NOT EXISTS "+cF+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",F="CREATE TABLE IF NOT EXISTS "+bi+" (id UNIQUE, rev, json)";O.executeSql(P),O.executeSql(F),O.executeSql(N,[],function(){O.executeSql(cI),O.executeSql(bv)}),O.executeSql(L,[],function(){O.executeSql(cs),O.executeSql(M,[],function(){O.executeSql(c1),O.executeSql(eT),O.executeSql(G,[],function(){var Q="INSERT INTO "+cz+" (db_version, dbid) VALUES (?,?)";D=f9();var R=[aY,D];O.executeSql(Q,R,function(){B()})})})})}else{var I=function(){var R=aY>K;R&&O.executeSql("UPDATE "+cz+" SET db_version = "+aY);var Q="SELECT dbid FROM "+cz;O.executeSql(Q,[],function(T,S){D=S.rows.item(0).dbid,B()})},E=[g,A,w,r,o,s,I],H=K,J=function(Q){E[H-1](Q,J),H++};J(O)}}function p(){h.transaction(function(E){v(E,function(){m(E)})},dX(n),C)}function m(F){var E="SELECT sql FROM sqlite_master WHERE tbl_name = "+cz;F.executeSql(E,[],function(H,G){G.rows.length?/db_version/.test(G.rows.item(0).sql)?H.executeSql("SELECT db_version FROM "+cz,[],function(I,K){var J=K.rows.item(0).db_version;x(I,J)}):H.executeSql("ALTER TABLE "+cz+" ADD COLUMN db_version INTEGER",[],function(){x(H,1)}):x(H,0)})}function k(F,E){if(-1!==j._docCount){return E(j._docCount)}var G=f0("COUNT("+cR+".id) AS 'num'",[cR,cF],dU,cF+".deleted=0");F.executeSql(G,[],function(H,I){j._docCount=I.rows.item(0).num,E(j._docCount)})}var l,j=this,D=null,z=bW(y),i=[];j._docCount=-1,j._name=y.name;var q=eA.extend({},y,{size:z,version:b1}),u=dY(q);if(u.error){return dX(n)(u.error)}var h=u.db;"function"!=typeof h.readTransaction&&(h.readTransaction=h.transaction),p(),j.type=function(){return"websql"},j._id=fP(function(E){E(null,D)}),j._info=function(E){h.readTransaction(function(F){k(F,function(H){var G="SELECT MAX(seq) AS seq FROM "+cF;F.executeSql(G,[],function(K,I){var J=I.rows.item(0).seq||0;E(null,{doc_count:H,update_seq:J,sqlite_plugin:h._sqlitePlugin,websql_encoding:l})})})},dX(E))},j._bulkDocs=function(E,G,F){fB(y,E,G,j,h,bl,F)},j._get=function(E,I,M){function J(){M(G,{doc:K,metadata:N,ctx:L})}var K,N,G,L=I.ctx;if(!L){return h.readTransaction(function(O){j._get(E,eA.extend({ctx:O},I),M)})}var H,F;I.rev?(H=f0(kj,[cR,cF],cR+".id="+cF+".doc_id",[cF+".doc_id=?",cF+".rev=?"]),F=[E,I.rev]):(H=f0(kj,[cR,cF],dU,cR+".id=?"),F=[E]),L.executeSql(H,F,function(O,P){if(!P.rows.length){return G=f1(aA,"missing"),J()}var Q=P.rows.item(0);return N=eU(Q.metadata),Q.deleted&&!I.rev?(G=f1(aA,"deleted"),J()):(K=aH(Q.data,N.id,Q.rev),void J())})},j._allDocs=function(O,I){var F,P=[],R="startkey" in O?O.startkey:!1,L="endkey" in O?O.endkey:!1,G="key" in O?O.key:!1,J="descending" in O?O.descending:!1,H="limit" in O?O.limit:-1,E="skip" in O?O.skip:0,N=O.inclusive_end!==!1,K=[],Q=[];if(G!==!1){Q.push(cR+".id = ?"),K.push(G)}else{if(R!==!1||L!==!1){if(R!==!1&&(Q.push(cR+".id "+(J?"<=":">=")+" ?"),K.push(R)),L!==!1){var M=J?">":"<";N&&(M+="="),Q.push(cR+".id "+M+" ?"),K.push(L)}G!==!1&&(Q.push(cR+".id = ?"),K.push(G))}}"ok"!==O.deleted&&Q.push(cF+".deleted = 0"),h.readTransaction(function(S){k(S,function(T){if(F=T,0!==H){var U=f0(kj,[cR,cF],dU,Q,cR+".id "+(J?"DESC":"ASC"));U+=" LIMIT "+H+" OFFSET "+E,S.executeSql(U,K,function(ae,ao){for(var an=0,W=ao.rows.length;W>an;an++){var Z=ao.rows.item(an),ai=eU(Z.metadata),V=ai.id,Y=aH(Z.data,V,Z.rev),X=Y._rev,ar={id:V,key:V,value:{rev:X}};if(O.include_docs&&(ar.doc=Y,ar.doc._rev=X,O.conflicts&&(ar.doc._conflicts=eW(ai)),bY(ar.doc,O,j,ae)),Z.deleted){if("ok"!==O.deleted){continue}ar.value.deleted=!0,ar.doc=null}P.push(ar)}})}})},dX(I),function(){I(null,{total_rows:F,offset:O.skip,rows:P})})},j._changes=function(G){function H(){var S=cR+".json AS metadata, "+cR+".max_seq AS maxSeq, "+cF+".json AS winningDoc, "+cF+".rev AS winningRev ",T=cR+" JOIN "+cF,R=cR+".id="+cF+".doc_id AND "+cR+".winningseq="+cF+".seq",Q=["maxSeq > ?"],N=[G.since];G.doc_ids&&(Q.push(cR+".id IN "+a8(G.doc_ids.length)),N=N.concat(G.doc_ids));var U="maxSeq "+(L?"DESC":"ASC"),O=f0(S,T,R,Q,U),M=eF(G);G.view||G.filter||(O+=" LIMIT "+I);var P=G.since||0;h.readTransaction(function(V){V.executeSql(O,N,function(Z,ai){function Y(a0){return function(){G.onChange(a0)}}for(var W=0,ar=ai.rows.length;ar>W;W++){var ao=ai.rows.item(W),an=eU(ao.metadata);P=ao.maxSeq;var ae=aH(ao.winningDoc,an.id,ao.winningRev),X=G.processChange(ae,an,G);X.seq=ao.maxSeq;var at=M(X);if("object"==typeof at){return G.complete(at)}if(at&&(K++,F&&E.push(X),G.attachments&&G.include_docs?bY(ae,G,j,Z,Y(X)):Y(X)()),K===I){break}}})},dX(G.complete),function(){G.continuous||G.complete(null,{results:E,last_seq:P})})}if(G=cl(G),G.continuous){var J=j._name+":"+f9();return bl.addListener(j._name,J,j,G),bl.notify(j._name),{cancel:function(){bl.removeListener(j._name,J)}}}var L=G.descending;G.since=G.since&&!L?G.since:0;var I="limit" in G?G.limit:-1;0===I&&(I=1);var F;F="return_docs" in G?G.return_docs:"returnDocs" in G?G.returnDocs:!0;var E=[],K=0;H()},j._close=function(E){E()},j._getAttachment=function(G,H,J){var L,I=H.ctx,F=G.digest,E=G.content_type,K="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+bb+" WHERE digest=?";I.executeSql(K,[F],function(P,M){var N=M.rows.item(0),O=N.escaped?ch(N.body):cv(N.body,l);L=H.binary?bX(O,E):jY(O),J(null,L)})},j._getRevisionTree=function(F,E){h.readTransaction(function(H){var G="SELECT json AS metadata FROM "+cR+" WHERE id = ?";H.executeSql(G,[F],function(I,J){if(J.rows.length){var K=eU(J.rows.item(0).metadata);E(null,K.rev_tree)}else{E(f1(aA))}})})},j._doCompaction=function(F,E,G){return E.length?void h.transaction(function(I){var H="SELECT json AS metadata FROM "+cR+" WHERE id = ?";I.executeSql(H,[F],function(K,M){var J=eU(M.rows.item(0).metadata);jU(J.rev_tree,function(O,Q,N,P,S){var R=Q+"-"+N;-1!==E.indexOf(R)&&(S.status="missing")});var L="UPDATE "+cR+" SET json = ? WHERE id = ?";K.executeSql(L,[dW(J),F])}),bB(E,F,I)},dX(G),function(){G()}):G()},j._getLocal=function(F,E){h.readTransaction(function(H){var G="SELECT json, rev FROM "+bi+" WHERE id=?";H.executeSql(G,[F],function(J,L){if(L.rows.length){var I=L.rows.item(0),K=aH(I.json,F,I.rev);E(null,K)}else{E(f1(aA))}})})},j._putLocal=function(G,J,E){function L(N){var P,O;F?(P="UPDATE "+bi+" SET rev=?, json=? WHERE id=? AND rev=?",O=[M,I,H,F]):(P="INSERT INTO "+bi+" (id, rev, json) VALUES (?,?,?)",O=[H,M,I]),N.executeSql(P,O,function(R,Q){Q.rowsAffected?(K={ok:!0,id:H,rev:M},J.ctx&&E(null,K)):E(f1(aO))},function(){return E(f1(aO)),!1})}"function"==typeof J&&(E=J,J={}),delete G._revisions;var M,F=G._rev,H=G._id;M=F?G._rev="0-"+(parseInt(F.split("-")[1],10)+1):G._rev="0-1";var K,I=cN(G);J.ctx?L(J.ctx):h.transaction(L,dX(E),function(){K&&E(null,K)})},j._removeLocal=function(G,E,I){function F(L){var K="DELETE FROM "+bi+" WHERE id=? AND rev=?",J=[G._id,G._rev];L.executeSql(K,J,function(N,M){return M.rowsAffected?(H={ok:!0,id:G._id,rev:"0-0"},void (E.ctx&&I(null,H))):I(f1(aA))})}"function"==typeof E&&(I=E,E={});var H;E.ctx?F(E.ctx):h.transaction(F,dX(I),function(){H&&I(null,H)})},j._destroy=function(F,E){bl.removeAllListeners(j._name),h.transaction(function(H){var G=[cR,cF,bb,cz,bi,jR];G.forEach(function(I){H.executeSql("DROP TABLE IF EXISTS "+I,[])})},dX(E),function(){fO()&&(delete window.localStorage["_pouch__websqldb_"+j._name],delete window.localStorage[j._name]),E(null,{ok:!0})})}}var eA=d(7),cT=dJ(eA),aG=dJ(d(2)),eM=dJ(d(6)),du=dJ(d(8)),dS=d(12),ap=dJ(d(1)),aS=d(4),f5=dJ(d(14)),b0=d(10),bO=dJ(b0),b6=dJ(d(15)),j9=dJ(d(16)),e7="function"==typeof Promise?Promise:du,b4=aG("pouchdb:api");eM(jT,Error),jT.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var e=new jT({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),em=new jT({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),aA=new jT({status:404,error:"not_found",reason:"missing"}),aO=new jT({status:409,error:"conflict",reason:"Document update conflict"}),j6=new jT({status:400,error:"invalid_id",reason:"_id field must contain a string"}),cx=new jT({status:412,error:"missing_id",reason:"_id is required for puts"}),dM=new jT({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),eH=new jT({status:412,error:"precondition_failed",reason:"Database not open"}),aW=new jT({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),d6=new jT({status:500,error:"badarg",reason:"Some query argument is invalid"}),cc=new jT({status:400,error:"invalid_request",reason:"Request was invalid"}),ef=new jT({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),aI=new jT({status:500,error:"doc_validation",reason:"Bad special document member"}),aE=new jT({status:400,error:"bad_request",reason:"Something wrong with the request"}),dT=new jT({status:400,error:"bad_request",reason:"Document must be a JSON object"}),bU=new jT({status:404,error:"not_found",reason:"Database not found"}),dc=new jT({status:500,error:"indexed_db_went_bad",reason:"unknown"}),kb=new jT({status:500,error:"web_sql_went_bad",reason:"unknown"}),cW=new jT({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),aV=new jT({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),bw=new jT({status:400,error:"bad_request",reason:"Invalid rev format"}),bC=new jT({status:412,error:"file_exists",reason:"The database could not be created, the file already exists."}),dE=new jT({status:412,error:"missing_stub"}),c0=new jT({status:413,error:"invalid_url",reason:"Provided URL is invalid"}),c2={UNAUTHORIZED:e,MISSING_BULK_DOCS:em,MISSING_DOC:aA,REV_CONFLICT:aO,INVALID_ID:j6,MISSING_ID:cx,RESERVED_ID:dM,NOT_OPEN:eH,UNKNOWN_ERROR:aW,BAD_ARG:d6,INVALID_REQUEST:cc,QUERY_PARSE_ERROR:ef,DOC_VALIDATION:aI,BAD_REQUEST:aE,NOT_AN_OBJECT:dT,DB_MISSING:bU,WSQ_ERROR:kb,LDB_ERROR:cW,FORBIDDEN:aV,INVALID_REV:bw,FILE_EXISTS:bC,MISSING_STUB:dE,IDB_ERROR:dc,INVALID_URL:c0},jL=function(g,j,i){var k=Object.keys(c2).filter(function(m){var l=c2[m];return"function"!=typeof l&&l[g]===j}),h=i&&k.filter(function(m){var l=c2[m];return l.message===i})[0]||k[0];return h?c2[h]:null};eM(d5,aS.EventEmitter),d5.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},d5.prototype.doChanges=function(g){var j=this,i=g.complete;if(g=cl(g),"live" in g&&!("continuous" in g)&&(g.continuous=g.live),g.processChange=eL,"latest"===g.since&&(g.since="now"),g.since||(g.since=0),"now"===g.since){return void this.db.info().then(function(l){return j.isCancelled?void i(null,{status:"cancelled"}):(g.since=l.update_seq,void j.doChanges(g))},i)}if(g.continuous&&"now"!==g.since&&this.db.info().then(function(l){j.startSeq=l.update_seq},function(l){if("idbNull"!==l.id){throw l}}),g.filter&&"string"==typeof g.filter&&("_view"===g.filter?g.view=f4(g.view):g.filter=f4(g.filter),"http"!==this.db.type()&&!g.doc_ids)){return this.filterChanges(g)}"descending" in g||(g.descending=!1),g.limit=0===g.limit?1:g.limit,g.complete=i;var k=this.db._changes(g);if(k&&"function"==typeof k.cancel){var h=j.cancel;j.cancel=ap(function(l){k.cancel(),h.apply(this,l)})}},d5.prototype.filterChanges=function(h){var k=this,j=h.complete;if("_view"===h.filter){if(!h.view||"string"!=typeof h.view){var l=f1(aE,"`view` filter parameter not found or invalid.");return j(l)}var i=cX(h.view);this.db.getView(i[0],i[1],function(n,m){return k.isCancelled?j(null,{status:"cancelled"}):n?j(ba(n)):m.map?(h.filter=bx(m.map),void k.doChanges(h)):j(f1(aA))})}else{var g=cX(h.filter);if(!g){return k.doChanges(h)}this.db.getFilter(g[0],g[1],function(n,m){return k.isCancelled?j(null,{status:"cancelled"}):n?j(ba(n)):(h.filter=ab(m),void k.doChanges(h))})}};var bd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d2=ea(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),eG=ea(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);eM(ek,aS.EventEmitter),ek.prototype.post=bG("post",function(h,g,i){return"function"==typeof g&&(i=g,g={}),"object"!=typeof h||Array.isArray(h)?i(f1(dT)):void this.bulkDocs({docs:[h]},g,bH(i))}),ek.prototype.put=bG("put",ap(function(j){var m,g,i,k,l=j.shift(),h="_id" in l;if("object"!=typeof l||Array.isArray(l)){return(k=j.pop())(f1(dT))}for(;;){if(m=j.shift(),g=typeof m,"string"!==g||h?"string"!==g||!h||"_rev" in l?"object"===g?i=m:"function"===g&&(k=m):l._rev=m:(l._id=m,h=!0),!j.length){break}}return i=i||{},jP(l._id),f8(l._id)&&"function"==typeof this._putLocal?l._deleted?this._removeLocal(l,k):this._putLocal(l,k):void this.bulkDocs({docs:[l]},i,bH(k))})),ek.prototype.putAttachment=bG("putAttachment",function(j,m,g,i,k){function l(n){var o="_rev" in n?parseInt(n._rev,10):0;return n._attachments=n._attachments||{},n._attachments[m]={content_type:k,data:i,revpos:++o},h.put(n)}var h=this;return"function"==typeof k&&(k=i,i=g,g=null),"undefined"==typeof k&&(k=i,i=g,g=null),h.get(j).then(function(n){if(n._rev!==g){throw f1(aO)}return l(n)},function(n){if(n.reason===aA.message){return l({_id:j})}throw n})}),ek.prototype.removeAttachment=bG("removeAttachment",function(g,j,i,k){var h=this;h.get(g,function(m,l){return m?void k(m):l._rev!==i?void k(f1(aO)):l._attachments?(delete l._attachments[j],0===Object.keys(l._attachments).length&&delete l._attachments,void h.put(l,k)):k()})}),ek.prototype.remove=bG("remove",function(h,k,j,l){var i;"string"==typeof k?(i={_id:h,_rev:k},"function"==typeof j&&(l=j,j={})):(i=h,"function"==typeof k?(l=k,j={}):(l=j,j=k)),j=j||{},j.was_delete=!0;var g={_id:i._id,_rev:i._rev||j.rev};return g._deleted=!0,f8(g._id)&&"function"==typeof this._removeLocal?this._removeLocal(i,l):void this.bulkDocs({docs:[g]},j,bH(l))}),ek.prototype.revsDiff=bG("revsDiff",function(n,g,k){function h(o,p){l.has(o)||l.set(o,{missing:[]}),l.get(o).missing.push(p)}function i(q,p){var o=n[q].slice(0);jU(p,function(w,v,s,x,u){var r=v+"-"+s,y=o.indexOf(r);-1!==y&&(o.splice(y,1),"available"!==u.status&&h(q,r))}),o.forEach(function(r){h(q,r)})}"function"==typeof g&&(k=g,g={});var j=Object.keys(n);if(!j.length){return k(null,{})}var m=0,l=new dS.Map;j.map(function(o){this._getRevisionTree(o,function(q,p){if(q&&404===q.status&&"missing"===q.message){l.set(o,{missing:n[o]})}else{if(q){return k(q)}i(o,p)}if(++m===j.length){var r={};return l.forEach(function(u,s){r[s]=u}),k(null,r)}})},this)}),ek.prototype.bulkGet=bG("bulkGet",function(g,h){eJ(this,g,h)}),ek.prototype.compactDocument=bG("compactDocument",function(h,j,i){var g=this;this._getRevisionTree(h,function(m,k){if(m){return i(m)}var n=j8(k),l=[],o=[];Object.keys(n).forEach(function(p){n[p]>j&&l.push(p)}),jU(k,function(p,u,r,v,q){var s=u+"-"+r;"available"===q.status&&-1!==l.indexOf(s)&&o.push(s)}),g._doCompaction(h,o,i)})}),ek.prototype.compact=bG("compact",function(h,g){"function"==typeof h&&(g=h,h={});var i=this;h=h||{},i._compactionQueue=i._compactionQueue||[],i._compactionQueue.push({opts:h,callback:g}),1===i._compactionQueue.length&&dK(i)}),ek.prototype._compact=function(j,m){function g(n){h.push(k.compactDocument(n.id,0))}function i(n){var o=n.last_seq;e7.all(h).then(function(){return t(k,"_local/compaction",function(p){return !p.last_seq||p.last_seq<o?(p.last_seq=o,p):!1})}).then(function(){m(null,{ok:!0})})["catch"](m)}var k=this,l={return_docs:!1,last_seq:j.last_seq||0},h=[];k.changes(l).on("change",g).on("complete",i).on("error",m)},ek.prototype.get=bG("get",function(n,g,k){function h(){var o=[],p=i.length;return p?void i.forEach(function(q){j.get(n,{rev:q,revs:g.revs,attachments:g.attachments},function(s,r){s?o.push({missing:q}):o.push({ok:r}),p--,p||k(null,o)})}):k(null,o)}if("function"==typeof g&&(k=g,g={}),"string"!=typeof n){return k(f1(j6))}if(f8(n)&&"function"==typeof this._getLocal){return this._getLocal(n,k)}var i=[],j=this;if(!g.open_revs){return this._get(n,g,function(v,w){if(v){return k(v)}var u=w.doc,y=w.metadata,B=w.ctx;if(g.conflicts){var p=eW(y);p.length&&(u._conflicts=p)}if(eE(y,u._rev)&&(u._deleted=!0),g.revs||g.revs_info){var A=cU(y.rev_tree),r=jF(A,function(D){return -1!==D.ids.map(function(E){return E.id}).indexOf(u._rev.split("-")[1])}),q=r.ids.map(function(D){return D.id}).indexOf(u._rev.split("-")[1])+1,z=r.ids.length-q;if(r.ids.splice(q,z),r.ids.reverse(),g.revs&&(u._revisions={start:r.pos+r.ids.length-1,ids:r.ids.map(function(D){return D.id})}),g.revs_info){var s=r.pos+r.ids.length;u._revs_info=r.ids.map(function(D){return s--,{rev:s+"-"+D.id,status:D.opts.status}})}}if(g.attachments&&u._attachments){var x=u._attachments,o=Object.keys(x).length;if(0===o){return k(null,u)}Object.keys(x).forEach(function(D){this._getAttachment(x[D],{binary:g.binary,ctx:B},function(F,G){var E=u._attachments[D];E.data=G,delete E.stub,delete E.length,--o||k(null,u)})},j)}else{if(u._attachments){for(var C in u._attachments){u._attachments.hasOwnProperty(C)&&(u._attachments[C].stub=!0)}}k(null,u)}})}if("all"===g.open_revs){this._getRevisionTree(n,function(o,p){return o?k(o):(i=d7(p).map(function(q){return q.rev}),void h())})}else{if(!Array.isArray(g.open_revs)){return k(f1(aW,"function_clause"))}i=g.open_revs;for(var m=0;m<i.length;m++){var l=i[m];if("string"!=typeof l||!/^\d+-/.test(l)){return k(f1(bw))}}h()}}),ek.prototype.getView=bG("getView",function(h,g,i){bD(this,h,"views",g,i)}),ek.prototype.getFilter=bG("getFilter",function(h,g,i){bD(this,h,"filters",g,i)}),ek.prototype.getAttachment=bG("getAttachment",function(g,j,i,k){var h=this;i instanceof Function&&(k=i,i={}),this._get(g,i,function(m,l){return m?k(m):l.doc._attachments&&l.doc._attachments[j]?(i.ctx=l.ctx,i.binary=!0,h._getAttachment(l.doc._attachments[j],i,k),void 0):k(f1(aA))})}),ek.prototype.allDocs=bG("allDocs",function(h,g){if("function"==typeof h&&(g=h,h={}),h.skip="undefined"!=typeof h.skip?h.skip:0,h.start_key&&(h.startkey=h.start_key),h.end_key&&(h.endkey=h.end_key),"keys" in h){if(!Array.isArray(h.keys)){return g(new TypeError("options.keys must be an array"))}var i=["startkey","endkey","key"].filter(function(j){return j in h})[0];if(i){return void g(f1(ef,"Query parameter `"+i+"` is not compatible with multi-get"))}if("http"!==this.type()){return bs(this,h,g)}}return this._allDocs(h,g)}),ek.prototype.changes=function(g,h){return"function"==typeof g&&(h=g,g={}),new d5(this,g,h)},ek.prototype.close=bG("close",function(g){return this._closed=!0,this._close(g)}),ek.prototype.info=bG("info",function(g){var h=this;this._info(function(j,i){return j?g(j):(i.db_name=i.db_name||h._db_name,i.auto_compaction=!(!h.auto_compaction||"http"===h.type()),i.adapter=h.type(),void g(null,i))})}),ek.prototype.id=bG("id",function(g){return this._id(g)}),ek.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},ek.prototype.bulkDocs=bG("bulkDocs",function(g,j,i){if("function"==typeof j&&(i=j,j={}),j=j||{},Array.isArray(g)&&(g={docs:g}),!g||!g.docs||!Array.isArray(g.docs)){return i(f1(em))}for(var k=0;k<g.docs.length;++k){if("object"!=typeof g.docs[k]||Array.isArray(g.docs[k])){return i(f1(dT))}}var h;return g.docs.forEach(function(l){l._attachments&&Object.keys(l._attachments).forEach(function(m){h=h||j0(m)})}),h?i(f1(aE,h)):("new_edits" in j||("new_edits" in g?j.new_edits=g.new_edits:j.new_edits=!0),j.new_edits||"http"===this.type()||g.docs.sort(bN),ec(g.docs),this._bulkDocs(g,j,function(m,l){return m?i(m):(j.new_edits||(l=l.filter(function(n){return n.error})),void i(null,l))}))}),ek.prototype.registerDependentDatabase=bG("registerDependentDatabase",function(h,j){function i(k){return k.dependentDbs=k.dependentDbs||{},k.dependentDbs[h]?!1:(k.dependentDbs[h]=!0,k)}var g=new this.constructor(h,this.__opts);t(this,"_local/_pouch_dependentDbs",i).then(function(){j(null,{db:g})})["catch"](j)}),ek.prototype.destroy=bG("destroy",function(g,j){function i(){k._destroy(g,function(l,m){return l?j(l):(k._destroyed=!0,k.emit("destroyed"),void j(null,m||{ok:!0}))})}"function"==typeof g&&(j=g,g={});var k=this,h="use_prefix" in k?k.use_prefix:!0;return"http"===k.type()?i():void k.get("_local/_pouch_dependentDbs",function(n,l){if(n){return 404!==n.status?j(n):i()}var o=l.dependentDbs,m=k.constructor,p=Object.keys(o).map(function(r){var q=h?r.replace(new RegExp("^"+m.prefix),""):r;return new m(q,k.__opts).destroy()});e7.all(p).then(i,j)})}),cd.prototype.execute=function(){var g;if(this.failed){for(;g=this.queue.shift();){g(this.failed)}}else{for(;g=this.queue.shift();){g()}}},cd.prototype.fail=function(g){this.failed=g,this.execute()},cd.prototype.ready=function(g){this.isReady=!0,this.db=g,this.execute()},cd.prototype.addTask=function(g){this.queue.push(g),this.failed&&this.execute()},eM(bL,ek),bL.debug=aG;var d3;if(dz()){d3=!1}else{try{localStorage.setItem("_pouch_check_localstorage",1),d3=!!localStorage.getItem("_pouch_check_localstorage")}catch(j1){d3=!1}}bL.adapters={},bL.preferredAdapters=[],bL.prefix="_pouch_";var kg=new aS.EventEmitter;f2(bL),bL.parseAdapter=function(n,g){var k,h,i=n.match(/([a-z\-]*):\/\/(.*)/);if(i){if(n=/http(s?)/.test(i[1])?i[1]+"://"+i[2]:i[2],k=i[1],!bL.adapters[k].valid()){throw"Invalid adapter"}return{name:n,adapter:i[1]}}var j="idb" in bL.adapters&&"websql" in bL.adapters&&fO()&&localStorage["_pouch__websqldb_"+bL.prefix+n];if(g.adapter){h=g.adapter}else{if("undefined"!=typeof g&&g.db){h="leveldb"}else{for(var m=0;m<bL.preferredAdapters.length;++m){if(h=bL.preferredAdapters[m],h in bL.adapters){if(j&&"idb"===h){console.log('PouchDB is downgrading "'+n+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}}}}k=bL.adapters[h];var l=k&&"use_prefix" in k?k.use_prefix:!0;return{name:l?bL.prefix+n:n,adapter:h}},bL.adapter=function(h,g,i){g.valid()&&(bL.adapters[h]=g,i&&bL.preferredAdapters.push(h))},bL.plugin=function(g){return Object.keys(g).forEach(function(h){bL.prototype[h]=g[h]}),bL},bL.defaults=function(g){function h(k,i,j){return this instanceof h?("function"!=typeof i&&"undefined"!=typeof i||(j=i,i={}),k&&"object"==typeof k&&(i=k,k=void 0),i=eA.extend({},g,i),void bL.call(this,k,i,j)):new h(k,i,j)}return eM(h,bL),f2(h),h.preferredAdapters=bL.preferredAdapters.slice(),Object.keys(bL).forEach(function(i){i in h||(h[i]=bL[i])}),h};var c8=aT(),fD=function(){},bk=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],dH="queryKey",au=/(?:^|&)([^&=]*)=?([^&]*)/g,cy=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,dZ=function(g){return atob(g)},jY=function(g){return btoa(g)},bu=cT.extend,bS={ajax:ke,parseUri:bp,uuid:f9,Promise:e7,atob:dZ,btoa:jY,binaryStringToBlobOrBuffer:bX,clone:cl,extend:bu,createError:f1},ck=bO.collate,d4=1,aQ="pouchdb",c6=5,a9=0;al.prototype.writeCheckpoint=function(h,g){var i=this;return this.updateTarget(h,g).then(function(){return i.updateSource(h,g)})},al.prototype.updateTarget=function(g,h){return bK(this.target,this.id,g,h,this.returnValue)},al.prototype.updateSource=function(h,g){var i=this;return this.readOnlySource?e7.resolve(!0):bK(this.src,this.id,h,g,this.returnValue)["catch"](function(j){if(aU(j)){return i.readOnlySource=!0,!0}throw j})};var dN={undefined:function(g,h){return 0===ck(g.last_seq,h.last_seq)?h.last_seq:0},1:function(g,h){return d9(h,g).last_seq}};al.prototype.getCheckpoint=function(){var g=this;return g.target.get(g.id).then(function(h){return g.readOnlySource?e7.resolve(h.last_seq):g.src.get(g.id).then(function(i){if(h.version!==i.version){return a9}var j;return j=h.version?h.version.toString():"undefined",j in dN?dN[j](h,i):a9},function(i){if(404===i.status&&h.last_seq){return g.src.put({_id:g.id,last_seq:a9}).then(function(){return a9},function(j){return aU(j)?(g.readOnlySource=!0,h.last_seq):a9})}throw i})})["catch"](function(h){if(404!==h.status){throw h}return a9})};var bc=0,bI=dQ.setImmediate||dQ.setTimeout,aP=32768,jS=fP(function(h,j){function o(){var q=k*g,u=q+g;if(k++,i>k){p(n,h,q,u),bI(o)}else{p(n,h,q,u);var r=n.end(!0),s=ag(r);j(null,s),n.destroy()}}var l="string"==typeof h,m=l?h.length:h.byteLength,g=Math.min(aP,m),i=Math.ceil(m/g),k=0,n=l?new b6:new b6.ArrayBuffer,p=l?av:cp;o()});eM(eb,aS.EventEmitter),eb.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},eb.prototype.ready=function(g,j){function i(){h.cancel()}function k(){g.removeListener("destroyed",i),j.removeListener("destroyed",i)}var h=this;h._readyCalled||(h._readyCalled=!0,g.once("destroyed",i),j.once("destroyed",i),h.once("complete",k))};var dq={replicate:eS,toPouch:kf},eY=dq.replicate;eM(bj,aS.EventEmitter),bj.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};var eV=25,cm=50,aC={},aZ=1800,bM=aG("pouchdb:http");b7.valid=function(){return !0},fE.prototype.add=function(g){return this.promise=this.promise["catch"](function(){}).then(function(){return g()}),this.promise},fE.prototype.finish=function(){return this.promise};var by,f3=function(g,h){return h&&g.then(function(i){df.nextTick(function(){h(null,i)})},function(i){df.nextTick(function(){h(i)})}),g},fJ=function(g){return ap(function(h){var j=h.pop(),i=g.apply(this,h);return"function"==typeof j&&f3(i,j),i})},cS=function(g,h){return g.then(function(i){return h().then(function(){return i})},function(i){return h().then(function(){throw i})})},dg=function(g,h){return function(){var j=arguments,i=this;return g.add(function(){return h.apply(i,j)})}},eR=function(h){for(var k={},j=0,l=h.length;l>j;j++){k["$"+h[j]]=!0}var i=Object.keys(k),g=new Array(i.length);for(j=0,l=i.length;l>j;j++){g[j]=i[j].substring(1)}return g},dP={uniq:eR,sequentialize:dg,fin:cS,callbackify:fJ,promisedCallback:f3},cJ=bO.collate,cA=bO.toIndexableString,dC=bO.normalizeKey,ej=bO.parseIndexableString;by="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var cP=dP.callbackify,j2=dP.sequentialize,cC=dP.uniq,f7=dP.fin,dO=dP.promisedCallback,e0={},eZ=new fE,cL=50,jM={_sum:function(g,h){return ca(h)},_count:function(g,h){return h.length},_stats:function(h,g){function i(j){for(var m=0,l=0,n=j.length;n>l;l++){var k=j[l];m+=k*k}return m}return{sum:ca(g),min:Math.min.apply(null,g),max:Math.max.apply(null,g),count:g.length,sumsqr:i(g)}}},eN=cP(function(){var g=this;return g._ddocCache&&delete g._ddocCache,"http"===g.type()?jK(g):"function"==typeof g._viewCleanup?cK(g):dp(g)}),ax=function(g,j,i){"function"==typeof j&&(i=j,j={}),j=j?cZ(j):{},"function"==typeof g&&(g={map:g});var k=this,h=e7.resolve().then(function(){return aK(k,g,j)});return dO(h,i),h};eM(eX,Error),eM(dw,Error);var cO={query:ax,viewCleanup:eN},dI=5,jV="document-store",cb="by-sequence",aX="attach-store",bF="attach-seq-store",c9="meta-store",fC="local-store",cu="detect-blob-support",bJ={running:!1,queue:[]};eM(c7,aS.EventEmitter),c7.prototype.addListener=function(i,h,k,m){function j(){function n(){l=!1}if(g._listeners[h]){if(l){return void (l="waiting")}l=!0;var o=dv(m,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);k.changes(o).on("change",function(p){p.seq>m.since&&!m.cancelled&&(m.since=p.seq,m.onChange(p))}).on("complete",function(){"waiting"===l&&setTimeout(function(){j()},0),l=!1}).on("error",n)}}if(!this._listeners[h]){var g=this,l=!1;this._listeners[h]=j,this.on(i,j)}},c7.prototype.removeListener=function(g,h){h in this._listeners&&aS.EventEmitter.prototype.removeListener.call(this,g,this._listeners[h])},c7.prototype.notifyLocalWindows=function(g){dz()?chrome.storage.local.set({dbName:g}):fO()&&(localStorage[g]="a"===localStorage[g]?"b":"a")},c7.prototype.notify=function(g){this.emit(g),this.notifyLocalWindows(g)};var el,jO=new dS.Map,eQ=new c7,aD=new dS.Map;bQ.valid=function(){var g="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return !g&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var aY=7,cR=eP("document-store"),cF=eP("by-sequence"),bb=eP("attach-store"),bi=eP("local-store"),cz=eP("metadata-store"),jR=eP("attach-seq-store"),bV=new dS.Map,bl=new c7,b1=1,c1="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+cF+" (seq, deleted)",eT="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+cF+" (doc_id, rev)",cs="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+cR+" (winningseq)",cI="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+jR+" (seq)",bv="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+jR+" (digest, seq)",dU=cF+".seq = "+cR+".winningseq",kj=cF+".seq AS seq, "+cF+".deleted AS deleted, "+cF+".json AS data, "+cF+".rev AS rev, "+cR+".json AS metadata";dy.use_prefix=!("undefined"!=typeof df&&!df.browser),dy.valid=dR;var ak={idb:bQ,websql:dy};bL.ajax=ke,bL.utils=bS,bL.Errors=c2,bL.replicate=dq.replicate,bL.sync=ds,bL.version="5.3.2",bL.adapter("http",b7),bL.adapter("https",b7),bL.plugin(cO),Object.keys(ak).forEach(function(g){bL.adapter(g,ak[g],!0)}),c.exports=bL}).call(this,d(13),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,12:12,13:13,14:14,15:15,16:16,2:2,4:4,6:6,7:7,8:8}]},{},[17])(17)});